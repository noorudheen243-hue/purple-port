import{J as w,r as h,C as v,j as e,x as u}from"./index-CVFz3GnQ.js";import{u as D,i as P,F as S,j as d,Y as _,K as C}from"./index-MXZ1Fyy1.js";import{f as n}from"./format-D4js0obD.js";import{E as M}from"./jspdf.es.min-BjSK_EZa.js";import{a as k}from"./jspdf.plugin.autotable-CtA5BUKo.js";import{P as E}from"./printer-DRzDhpol.js";const G=()=>{const[l]=w(),[x,p]=h.useState(l.get("ledger_id")||""),[r,y]=h.useState({start:"",end:""}),[a,j]=h.useState(null),{data:i,isLoading:F}=D({queryKey:["ledgers"],queryFn:async()=>(await u.get("/accounting/ledgers")).data});v.useEffect(()=>{if(i){const t=l.get("ledger_id"),o=l.get("entity_id"),c=l.get("entity_type");if(t)p(t);else if(o&&c){const s=i.find(m=>m.entity_id===o&&m.entity_type===c);s&&p(s.id)}}},[i,l]);const g=P({mutationFn:async()=>u.post("/accounting/reports/statement",{ledger_id:x,start_date:r.start,end_date:r.end}),onSuccess:t=>{j(t.data)},onError:t=>alert("Failed to generate: "+t.message)}),b=()=>{window.print()},f=()=>{if(!a)return;const t=new M;t.setFontSize(18),t.text("Account Statement",14,22),t.setFontSize(11),t.text(`Account: ${a.ledger.name} (${a.ledger.head.name})`,14,32),t.text(`Period: ${d(new Date(a.period.start),"dd MMM yyyy")} to ${d(new Date(a.period.end),"dd MMM yyyy")}`,14,38),t.text(`Opening Balance: ${n(a.opening_balance)}`,14,44);const o=["Date","Description","Ref","Type","Debit","Credit","Balance"],c=[];a.transactions.forEach(s=>{const m=[d(new Date(s.date),"dd/MM/yyyy"),s.description,s.reference||"-",s.type,s.debit?n(s.debit):"-",s.credit?n(s.credit):"-",n(s.balance)];c.push(m)}),c.push(["","Closing Balance","","","","",n(a.closing_balance)]),k(t,{head:[o],body:c,startY:50}),t.save(`Statement_${a.ledger.name}_${d(new Date,"yyyyMMdd")}.pdf`)},N=()=>{alert("Email functionality is not configured yet.")};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center no-print",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Account Statement Generator"})}),e.jsxs("div",{className:"bg-card p-6 rounded-lg border space-y-4 no-print shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Select Account"}),e.jsxs("select",{className:"w-full bg-background border rounded-md px-3 py-2",value:x,onChange:t=>p(t.target.value),children:[e.jsx("option",{value:"",children:"Choose Ledger..."}),i==null?void 0:i.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.head.name,")"]},t.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"From Date"}),e.jsx("input",{type:"date",className:"w-full bg-background border rounded-md px-3 py-2",value:r.start,onChange:t=>y({...r,start:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"To Date"}),e.jsx("input",{type:"date",className:"w-full bg-background border rounded-md px-3 py-2",value:r.end,onChange:t=>y({...r,end:t.target.value})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>g.mutate(),disabled:!x||!r.start||!r.end||g.isPending,className:"bg-primary text-primary-foreground px-6 py-2 rounded-md hover:bg-primary/90 flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"})," ",g.isPending?"Generating...":"Generate Statement"]})})]}),a&&e.jsxs("div",{className:"bg-white text-black p-8 rounded-lg shadow-lg border printable-area",children:[e.jsxs("div",{className:"flex justify-between items-start border-b pb-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("img",{src:"/qix_logo.png",alt:"Qix Ads",className:"h-12 w-auto mb-4"}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Statement of Account"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[a.ledger.name," ",e.jsxs("span",{className:"text-sm text-gray-400 ml-2",children:["(",a.ledger.head.name,")"]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Generated on:"})," ",d(new Date,"PPpp")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Period:"})," ",d(new Date(a.period.start),"PP")," - ",d(new Date(a.period.end),"PP")]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mb-6 no-print",children:[e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-3 py-1.5 border rounded hover:bg-gray-50 text-sm",children:[e.jsx(E,{className:"w-4 h-4"})," Print"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-3 py-1.5 border rounded hover:bg-gray-50 text-sm",children:[e.jsx(_,{className:"w-4 h-4"})," Download PDF"]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-3 py-1.5 border rounded hover:bg-gray-50 text-sm",children:[e.jsx(C,{className:"w-4 h-4"})," Email"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 uppercase tracking-wider",children:"Opening Balance"}),e.jsx("p",{className:"text-lg font-mono font-medium",children:n(a.opening_balance)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm text-gray-500 uppercase tracking-wider",children:"Closing Balance"}),e.jsx("p",{className:"text-2xl font-mono font-bold text-primary",children:n(a.closing_balance)})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3",children:"Description"}),e.jsx("th",{className:"px-4 py-3",children:"Ref"}),e.jsx("th",{className:"px-4 py-3",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Debit"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Credit"}),e.jsx("th",{className:"px-4 py-3 text-right text-gray-900",children:"Balance"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:a.transactions.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"No transactions found in this period."})}):a.transactions.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:d(new Date(t.date),"dd/MM/yyyy")}),e.jsx("td",{className:"px-4 py-3",children:t.description}),e.jsx("td",{className:"px-4 py-3 text-gray-500 font-mono text-xs",children:t.reference||"-"}),e.jsx("td",{className:"px-4 py-3 text-xs uppercase badge",children:t.type}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-gray-600",children:t.debit?n(t.debit):"-"}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-gray-600",children:t.credit?n(t.credit):"-"}),e.jsx("td",{className:"px-4 py-3 text-right font-mono font-medium",children:n(t.balance)})]},t.id))})]})}),e.jsx("div",{className:"mt-12 pt-8 border-t text-center text-xs text-gray-400",children:e.jsx("p",{children:"Generated by Qix Ads ERP System"})})]}),e.jsx("style",{children:`
                @media print {
                    .no-print { display: none !important; }
                    .printable-area { 
                        position: absolute; 
                        top: 0; 
                        left: 0; 
                        width: 100%; 
                        height: 100%; 
                        margin: 0; 
                        padding: 20px;
                        border: none;
                        box-shadow: none;
                    }
                    body { background: white; }
                }
            `})]})};export{G as default};
