import{q as D,u as R,J as q,r as h,x,j as e}from"./index-CVFz3GnQ.js";import{u as g,i as _,S as p,$ as I,F as b,B as i}from"./index-MXZ1Fyy1.js";import{C as P}from"./card-L7c9AA96.js";import{B as f}from"./badge-DB3i4Vcz.js";import{A as j}from"./alert-circle-DVBvcfOk.js";import{C as v}from"./check-circle-C7q7Y3EO.js";import{E as F}from"./external-link-CrZT27eC.js";import{X as V}from"./x-circle--Q6_SlDM.js";const J=({clientIdProp:o})=>{const N=D(),{user:t}=R(),[y]=q(),[d,w]=h.useState({}),l=(t==null?void 0:t.role)==="ADMIN"||(t==null?void 0:t.role)==="MANAGER"||(t==null?void 0:t.role)==="DEVELOPER_ADMIN",[C,E]=h.useState(null),k=y.get("clientId"),r=o||(l?C||k:t==null?void 0:t.linked_client_id),{data:c}=g({queryKey:["clients-list-simple"],queryFn:async()=>(await x.get("/clients")).data,enabled:l&&!o}),{data:u=[],isLoading:A}=g({queryKey:["client-approvals",r],queryFn:async()=>{if(l&&!r)return[];const{data:s}=await x.get(`/client-portal/approvals?clientId=${r||""}`);return s.content||[]},enabled:!!r}),S=_({mutationFn:async({id:s,status:a,comment:n})=>{await x.patch(`/client-portal/approvals/${s}`,{status:a,feedback:n})},onSuccess:()=>{N.invalidateQueries({queryKey:["client-approvals"]}),p.fire({icon:"success",title:"Status Updated",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:s=>{var a,n;p.fire("Error",((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||"Update failed","error")}}),m=(s,a)=>{S.mutate({id:s,status:a,comment:d[s]})};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Pending Approvals"}),l&&r&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Viewing items for Client ID: ",r.substring(0,8),"..."]})]}),l&&!o&&e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsxs("select",{className:"w-full h-10 pl-3 pr-10 rounded-md border border-input bg-background text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",onChange:s=>E(s.target.value||null),value:r||"",children:[e.jsx("option",{value:"",children:"-- Select Client --"}),c==null?void 0:c.sort((s,a)=>s.name.localeCompare(a.name)).map(s=>e.jsxs("option",{value:s.id,children:[s.client_code?`${s.client_code} - `:"",s.name]},s.id))]}),e.jsx(I,{className:"absolute right-3 top-3 h-4 w-4 opacity-50 pointer-events-none"})]})]}),r?A?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[1,2].map(s=>e.jsx("div",{className:"h-48 bg-gray-100 animate-pulse rounded-lg"},s))}):e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-dashed",children:[e.jsx(v,{className:"mx-auto h-12 w-12 text-gray-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"All Caught Up!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No pending items requiring attention for this client."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:u.map(s=>e.jsx(P,{className:"overflow-hidden border-l-4 border-l-yellow-500 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"md:flex",children:[e.jsx("div",{className:"md:w-1/3 bg-gray-50/50 border-r p-6 flex items-center justify-center",children:s.link?e.jsxs("div",{className:"text-center space-y-3 w-full",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto ring-4 ring-blue-50",children:e.jsx(b,{size:24})}),e.jsxs("div",{className:"px-3",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-900 truncate max-w-full",title:s.title,children:s.title}),e.jsx("a",{href:s.link,target:"_blank",rel:"noreferrer",className:"inline-block mt-2",children:e.jsxs(i,{variant:"outline",size:"sm",className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:["View Deliverable ",e.jsx(F,{size:12,className:"ml-1"})]})})]})]}):e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx(b,{size:48,className:"mx-auto opacity-20"}),e.jsx("span",{className:"text-sm mt-2 block",children:"No Preview Link"})]})}),e.jsxs("div",{className:"md:w-2/3 p-6 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(f,{variant:"outline",className:"bg-white",children:s.type.replace("_"," ")}),e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 leading-tight",children:s.title})]}),e.jsx(f,{className:`border ${s.status==="APPROVED"?"bg-green-100 text-green-800 border-green-200":s.status==="REJECTED"?"bg-red-100 text-red-800 border-red-200":"bg-yellow-100 text-yellow-800 border-yellow-200"}`,children:s.status.replace("_"," ")})]}),s.notes&&e.jsxs("div",{className:"mb-4 bg-gray-50 p-3 rounded-lg text-sm text-gray-600 border relative",children:[e.jsx("span",{className:"absolute top-2 left-2 text-gray-300 text-xl font-serif",children:'"'}),e.jsx("p",{className:"px-2 italic",children:s.notes})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wider text-gray-500",children:"Your Feedback / Comments"}),e.jsx("textarea",{className:"w-full p-3 border rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none min-h-[80px] bg-white",placeholder:"Enter feedback prior to approval or rejection...",value:d[s.id]||"",onChange:a=>w({...d,[s.id]:a.target.value})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 mt-6 pt-4 border-t border-gray-100",children:[e.jsxs(i,{variant:"ghost",className:"text-red-600 hover:bg-red-50 hover:text-red-700",onClick:()=>m(s.id,"REJECTED"),children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Reject"]}),e.jsxs(i,{variant:"outline",className:"text-yellow-600 border-yellow-200 hover:bg-yellow-50",onClick:()=>m(s.id,"CHANGES_REQUESTED"),children:[e.jsx(j,{className:"mr-2 h-4 w-4"})," Request Changes"]}),e.jsxs(i,{className:"bg-green-600 hover:bg-green-700 text-white shadow-sm hover:shadow",onClick:()=>m(s.id,"APPROVED"),children:[e.jsx(v,{className:"mr-2 h-4 w-4"})," Approve"]})]})]})]})},s.id))})}):e.jsxs("div",{className:"p-12 text-center border-2 border-dashed rounded-xl bg-gray-50/50",children:[e.jsx(j,{className:"mx-auto h-12 w-12 text-gray-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Select a Client"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Please select a client from the dropdown to manage their approvals."})]})]})};export{J as default};
