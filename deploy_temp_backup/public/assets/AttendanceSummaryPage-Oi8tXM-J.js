import{v as ie,r as m,x as U,j as e}from"./index-CVFz3GnQ.js";import{u as I,w as xe}from"./xlsx-DrgRuPKf.js";import{E as me}from"./jspdf.es.min-BjSK_EZa.js";import"./jspdf.plugin.autotable-CtA5BUKo.js";import{C as V,a as z,b as B,c as Z}from"./card-L7c9AA96.js";import{C as ue,ak as K,I as he,B as w,Y as pe,f as fe,X as ge}from"./index-MXZ1Fyy1.js";import{S as T,a as C,b as k,c as H,d as S}from"./select-CRNC5CBq.js";import{T as q,a as P,b as y,c as h,d as W,e as u}from"./table-DEHLnAz_.js";import be from"./RegularisationPage-DfKy3r9D.js";import ye from"./BiometricDetailsPage-DfBGjrrj.js";import{C as je}from"./clipboard-list-B3GWzL3o.js";import{F as Ne}from"./file-spreadsheet-CnIqeaW4.js";import"./index-C_y8q7n2.js";import"./index-COFXZIMB.js";import"./label-BDi2E6m5.js";import"./badge-DB3i4Vcz.js";import"./textarea-D2C36G61.js";import"./clock-DRstIMdH.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=ie("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]),Ge=()=>{const $=new Date,[c,X]=m.useState(($.getMonth()+1).toString()),[d,J]=m.useState($.getFullYear().toString()),[p,Q]=m.useState([]),[A,ee]=m.useState([]),[M,O]=m.useState(!1),[i,j]=m.useState("REGISTER"),[F,te]=m.useState(""),[D,se]=m.useState("ALL"),[Y,_]=m.useState(!1),[G,N]=m.useState(!1);m.useEffect(()=>{const t=new Date(parseInt(d),parseInt(c),0).getDate();Q(Array.from({length:t},(s,a)=>a+1)),v()},[c,d]);const v=async()=>{O(!0);try{const{data:t}=await U.get(`/attendance/team-summary?month=${c}&year=${d}`);ee(t)}catch(t){console.error("Failed to fetch attendance summary",t)}finally{O(!1)}},ae=async()=>{var t,s;if(window.confirm("This will recalculate attendance status for ALL staff based on current shift assignments. Continue?")){_(!0);try{const{data:a}=await U.post("/attendance/recalculate-all");alert(a.message||"Recalculation complete"),v()}catch(a){alert("Recalculation failed: "+(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||a.message))}finally{_(!1)}}},f=A.filter(t=>{const s=t.user.name.toLowerCase().includes(F.toLowerCase()),a=D==="ALL"||t.user.department===D;return s&&a}),re=m.useMemo(()=>{const t=new Set;return A.forEach(s=>{s.user.department&&t.add(s.user.department)}),Array.from(t).sort()},[A]),le=()=>{N(!0);try{const t=`Attendance_${i}_${c}_${d}.xlsx`;let s=[];i==="SUMMARY"?s=f.map(r=>{const l=E(r);return{"Staff Name":r.user.name,Designation:r.user.designation,Department:r.user.department,"Total Days":l.totalDays,Holidays:l.totalHolidays,"Present (Effective)":l.totalPresentValue,"Half Days":l.totalHalfDaysCount,Leaves:l.totalLeaves,"LOP Days":l.totalLOP}}):s=f.map(r=>{const l={"Staff Name":r.user.name,Department:r.user.department};return p.forEach(x=>{const o=`${d}-${c.padStart(2,"0")}-${String(x).padStart(2,"0")}`,g=r.attendance[o];l[x]=g?g.status:new Date(parseInt(d),parseInt(c)-1,x)<new Date?"ABSENT":"-"}),l});const a=I.json_to_sheet(s),n=I.book_new();I.book_append_sheet(n,a,"Attendance"),xe(n,t)}catch(t){console.error("Export Failed",t),alert("Export Failed")}finally{N(!1)}},ne=()=>{N(!0);try{const t=new me("l","mm","a4"),s=new Date(0,parseInt(c)-1).toLocaleString("default",{month:"long"});if(t.setFontSize(18),t.text(`Attendance ${i==="SUMMARY"?"Summary":"Register"} - ${s} ${d}`,14,20),t.setFontSize(10),t.text(`Generated on: ${new Date().toLocaleString()}`,14,28),i==="SUMMARY"){const a=f.map(n=>{const r=E(n);return[n.user.name,n.user.department,r.totalDays,r.totalHolidays,r.totalPresentValue,r.totalHalfDaysCount,r.totalLeaves,r.totalLOP]});t.autoTable({startY:35,head:[["Name","Dept","Days","Hol","Pres","HD","Leave","LOP"]],body:a,theme:"grid",headStyles:{fillColor:[128,0,128]}})}else{const a=["Name",...p.map(String)],n=f.map(r=>[r.user.name,...p.map(l=>{const x=`${d}-${c.padStart(2,"0")}-${String(l).padStart(2,"0")}`,o=r.attendance[x];return o?o.status==="PRESENT"||o.status==="REGULARIZED"?"P":o.status==="HALF_DAY"?"HD":o.status==="ABSENT"?"AB":o.status==="LEAVE"?"L":o.status==="HOLIDAY"?"H":"?":"-"})]);t.autoTable({startY:35,head:[a],body:n,styles:{fontSize:6,cellPadding:1},headStyles:{fillColor:[128,0,128]},columnStyles:{0:{cellWidth:30}}})}t.save(`Attendance_${i}_${c}_${d}.pdf`)}catch(t){console.error("PDF Export Failed",t),alert("PDF Export Failed")}finally{N(!1)}},oe=(t,s,a)=>{const n=new Date(parseInt(d),parseInt(c)-1,s);if(n.getDay()===0)return e.jsx("div",{className:"flex items-center justify-center h-full text-blue-600 font-bold text-sm",children:"H"});if(t){if(t.status==="HOLIDAY")return e.jsx("div",{className:"flex items-center justify-center h-full text-blue-600 font-bold text-sm",children:"H"});if(t.status==="LEAVE"){let x=e.jsx(ge,{className:"h-4 w-4 text-red-600"});if(t.leave_type){const g={CASUAL:"CL",SICK:"SL",EARNED:"EL",UNPAID:"LOP",MATERNITY:"ML",PATERNITY:"PL",COMPENSATORY:"CO"}[t.leave_type]||"L";x=e.jsx("span",{className:"text-[10px] font-bold text-red-700",children:g})}return e.jsx("div",{className:"w-full h-full bg-red-100 flex items-center justify-center rounded border border-red-200",children:x})}if(t.status==="REGULARIZED")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-600",children:"REG"}),e.jsx(K,{className:"h-3 w-3 text-purple-600"})]});const l=t.status;return l==="HALF_DAY"?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("span",{className:"text-[10px] font-bold text-orange-600",children:"HD"}),e.jsx("span",{className:"text-[8px] text-muted-foreground",children:t.check_in?t.check_out?"Hours":"In Only":"Out Only"})]}):l==="PRESENT"||l==="LATE"||l==="REGULARIZED"?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(fe,{className:"h-5 w-5 text-green-600"})}):l==="ABSENT"?e.jsx("div",{className:"w-full h-full bg-red-100 flex items-center justify-center rounded text-red-600 font-bold text-xs",children:"AB"}):e.jsx("span",{children:l})}const r=new Date;return r.setHours(0,0,0,0),n<r?e.jsx("div",{className:"w-full h-full bg-red-100 flex items-center justify-center rounded text-red-600 font-bold text-xs",children:"AB"}):e.jsx("span",{className:"text-[9px] text-muted-foreground/50 whitespace-pre-wrap leading-tight block text-center",children:a&&a!=="Check Assignments"?a:"Pending Shift"})},ce=t=>{if(!t)return 0;const s=t.status;return s==="PRESENT"||s==="LATE"||s==="REGULARIZED"||s==="LEAVE"||s==="HOLIDAY"?1:s==="HALF_DAY"?.5:0},E=t=>{let s=0,a=0,n=0,r=0,l=0;return p.forEach(x=>{const o=new Date(parseInt(d),parseInt(c)-1,x),g=`${d}-${c.padStart(2,"0")}-${String(x).padStart(2,"0")}`;if(o.getDay()===0){s++;return}const L=t.attendance[g];if(L){const b=L.status,R=ce(L);b==="HOLIDAY"?s++:b==="LEAVE"?(n++,a+=R):b==="HALF_DAY"?(l++,a+=R):b==="ABSENT"?r++:a+=R}else{const b=new Date;b.setHours(0,0,0,0),o<b&&r++}}),{totalDays:p.length,totalHolidays:s,totalPresentValue:a,totalLeaves:n,totalLOP:r,totalHalfDaysCount:l}},de=Array.from({length:11},(t,s)=>2026+s);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-100",children:"Attendance Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor daily attendance and generate monthly summaries."})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-muted/40 p-2 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:()=>j("LOGS"),className:`px-4 py-2 text-sm font-bold rounded-md transition-all border ${i==="LOGS"?"bg-white text-yellow-700 border-yellow-500 shadow-sm ring-1 ring-yellow-100":"bg-white text-gray-600 border-gray-200 hover:bg-yellow-50 hover:text-yellow-700 hover:border-yellow-200"}`,children:[e.jsx(we,{className:"w-4 h-4 mr-2 inline-block"}),"Attendance Log"]}),e.jsxs("button",{onClick:()=>j("REGISTER"),className:`px-4 py-2 text-sm font-bold rounded-md transition-all border ${i==="REGISTER"?"bg-purple-700 text-white border-purple-800 shadow-md":"bg-white text-gray-600 border-gray-200 hover:bg-purple-50 hover:text-purple-700 hover:border-purple-200"}`,children:[e.jsx(ue,{className:"w-4 h-4 mr-2 inline-block"}),"Attendance Register"]}),e.jsxs("button",{onClick:()=>j("SUMMARY"),className:`px-4 py-2 text-sm font-bold rounded-md transition-all border ${i==="SUMMARY"?"bg-yellow-400 text-black border-yellow-500 shadow-md":"bg-white text-gray-600 border-gray-200 hover:bg-yellow-50 hover:text-yellow-700 hover:border-yellow-200"}`,children:[e.jsx(je,{className:"w-4 h-4 mr-2 inline-block"}),"Attendance Summary"]}),e.jsxs("button",{onClick:()=>j("REGULARIZATION"),className:`px-4 py-2 text-sm font-bold rounded-md transition-all border ${i==="REGULARIZATION"?"bg-white text-purple-700 border-purple-600 shadow-sm ring-1 ring-purple-100":"bg-white text-gray-600 border-gray-200 hover:bg-purple-50 hover:text-purple-700 hover:border-purple-200"}`,children:[e.jsx(K,{className:"w-4 h-4 mr-2 inline-block"}),"Attendance Regularization"]})]}),i!=="LOGS"&&i!=="REGULARIZATION"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"w-[150px]",children:e.jsx(he,{placeholder:"Filter by name...",value:F,onChange:t=>te(t.target.value),className:"h-9"})}),e.jsxs(T,{value:D,onValueChange:se,children:[e.jsx(C,{className:"w-[140px] h-9 bg-background",children:e.jsx(k,{placeholder:"Department"})}),e.jsxs(H,{children:[e.jsx(S,{value:"ALL",children:"All Depts"}),re.map(t=>e.jsx(S,{value:t,children:t},t))]})]}),e.jsx("div",{className:"h-6 w-px bg-border mx-1"}),e.jsxs(T,{value:c,onValueChange:X,children:[e.jsx(C,{className:"w-[120px] h-9 bg-background",children:e.jsx(k,{placeholder:"Month"})}),e.jsx(H,{children:Array.from({length:12},(t,s)=>e.jsx(S,{value:(s+1).toString(),children:new Date(0,s).toLocaleString("default",{month:"long"})},s+1))})]}),e.jsxs(T,{value:d,onValueChange:J,children:[e.jsx(C,{className:"w-[90px] h-9 bg-background",children:e.jsx(k,{placeholder:"Year"})}),e.jsx(H,{children:de.map(t=>e.jsx(S,{value:t.toString(),children:t},t))})]}),e.jsx(w,{variant:"outline",size:"sm",onClick:v,disabled:M,className:"h-9",children:M?"...":"Refresh"}),e.jsx(w,{variant:"destructive",size:"sm",onClick:ae,disabled:Y,className:"h-9 bg-red-600 hover:bg-red-700",children:Y?"Recalculating...":"Recalculate All"}),e.jsx("div",{className:"h-6 w-px bg-border mx-1"}),e.jsxs(w,{variant:"outline",size:"sm",onClick:le,disabled:G,className:"h-9 gap-1 text-green-700 border-green-200 hover:bg-green-50",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Excel"]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:ne,disabled:G,className:"h-9 gap-1 text-red-700 border-red-200 hover:bg-red-50",children:[e.jsx(pe,{className:"w-4 h-4"}),"PDF"]})]})]})]}),i==="REGISTER"&&e.jsxs(V,{className:"overflow-hidden shadow-lg border-t-4 border-t-purple-600",children:[e.jsx(z,{className:"bg-purple-50/50 pb-4",children:e.jsx(B,{className:"text-purple-900",children:"Monthly Register"})}),e.jsx(Z,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(q,{children:[e.jsx(P,{children:e.jsxs(y,{className:"bg-muted/50",children:[e.jsx(h,{className:"w-[250px] sticky left-0 bg-background z-20 font-bold border-r",children:"Staff Details"}),p.map(t=>{const s=new Date(parseInt(d),parseInt(c)-1,t),a=s.getDay()===0;return e.jsx(h,{className:`min-w-[45px] text-center p-1 border-l ${a?"bg-blue-50 text-blue-700":""}`,children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("span",{className:"font-bold",children:t}),e.jsx("span",{className:"text-[9px] uppercase",children:s.toLocaleDateString("en-US",{weekday:"narrow"})})]})},t)})]})}),e.jsx(W,{children:f.map((t,s)=>e.jsxs(y,{className:s%2===0?"bg-white":"bg-slate-50",children:[e.jsxs(u,{className:"sticky left-0 bg-inherit z-10 border-r py-3",children:[e.jsx("div",{className:"font-medium text-sm",children:t.user.name}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:t.user.designation})]}),p.map(a=>{const n=`${d}-${c.padStart(2,"0")}-${String(a).padStart(2,"0")}`,r=t.attendance[n],l=new Date(parseInt(d),parseInt(c)-1,a).getDay()===0;return e.jsx(u,{className:`p-0 text-center border-l h-12 ${l?"bg-blue-50/30":""}`,children:oe(r,a,t.user.shift)},a)})]},t.user.id))}),e.jsx(P,{className:"sticky bottom-0 bg-muted/80 z-30 font-bold border-t-2",children:e.jsxs(y,{children:[e.jsx(u,{className:"sticky left-0 bg-muted/90 z-40 border-r py-3 font-bold text-xs uppercase tracking-wider",children:"Daily Totals"}),p.map(t=>{const s=`${d}-${c.padStart(2,"0")}-${String(t).padStart(2,"0")}`,a=new Date(parseInt(d),parseInt(c)-1,t).getDay()===0;let n=0,r=0,l=0;return f.forEach(x=>{const o=x.attendance[s];!o&&!a?new Date(parseInt(d),parseInt(c)-1,t)<new Date&&l++:o&&(o.status==="LEAVE"?r++:o.status==="ABSENT"?l++:["PRESENT","LATE","REGULARIZED","HALF_DAY"].includes(o.status)&&(n+=o.status==="HALF_DAY"?.5:1))}),e.jsx(u,{className:`p-1 text-center border-l font-bold text-[10px] ${a?"bg-blue-100/50":""}`,children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[n>0&&e.jsxs("span",{className:"text-green-700",children:["P:",n]}),r>0&&e.jsxs("span",{className:"text-red-700",children:["L:",r]}),l>0&&e.jsxs("span",{className:"text-orange-700",children:["A:",l]})]})},t)})]})})]})})})]}),i==="SUMMARY"&&e.jsxs(V,{className:"shadow-lg border-t-4 border-t-yellow-500",children:[e.jsx(z,{className:"bg-yellow-50/50 pb-4",children:e.jsx(B,{className:"text-yellow-800",children:"Attendance Summary"})}),e.jsx(Z,{children:e.jsxs(q,{children:[e.jsx(P,{children:e.jsxs(y,{className:"bg-muted/50",children:[e.jsx(h,{className:"w-[300px]",children:"Staff Name"}),e.jsx(h,{className:"text-center",children:"Total Days"}),e.jsx(h,{className:"text-center text-blue-600",children:"Holidays"}),e.jsx(h,{className:"text-center text-green-600",children:"Present (Effective)"}),e.jsx(h,{className:"text-center text-orange-600",children:"Half Days"}),e.jsx(h,{className:"text-center text-purple-600",children:"Approved Leaves"}),e.jsx(h,{className:"text-center text-red-600",children:"LOP Days"})]})}),e.jsx(W,{children:f.map(t=>{const s=E(t);return e.jsxs(y,{children:[e.jsxs(u,{children:[e.jsx("div",{className:"font-medium",children:t.user.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.user.designation})]}),e.jsx(u,{className:"text-center",children:s.totalDays}),e.jsx(u,{className:"text-center font-medium text-blue-700",children:s.totalHolidays}),e.jsx(u,{className:"text-center font-bold text-green-700",children:s.totalPresentValue}),e.jsx(u,{className:"text-center text-orange-700",children:s.totalHalfDaysCount}),e.jsx(u,{className:"text-center text-purple-700",children:s.totalLeaves}),e.jsx(u,{className:"text-center font-bold text-red-600",children:s.totalLOP})]},t.user.id)})})]})})]}),i==="REGULARIZATION"&&e.jsx(be,{}),i==="LOGS"&&e.jsx(ye,{})]})};export{Ge as default};
