import{v as de,r as m,j as e,x as l,q as pe,C as ge,D as H}from"./index-CVFz3GnQ.js";import{X as fe,B as p,P as oe,l as Y,D as je,a as ye,d as Ne,e as be,I as V,j as J,k as ve,S as b,u as U,i as A,U as we,m as Se,a0 as le}from"./index-MXZ1Fyy1.js";import{C as me}from"./clock-DRstIMdH.js";import{L as Q}from"./label-BDi2E6m5.js";import{C as $}from"./card-L7c9AA96.js";import{A as _e}from"./activity-DCF9pRFP.js";import{C as ce}from"./check-circle-C7q7Y3EO.js";import{S as ke}from"./save-Ch7_aoOB.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=de("Fingerprint",[["path",{d:"M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4",key:"1jc9o5"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2",key:"1mxgy1"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2c0 .47 0 1.17-.02 2",key:"1fgabc"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=de("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),Me=({isOpen:u,onClose:F})=>{const[d,O]=m.useState([]),[L,I]=m.useState(!1),[x,f]=m.useState({name:"",start_time:"09:00",end_time:"18:00",default_grace_time:15}),[v,w]=m.useState(""),[n,S]=m.useState(null),_=async()=>{try{I(!0);const a=await l.get("/attendance/shifts");O(a.data)}catch(a){console.error(a)}finally{I(!1)}};m.useEffect(()=>{u&&(_(),j())},[u]);const j=()=>{f({name:"",start_time:"09:00",end_time:"18:00",default_grace_time:15}),S(null),w("")},y=async()=>{var a,h;if(!x.name)return w("Name is required");try{w(""),n?await l.put(`/attendance/shifts/${n}`,x):await l.post("/attendance/shifts",x),j(),_()}catch(D){w(((h=(a=D.response)==null?void 0:a.data)==null?void 0:h.error)||"Failed to save preset")}},E=a=>{f({name:a.name,start_time:a.start_time,end_time:a.end_time,default_grace_time:a.default_grace_time||15}),S(a.id),w("")},k=async a=>{if(confirm("Are you sure? This will not remove the shift from staff currently assigned to it, but will remove it from the list."))try{await l.delete(`/attendance/shifts/${a}`),n===a&&j(),_()}catch(h){console.error(h)}},C=a=>{if(!a)return"";const[h,D]=a.split(":"),P=parseInt(h),t=P>=12?"PM":"AM";return`${P%12||12}:${D} ${t}`};return u?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50",children:[e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(me,{size:16})," Shift Presets"]}),e.jsx("button",{onClick:F,className:"text-gray-400 hover:text-gray-600",children:e.jsx(fe,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:`p-3 rounded-md border text-sm space-y-3 ${n?"bg-blue-50 border-blue-200":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:`font-medium ${n?"text-blue-700":"text-gray-700"}`,children:n?"Edit Preset":"Add New Preset"}),n&&e.jsx("button",{onClick:j,className:"text-xs text-blue-600 hover:underline",children:"Cancel"})]}),e.jsx("input",{type:"text",placeholder:"Shift Name (e.g. Morning Shift)",className:"w-full p-2 border rounded",value:x.name,onChange:a=>f({...x,name:a.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"Start Time"}),e.jsx("input",{type:"time",className:"w-full p-2 border rounded",value:x.start_time,onChange:a=>f({...x,start_time:a.target.value})})]}),e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"End Time"}),e.jsx("input",{type:"time",className:"w-full p-2 border rounded",value:x.end_time,onChange:a=>f({...x,end_time:a.target.value})})]}),e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"Grace (Min)"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded",value:x.default_grace_time,onChange:a=>f({...x,default_grace_time:parseInt(a.target.value)||0})})]})]}),v&&e.jsx("p",{className:"text-red-500 text-xs",children:v}),e.jsx(p,{size:"sm",onClick:y,className:`w-full ${n?"bg-blue-600 hover:bg-blue-700":""}`,children:n?"Update Preset":e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:14,className:"mr-1"})," Add Preset"]})})]}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[L?e.jsx("p",{className:"text-center text-gray-400 text-sm",children:"Loading..."}):d.map(a=>e.jsxs("div",{className:`flex justify-between items-center p-2 border rounded hover:bg-gray-50 ${n===a.id?"border-blue-300 bg-blue-50":""}`,children:[e.jsxs("div",{className:"cursor-pointer flex-1",onClick:()=>E(a),children:[e.jsx("p",{className:"font-medium text-sm text-gray-800",children:a.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[C(a.start_time)," - ",C(a.end_time)," â€¢ Grace: ",a.default_grace_time,"m"]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>k(a.id),className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(Y,{size:14})})})]},a.id)),!L&&d.length===0&&e.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"No presets defined."})]})]})]})}):null},Ae=({isOpen:u,onClose:F,staffId:d,staffName:O,onSuccess:L})=>{const[I,x]=m.useState([]),[f,v]=m.useState([]),[w,n]=m.useState(!1),[S,_]=m.useState(""),[j,y]=m.useState(""),[E,k]=m.useState(""),[C,a]=m.useState("");m.useEffect(()=>{u&&d&&h()},[u,d]);const h=async()=>{try{n(!0);const[t,N]=await Promise.all([l.get("/attendance/shifts"),l.get(`/attendance/shifts/assignments/${d}`)]);x(t.data),v(N.data)}catch(t){console.error("Failed to fetch data",t)}finally{n(!1)}},D=async()=>{var t,N;if(!S||!j){b.fire("Error","Please select a shift and start date.","error");return}try{await l.post("/attendance/shifts/assign",{staff_id:d,shift_id:S,from_date:j,to_date:E||null,grace_time:C?parseInt(C):void 0}),b.fire({icon:"success",title:"Assigned!",text:"Shift assigned successfully.",timer:1500,showConfirmButton:!1}),_(""),y(""),k(""),a(""),h(),L()}catch(T){b.fire("Error",((N=(t=T.response)==null?void 0:t.data)==null?void 0:N.error)||"Assignment failed","error")}},P=async t=>{if(window.confirm("Are you sure you want to remove this assignment?"))try{await l.delete(`/attendance/shifts/assignments/${t}`),h(),L()}catch{b.fire("Error","Failed to delete assignment","error")}};return e.jsx(je,{open:u,onOpenChange:F,children:e.jsxs(ye,{className:"sm:max-w-[700px]",children:[e.jsx(Ne,{children:e.jsxs(be,{children:["Manage Shift Assignments: ",O]})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200 space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-sm text-slate-700 flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"})," New Assignment"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Shift"}),e.jsxs("select",{className:"w-full flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:S,onChange:t=>_(t.target.value),children:[e.jsx("option",{value:"",children:"Select Shift..."}),I.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.start_time," - ",t.end_time,")"]},t.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Grace Time Override (Min)"}),e.jsx(V,{type:"number",placeholder:"Default",value:C,onChange:t=>a(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"From Date"}),e.jsx(V,{type:"date",value:j,onChange:t=>y(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"To Date (Optional)"}),e.jsx(V,{type:"date",value:E,onChange:t=>k(t.target.value)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Leave empty for indefinite assignment"})]})]}),e.jsx(p,{className:"w-full",onClick:D,children:"Assign Shift"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-slate-700 mb-3",children:"Assignment History"}),e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-600 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Shift"}),e.jsx("th",{className:"px-4 py-2",children:"Period"}),e.jsx("th",{className:"px-4 py-2",children:"Grace"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-slate-500",children:"No assignments found."})}):f.map(t=>e.jsxs("tr",{className:t.is_active?"":"opacity-50 bg-slate-50",children:[e.jsxs("td",{className:"px-4 py-2 font-medium",children:[t.shift.name,e.jsxs("span",{className:"text-xs text-slate-400 block",children:[t.shift.start_time," - ",t.shift.end_time]})]}),e.jsxs("td",{className:"px-4 py-2",children:[J(new Date(t.from_date),"MMM d, yyyy")," -> ",t.to_date?J(new Date(t.to_date),"MMM d, yyyy"):"Indefinite"]}),e.jsx("td",{className:"px-4 py-2",children:t.grace_time?`${t.grace_time}m (Override)`:`${t.shift.default_grace_time}m (Default)`}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 text-red-500",onClick:()=>P(t.id),children:e.jsx(Y,{className:"w-4 h-4"})})})]},t.id))})]})})]})]}),e.jsx(ve,{children:e.jsx(p,{variant:"outline",onClick:F,children:"Close"})})]})})},Le=async()=>(await l.get("/attendance/biometric/status")).data,Ie=async()=>(await l.get("/attendance/biometric/users")).data,Ee=async()=>(await l.post("/attendance/biometric/sync-time")).data,$e=async()=>(await l.post("/attendance/biometric/restart")).data,Fe=async()=>(await l.post("/attendance/biometric/clear-logs")).data,Pe=async u=>(await l.post("/attendance/biometric/users/add",u)).data,Ue=async u=>(await l.post("/attendance/biometric/users/delete",{uid:u})).data,Oe=async()=>(await l.get("/attendance/biometric/users/unlinked")).data,Te=async u=>(await l.post("/attendance/biometric/users/link",u)).data,Re=async()=>(await l.post("/attendance/biometric/users/upload")).data,qe=async()=>(await l.get("/attendance/shifts")).data,ze=async()=>(await l.post("/attendance/biometric/users/import")).data,Ge=async()=>(await l.get("/attendance/biometric/audit")).data,Be=async()=>(await l.get("/team/staff")).data,Ze=()=>{var ae,re,ie;pe();const[u,F]=m.useState([]),[d,O]=m.useState("console"),[L,I]=m.useState(!1),[x,f]=m.useState({}),[v,w]=m.useState({isOpen:!1,staffId:"",staffName:""}),{data:n,isLoading:S,refetch:_,isRefetching:j}=U({queryKey:["biometric-info"],queryFn:Le,refetchInterval:3e4}),y=ge.useMemo(()=>{if(!(n!=null&&n.device_info))return{};try{return JSON.parse(n.device_info)}catch(s){return console.error("Failed to parse device info",s),{}}},[n==null?void 0:n.device_info]),E=(n==null?void 0:n.status)==="ONLINE",{data:k,isLoading:C,refetch:a}=U({queryKey:["biometric-users"],queryFn:Ie}),{data:h,isLoading:D,refetch:P}=U({queryKey:["staff-list-policies"],queryFn:Be,enabled:d==="policies"||d==="link_users"}),{data:t,isLoading:N,refetch:T}=U({queryKey:["biometric-unlinked-users"],queryFn:Oe,enabled:d==="link_users"}),{data:R,refetch:xe}=U({queryKey:["shifts-list"],queryFn:qe,enabled:d==="policies"||d==="shifts"}),{data:q,isLoading:X,refetch:z,isRefetching:B}=U({queryKey:["biometric-audit"],queryFn:Ge,enabled:!1,staleTime:1/0}),o=s=>F(r=>[`[${new Date().toLocaleTimeString()}] ${s}`,...r]),W=A({mutationFn:$e,onSuccess:s=>o(`Success: ${s.message}`),onError:s=>{var r,i;return o(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}}),Z=A({mutationFn:Ee,onSuccess:s=>o(`Success: ${s.message}`),onError:s=>{var r,i;return o(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}}),ee=A({mutationFn:Fe,onSuccess:s=>o(`Success: ${s.message}`),onError:s=>{var r,i;return o(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}});A({mutationFn:Pe,onSuccess:s=>{o(`Success: ${s.message}`),a()},onError:s=>{var r,i;return o(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}});const he=A({mutationFn:Ue,onSuccess:s=>{o(`Success: ${s.message}`),a(),z(),T()},onError:s=>{var r,i;return o(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}}),se=A({mutationFn:Te,onSuccess:s=>{o(`Link Success: ${s.message}`),b.fire("Linked","Device user successfully linked to profile.","success"),T(),z()},onError:s=>{var r,i,M,c;o(`Link Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`),b.fire("Error",((c=(M=s.response)==null?void 0:M.data)==null?void 0:c.error)||s.message,"error")}});A({mutationFn:Re,onSuccess:s=>{o(`Upload Success: ${s.message}`),a(),z()},onError:s=>{var r,i;return o(`Upload Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}}),A({mutationFn:ze,onSuccess:s=>{o(`Import Success: ${s.message}`),a(),z()},onError:s=>{var r,i;return o(`Import Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}});const te=s=>{if(!s||!s.includes(":"))return s;const[r,i]=s.split(":"),M=parseInt(r),c=M>=12?"PM":"AM";return`${M%12||12}:${i} ${c}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Biometric Device Console"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage ESSL device connection and data"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1 mr-4",children:[{id:"console",label:"CONSOLE"},{id:"link_users",label:"Link Users"},{id:"audit",label:"Audit"},{id:"shifts",label:"Create Shift"},{id:"policies",label:"Shift Management"}].map(s=>e.jsx("button",{onClick:()=>O(s.id),className:`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${d===s.id?"bg-white shadow text-gray-900":"text-gray-500 hover:text-gray-700"}`,children:s.label},s.id))}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${E?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:E?"ONLINE":"OFFLINE"}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>_(),disabled:S||j,children:e.jsx(H,{className:`w-4 h-4 ${S||j?"animate-spin":""}`})})]})]}),d==="console"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(_e,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"Device Specs"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Name:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.deviceName||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Serial:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.serialNumber||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Platform:"}),e.jsx("span",{className:"font-medium text-gray-900",children:y.platform||"-"})]})]})]}),e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(we,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"Capacity Stats"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:y.userCount||"-"}),e.jsx("div",{className:"text-xs text-purple-400",children:"Users Enrolled"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.logCount||"-"}),e.jsx("div",{className:"text-xs text-blue-400",children:"Attendance Logs"})]})]})]}),e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Se,{className:"w-5 h-5 text-orange-500"}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"Device Control"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(p,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-6 group",onClick:async()=>{try{o("Initiating Import All Logs..."),await l.post("/attendance/biometric/sync-all"),o("Import completed successfully."),b.fire("Success","Import All Logs Complete","success")}catch(s){o(`Import Failed: ${s.message}`),b.fire("Error","Import failed","error")}},children:[e.jsx(H,{className:"w-5 h-5 mr-2 group-hover:animate-spin"}),"IMPORT ALL LOGS (Direct)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(p,{variant:"outline",className:"text-xs",onClick:()=>Z.mutate(),disabled:Z.isPending,children:[e.jsx(me,{className:"w-3 h-3 mr-2"})," Sync Time"]}),e.jsxs(p,{variant:"outline",className:"text-xs text-red-600 px-0",onClick:()=>{window.confirm("Restart Device?")&&W.mutate()},disabled:W.isPending,children:[e.jsx(De,{className:"w-3 h-3 mr-2"})," Restart"]}),e.jsxs(p,{variant:"outline",className:"text-xs col-span-2 text-red-700",onClick:()=>{window.confirm("DANGER: Clear ALL logs?")&&ee.mutate()},disabled:ee.isPending,children:[e.jsx(Y,{className:"w-3 h-3 mr-2"})," Clear Logs"]})]})]})]})]}),u.length>0&&e.jsxs("div",{className:"bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-xs max-h-40 overflow-y-auto shadow-inner",children:[e.jsx("div",{className:"font-bold text-gray-500 mb-2 uppercase tracking-wide",children:"Console Output"}),u.map((s,r)=>e.jsx("div",{children:s},r))]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-gray-700",children:"Enrolled Users"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Fetched directly from device memory"})]}),C?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading users from device..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"User ID"}),e.jsx("th",{className:"px-6 py-3",children:"Name"}),e.jsx("th",{className:"px-6 py-3",children:"Role"}),e.jsx("th",{className:"px-6 py-3",children:"UID"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:(ae=k==null?void 0:k.data)==null?void 0:ae.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-3 font-medium",children:s.userId}),e.jsx("td",{className:"px-6 py-3",children:s.name||"Unknown"}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.role===0?"bg-gray-100":"bg-purple-100 text-purple-700"}`,children:s.role===0?"User":"Admin"})}),e.jsx("td",{className:"px-6 py-3 text-gray-400",children:s.uid}),e.jsx("td",{className:"px-6 py-3 text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-800",onClick:()=>{window.confirm(`Delete ${s.userId}?`)&&he.mutate(s.userId)},children:e.jsx(Y,{className:"w-4 h-4"})})})})]},r))})]})})]})]}),d==="audit"&&e.jsx("div",{className:"space-y-6",children:e.jsxs($,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Synchronization Status"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Compare application staff with device users"})]}),e.jsxs(p,{onClick:()=>z(),disabled:B||X,children:[e.jsx(H,{className:`w-4 h-4 mr-2 ${B||X?"animate-spin":""}`}),B||X?"Scanning...":"Run Audit Scan"]})]}),!B&&(q==null?void 0:q.audit)&&e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"border border-yellow-200 bg-yellow-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-yellow-800 mb-2",children:["Missing on Device (",q.audit.missingOnDevice.length,")"]}),q.audit.missingOnDevice.length>0?e.jsx("div",{className:"text-sm text-yellow-700",children:'Run "Upload Users" in Console to fix this.'}):e.jsx("div",{className:"text-sm text-green-600",children:"All staff present on device."})]})})]})}),d==="link_users"&&e.jsx("div",{className:"space-y-6",children:e.jsxs($,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-indigo-500"}),"Unlinked Device Users"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Attach unmapped physical device IDs to existing web application profiles"})]}),e.jsxs(p,{onClick:()=>T(),disabled:N,children:[e.jsx(H,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),"Refresh List"]})]}),N||D?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Scanning for unmapped fingerprints..."}):((re=t==null?void 0:t.data)==null?void 0:re.length)===0?e.jsxs("div",{className:"p-8 text-center bg-green-50 rounded border border-green-100 shadow-inner",children:[e.jsx(ce,{className:"w-10 h-10 text-green-500 mx-auto mb-2"}),e.jsx("h4",{className:"font-bold text-green-700",children:"All Setup!"}),e.jsx("p",{className:"text-sm text-green-600",children:"Every user on the physical device is matched to a web profile."})]}):e.jsx("div",{className:"overflow-x-auto border rounded-md shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-b",children:"Device ID (UID)"}),e.jsx("th",{className:"px-4 py-3 border-b",children:"Device Name"}),e.jsx("th",{className:"px-4 py-3 border-b w-1/3",children:"Match to Staff Profile"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:(ie=t==null?void 0:t.data)==null?void 0:ie.map((s,r)=>e.jsxs("tr",{className:"hover:bg-indigo-50/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 font-mono font-bold text-indigo-700",children:s.userId}),e.jsx("td",{className:"px-4 py-4 font-medium",children:s.name||"No Name"}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("select",{className:"w-full p-2 border border-gray-200 rounded text-sm focus:ring-indigo-500 focus:border-indigo-500",value:x[s.userId]||"",onChange:i=>f({...x,[s.userId]:i.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Staff Profile --"}),h==null?void 0:h.map(i=>e.jsxs("option",{value:i.id,children:[i.user.full_name," (",i.staff_number,")"]},i.id))]})}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs(p,{size:"sm",className:"bg-indigo-600 hover:bg-indigo-700 text-white shadow-sm gap-2 whitespace-nowrap",disabled:!x[s.userId]||se.isPending,onClick:()=>{window.confirm(`Are you sure you want to permanently link Device ID "${s.userId}" to this profile?`)&&se.mutate({deviceUserId:s.userId,staffProfileId:x[s.userId]})},children:[e.jsx(ce,{className:"w-4 h-4"})," Link Profile"]})})]},s.userId||r))})]})})]})}),d==="shifts"&&e.jsx("div",{className:"space-y-6",children:e.jsxs($,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Shift Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Define shifts and their working hours"})]}),e.jsxs(p,{onClick:()=>I(!0),children:[e.jsx(le,{className:"w-4 h-4 mr-2"})," Add / Edit Shifts"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Shift Name"}),e.jsx("th",{className:"px-4 py-2",children:"Start Time"}),e.jsx("th",{className:"px-4 py-2",children:"End Time"}),e.jsx("th",{className:"px-4 py-2",children:"Default Grace"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[R==null?void 0:R.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:s.name}),e.jsx("td",{className:"px-4 py-3",children:te(s.start_time)}),e.jsx("td",{className:"px-4 py-3",children:te(s.end_time)}),e.jsxs("td",{className:"px-4 py-3",children:[s.default_grace_time," min"]})]},s.id)),(!R||R.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-gray-400",children:"No shifts defined"})})]})]})})]})}),d==="policies"&&e.jsx("div",{className:"space-y-6",children:e.jsxs($,{className:"p-6",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-6",children:"Staff Attendance Policies"})}),D?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading staff details..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Staff"}),e.jsx("th",{className:"px-4 py-2",children:"Current Shift (Date Range)"}),e.jsx("th",{className:"px-4 py-2",children:"Grace Time"}),e.jsx("th",{className:"px-4 py-2",children:"Manage Shift"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:h==null?void 0:h.map(s=>{var M;const r=(M=s.shift_assignments)==null?void 0:M.find(c=>{const g=new Date,G=new Date(c.from_date),K=c.to_date?new Date(c.to_date):null;return G<=g&&(!K||K>=g)}),i=r?(r.grace_time??r.shift.default_grace_time)+" min":"-";return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.user.full_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.staff_number})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex flex-col gap-1",children:s.shift_assignments&&s.shift_assignments.length>0?s.shift_assignments.filter(c=>{const g=new Date,G=new Date(g.getFullYear(),g.getMonth(),1),K=new Date(g.getFullYear(),g.getMonth()+1,0),ue=new Date(c.from_date),ne=c.to_date?new Date(c.to_date):null;return ue<=K&&(!ne||ne>=G)}).map((c,g)=>e.jsx("div",{className:"flex items-center justify-between text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded",children:e.jsxs("span",{children:[c.shift.name,e.jsxs("span",{className:"text-blue-400 ml-1",children:["(",J(new Date(c.from_date),"d MMM")," - ",c.to_date?J(new Date(c.to_date),"d MMM"):"Now",")"]})]})},g)):e.jsx("span",{className:"text-xs text-gray-400",children:"No Active Shift"})})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:i}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(p,{size:"sm",variant:"outline",className:"h-8 gap-2",onClick:()=>w({isOpen:!0,staffId:s.id,staffName:s.user.full_name}),children:[e.jsx(le,{className:"w-3 h-3"})," Assign/Edit"]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs(p,{size:"sm",className:"h-8 bg-green-600 hover:bg-green-700 text-white gap-2",onClick:async()=>{var c,g;try{await l.post("/attendance/shifts/sync-logs",{staffId:s.user.id}),b.fire({icon:"success",title:"Synced!",text:"Attendance logs updated with current shift rules.",timer:2e3,showConfirmButton:!1})}catch(G){b.fire("Error",((g=(c=G.response)==null?void 0:c.data)==null?void 0:g.error)||"Sync failed","error")}},children:[e.jsx(ke,{className:"w-4 h-4"})," Save"]})})]},s.id)})})]})})]})}),e.jsx(Me,{isOpen:L,onClose:()=>{I(!1),xe()}}),e.jsx(Ae,{isOpen:v.isOpen,onClose:()=>w({...v,isOpen:!1}),staffId:v.staffId,staffName:v.staffName,onSuccess:()=>{P()}})]})};export{Ze as default};
