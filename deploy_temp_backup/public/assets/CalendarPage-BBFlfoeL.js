import{u as k,r as b,C as L,j as e,x as g}from"./index-CVFz3GnQ.js";import{C as O,c as _}from"./card-L7c9AA96.js";import{az as T,u as p,j as d,aA as j,B as N,ah as F}from"./index-MXZ1Fyy1.js";import{S as R,a as H,b as $,c as P,d as B}from"./select-CRNC5CBq.js";import{e as V,C as Y,i as M,s as q,a as K}from"./subMonths-D4QG7jFA.js";import{s as m}from"./startOfMonth-C0iE2rZu.js";import"./index-C_y8q7n2.js";import"./index-COFXZIMB.js";function v(a){return T(a).getDay()}const ee=()=>{const{user:a}=k(),[r,u]=b.useState(new Date),[c,f]=b.useState("");L.useEffect(()=>{a!=null&&a.id&&!c&&f(a.id)},[a]);const{data:x}=p({queryKey:["staff-list-calendar"],queryFn:async()=>(await g.get("/team/staff")).data,enabled:["ADMIN","MANAGER","DEVELOPER_ADMIN"].includes((a==null?void 0:a.role)||"")}),{data:h}=p({queryKey:["attendance",d(r,"yyyy-MM"),c],queryFn:async()=>{if(!c)return[];const t=d(m(r),"yyyy-MM-dd"),i=d(j(r),"yyyy-MM-dd");return(await g.get(`/attendance/summary?userId=${c}&start=${t}&end=${i}`)).data},enabled:!!c}),D=t=>h?h.find(s=>M(new Date(s.date),t)):null,E=V({start:m(r),end:j(r)}),S=v(m(r)),A=Array.from({length:S}).fill(null).concat(E),w=()=>u(q(r)),C=()=>u(K(r,1));return e.jsxs("div",{className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Attendance Calendar"}),e.jsxs("div",{className:"flex items-center gap-4",children:[["ADMIN","MANAGER","DEVELOPER_ADMIN"].includes((a==null?void 0:a.role)||"")&&x&&e.jsx("div",{className:"w-[200px]",children:e.jsxs(R,{value:c,onValueChange:f,children:[e.jsx(H,{children:e.jsx($,{placeholder:"Select Staff"})}),e.jsx(P,{children:x.map(t=>e.jsx(B,{value:t.user.id,children:t.user.full_name},t.user.id))})]})}),e.jsx(N,{variant:"outline",size:"icon",onClick:w,children:e.jsx(Y,{})}),e.jsx("span",{className:"text-lg font-medium min-w-[150px] text-center",children:d(r,"MMMM yyyy")}),e.jsx(N,{variant:"outline",size:"icon",onClick:C,children:e.jsx(F,{})})]})]}),e.jsx(O,{className:"flex-1 overflow-hidden",children:e.jsxs(_,{className:"p-0 h-full flex flex-col",children:[e.jsx("div",{className:"grid grid-cols-7 text-center border-b",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"p-4 font-bold bg-muted/20 text-muted-foreground",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 flex-1 auto-rows-fr",children:A.map((t,i)=>{if(!t)return e.jsx("div",{className:"border-b border-r bg-muted/5"},`empty-${i}`);const s=D(t),y=M(t,new Date);let o="bg-gray-50",n="";const I=v(t)===0;let l=s==null?void 0:s.status;if(I?l="WEEKLY_OFF":(!s&&t<new Date(new Date().setHours(0,0,0,0))&&(l="ABSENT"),s&&s.status==="PRESENT"&&!s.check_in&&(l="ABSENT")),l)switch(l){case"PRESENT":o="bg-green-50 hover:bg-green-100 border-green-100",n="Present";break;case"ABSENT":o="bg-red-50 hover:bg-red-100 border-red-100",n="Absent";break;case"LEAVE":o="bg-purple-50 hover:bg-purple-100 border-purple-100",n="On Leave";break;case"HALF_DAY":o="bg-yellow-50 hover:bg-yellow-100 border-yellow-100",n="Half Day";break;case"WEEKLY_OFF":case"HOLIDAY":o="bg-blue-50/50 text-blue-700",n=l==="HOLIDAY"?"Holiday":"Weekly Off";break;default:n=l}return e.jsxs("div",{className:`p-2 border-b border-r min-h-[100px] flex flex-col items-start justify-between transition-colors ${o} ${y?"ring-2 ring-primary ring-inset":""}`,children:[e.jsx("span",{className:`text-sm font-medium ${y?"text-primary":"text-muted-foreground"}`,children:d(t,"d")}),(s||l)&&e.jsxs("div",{className:"w-full",children:[n&&e.jsx("span",{className:"text-xs font-semibold block mb-1",children:n}),(s==null?void 0:s.check_in)&&e.jsxs("div",{className:"text-[10px] text-muted-foreground flex items-center gap-1",children:[e.jsx("span",{className:"text-green-600",children:"IN:"})," ",d(new Date(s.check_in),"HH:mm")]})]})]},t.toString())})})]})})]})};export{ee as default};
