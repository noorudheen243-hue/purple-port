import{q as U,r as p,j as e,x as j}from"./index-CVFz3GnQ.js";import{u as P,i as k,p as q,I as g,B as i,N as F,Q as w,W as L}from"./index-MXZ1Fyy1.js";import{T as z,a as M,b as f,c as o,d as A,e as d}from"./table-DEHLnAz_.js";import{C as I,a as Q,b as B,c as H}from"./card-L7c9AA96.js";import{S as R}from"./save-Ch7_aoOB.js";const D=()=>{const N=U(),[c,v]=p.useState(""),[C,m]=p.useState(null),[t,n]=p.useState({username:"",password:""}),{data:x,isLoading:y}=P({queryKey:["client-credentials"],queryFn:async()=>{const{data:s}=await j.get("/clients/credentials");return s}}),b=k({mutationFn:async({clientId:s,data:a})=>{await j.put(`/clients/credentials/${s}`,a)},onSuccess:()=>{m(null),n({username:"",password:""}),N.invalidateQueries({queryKey:["client-credentials"]})},onError:s=>{var a,r;alert("Update Failed: "+(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||s.message))}}),S=s=>{var r;m(s.id);const a=((r=s.portalUser)==null?void 0:r.email)||"";n({username:a,password:""})},E=s=>{if(!t.username)return alert("Username is required");const a={username:t.username};t.password&&(a.password=t.password),b.mutate({clientId:s,data:a})},T=()=>{m(null),n({username:"",password:""})},u=x==null?void 0:x.filter(s=>{var a;return s.name.toLowerCase().includes(c.toLowerCase())||((a=s.portalUser)==null?void 0:a.email.toLowerCase().includes(c.toLowerCase()))});return y?e.jsx("div",{className:"p-8 text-center",children:"Loading Credentials..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Client Access"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage login credentials for the Client Portal."})]})}),e.jsxs(I,{children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(B,{children:"Accounts"}),e.jsxs("div",{className:"relative w-72",children:[e.jsx(q,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(g,{placeholder:"Search clients...",className:"pl-8",value:c,onChange:s=>v(s.target.value)})]})]})}),e.jsx(H,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(z,{children:[e.jsx(M,{children:e.jsxs(f,{children:[e.jsx(o,{className:"w-[200px]",children:"Client Name"}),e.jsx(o,{className:"w-[300px]",children:"Username (Email)"}),e.jsx(o,{className:"w-[300px]",children:"Password"}),e.jsx(o,{className:"w-[100px]",children:"Status"}),e.jsx(o,{className:"text-right",children:"Actions"})]})}),e.jsx(A,{children:u==null?void 0:u.map(s=>{var r;const a=C===s.id;return e.jsxs(f,{className:a?"bg-muted/50":"",children:[e.jsx(d,{className:"font-medium align-middle",children:s.name}),e.jsx(d,{className:"align-middle",children:a?e.jsx(g,{value:t.username,onChange:l=>n(h=>({...h,username:l.target.value})),placeholder:"company@qix.com"}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:s.portalUser?"":"text-muted-foreground italic",children:((r=s.portalUser)==null?void 0:r.email)||"No Account"})})}),e.jsx(d,{className:"align-middle",children:a?e.jsxs("div",{className:"relative",children:[e.jsx(g,{type:t.showPassword?"text":"password",value:t.password,onChange:l=>n(h=>({...h,password:l.target.value})),placeholder:s.portalUser?"Reset Password":"Set Password",className:"pr-10"}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>n(l=>({...l,showPassword:!l.showPassword})),children:t.showPassword?e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(w,{className:"h-4 w-4 text-muted-foreground"})})]}):e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsx("span",{className:"text-muted-foreground",children:"••••••••"}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground hover:text-foreground",onClick:()=>alert(`For security reasons, saved passwords cannot be viewed in plain text.

You can reset the password by clicking 'Modify'.`),children:e.jsx(w,{className:"h-4 w-4"})})]})}),e.jsx(d,{className:"align-middle",children:s.portalUser?e.jsxs("div",{className:"flex items-center gap-1 text-green-600 font-medium text-sm",children:[e.jsx(L,{className:"h-4 w-4"}),"Configured"]}):e.jsx("div",{className:"text-muted-foreground text-sm",children:"Not Configured"})}),e.jsx(d,{className:"text-right align-middle",children:a?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(i,{size:"sm",onClick:()=>E(s.id),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(R,{className:"h-4 w-4 mr-1"})," Save"]}),e.jsx(i,{size:"sm",variant:"ghost",onClick:T,children:"Cancel"})]}):e.jsx(i,{size:"sm",variant:"outline",onClick:()=>S(s),children:"Modify"})})]},s.id)})})]})})})]})]})};export{D as default};
