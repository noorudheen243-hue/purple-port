import{q as P,x as f,j as e,J as z,a as F,u as G}from"./index-CVFz3GnQ.js";import{a1 as q,i as O,S as A,I as T,B as c,u as S,F as I,t as D}from"./index-MXZ1Fyy1.js";import{L as j}from"./label-BDi2E6m5.js";import{S as R,a as w,b as B,c as V,d as i}from"./select-CRNC5CBq.js";import{T as U}from"./textarea-D2C36G61.js";import{C as X,a as K,b as Y,c as $}from"./card-L7c9AA96.js";import{B as E}from"./badge-DB3i4Vcz.js";import{T as J,a as Q,b as N,c as v}from"./tabs-Dihxgigl.js";import{A as H}from"./arrow-left-BOi8SXvp.js";import{E as W}from"./external-link-CrZT27eC.js";import{C as k}from"./check-circle-C7q7Y3EO.js";import{X as L}from"./x-circle--Q6_SlDM.js";import{P as Z}from"./pen-tool-Ch9tCtKP.js";import{C as ee}from"./clock-DRstIMdH.js";import"./index-C_y8q7n2.js";import"./index-COFXZIMB.js";import"./index-CGf8YfUr.js";const se=({clientId:y,onSuccess:d})=>{const s=P(),{register:m,handleSubmit:C,reset:b,setValue:t,watch:o}=q({defaultValues:{title:"",type:"CREATIVE",status:"DRAFT",link:"",notes:""}});o("type");const n=O({mutationFn:async l=>await f.post("/client-portal/tracking/content",{client_id:y,title:l.title,type:l.type,status:l.status,link:l.link,notes:l.notes}),onSuccess:()=>{s.invalidateQueries({queryKey:["content-deliverables"]}),A.fire("Saved","Deliverable added successfully","success"),b(),d&&d()},onError:l=>{var h,u;A.fire("Error",((u=(h=l.response)==null?void 0:h.data)==null?void 0:u.message)||"Failed to save","error")}}),x=l=>{n.mutate(l)};return e.jsxs(X,{className:"mb-8 border-primary/20 bg-primary/5",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-lg",children:"Add New Deliverable"})}),e.jsx($,{children:e.jsxs("form",{onSubmit:C(x),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Title / Topic"}),e.jsx(T,{...m("title"),placeholder:"e.g. September Social Media Calendar",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Type"}),e.jsxs(R,{onValueChange:l=>t("type",l),defaultValue:"CREATIVE",children:[e.jsx(w,{children:e.jsx(B,{placeholder:"Type"})}),e.jsxs(V,{children:[e.jsx(i,{value:"CREATIVE",children:"Creative (Design)"}),e.jsx(i,{value:"COPY",children:"Copywriting"}),e.jsx(i,{value:"BLOG",children:"Blog Article"}),e.jsx(i,{value:"BRANDING_ASSET",children:"Branding Asset"}),e.jsx(i,{value:"VIDEO",children:"Video / Reel"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Link / URL (Drive, Figma, Doc)"}),e.jsx(T,{...m("link"),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Status"}),e.jsxs(R,{onValueChange:l=>t("status",l),defaultValue:"DRAFT",children:[e.jsx(w,{children:e.jsx(B,{placeholder:"Status"})}),e.jsxs(V,{children:[e.jsx(i,{value:"DRAFT",children:"Draft / In Progress"}),e.jsx(i,{value:"SUBMITTED",children:"Submitted for Review"}),e.jsx(i,{value:"APPROVED",children:"Approved"}),e.jsx(i,{value:"REJECTED",children:"Changes Requested"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Notes"}),e.jsx(U,{...m("notes"),placeholder:"Instructions or comments..."})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(c,{type:"submit",disabled:n.isPending,children:n.isPending?"Saving...":"Add Deliverable"})})]})})]})},ve=()=>{const[y]=z(),d=F(),{user:s}=G(),m=P(),C=y.get("clientId"),b=y.get("mode"),t=(s==null?void 0:s.role)==="CLIENT"?s==null?void 0:s.linked_client_id:C,o=(s==null?void 0:s.role)==="ADMIN"||(s==null?void 0:s.role)==="MANAGER"||(s==null?void 0:s.role)==="DEVELOPER_ADMIN"||(s==null?void 0:s.role)==="MARKETING_EXEC"||(s==null?void 0:s.role)==="DM_EXECUTIVE"||(s==null?void 0:s.role)==="WEB_SEO_EXECUTIVE"||(s==null?void 0:s.role)==="CREATIVE_DESIGNER"||(s==null?void 0:s.role)==="OPERATIONS_EXECUTIVE",n=o&&b==="manage",{data:x,isLoading:l}=S({queryKey:["content-deliverables",t],queryFn:async()=>{if(!t)return[];const{data:r}=await f.get(`/client-portal/tracking/content?clientId=${t}`);return r},enabled:!!t}),{data:h}=S({queryKey:["client-details-content",t],queryFn:async()=>(await f.get(`/clients/${t}`)).data,enabled:!!t}),u=O({mutationFn:async({id:r,status:g})=>await f.patch(`/client-portal/tracking/content/${r}`,{status:g}),onSuccess:()=>{m.invalidateQueries({queryKey:["content-deliverables"]}),A.fire({title:"Status Updated",icon:"success",timer:1500,showConfirmButton:!1,toast:!0,position:"top-end"})}});if(!t)return e.jsx("div",{className:"p-8 text-center",children:"No Client Selected"});const M=r=>{switch(r){case"CREATIVE":return e.jsx(D,{size:16,className:"text-purple-500"});case"COPY":return e.jsx(I,{size:16,className:"text-blue-500"});case"BLOG":return e.jsx(Z,{size:16,className:"text-orange-500"});case"BRANDING_ASSET":return e.jsx(D,{size:16,className:"text-pink-500"});default:return e.jsx(I,{size:16,className:"text-gray-500"})}},_=r=>{switch(r){case"APPROVED":return e.jsxs(E,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:[e.jsx(k,{size:12,className:"mr-1"})," Approved"]});case"SUBMITTED":return e.jsxs(E,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:[e.jsx(ee,{size:12,className:"mr-1"})," In Review"]});case"REJECTED":return e.jsxs(E,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:[e.jsx(L,{size:12,className:"mr-1"})," Changes Req"]});default:return e.jsx(E,{variant:"secondary",className:"bg-gray-100 text-gray-600",children:"Draft"})}},p=r=>{const g=r?x==null?void 0:x.filter(a=>a.type===r):x;return!g||g.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground italic flex flex-col items-center gap-4",children:[e.jsx("span",{children:"No deliverables found."}),o&&!n&&e.jsx(c,{variant:"outline",size:"sm",onClick:()=>d(`?mode=manage&clientId=${t}`),children:"Add First Daily Entry"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:g.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border rounded-lg hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-gray-50 rounded-lg border",children:M(a.type)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-900",children:a.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:new Date(a.createdAt).toLocaleDateString()}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:a.type.replace("_"," ")})]}),a.notes&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 max-w-md truncate",children:a.notes})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[a.link&&e.jsx("a",{href:a.link,target:"_blank",rel:"noreferrer",children:e.jsxs(c,{variant:"ghost",size:"sm",className:"h-8 text-blue-600",children:["Open ",e.jsx(W,{size:12,className:"ml-1"})]})}),e.jsx("div",{children:_(a.status)}),(o||n)&&e.jsx("div",{className:"flex flex-col gap-1 items-end",children:a.status==="SUBMITTED"&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{size:"icon",variant:"ghost",className:"h-6 w-6 text-green-600 bg-green-50",onClick:()=>u.mutate({id:a.id,status:"APPROVED"}),title:"Approve",children:e.jsx(k,{size:14})}),e.jsx(c,{size:"icon",variant:"ghost",className:"h-6 w-6 text-red-600 bg-red-50",onClick:()=>u.mutate({id:a.id,status:"REJECTED"}),title:"Reject",children:e.jsx(L,{size:14})})]})})]})]},a.id))})};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>d(-1),children:[e.jsx(H,{className:"mr-2 h-4 w-4"})," Back"]}),e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Content & Branding"}),h&&e.jsx("p",{className:"text-muted-foreground",children:h.name})]})})]}),o&&!n&&e.jsx(c,{variant:"outline",onClick:()=>d(`?mode=manage&clientId=${t}`),children:"Add Entry / Manage"}),n&&e.jsx("div",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded text-xs font-bold uppercase tracking-wider",children:"Management Mode"})]}),n&&e.jsx(se,{clientId:t}),e.jsxs(J,{defaultValue:"ALL",className:"w-full",children:[e.jsxs(Q,{className:"bg-muted/50 p-1 mb-6",children:[e.jsx(N,{value:"ALL",className:"px-4",children:"All Items"}),e.jsx(N,{value:"CREATIVE",className:"px-4",children:"Creatives"}),e.jsx(N,{value:"COPY",className:"px-4",children:"Copywriting"}),e.jsx(N,{value:"BLOG",className:"px-4",children:"Blogs"}),e.jsx(N,{value:"BRANDING_ASSET",className:"px-4",children:"Branding"})]}),e.jsx(v,{value:"ALL",className:"space-y-4",children:p()}),e.jsx(v,{value:"CREATIVE",className:"space-y-4",children:p("CREATIVE")}),e.jsx(v,{value:"COPY",className:"space-y-4",children:p("COPY")}),e.jsx(v,{value:"BLOG",className:"space-y-4",children:p("BLOG")}),e.jsx(v,{value:"BRANDING_ASSET",className:"space-y-4",children:p("BRANDING_ASSET")})]})]})};export{ve as default};
