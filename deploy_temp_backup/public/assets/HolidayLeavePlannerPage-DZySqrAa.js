import{v as J,r as m,j as e,q as W,D as X,C as _,x as g}from"./index-CVFz3GnQ.js";import{c as E,aa as Z,u as F,i as w,B as N,P as ee,I as u,j as ae,l as se,p as te}from"./index-MXZ1Fyy1.js";import{C as k,a as S,b as L,c as T,d as le}from"./card-L7c9AA96.js";import{T as re,a as ne,b as q,c as D}from"./tabs-Dihxgigl.js";import{L as A}from"./label-BDi2E6m5.js";import{T as P,a as R,b as h,c as o,d as z,e as n}from"./table-DEHLnAz_.js";import{B as $}from"./badge-DB3i4Vcz.js";import{S as ie}from"./save-Ch7_aoOB.js";import"./index-CGf8YfUr.js";import"./index-C_y8q7n2.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=J("ServerCrash",[["path",{d:"M6 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2",key:"4b9dqc"}],["path",{d:"M6 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2",key:"22nnkd"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m13 6-4 6h6l-4 6",key:"14hqih"}]]),de=Z("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),B=m.forwardRef(({className:s,variant:t,...r},c)=>e.jsx("div",{ref:c,role:"alert",className:E(de({variant:t}),s),...r}));B.displayName="Alert";const I=m.forwardRef(({className:s,...t},r)=>e.jsx("h5",{ref:r,className:E("mb-1 font-medium leading-none tracking-tight",s),...t}));I.displayName="AlertTitle";const K=m.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:E("text-sm [&_p]:leading-relaxed",s),...t}));K.displayName="AlertDescription";const we=()=>{const s=W(),[t,r]=m.useState(new Date().getFullYear()),[c,x]=m.useState(""),{data:p=[],isLoading:y,isError:b,error:d}=F({queryKey:["holidays",t],queryFn:async()=>{try{return(await g.get(`/attendance/planner/holidays?year=${t}`)).data}catch(a){throw a}},retry:1}),[i,v]=m.useState({name:"",date:"",description:""}),f=w({mutationFn:async a=>await g.post("/attendance/planner/holidays",a),onSuccess:()=>{s.invalidateQueries({queryKey:["holidays",t]}),v({name:"",date:"",description:""})},onError:a=>{var l,j;return alert(((j=(l=a.response)==null?void 0:l.data)==null?void 0:j.error)||"Failed")}}),Q=w({mutationFn:async a=>await g.delete(`/attendance/planner/holidays/${a}`),onSuccess:()=>s.invalidateQueries({queryKey:["holidays",t]})}),H=w({mutationFn:async()=>await g.post("/attendance/planner/holidays/sundays",{year:t}),onSuccess:a=>{alert(a.data.message),s.invalidateQueries({queryKey:["holidays",t]})}}),{data:C=[],isLoading:U,isError:O}=F({queryKey:["allocations",t],queryFn:async()=>(await g.get(`/attendance/planner/allocations?year=${t}`)).data,retry:1}),V=w({mutationFn:async a=>await g.post("/attendance/planner/allocations",a),onSuccess:()=>{s.invalidateQueries({queryKey:["allocations",t]})},onError:a=>{var l,j;return alert(((j=(l=a.response)==null?void 0:l.data)==null?void 0:j.error)||"Update Failed")}}),Y=(a,l)=>{const j={user_id:a.user_id,year:t,casual:parseFloat(l.casual)||0,sick:parseFloat(l.sick)||0,earned:parseFloat(l.earned)||0,unpaid:parseFloat(l.unpaid)||0};V.mutate(j)},M=m.useMemo(()=>c?C.filter(a=>{var l;return a.name.toLowerCase().includes(c.toLowerCase())||((l=a.staff_number)==null?void 0:l.includes(c))}):C,[C,c]),G=b||O;return e.jsxs("div",{className:"p-6 space-y-6 max-w-[1600px] mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Holiday & Leave Planner"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage organization holidays and staff leave credits."})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-card p-1 rounded-lg border shadow-sm",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>r(t-1),children:"←"}),e.jsx("span",{className:"font-bold text-xl px-4 min-w-[80px] text-center",children:t}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>r(t+1),children:"→"})]})]}),G&&e.jsxs(B,{variant:"destructive",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(I,{children:"Connection Error"}),e.jsxs(K,{children:["Unable to connect to the Planner Service.",e.jsx("strong",{children:" If you just enabled this feature, you MUST restart your backend server."}),e.jsx("br",{}),"(Check console for details: 404 means route not found, 500 means Prisma Client mismatch)."]})]}),e.jsxs(re,{defaultValue:"holidays",className:"w-full",children:[e.jsxs(ne,{className:"grid w-full md:w-[400px] grid-cols-2",children:[e.jsx(q,{value:"holidays",children:"Holidays"}),e.jsx(q,{value:"allocations",children:"Leave Allocation"})]}),e.jsx(D,{value:"holidays",className:"space-y-4 pt-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-6",children:[e.jsxs(k,{className:"md:col-span-4 h-fit",children:[e.jsx(S,{children:e.jsxs(L,{className:"text-lg flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"})," Add Holiday"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Date"}),e.jsx(u,{type:"date",value:i.date,onChange:a=>v({...i,date:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Name"}),e.jsx(u,{placeholder:"e.g. Independence Day",value:i.name,onChange:a=>v({...i,name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Description"}),e.jsx(u,{placeholder:"Optional",value:i.description,onChange:a=>v({...i,description:a.target.value})})]}),e.jsx(N,{className:"w-full",onClick:()=>f.mutate(i),disabled:!i.date||!i.name||f.isPending,children:f.isPending?"Saving...":"Add Holiday"}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs(N,{variant:"secondary",className:"w-full",onClick:()=>H.mutate(),disabled:H.isPending,children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Populate All Sundays"]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground mt-2 text-center text-balance",children:["Automatically marks every Sunday in ",t," as a recurring holiday."]})]})]})]}),e.jsxs(k,{className:"md:col-span-8",children:[e.jsx(S,{children:e.jsxs(L,{className:"text-lg",children:["Holiday List (",p.length,")"]})}),e.jsx(T,{children:e.jsx("div",{className:"rounded-md border h-[500px] overflow-y-auto relative",children:e.jsxs(P,{children:[e.jsx(R,{className:"sticky top-0 bg-background z-10",children:e.jsxs(h,{children:[e.jsx(o,{children:"Date"}),e.jsx(o,{children:"Holiday"}),e.jsx(o,{children:"Type"}),e.jsx(o,{className:"text-right",children:"Action"})]})}),e.jsx(z,{children:y?e.jsx(h,{children:e.jsx(n,{colSpan:4,className:"text-center h-24",children:"Loading Holidays..."})}):p.length===0?e.jsx(h,{children:e.jsxs(n,{colSpan:4,className:"text-center h-24 text-muted-foreground",children:["No holidays found for ",t,"."]})}):p.map(a=>e.jsxs(h,{children:[e.jsx(n,{className:"font-medium whitespace-nowrap",children:ae(new Date(a.date),"dd MMM, EEEE")}),e.jsxs(n,{children:[e.jsx("div",{className:"font-medium",children:a.name}),a.description&&e.jsx("div",{className:"text-xs text-muted-foreground",children:a.description})]}),e.jsx(n,{children:a.is_recurring?e.jsx($,{variant:"secondary",className:"text-[10px]",children:"Recurring"}):e.jsx($,{variant:"outline",className:"text-[10px]",children:"One-time"})}),e.jsx(n,{className:"text-right",children:e.jsx(N,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>Q.mutate(a.id),children:e.jsx(se,{className:"w-4 h-4"})})})]},a.id))})]})})})]})]})}),e.jsx(D,{value:"allocations",className:"pt-4",children:e.jsxs(k,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsx(L,{children:"Staff Leave Allocations"}),e.jsx(le,{children:"Set annual leave credits for staff members."})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative w-64",children:[e.jsx(te,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(u,{placeholder:"Search staff...",className:"pl-8",value:c,onChange:a=>x(a.target.value)})]})})]}),e.jsx(T,{children:e.jsx("div",{className:"rounded-md border max-h-[600px] overflow-y-auto relative",children:e.jsxs(P,{children:[e.jsx(R,{className:"sticky top-0 bg-background z-10 shadow-sm",children:e.jsxs(h,{children:[e.jsx(o,{className:"w-[250px]",children:"Employee"}),e.jsx(o,{className:"text-center w-[120px]",children:"Medical (SL)"}),e.jsx(o,{className:"text-center w-[120px]",children:"Casual (CL)"}),e.jsx(o,{className:"text-center w-[120px]",children:"Earned (EL)"}),e.jsx(o,{className:"text-center w-[120px]",children:"Unpaid Limit"}),e.jsx(o,{className:"text-right w-[100px]",children:"Actions"})]})}),e.jsx(z,{children:U?e.jsx(h,{children:e.jsx(n,{colSpan:6,className:"text-center h-32",children:"Loading Allocations..."})}):M.length===0?e.jsx(h,{children:e.jsx(n,{colSpan:6,className:"text-center h-32 text-muted-foreground",children:"No staff found."})}):M.map(a=>e.jsx(oe,{staff:a,onSave:l=>Y(a,l)},a.user_id))})]})})})]})})]})]})},oe=_.memo(({staff:s,onSave:t})=>{const[r,c]=m.useState({sick:s.allocation.sick_leave,casual:s.allocation.casual_leave,earned:s.allocation.earned_leave,unpaid:s.allocation.unpaid_leave}),[x,p]=m.useState(!1);_.useEffect(()=>{c({sick:s.allocation.sick_leave,casual:s.allocation.casual_leave,earned:s.allocation.earned_leave,unpaid:s.allocation.unpaid_leave}),p(!1)},[s]);const y=(d,i)=>{c(v=>({...v,[d]:i})),p(!0)},b=()=>{t(r),p(!1)};return e.jsxs(h,{className:"hover:bg-muted/50",children:[e.jsx(n,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-xs font-bold text-primary",children:s.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-sm",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.department})]})]})}),e.jsx(n,{className:"text-center p-2",children:e.jsx(u,{type:"number",className:`w-20 mx-auto text-center h-8 ${x?"bg-yellow-50 border-yellow-300":""}`,value:r.sick,onChange:d=>y("sick",d.target.value)})}),e.jsx(n,{className:"text-center p-2",children:e.jsx(u,{type:"number",className:`w-20 mx-auto text-center h-8 ${x?"bg-yellow-50 border-yellow-300":""}`,value:r.casual,onChange:d=>y("casual",d.target.value)})}),e.jsx(n,{className:"text-center p-2",children:e.jsx(u,{type:"number",className:`w-20 mx-auto text-center h-8 ${x?"bg-yellow-50 border-yellow-300":""}`,value:r.earned,onChange:d=>y("earned",d.target.value)})}),e.jsx(n,{className:"text-center p-2",children:e.jsx(u,{type:"number",className:`w-20 mx-auto text-center h-8 ${x?"bg-yellow-50 border-yellow-300":""}`,value:r.unpaid,onChange:d=>y("unpaid",d.target.value)})}),e.jsx(n,{className:"text-right",children:e.jsx(N,{size:"sm",variant:x?"default":"ghost",className:x?"animate-pulse":"",disabled:!x,onClick:b,children:e.jsx(ie,{className:"w-4 h-4"})})})]})});export{we as default};
