import{q as A,r as j,x as p,j as e,E as S}from"./index-CVFz3GnQ.js";import{u as v,i as f,P as L,p as k,l as T,a1 as _,a4 as q,a6 as F,X as I,a9 as M,a7 as y}from"./index-MXZ1Fyy1.js";import{f as R}from"./format-D4js0obD.js";import{P as O}from"./pencil-D8PRgE1X.js";const P=F({name:y().min(3,"Name must be at least 3 characters"),head_id:y().uuid("Account Head is required"),entity_type:y().min(1,"Type is required"),description:y().optional(),opening_balance:M().optional()}),U=()=>{const i=A(),[n,t]=j.useState(""),[b,u]=j.useState(!1),[l,m]=j.useState(null),[o,a]=j.useState(null),{data:h,isLoading:d}=v({queryKey:["ledgers"],queryFn:async()=>(await p.get("/accounting/ledgers")).data}),{data:g}=v({queryKey:["accountHeads"],queryFn:async()=>(await p.get("/accounting/heads")).data}),C=f({mutationFn:s=>p.post("/accounting/ledgers",s),onSuccess:()=>{i.invalidateQueries({queryKey:["ledgers"]}),u(!1)},onError:s=>{var r,c;return alert("Failed to create: "+(((c=(r=s.response)==null?void 0:r.data)==null?void 0:c.message)||s.message))}}),w=f({mutationFn:s=>p.put(`/accounting/ledgers/${s.id}`,s.payload),onSuccess:()=>{i.invalidateQueries({queryKey:["ledgers"]}),m(null)},onError:s=>{var r,c;return alert("Failed to update: "+(((c=(r=s.response)==null?void 0:r.data)==null?void 0:c.message)||s.message))}}),N=f({mutationFn:s=>p.delete(`/accounting/ledgers/${s}`),onSuccess:()=>{i.invalidateQueries({queryKey:["ledgers"]}),a(null)},onError:s=>{var r,c;return alert("Failed to delete: "+(((c=(r=s.response)==null?void 0:r.data)==null?void 0:c.message)||s.message))}}),x=h==null?void 0:h.filter(s=>s.name.toLowerCase().includes(n.toLowerCase())||s.head.name.toLowerCase().includes(n.toLowerCase())),E=s=>s>=0?"text-green-600":"text-red-600";return d?e.jsx("div",{children:"Loading Ledgers..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Ledger Master List"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your chart of accounts."})]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90",children:[e.jsx(L,{className:"w-4 h-4"})," Create Account"]})]}),e.jsxs("div",{className:"flex gap-4 items-center bg-card p-4 rounded-lg border",children:[e.jsx(k,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search ledgers...",className:"bg-transparent outline-none flex-1",value:n,onChange:s=>t(s.target.value)})]}),e.jsx("div",{className:"bg-card rounded-lg border shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted text-muted-foreground font-medium border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Code"}),e.jsx("th",{className:"px-4 py-3",children:"Account Name"}),e.jsx("th",{className:"px-4 py-3",children:"Group (Head)"}),e.jsx("th",{className:"px-4 py-3",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Balance"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[x==null?void 0:x.map(s=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-xs text-muted-foreground font-mono",children:s.ledger_code||"-"}),e.jsx("td",{className:"px-4 py-3 font-medium",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground",children:s.head.name}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-xs uppercase",children:s.entity_type}),e.jsx("td",{className:`px-4 py-3 text-right font-mono ${E(s.balance)}`,children:R(s.balance)}),e.jsxs("td",{className:"px-4 py-3 text-right flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>m(s),className:"p-1 hover:bg-secondary rounded text-blue-600",title:"Edit",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>a(s),className:"p-1 hover:bg-secondary rounded text-red-600",title:"Delete",children:e.jsx(T,{className:"w-4 h-4"})})]})]},s.id)),!(x!=null&&x.length)&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-muted-foreground",children:"No ledgers found."})})]})]})}),(b||l)&&e.jsx(B,{isOpen:!0,mode:l?"EDIT":"CREATE",initialData:l||void 0,heads:g||[],onClose:()=>{u(!1),m(null)},onSubmit:s=>{l?w.mutate({id:l.id,payload:s}):C.mutate(s)},isLoading:C.isPending||w.isPending}),o&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card w-full max-w-md rounded-lg shadow-lg border p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-destructive",children:[e.jsx(S,{className:"w-6 h-6"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Delete Account?"})]}),e.jsxs("p",{className:"text-muted-foreground",children:["Are you sure you want to delete ",e.jsx("strong",{children:o.name}),"? This action cannot be undone. If there are existing transactions, deletion will fail."]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:()=>a(null),className:"px-4 py-2 rounded-md hover:bg-muted",children:"Cancel"}),e.jsx("button",{onClick:()=>N.mutate(o.id),disabled:N.isPending,className:"px-4 py-2 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90",children:N.isPending?"Deleting...":"Confirm Delete"})]})]})})]})},B=({isOpen:i,mode:n,initialData:t,heads:b,onClose:u,onSubmit:l,isLoading:m})=>{const{data:o}=v({queryKey:["nextLedgerCode"],queryFn:async()=>(await p.get("/accounting/ledgers/next-code")).data,enabled:n==="CREATE"&&i}),{register:a,handleSubmit:h,formState:{errors:d}}=_({resolver:q(P),defaultValues:{name:(t==null?void 0:t.name)||"",head_id:(t==null?void 0:t.head.id)||"",entity_type:(t==null?void 0:t.entity_type)||"INCOME",description:(t==null?void 0:t.description)||"",opening_balance:(t==null?void 0:t.balance)||0}});return i?e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card w-full max-w-2xl rounded-lg shadow-lg border p-6 space-y-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-lg",children:n==="CREATE"?"New Account":"Edit Account"}),e.jsx("button",{onClick:u,children:e.jsx(I,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsxs("form",{onSubmit:h(l),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Ledger Code"}),e.jsx("input",{className:"w-full bg-muted border rounded-md px-3 py-2 text-muted-foreground font-mono",value:n==="CREATE"?(o==null?void 0:o.nextCode)||"Loading...":(t==null?void 0:t.ledger_code)||"-",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Account Name"}),e.jsx("input",{className:"w-full bg-background border rounded-md px-3 py-2",...a("name"),placeholder:"e.g. Office Rent"}),d.name&&e.jsx("span",{className:"text-destructive text-xs",children:d.name.message})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Account Group (Head)"}),e.jsxs("select",{className:"w-full bg-background border rounded-md px-3 py-2",...a("head_id"),children:[e.jsx("option",{value:"",children:"Select Group..."}),b.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]}),d.head_id&&e.jsx("span",{className:"text-destructive text-xs",children:d.head_id.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Type"}),e.jsxs("select",{className:"w-full bg-background border rounded-md px-3 py-2",...a("entity_type"),children:[e.jsx("option",{value:"INCOME",children:"Income"}),e.jsx("option",{value:"EXPENSE",children:"Expense"}),e.jsx("option",{value:"ASSET",children:"Asset (Fixed/Current)"}),e.jsx("option",{value:"LIABILITY",children:"Liability"}),e.jsx("option",{value:"EQUITY",children:"Equity"}),e.jsx("option",{value:"BANK",children:"Bank"}),e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"VENDOR",children:"Vendor"})]}),d.entity_type&&e.jsx("span",{className:"text-destructive text-xs",children:d.entity_type.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("input",{className:"w-full bg-background border rounded-md px-3 py-2",...a("description"),placeholder:"Optional description"})]}),e.jsxs("div",{className:"space-y-2 bg-muted/50 p-3 rounded-md",children:[e.jsx("label",{className:"text-sm font-medium",children:n==="CREATE"?"Opening Balance":"Current Balance (Adjustment)"}),e.jsx("input",{type:"number",className:"w-full bg-background border rounded-md px-3 py-2",...a("opening_balance",{valueAsNumber:!0}),placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n==="CREATE"?"Will create an opening journal entry.":"Updating this will create a manual adjustment transaction."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 hover:bg-muted rounded-md text-sm",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-primary text-primary-foreground rounded-md text-sm hover:bg-primary/90",children:m?"Saving...":n==="CREATE"?"Create Account":"Update Account"})]})]})]})}):null};export{U as L};
