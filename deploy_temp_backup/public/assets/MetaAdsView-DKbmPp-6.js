import{q as $,r as R,x as S,j as e,J as z,a as K,u as G,C as H}from"./index-CVFz3GnQ.js";import{a1 as J,i as Q,S as C,B as p,I as m,u as O}from"./index-MXZ1Fyy1.js";import{L as i}from"./label-BDi2E6m5.js";import{S as P,a as q,b as V,c as B,d as u}from"./select-CRNC5CBq.js";import{T as U}from"./textarea-D2C36G61.js";import{C as w,a as T,b as I,c as k}from"./card-L7c9AA96.js";import{T as X,a as Y,b as M,c as j,d as W,e as h}from"./table-DEHLnAz_.js";import{A as D}from"./arrow-left-BOi8SXvp.js";import"./index-C_y8q7n2.js";import"./index-COFXZIMB.js";const Z=({clientId:_,initialData:a,onSuccess:s,onCancel:g})=>{const y=$(),{register:c,handleSubmit:L,reset:f,setValue:d}=J(),[v,o]=R.useState("Facebook"),[n,b]=R.useState("Engagement");R.useEffect(()=>{if(a){o(a.platform||"Facebook"),b(a.objective||"Engagement");const r=typeof a.results_json=="string"?JSON.parse(a.results_json):a.results_json||{},t={...a,date:a.date?new Date(a.date).toISOString().split("T")[0]:"",...r};f(t)}else f({}),o("Facebook"),b("Engagement")},[a,f]);const N=Q({mutationFn:async r=>{const t={engagements:r.engagements,reach:r.reach,impressions:r.impressions,leads:r.leads,cost_per_lead:r.cost_per_lead,clicks:r.clicks,cpc:r.cpc},l={client_id:_,date:r.date,campaign_name:r.campaign_name,objective:n,platform:v,spend:r.spend,results_json:t,notes:r.notes};return a!=null&&a.id?await S.patch(`/client-portal/tracking/meta-ads/${a.id}`,l):await S.post("/client-portal/tracking/meta-ads",l)},onSuccess:()=>{y.invalidateQueries({queryKey:["meta-ads-logs"]}),C.fire("Saved",`Record ${a?"updated":"added"} successfully`,"success"),a||f(),s&&s()},onError:r=>{var t,l;C.fire("Error",((l=(t=r.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to save","error")}}),A=r=>{N.mutate(r)};return e.jsxs(w,{className:`mb-8 border-primary/20 ${a?"bg-yellow-50":"bg-primary/5"}`,children:[e.jsx(T,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(I,{className:"text-lg",children:a?"Edit Daily Entry":"Add Daily Entry"}),g&&e.jsx(p,{variant:"ghost",size:"sm",onClick:g,type:"button",children:"Cancel Edit"})]})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:L(A),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Date"}),e.jsx(m,{type:"date",...c("date"),defaultValue:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Campaign Name"}),e.jsx(m,{...c("campaign_name"),placeholder:"e.g. Summer Sale",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Platform"}),e.jsxs(P,{onValueChange:o,value:v,children:[e.jsx(q,{children:e.jsx(V,{placeholder:"Platform"})}),e.jsxs(B,{children:[e.jsx(u,{value:"Facebook",children:"Facebook"}),e.jsx(u,{value:"Instagram",children:"Instagram"}),e.jsx(u,{value:"Both",children:"Both"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Objective"}),e.jsxs(P,{onValueChange:b,value:n,children:[e.jsx(q,{children:e.jsx(V,{placeholder:"Objective"})}),e.jsxs(B,{children:[e.jsx(u,{value:"Engagement",children:"Engagement"}),e.jsx(u,{value:"Leads",children:"Leads"}),e.jsx(u,{value:"Traffic",children:"Traffic"}),e.jsx(u,{value:"Sales",children:"Sales"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Spend (₹)"}),e.jsx(m,{type:"number",step:"0.01",...c("spend"),required:!0})]}),(n==="Engagement"||n==="Sales")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Engagements"}),e.jsx(m,{type:"number",...c("engagements")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Reach"}),e.jsx(m,{type:"number",...c("reach")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Impressions"}),e.jsx(m,{type:"number",...c("impressions")})]})]}),n==="Leads"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Leads Generated"}),e.jsx(m,{type:"number",...c("leads")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Cost per Lead (CPL)"}),e.jsx(m,{type:"number",step:"0.01",...c("cost_per_lead")})]})]}),n==="Traffic"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Link Clicks"}),e.jsx(m,{type:"number",...c("clicks")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"CPC"}),e.jsx(m,{type:"number",step:"0.01",...c("cpc")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Notes (Optional)"}),e.jsx(U,{...c("notes"),placeholder:"Campaign observations..."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[g&&e.jsx(p,{variant:"outline",type:"button",onClick:g,children:"Cancel"}),e.jsx(p,{type:"submit",disabled:N.isPending,children:N.isPending?"Saving...":a?"Update Record":"Save Record"})]})]})})]})},oe=()=>{const[_]=z(),a=K(),{user:s}=G(),g=$(),[y,c]=H.useState(null),L=_.get("clientId"),f=_.get("mode"),d=(s==null?void 0:s.role)==="CLIENT"?s==null?void 0:s.linked_client_id:L,v=(s==null?void 0:s.role)==="ADMIN"||(s==null?void 0:s.role)==="MANAGER"||(s==null?void 0:s.role)==="DEVELOPER_ADMIN"||(s==null?void 0:s.role)==="MARKETING_EXEC"||(s==null?void 0:s.role)==="DM_EXECUTIVE"||(s==null?void 0:s.role)==="WEB_SEO_EXECUTIVE"||(s==null?void 0:s.role)==="CREATIVE_DESIGNER"||(s==null?void 0:s.role)==="OPERATIONS_EXECUTIVE",o=v&&f==="manage",{data:n,isLoading:b}=O({queryKey:["meta-ads-logs",d],queryFn:async()=>{if(!d)return[];const{data:t}=await S.get(`/client-portal/tracking/meta-ads?clientId=${d}`);return t},enabled:!!d}),{data:N}=O({queryKey:["client-details-meta",d],queryFn:async()=>(await S.get(`/clients/${d}`)).data,enabled:!!d}),A=(t,l)=>{try{const x=typeof t.results_json=="string"?JSON.parse(t.results_json):t.results_json;return(x==null?void 0:x[l])||"-"}catch{return"-"}},r=async t=>{var x,E;if((await C.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await S.delete(`/client-portal/tracking/meta-ads/${t}`),g.invalidateQueries({queryKey:["meta-ads-logs"]}),C.fire("Deleted!","Record has been deleted.","success")}catch(F){C.fire("Error",((E=(x=F.response)==null?void 0:x.data)==null?void 0:E.message)||"Failed to delete","error")}};return d?e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>a(-1),children:[e.jsx(D,{className:"mr-2 h-4 w-4"})," Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Meta Ads Performance"}),N&&e.jsx("p",{className:"text-muted-foreground",children:N.name})]})]}),v&&!o&&e.jsx(p,{variant:"outline",onClick:()=>a(`?mode=manage&clientId=${d}`),children:"Add Entry / Manage"}),o&&e.jsx("div",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded text-xs font-bold uppercase tracking-wider",children:"Management Mode"})]}),o&&e.jsx(Z,{clientId:d,initialData:y,onSuccess:()=>c(null),onCancel:()=>c(null)}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(w,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(I,{className:"text-sm font-medium text-gray-500",children:"Total Spend"})}),e.jsx(k,{children:e.jsxs("div",{className:"text-2xl font-bold",children:["₹",n==null?void 0:n.reduce((t,l)=>t+(l.spend||0),0).toLocaleString()]})})]}),e.jsxs(w,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(I,{className:"text-sm font-medium text-gray-500",children:"Impressions"})}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:n==null?void 0:n.reduce((t,l)=>t+(Number(A(l,"impressions"))||0),0).toLocaleString()})})]})]}),e.jsxs(w,{children:[e.jsx(T,{children:e.jsx(I,{children:"Campaign History"})}),e.jsx(k,{children:b?e.jsx("div",{className:"text-center py-8",children:"Loading data..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(M,{children:[e.jsx(j,{children:"Date"}),e.jsx(j,{children:"Campaign"}),e.jsx(j,{children:"Platform"}),e.jsx(j,{children:"Objective"}),e.jsx(j,{className:"text-right",children:"Spend"}),e.jsx(j,{className:"text-right",children:"Results"}),e.jsx(j,{children:"Notes"}),o&&e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(W,{children:(n==null?void 0:n.length)>0?n.map(t=>{var x;const l=typeof t.results_json=="string"?JSON.parse(t.results_json):t.results_json;return e.jsxs(M,{className:(y==null?void 0:y.id)===t.id?"bg-yellow-50":"",children:[e.jsx(h,{children:new Date(t.date).toLocaleDateString()}),e.jsx(h,{className:"font-medium",children:t.campaign_name}),e.jsx(h,{children:t.platform}),e.jsx(h,{children:t.objective}),e.jsxs(h,{className:"text-right font-mono",children:["₹",(x=t.spend)==null?void 0:x.toLocaleString()]}),e.jsx(h,{className:"text-right text-xs text-muted-foreground",children:Object.entries(l||{}).map(([E,F])=>e.jsxs("div",{children:[E,": ",e.jsx("b",{children:F})]},E))}),e.jsx(h,{className:"max-w-[200px] truncate",title:t.notes,children:t.notes||"-"}),o&&e.jsxs(h,{className:"text-right space-x-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{window.scrollTo({top:0,behavior:"smooth"}),c(t)},children:"Edit"}),e.jsx(p,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>r(t.id),children:"Delete"})]})]},t.id)}):e.jsx(M,{children:e.jsx(h,{colSpan:o?8:7,className:"text-center h-32 text-muted-foreground",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("p",{children:"No records found."}),v&&!o&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>a(`?mode=manage&clientId=${d}`),children:"Add First Daily Entry"})]})})})})]})})})]})]}):e.jsx("div",{className:"p-8 text-center",children:"No Client Selected"})};export{oe as default};
