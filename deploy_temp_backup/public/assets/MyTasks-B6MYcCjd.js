import{u as D,a as R,q as P,r as p,j as e,x as N}from"./index-CVFz3GnQ.js";import{u as I,i as M,p as T,a3 as $,S as f}from"./index-MXZ1Fyy1.js";import{C as _}from"./clock-DRstIMdH.js";import{S as G}from"./save-Ch7_aoOB.js";const z=()=>{const{user:r}=D(),b=R(),S=P(),[u,v]=p.useState(""),[m,E]=p.useState("ALL"),[x,h]=p.useState({}),{data:g,isLoading:C}=I({queryKey:["tasks","my",r==null?void 0:r.id],queryFn:async()=>(await N.get(`/tasks?assignee_id=${r==null?void 0:r.id}`)).data,enabled:!!(r!=null&&r.id)}),y=M({mutationFn:async({taskId:s,status:t})=>await N.patch(`/tasks/${s}`,{status:t}),onSuccess:(s,t)=>{const a={...x};delete a[t.taskId],h(a),S.invalidateQueries({queryKey:["tasks","my"]}),f.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}).fire({icon:"success",title:"Status Updated"})},onError:s=>{var n,i,o,l,d;console.error("Task Update Failed:",s);let t="Failed to update status";const a=(n=s.response)==null?void 0:n.status;(o=(i=s.response)==null?void 0:i.data)!=null&&o.errors?t=s.response.data.errors.map(j=>`${j.path.join(".")}: ${j.message}`).join(`
`):(d=(l=s.response)==null?void 0:l.data)!=null&&d.message?t=s.response.data.message:a===404?t="Server endpoint not found (404). API Route missing?":a===405?t="Method Not Allowed (405). PATCH/PUT mismatch?":a===0&&(t="Network Error. Server unreachable or CORS issue."),f.fire("Error",`(${a||"?"}) ${t}`,"error")}}),c=g==null?void 0:g.filter(s=>{var n,i,o,l,d;const t=s.title.toLowerCase().includes(u.toLowerCase())||((o=(i=(n=s.campaign)==null?void 0:n.client)==null?void 0:i.name)==null?void 0:o.toLowerCase().includes(u.toLowerCase()))||((d=(l=s.campaign)==null?void 0:l.title)==null?void 0:d.toLowerCase().includes(u.toLowerCase())),a=m==="ALL"?!0:s.status===m;return t&&a}),w=s=>{switch(s){case"URGENT":return"text-red-600 bg-red-50";case"HIGH":return"text-orange-600 bg-orange-50";case"MEDIUM":return"text-blue-600 bg-blue-50";default:return"text-gray-600 bg-gray-50"}},L=(s,t)=>{h(a=>({...a,[s]:t}))},A=s=>{const t=x[s];t&&y.mutate({taskId:s,status:t})};return C?e.jsx("div",{className:"p-8",children:"Loading My Tasks..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"My Tasks"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search tasks...",className:"pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 w-64",value:u,onChange:s=>v(s.target.value)})]}),e.jsxs("select",{value:m,onChange:s=>E(s.target.value),className:"border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"PLANNED",children:"Planned"}),e.jsx("option",{value:"ASSIGNED",children:"Assigned"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"REVIEW",children:"Review"}),e.jsx("option",{value:"COMPLETED",children:"Completed"})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 font-semibold text-gray-600 text-sm",children:"Task Name"}),e.jsx("th",{className:"p-4 font-semibold text-gray-600 text-sm",children:"Campaign / Client"}),e.jsx("th",{className:"p-4 font-semibold text-gray-600 text-sm",children:"Priority"}),e.jsx("th",{className:"p-4 font-semibold text-gray-600 text-sm",children:"Due / SLA"}),e.jsx("th",{className:"p-4 font-semibold text-gray-600 text-sm",children:"Status"}),e.jsx("th",{className:"p-4 font-semibold text-gray-600 text-sm w-32",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[c==null?void 0:c.map(s=>{var n,i,o,l;const t=x[s.id]||s.status,a=!!x[s.id];return e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.type," â€¢ ",s.nature]})]}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:((n=s.client)==null?void 0:n.name)||((o=(i=s.campaign)==null?void 0:i.client)==null?void 0:o.name)||"General / No Client"}),e.jsx("div",{className:"text-xs text-gray-500",children:((l=s.campaign)==null?void 0:l.title)||(s.client?"Direct Task":"-")})]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${w(s.priority)}`,children:s.priority})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{size:14,className:s.sla_status==="BREACHED"?"text-red-500":"text-gray-400"}),e.jsx("span",{className:`text-sm ${s.sla_status==="BREACHED"?"text-red-600 font-bold":"text-gray-600"}`,children:s.due_date?new Date(s.due_date).toLocaleDateString():s.sla_target?new Date(s.sla_target).toLocaleDateString():"-"})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("select",{value:t,onChange:d=>L(s.id,d.target.value),className:`
                                                text-sm px-2 py-1.5 rounded border focus:outline-none focus:ring-2 focus:ring-purple-200
                                                ${t==="COMPLETED"?"bg-green-50 text-green-900 border-green-200":""}
                                                ${t==="IN_PROGRESS"?"bg-blue-50 text-blue-900 border-blue-200":""}
                                                ${["PLANNED","ASSIGNED"].includes(t)?"bg-gray-100 text-gray-700 border-gray-200":""}
                                                ${a?"ring-2 ring-yellow-400 border-yellow-500":""} 
                                            `,children:[e.jsx("option",{value:"ASSIGNED",children:"Assigned"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"REVIEW",children:"Under Review"}),e.jsx("option",{value:"REVISION_REQUESTED",children:"Revision Needed"}),e.jsx("option",{value:"COMPLETED",children:"Completed"})]})}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center gap-2",children:a?e.jsxs("button",{onClick:()=>A(s.id),disabled:y.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-600 text-white text-xs font-bold rounded-md hover:bg-green-700 shadow-sm animate-in zoom-in",title:"Save Status",children:[e.jsx(G,{size:14}),"Save"]}):e.jsx("button",{onClick:()=>b(`/dashboard/tasks/${s.id}`),className:"flex items-center gap-1 px-3 py-1.5 text-gray-500 hover:bg-gray-100 rounded-md text-xs font-medium transition-colors",children:"Details"})})})]},s.id)}),(c==null?void 0:c.length)===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx($,{size:32,className:"text-gray-300"}),e.jsx("p",{children:"No tasks found assigned to you. Enjoy your day!"})]})})})]})]})})]})};export{z as default};
