import{r as g,x as F,j as e,u as Y,q}from"./index-CVFz3GnQ.js";import{a1 as B,i as K,D as $,a as W,d as Q,e as U,I as P,k as G,B as O,u as H,C as z}from"./index-MXZ1Fyy1.js";import{C as j,a as S,b as v,c as f}from"./card-L7c9AA96.js";import{S as k,a as E,b as w,c as C,d as x}from"./select-CRNC5CBq.js";import{B as J}from"./badge-DB3i4Vcz.js";import{L as I}from"./label-BDi2E6m5.js";import{C as X}from"./clock-DRstIMdH.js";import"./index-C_y8q7n2.js";import"./index-COFXZIMB.js";const Z=({isOpen:r,onClose:d,dayData:t,userId:o,onSuccess:_})=>{const{register:h,handleSubmit:D,setValue:c,watch:y}=B({defaultValues:{status:"PRESENT",check_in:"",check_out:"",work_hours:0}});g.useEffect(()=>{var l,i;if(t){if(c("status",t.status==="HOLIDAY"||t.status==="LEAVE"||t.status==="WEEKOFF"?"PRESENT":t.status),(l=t.details)!=null&&l.check_in){const n=new Date(t.details.check_in).toTimeString().slice(0,5);c("check_in",n)}if((i=t.details)!=null&&i.check_out){const n=new Date(t.details.check_out).toTimeString().slice(0,5);c("check_out",n)}}},[t,c]);const m=K({mutationFn:async l=>{const i=t.date;let p=null,n=null;return l.check_in&&(p=new Date(`${i}T${l.check_in}:00`).toISOString()),l.check_out&&(n=new Date(`${i}T${l.check_out}:00`).toISOString()),F.post("/attendance/admin/update",{userId:o,date:i,status:l.status,check_in:p,check_out:n})},onSuccess:()=>{_(),d()},onError:l=>alert("Failed to update: "+l.message)}),A=l=>{m.mutate(l)};return e.jsx($,{open:r,onOpenChange:d,children:e.jsxs(W,{children:[e.jsx(Q,{children:e.jsxs(U,{children:["Edit Attendance - ",t==null?void 0:t.date]})}),e.jsxs("form",{onSubmit:D(A),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Status"}),e.jsxs(k,{onValueChange:l=>c("status",l),defaultValue:y("status"),children:[e.jsx(E,{children:e.jsx(w,{placeholder:"Select Status"})}),e.jsxs(C,{children:[e.jsx(x,{value:"PRESENT",children:"Present"}),e.jsx(x,{value:"ABSENT",children:"Absent"}),e.jsx(x,{value:"HALF_DAY",children:"Half Day"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Check In Time"}),e.jsx(P,{type:"time",...h("check_in")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Check Out Time"}),e.jsx(P,{type:"time",...h("check_out")})]})]}),e.jsxs(G,{children:[e.jsx(O,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),e.jsx(O,{type:"submit",disabled:m.isPending,children:m.isPending?"Updating...":"Save Changes"})]})]})]})})},oe=()=>{const{user:r}=Y(),d=(r==null?void 0:r.role)==="ADMIN"||(r==null?void 0:r.role)==="MANAGER"||(r==null?void 0:r.role)==="DEVELOPER_ADMIN",t=q(),[o,_]=g.useState("me"),[h,D]=g.useState((new Date().getMonth()+1).toString()),[c,y]=g.useState(new Date().getFullYear().toString()),[m,A]=g.useState(null),[l,i]=g.useState(!1),{data:p=[]}=H({queryKey:["staff-list"],queryFn:async()=>(await F.get("/team/staff")).data,enabled:d}),{data:n,isLoading:ee}=H({queryKey:["payroll-calendar",o,h,c],queryFn:async()=>{const s={month:h,year:c};return o!=="me"&&(s.userId=o),(await F.get("/attendance/calendar",{params:s})).data}}),T=(n==null?void 0:n.calendar)||[],b=(n==null?void 0:n.stats)||{totalDays:0,holidays:0,leaves:0,workingDays:0},R=s=>{d&&(A(s),i(!0))};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(z,{className:"w-6 h-6 text-purple-600"}),"Payroll Calendar"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[d&&e.jsx("div",{className:"w-[200px]",children:e.jsxs(k,{value:o,onValueChange:_,children:[e.jsx(E,{children:e.jsx(w,{placeholder:"Select Staff"})}),e.jsxs(C,{children:[e.jsx(x,{value:"me",children:"My Calendar"}),p.map(s=>e.jsx(x,{value:s.user_id,children:s.user.full_name},s.user_id))]})]})}),e.jsxs(k,{value:h,onValueChange:D,children:[e.jsx(E,{className:"w-[120px]",children:e.jsx(w,{placeholder:"Month"})}),e.jsx(C,{children:Array.from({length:12},(s,a)=>e.jsx(x,{value:(a+1).toString(),children:new Date(0,a).toLocaleString("default",{month:"long"})},a+1))})]}),e.jsxs(k,{value:c,onValueChange:y,children:[e.jsx(E,{className:"w-[100px]",children:e.jsx(w,{placeholder:"Year"})}),e.jsx(C,{children:Array.from({length:5},(s,a)=>{const u=new Date().getFullYear()-2+a;return e.jsx(x,{value:u.toString(),children:u},u)})})]}),e.jsx(O,{variant:"outline",onClick:()=>t.invalidateQueries({queryKey:["payroll-calendar"]}),children:"Refresh"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(j,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:"Total Days"})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:b.totalDays})})]}),e.jsxs(j,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:"Holidays"})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:b.holidays})})]}),e.jsxs(j,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:"Leaves"})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.leaves})})]}),e.jsxs(j,{className:"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800",children:[e.jsx(S,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium text-purple-900 dark:text-purple-300",children:"Effective Working Days"})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-400",children:b.workingDays})})]})]}),e.jsx(j,{children:e.jsxs(f,{className:"p-0",children:[e.jsx("div",{className:"grid grid-cols-7 border-b text-center font-semibold bg-muted/50",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"p-3 border-r last:border-r-0",children:s},s))}),e.jsxs("div",{className:"grid grid-cols-7",children:[(()=>{if(T.length===0)return null;const s=T[0].date,a=new Date(s).getDay();return Array.from({length:a}).map((u,N)=>e.jsx("div",{className:"h-32 border-b border-r bg-muted/10"},`pad-${N}`))})(),T.map(s=>{var u,N,L,V,M;let a="";return s.status==="HOLIDAY"?a="bg-yellow-50 dark:bg-yellow-900/20":s.status==="LEAVE"?a="bg-red-50 dark:bg-red-900/20":s.status==="WEEKOFF"?a="bg-slate-50 dark:bg-slate-900/10":s.status==="PRESENT"?a="bg-green-50 dark:bg-green-900/20":s.status==="ABSENT"&&new Date(s.date)<new Date&&(a="bg-red-50/50"),e.jsxs("div",{className:`h-32 border-b border-r p-2 hover:bg-slate-100 transition-colors cursor-pointer relative group ${a}`,onClick:()=>R(s),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:`text-sm font-medium ${s.status==="HOLIDAY"?"text-yellow-700":""}`,children:s.day}),s.status!=="WEEKOFF"&&s.status!=="ABSENT"&&e.jsx(J,{variant:"outline",className:"text-[10px] uppercase",children:s.status})]}),e.jsxs("div",{className:"mt-2 text-xs space-y-1",children:[s.status==="PRESENT"&&s.details&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1 text-green-700",children:[e.jsx(X,{className:"w-3 h-3"}),new Date(s.details.check_in).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"-",s.details.check_out?new Date(s.details.check_out).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"..."]}),s.details.work_hours&&e.jsxs("div",{className:"text-muted-foreground",children:[s.details.work_hours.toFixed(1)," hrs"]})]}),s.status==="HOLIDAY"&&e.jsx("div",{className:"text-yellow-700 truncate font-medium",title:(u=s.details)==null?void 0:u.name,children:(N=s.details)==null?void 0:N.name}),s.status==="LEAVE"&&e.jsxs("div",{className:"text-red-700 truncate",title:(L=s.details)==null?void 0:L.reason,children:[(V=s.details)==null?void 0:V.type," - ",(M=s.details)==null?void 0:M.reason]})]}),d&&e.jsx("div",{className:"absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 flex items-center justify-center pointer-events-none",children:e.jsx("span",{className:"text-xs font-semibold bg-white px-2 py-1 rounded shadow",children:"Edit"})})]},s.date)})]})]})}),l&&m&&e.jsx(Z,{isOpen:l,onClose:()=>i(!1),dayData:m,userId:o==="me"?(r==null?void 0:r.id)||"":o,onSuccess:()=>{t.invalidateQueries({queryKey:["payroll-calendar"]}),i(!1)}})]})};export{oe as default};
