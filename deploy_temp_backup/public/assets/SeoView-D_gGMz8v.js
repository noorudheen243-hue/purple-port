import{q as V,r as R,x as z,j as e,J as H,a as J,u as U}from"./index-CVFz3GnQ.js";import{a1 as G,a2 as D,i as X,S as K,I as p,B as d,P as F,u as P,T as $,p as Q}from"./index-MXZ1Fyy1.js";import{L as u}from"./label-BDi2E6m5.js";import{T as Y}from"./textarea-D2C36G61.js";import{C as v,a as b,b as k,c as w,d as W}from"./card-L7c9AA96.js";import{T as q}from"./trash-C_jM1Hr1.js";import{S as Z}from"./save-Ch7_aoOB.js";import{T as ee,a as se,b as L,c as O,d as ae,e as A}from"./table-DEHLnAz_.js";import{B as te}from"./badge-DB3i4Vcz.js";import{A as ie}from"./arrow-left-BOi8SXvp.js";import{C as B}from"./check-circle-C7q7Y3EO.js";const ne=({clientId:S,onSuccess:o})=>{const s=V(),E=new Date,[_,r]=R.useState(E.getMonth()+1),[m,x]=R.useState(E.getFullYear()),{register:t,control:N,handleSubmit:C,reset:c}=G({defaultValues:{organic_traffic:0,summary:"",activities:[{activity:""}],rankings:[{keyword:"",rank:"",change:""}]}}),{fields:T,append:I,remove:i}=D({control:N,name:"activities"}),{fields:M,append:h,remove:g}=D({control:N,name:"rankings"}),y=X({mutationFn:async a=>{const n=a.activities.map(f=>f.activity).filter(f=>f.trim()!==""),j=a.rankings.filter(f=>f.keyword.trim()!=="");return await z.post("/client-portal/tracking/seo",{client_id:S,month:_,year:m,organic_traffic:a.organic_traffic,summary:a.summary,activities_json:n,keyword_rankings_json:j})},onSuccess:()=>{s.invalidateQueries({queryKey:["seo-logs"]}),K.fire("Saved","SEO Monthly Log updated successfully","success"),o&&o()},onError:a=>{var n,j;K.fire("Error",((j=(n=a.response)==null?void 0:n.data)==null?void 0:j.message)||"Failed to save","error")}}),l=a=>{y.mutate(a)};return e.jsxs(v,{className:"mb-8 border-primary/20 bg-primary/5",children:[e.jsx(b,{children:e.jsx(k,{className:"text-lg",children:"Update Monthly SEO Log"})}),e.jsx(w,{children:e.jsxs("form",{onSubmit:C(l),className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"w-1/3 space-y-2",children:[e.jsx(u,{children:"Month"}),e.jsx(p,{type:"number",min:"1",max:"12",value:_,onChange:a=>r(parseInt(a.target.value)),required:!0})]}),e.jsxs("div",{className:"w-1/3 space-y-2",children:[e.jsx(u,{children:"Year"}),e.jsx(p,{type:"number",min:"2020",max:"2030",value:m,onChange:a=>x(parseInt(a.target.value)),required:!0})]}),e.jsxs("div",{className:"w-1/3 space-y-2",children:[e.jsx(u,{children:"Organic Traffic"}),e.jsx(p,{type:"number",...t("organic_traffic"),placeholder:"e.g. 5400"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Monthly Summary / Highlights"}),e.jsx(Y,{...t("summary"),placeholder:"Executive summary of SEO progress this month..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Key Activities Performed"}),e.jsx(d,{type:"button",size:"sm",variant:"ghost",onClick:()=>I({activity:""}),children:e.jsx(F,{size:16})})]}),T.map((a,n)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{...t(`activities.${n}.activity`),placeholder:"e.g. Optimized Home Page Meta Tags"}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>i(n),children:e.jsx(q,{size:16})})]},a.id))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Keyword Rankings Snapshot"}),e.jsx(d,{type:"button",size:"sm",variant:"ghost",onClick:()=>h({keyword:"",rank:"",change:""}),children:e.jsx(F,{size:16})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs font-semibold text-muted-foreground px-1",children:[e.jsx("div",{className:"col-span-5",children:"Keyword"}),e.jsx("div",{className:"col-span-3",children:"Rank"}),e.jsx("div",{className:"col-span-3",children:"Change"}),e.jsx("div",{className:"col-span-1"})]}),M.map((a,n)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-5",children:e.jsx(p,{...t(`rankings.${n}.keyword`),placeholder:"Keyword"})}),e.jsx("div",{className:"col-span-3",children:e.jsx(p,{...t(`rankings.${n}.rank`),placeholder:"#"})}),e.jsx("div",{className:"col-span-3",children:e.jsx(p,{...t(`rankings.${n}.change`),placeholder:"+/-"})}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx(d,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500",onClick:()=>g(n),children:e.jsx(q,{size:14})})})]},a.id))]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs(d,{type:"submit",disabled:y.isPending,children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),y.isPending?"Saving...":"Save Monthly Log"]})})]})})]})},ye=()=>{var T,I;const[S]=H(),o=J(),{user:s}=U(),E=S.get("clientId"),_=S.get("mode"),r=(s==null?void 0:s.role)==="CLIENT"?s==null?void 0:s.linked_client_id:E,m=(s==null?void 0:s.role)==="ADMIN"||(s==null?void 0:s.role)==="MANAGER"||(s==null?void 0:s.role)==="DEVELOPER_ADMIN"||(s==null?void 0:s.role)==="MARKETING_EXEC"||(s==null?void 0:s.role)==="DM_EXECUTIVE"||(s==null?void 0:s.role)==="WEB_SEO_EXECUTIVE"||(s==null?void 0:s.role)==="CREATIVE_DESIGNER"||(s==null?void 0:s.role)==="OPERATIONS_EXECUTIVE",x=m&&_==="manage",{data:t,isLoading:N}=P({queryKey:["seo-logs",r],queryFn:async()=>{if(!r)return[];const{data:i}=await z.get(`/client-portal/tracking/seo?clientId=${r}`);return i},enabled:!!r}),{data:C}=P({queryKey:["client-details-seo",r],queryFn:async()=>(await z.get(`/clients/${r}`)).data,enabled:!!r});if(!r)return e.jsx("div",{className:"p-8 text-center",children:"No Client Selected"});const c=t&&t.length>0?t[0]:null;return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>o(-1),children:[e.jsx(ie,{className:"mr-2 h-4 w-4"})," Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"SEO Performance"}),C&&e.jsx("p",{className:"text-muted-foreground",children:C.name})]})]}),m&&!x&&e.jsx(d,{variant:"outline",onClick:()=>o(`?mode=manage&clientId=${r}`),children:"Add Entry / Manage"}),x&&e.jsx("div",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded text-xs font-bold uppercase tracking-wider",children:"Management Mode"})]}),x&&e.jsx(ne,{clientId:r}),c&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(v,{className:"bg-gradient-to-br from-blue-50 to-white border-blue-100",children:[e.jsx(b,{className:"pb-2",children:e.jsxs(k,{className:"text-sm font-medium text-blue-800 flex items-center gap-2",children:[e.jsx($,{size:16})," Organic Traffic (",new Date(0,c.month-1).toLocaleString("default",{month:"short"}),")"]})}),e.jsx(w,{children:e.jsx("div",{className:"text-4xl font-bold text-blue-900",children:c.organic_traffic.toLocaleString()})})]}),e.jsxs(v,{children:[e.jsx(b,{className:"pb-2",children:e.jsxs(k,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(B,{size:16})," Key Activities"]})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold",children:((T=typeof c.activities_json=="string"?JSON.parse(c.activities_json):c.activities_json)==null?void 0:T.length)||0})})]}),e.jsxs(v,{children:[e.jsx(b,{className:"pb-2",children:e.jsxs(k,{className:"text-sm font-medium text-gray-600 flex items-center gap-2",children:[e.jsx(Q,{size:16})," Keywords Tracked"]})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold",children:((I=typeof c.keyword_rankings_json=="string"?JSON.parse(c.keyword_rankings_json):c.keyword_rankings_json)==null?void 0:I.length)||0})})]})]}),e.jsxs("div",{className:"space-y-8",children:[N&&e.jsx("div",{className:"text-center py-8",children:"Loading SEO data..."}),!N&&(!t||t.length===0)&&e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-gray-50 border-dashed",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No SEO reports found."}),m&&!x&&e.jsx(d,{onClick:()=>o(`?mode=manage&clientId=${r}`),children:"Add First Daily Entry"})]}),t==null?void 0:t.map((i,M)=>{const h=typeof i.activities_json=="string"?JSON.parse(i.activities_json):i.activities_json,g=typeof i.keyword_rankings_json=="string"?JSON.parse(i.keyword_rankings_json):i.keyword_rankings_json,y=new Date(0,i.month-1).toLocaleString("default",{month:"long"});return e.jsxs(v,{className:"overflow-hidden",children:[e.jsx(b,{className:"bg-gray-50/50 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m&&!x&&t&&t.length>0&&M===0&&e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>o(`?mode=manage&clientId=${r}`),children:"Add New"}),e.jsxs("div",{className:"bg-white border rounded-lg px-3 py-1.5 text-center shadow-sm",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:y.slice(0,3)}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:i.year})]}),e.jsxs("div",{children:[e.jsxs(k,{className:"text-lg",children:[y," Report"]}),e.jsxs(W,{children:["Generated on ",new Date(i.updatedAt).toLocaleDateString()]})]})]}),e.jsxs(te,{variant:"outline",className:"bg-white",children:["Traffic: ",i.organic_traffic.toLocaleString()]})]})}),e.jsxs(w,{className:"p-6 space-y-6",children:[i.summary&&e.jsxs("div",{className:"bg-blue-50/50 p-4 rounded-lg border border-blue-100 text-sm text-blue-900",children:[e.jsx("span",{className:"font-bold block mb-1",children:"Executive Summary:"}),i.summary]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(B,{size:14,className:"text-green-600"})," Completed Activities"]}),e.jsxs("ul",{className:"space-y-2",children:[h==null?void 0:h.map((l,a)=>e.jsxs("li",{className:"text-sm text-gray-600 flex items-start gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-300 mt-1.5 shrink-0"}),l]},a)),(!h||h.length===0)&&e.jsx("li",{className:"text-xs text-muted-foreground italic",children:"No activities recorded."})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-sm text-gray-700",children:[e.jsx($,{size:14,className:"text-indigo-600"})," Keyword Rankings"]}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsx("div",{className:"min-w-[400px]",children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(L,{className:"bg-gray-50 hover:bg-gray-50 h-8",children:[e.jsx(O,{className:"h-8 text-xs",children:"Keyword"}),e.jsx(O,{className:"h-8 text-xs text-right",children:"Rank"}),e.jsx(O,{className:"h-8 text-xs text-right",children:"Change"})]})}),e.jsxs(ae,{children:[g==null?void 0:g.map((l,a)=>{var n,j;return e.jsxs(L,{className:"h-8 text-xs",children:[e.jsx(A,{className:"font-medium p-2",children:l.keyword}),e.jsx(A,{className:"text-right p-2",children:l.rank}),e.jsx(A,{className:`text-right p-2 font-medium ${(n=l.change)!=null&&n.includes("+")?"text-green-600":(j=l.change)!=null&&j.includes("-")?"text-red-500":"text-gray-500"}`,children:l.change})]},a)}),(!g||g.length===0)&&e.jsx(L,{children:e.jsx(A,{colSpan:3,className:"text-center text-xs text-muted-foreground p-4",children:"No rankings recorded."})})]})]})})})]})]})]})]},i.id)})]})]})};export{ye as default};
