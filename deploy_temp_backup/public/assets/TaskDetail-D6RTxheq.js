import{v as ie,K as le,u as ne,q as oe,r as p,C as U,j as e,L as de,x as o}from"./index-CVFz3GnQ.js";import{u as ce,i as h,j as f,f as me,r as xe,_ as ue,J as d,F as H,Q as pe,l as he,v as ge,D as fe,a as be,X as ye,S as G}from"./index-MXZ1Fyy1.js";import{A as je}from"./arrow-left-BOi8SXvp.js";import{C as X}from"./clock-DRstIMdH.js";import{P as ve}from"./pencil-D8PRgE1X.js";import{L as Ne}from"./link-DaAnAjwX.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=ie("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Ee=()=>{var M,E,T,L,z,A,F,O,$,q,K,Q,I;const{id:i}=le(),{user:ke}=ne(),c=oe(),[j,v]=p.useState(!1),[b,k]=p.useState(""),[N,S]=p.useState(""),[r,y]=p.useState(null),[J,_]=p.useState(0),[m,D]=p.useState(""),{data:s,isLoading:V}=ce({queryKey:["task",i],queryFn:async()=>{const{data:t}=await o.get(`/tasks/${i}`);return t}});U.useEffect(()=>{s&&s.status&&D(s.status)},[s]);const n=(M=s==null?void 0:s.timeLogs)==null?void 0:M[0];U.useEffect(()=>{let t;if(n){const a=new Date(n.start_time).getTime();t=setInterval(()=>{const l=new Date().getTime();_(Math.floor((l-a)/1e3))},1e3)}else _(0);return()=>clearInterval(t)},[n]);const x=h({mutationFn:async t=>await o.put(`/tasks/${i}`,t),onSuccess:(t,a)=>{if(c.invalidateQueries({queryKey:["task",i]}),v(!1),a.status){const l=a.status;l!=="PLANNED"&&l!=="COMPLETED"&&!n?u.mutate("start"):l==="COMPLETED"&&n&&u.mutate("stop")}G.fire({icon:"success",title:"Task saved Successfully",text:a.status?`Status updated to ${a.status.replace("_"," ")}`:void 0,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}}),u=h({mutationFn:async t=>await o.post(`/tasks/${i}/timer/${t}`),onSuccess:()=>c.invalidateQueries({queryKey:["task",i]})});h({mutationFn:async t=>await o.patch(`/tasks/${i}`,{status:t}),onSuccess:(t,a)=>{c.invalidateQueries({queryKey:["task",i]}),a!=="PLANNED"&&a!=="COMPLETED"&&!n?u.mutate("start"):a==="COMPLETED"&&n&&u.mutate("stop")}});const Y=h({mutationFn:async t=>await o.delete(`/assets/${t}`),onSuccess:()=>c.invalidateQueries({queryKey:["task",i]})}),Z=h({mutationFn:async t=>{if(t.size>50*1024*1024){alert("File size exceeds 50MB limit.");return}const a=new FormData;a.append("file",t);const l=await o.post("/upload",a,{headers:{"Content-Type":"multipart/form-data"}});return await o.post("/assets",{task_id:i,original_name:t.name,file_url:l.data.url,file_type:t.type,size_bytes:t.size})},onSuccess:()=>c.invalidateQueries({queryKey:["task",i]})}),C=h({mutationFn:async t=>await o.post("/comments",{task_id:i,content:t}),onSuccess:()=>{c.invalidateQueries({queryKey:["task",i]}),S("")}}),ee=t=>{const a=Math.floor(t/3600),l=Math.floor(t%3600/60),w=t%60;return`${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`},te=()=>{x.mutate({description:b})},se=t=>{var a;(a=t.target.files)!=null&&a[0]&&Z.mutate(t.target.files[0])},P=t=>{t.preventDefault(),N.trim()&&C.mutate(N)},ae=()=>{const t={};m&&m!==s.status&&(t.status=m),j&&b!==s.description&&(t.description=b),Object.keys(t).length>0?x.mutate(t):(c.invalidateQueries({queryKey:["task",i]}),G.fire({icon:"success",title:"Task saved Successfully",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}))};if(V)return e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading task..."});if(!s)return e.jsx("div",{className:"p-8 text-center text-red-500",children:"Task not found"});const re=`QIX${(s.sequence_id||0).toString().padStart(8,"0")}`;return e.jsxs("div",{className:"h-full flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(de,{to:"/dashboard/tasks",className:"text-gray-500 hover:text-gray-700",children:e.jsx(je,{size:20})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-xl font-bold",children:s.title}),e.jsx("span",{className:"text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-500",children:re})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full font-medium ${s.status==="COMPLETED"?"bg-green-100 text-green-700":s.status==="IN_PROGRESS"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:s.status.replace("_"," ")}),s.priority&&e.jsxs("span",{className:"uppercase",children:[s.priority," Priority"]}),e.jsxs("span",{children:["• Created ",f(new Date(s.createdAt),"MMM d, yyyy")]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:ae,disabled:x.isPending,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-bold text-white shadow-md transition-all
                            ${m!==s.status?"bg-amber-500 hover:bg-amber-600 animate-pulse":"bg-green-600 hover:bg-green-700"}
                        `,children:x.isPending?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(me,{size:18})," ",m!==s.status?"Save Pending Changes":"Save Task"]})}),e.jsx("div",{className:"h-8 w-px bg-gray-200 mx-2"}),n?e.jsxs("div",{className:"flex items-center gap-3 bg-red-50 px-3 py-1.5 rounded-full border border-red-100 animate-pulse",children:[e.jsx(X,{size:16,className:"text-red-500"}),e.jsx("span",{className:"font-mono font-bold text-red-600 w-16 text-center",children:ee(J)}),e.jsx("button",{onClick:()=>u.mutate("stop"),className:"w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center",title:"Stop Timer",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-sm"})})]}):e.jsxs("button",{onClick:()=>u.mutate("start"),className:"flex items-center gap-2 px-3 py-1.5 bg-green-50 text-green-700 rounded-full hover:bg-green-100 border border-green-200 transition-colors",children:[e.jsx(we,{size:14})," ",e.jsx("span",{className:"text-xs font-semibold",children:"Start Timer"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 max-w-7xl mx-auto h-full",children:[e.jsxs("div",{className:"lg:col-span-2 flex flex-col gap-6 overflow-y-auto pr-2",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-sm group relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Description"}),!j&&e.jsx("button",{onClick:()=>{k(s.description||""),v(!0)},className:"opacity-0 group-hover:opacity-100 transition-opacity p-2 hover:bg-gray-100 rounded-full text-gray-500 hover:text-purple-600",title:"Edit Description",children:e.jsx(ve,{size:16})})]}),j?e.jsxs("div",{className:"space-y-3 animate-in fade-in",children:[e.jsx("textarea",{value:b,onChange:t=>k(t.target.value),className:"w-full p-3 border rounded-md min-h-[150px] focus:ring-2 focus:ring-purple-200 outline-none resize-y",placeholder:"Enter task description...",autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:te,disabled:x.isPending,className:"px-4 py-2 text-sm bg-purple-600 text-white hover:bg-purple-700 rounded-md flex items-center gap-2",children:x.isPending?"Saving...":"Save Changes"})]})]}):e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap leading-relaxed text-sm",children:s.description||e.jsx("span",{className:"italic text-gray-400",children:"No description provided."})})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(xe,{size:18})," Reference Attachments"]}),e.jsxs("label",{className:"cursor-pointer text-purple-600 hover:text-purple-700 text-sm font-medium flex items-center gap-2 bg-purple-50 px-3 py-1.5 rounded-lg border border-purple-100 hover:bg-purple-100 transition-colors",children:[e.jsx(ue,{size:14})," Upload New",e.jsx("input",{type:"file",className:"hidden",multiple:!0,onChange:se})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[((E=s.assets)==null?void 0:E.length)===0&&e.jsx("div",{className:"col-span-full text-sm text-muted-foreground italic text-center py-6 bg-gray-50 rounded-lg border border-dashed",children:"No attachments found."}),(T=s.assets)==null?void 0:T.map(t=>{var W,R,B;const a=(W=t.file_type)==null?void 0:W.startsWith("image/"),l=(R=t.file_type)==null?void 0:R.startsWith("video/"),w=t.file_type==="link/url"||((B=t.file_type)==null?void 0:B.includes("link"));return e.jsxs("div",{className:"relative group bg-white border border-gray-200 rounded-lg overflow-hidden flex flex-col hover:shadow-md transition-all h-40",children:[e.jsxs("div",{className:"flex-1 bg-gray-100 flex items-center justify-center overflow-hidden relative cursor-pointer",onClick:()=>y(t),children:[a?e.jsx("img",{src:d(t.file_url),className:"w-full h-full object-cover"}):l?e.jsx("video",{src:d(t.file_url),className:"w-full h-full object-cover opacity-80"}):w?e.jsxs("div",{className:"text-center px-4 w-full flex flex-col items-center",children:[e.jsx(Ne,{size:24,className:"text-blue-500 mb-2"}),e.jsx("a",{href:t.file_url.startsWith("http")?t.file_url:`https://${t.file_url}`,target:"_blank",rel:"noopener noreferrer",onClick:g=>g.stopPropagation(),className:"text-[10px] text-blue-600 block w-full hover:text-blue-800 break-all leading-tight bg-blue-50/50 px-2 py-1 rounded",children:t.original_name||t.file_url})]}):e.jsx(H,{size:32,className:"text-gray-400"}),e.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),y(t)},className:"bg-white text-gray-800 p-1.5 rounded-full hover:bg-purple-50 hover:text-purple-600",children:e.jsx(pe,{size:16})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),Y.mutate(t.id)},className:"bg-white text-red-600 p-1.5 rounded-full hover:bg-red-50",children:e.jsx(he,{size:16})})]})]}),e.jsxs("div",{className:"p-2 bg-white border-t text-xs",children:[e.jsx("div",{className:"font-medium truncate",title:t.original_name,children:t.original_name}),e.jsx("div",{className:"text-gray-400 text-[10px]",children:f(new Date(t.createdAt),"MMM d, h:mm a")})]})]},t.id)})]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg flex flex-col shadow-sm overflow-hidden min-h-[400px]",children:[e.jsx("div",{className:"p-4 border-b font-semibold bg-muted/30",children:"Activity & Comments"}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:(L=s.comments)==null?void 0:L.map(t=>t.content.startsWith("System:")?e.jsx("div",{className:"flex justify-center my-4",children:e.jsxs("span",{className:"text-xs text-center bg-gray-100 text-gray-500 px-3 py-1 rounded-full border border-gray-200 shadow-sm",children:[t.content.replace("System: ",""),e.jsxs("span",{className:"ml-2 text-[10px] text-gray-400 opacity-75",children:["• ",f(new Date(t.createdAt),"h:mm a, MMM d")]})]})},t.id):e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-xs font-bold shrink-0 overflow-hidden",children:t.author.avatar_url?e.jsx("img",{src:d(t.author.avatar_url),alt:"Avatar",className:"w-full h-full object-cover"}):t.author.full_name.charAt(0)}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-sm",children:t.author.full_name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:f(new Date(t.createdAt),"MMM d, h:mm a")})]}),e.jsx("div",{className:"text-sm text-foreground bg-muted/30 p-3 rounded-md whitespace-pre-wrap",children:t.content})]})]},t.id))}),e.jsx("div",{className:"p-4 border-t bg-background",children:e.jsxs("form",{onSubmit:P,className:"flex gap-2 items-end",children:[e.jsx("textarea",{className:"flex-1 min-h-[40px] max-h-[120px] px-3 py-2 rounded-md border border-input bg-background resize-y text-sm",placeholder:"Write a comment... (Shift+Enter for new line)",value:N,onChange:t=>S(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),P(t))}}),e.jsx("button",{type:"submit",className:"bg-primary text-primary-foreground h-10 w-10 flex items-center justify-center rounded-md hover:bg-primary/90 mb-0.5",disabled:C.isPending,children:e.jsx(ge,{size:18})})]})})]})]}),e.jsxs("div",{className:"lg:col-span-1 grid grid-cols-1 gap-3 content-start",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm sticky top-0",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase mb-2 block",children:"Status"}),e.jsxs("select",{className:"w-full p-2 border rounded-md text-sm bg-gray-50 mb-2",value:m,onChange:t=>D(t.target.value),children:[e.jsx("option",{value:"PLANNED",children:"Planned"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"COMPLETED",children:"Completed"}),e.jsx("option",{value:"ON_HOLD",children:"On Hold"})]}),m!==s.status&&e.jsx("p",{className:"text-[10px] text-amber-600 font-medium animate-pulse",children:"* Change pending save"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gray-500 uppercase mb-3 flex items-center gap-2",children:[e.jsx(X,{size:12})," Status History"]}),e.jsxs("div",{className:"space-y-3 max-h-[200px] overflow-y-auto pr-1",children:[((z=s.comments)==null?void 0:z.filter(t=>t.content.startsWith("System:")).length)===0&&e.jsx("p",{className:"text-xs text-gray-400 italic",children:"No status changes recorded."}),(A=s.comments)==null?void 0:A.filter(t=>t.content.startsWith("System:")).map(t=>e.jsxs("div",{className:"text-xs border-l-2 border-purple-200 pl-2 py-1",children:[e.jsx("div",{className:"text-gray-700 font-medium",children:t.content.replace("System: ","").split(" by ")[0]}),e.jsxs("div",{className:"text-[10px] text-gray-500 flex justify-between mt-1",children:[e.jsx("span",{children:t.content.split(" by ")[1]||"System"}),e.jsx("span",{children:f(new Date(t.createdAt),"MMM d, h:mm a")})]})]},t.id))]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm space-y-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"Assignment Details"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Assigned By:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[(F=s.assigned_by)!=null&&F.avatar_url?e.jsx("img",{src:d(s.assigned_by.avatar_url),className:"w-6 h-6 rounded-full object-cover"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600",children:(($=(O=s.assigned_by)==null?void 0:O.full_name)==null?void 0:$.charAt(0))||"?"}),e.jsx("span",{className:"font-medium",children:((q=s.assigned_by)==null?void 0:q.full_name)||"System"})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Assigned To:"}),e.jsx("div",{className:"flex items-center gap-2",children:s.assignee?e.jsxs(e.Fragment,{children:[s.assignee.avatar_url?e.jsx("img",{src:d(s.assignee.avatar_url),className:"w-6 h-6 rounded-full object-cover"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-100 text-purple-700 flex items-center justify-center text-xs font-bold",children:(K=s.assignee.full_name)==null?void 0:K.charAt(0)}),e.jsx("span",{className:"font-medium",children:s.assignee.full_name})]}):e.jsx("span",{className:"text-gray-400 italic",children:"Unassigned"})})]}),e.jsxs("div",{className:"pt-2 border-t mt-2 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsx("span",{children:"Created:"}),e.jsx("span",{className:"font-mono",children:new Date(s.createdAt).toLocaleString()})]}),s.due_date&&e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsx("span",{children:"Due Date:"}),e.jsx("span",{className:"font-mono text-red-500 font-medium",children:new Date(s.due_date).toLocaleDateString()})]})]})]})]}),e.jsx(fe,{open:!!r,onOpenChange:t=>!t&&y(null),children:e.jsx(be,{className:"max-w-4xl p-0 overflow-hidden bg-black/95 border-none text-white",children:e.jsxs("div",{className:"relative w-full h-[80vh] flex items-center justify-center",children:[e.jsx("button",{onClick:()=>y(null),className:"absolute top-4 right-4 z-50 p-2 bg-black/50 hover:bg-black/80 rounded-full text-white transition-colors",children:e.jsx(ye,{size:24})}),(Q=r==null?void 0:r.file_type)!=null&&Q.startsWith("image/")?e.jsx("img",{src:d(r.file_url),className:"max-w-full max-h-full object-contain"}):(I=r==null?void 0:r.file_type)!=null&&I.startsWith("video/")?e.jsx("video",{src:d(r.file_url),controls:!0,autoPlay:!0,className:"max-w-full max-h-full"}):e.jsxs("div",{className:"text-center p-10",children:[e.jsx(H,{size:64,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-xl font-semibold",children:r==null?void 0:r.original_name}),e.jsx("a",{href:d(r==null?void 0:r.file_url),target:"_blank",rel:"noopener noreferrer",className:"mt-4 inline-block bg-white text-black px-4 py-2 rounded hover:bg-gray-200",children:"Download / Open Original"})]})]})})})]})})]})};export{Ee as default};
