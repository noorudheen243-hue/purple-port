import{v as oe,q as J,u as ae,r as y,C as ce,x as m,j as e,D as ue,E as ee,J as xe,L as se}from"./index-CVFz3GnQ.js";import{u as z,a1 as me,a4 as pe,i as O,D as le,a as ie,f as Q,r as ge,_ as fe,X as W,F as he,P as de,g as be,C as ye,a6 as je,a7 as I,a8 as U,S,l as Y,d as Ne,e as ve,aj as we,k as ke}from"./index-MXZ1Fyy1.js";import{C as Ce}from"./ClientFormModal-CMSEf1Qy.js";import{F as Ee}from"./FormErrorAlert-DfwZ5q27.js";import{L as te}from"./link-DaAnAjwX.js";import{B as _e}from"./ImageUpload-B3ISCpRG.js";import{L as re}from"./layers-DyhbTBQr.js";import{D as Te,a as Ae,b as Ie,d as ne,e as Se}from"./dropdown-menu-BT2lFpFH.js";import{A as Re}from"./alert-circle-DVBvcfOk.js";import{P as Le}from"./pencil-D8PRgE1X.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=oe("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Me=je({title:I().min(3,"Title is required"),description:I().optional(),type:U(["GENERIC","GRAPHIC","VIDEO","COPY","STRATEGY","DEV","CONTENT_SHOOTING"]),priority:U(["LOW","MEDIUM","HIGH","URGENT"]),category:U(["CAMPAIGN","INTERNAL"]),nature:U(["NEW","REWORK"]),campaign_id:I().optional(),content_type:I().optional(),client_id:I().optional(),assignee_id:I().min(1,"Assigned To is required"),due_date:I().optional()}),De=({isOpen:g,onClose:x,initialData:t})=>{var X,Z;const _=J(),{user:w}=ae(),[j,i]=y.useState(!1),[o,h]=y.useState([]),[c,N]=y.useState([]),[d,u]=y.useState(""),[R,L]=y.useState(!1),{data:D}=z({queryKey:["campaigns"],queryFn:()=>m.get("/campaigns").then(s=>s.data)}),{data:k,refetch:H}=z({queryKey:["clients"],queryFn:()=>m.get("/clients").then(s=>s.data)}),{data:q}=z({queryKey:["users"],queryFn:()=>m.get("/users").then(s=>s.data)}),{register:p,handleSubmit:$,watch:r,setValue:a,formState:{errors:l,isValid:n},reset:T}=me({resolver:pe(Me),mode:"onChange",defaultValues:{priority:"MEDIUM",type:"GENERIC",category:"CAMPAIGN",nature:"NEW",description:""}});ce.useEffect(()=>{g&&t?(T({title:t.title,description:t.description||"",type:t.type,priority:t.priority,category:t.category,nature:t.nature,client_id:t.client_id||(t.category==="INTERNAL"?"GENERAL":""),assignee_id:t.assignee_id,due_date:t.due_date?new Date(t.due_date).toISOString().split("T")[0]:"",content_type:t.content_type||""}),t.client_id&&a("client_id",t.client_id)):g&&!t&&(T({priority:"MEDIUM",type:"GENERIC",category:"CAMPAIGN",nature:"NEW",description:""}),h([]),N([]),u(""))},[g,t,T,a]);const v=r("category"),C=r("nature"),P=r("client_id");D!=null&&D.filter(s=>s.client_id===P);const M=O({mutationFn:async s=>{const f={...s};s.content_type&&(f.content_type=s.content_type),(!s.client_id||s.client_id==="GENERAL")&&delete f.client_id,s.due_date&&(f.due_date=new Date(s.due_date));let A=t==null?void 0:t.id,E;return t?E=await m.put(`/tasks/${t.id}`,f):(E=await m.post("/tasks",f),A=E.data.id),A&&!t&&(o.length>0&&await Promise.all(o.map(async b=>{const V=new FormData;V.append("file",b);const B=await m.post("/upload",V,{headers:{"Content-Type":"multipart/form-data"}});await m.post("/assets",{task_id:A,original_name:b.name,file_url:B.data.url,file_type:b.type,size_bytes:b.size})})),c.length>0&&await Promise.all(c.map(async b=>{await m.post("/assets",{task_id:A,original_name:b,file_url:b,file_type:"link/url",size_bytes:0})}))),E},onSuccess:()=>{_.invalidateQueries({queryKey:["tasks"]}),T(),h([]),N([]),x()}}),G=s=>{M.mutate(s)},K=s=>{H().then(()=>{a("client_id",s.id)})},F=()=>{d.trim()&&(N([...c,d.trim()]),u(""),L(!1))};return e.jsxs(e.Fragment,{children:[e.jsx(le,{open:g,onOpenChange:x,children:e.jsx(ie,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:14,className:"text-purple-600"}),t?"Edit Task":"Create New Task"]}),initialWidth:1e3,initialHeight:800,className:"max-w-none bg-background p-0 overflow-hidden gap-0 max-h-[95vh] flex flex-col text-foreground",children:e.jsxs("form",{onSubmit:$(G,s=>{console.error("Task Validation Failed:",s)}),className:"p-6 pt-2 space-y-5 overflow-y-auto flex-1",children:[e.jsx(Ee,{errors:l}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-foreground",children:"Category"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>a("category","CAMPAIGN"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg border transition-all ${v==="CAMPAIGN"?"bg-purple-50 border-purple-500 text-purple-700 ring-1 ring-purple-500 dark:bg-purple-900/20 dark:text-purple-300":"bg-background border-border text-muted-foreground hover:bg-muted/50"}`,children:["Campaign",v==="CAMPAIGN"&&e.jsx(Q,{size:16,className:"text-purple-600"})]}),e.jsxs("button",{type:"button",onClick:()=>a("category","INTERNAL"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg border transition-all ${v==="INTERNAL"?"bg-blue-50 border-blue-500 text-blue-700 ring-1 ring-blue-500 dark:bg-blue-900/20 dark:text-blue-300":"bg-background border-border text-muted-foreground hover:bg-muted/50"}`,children:["Internal",v==="INTERNAL"&&e.jsx(Q,{size:16,className:"text-blue-600"})]})]}),e.jsx("input",{type:"hidden",...p("category")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-foreground",children:"Nature"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>a("nature","NEW"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg border transition-all ${C==="NEW"?"bg-green-50 border-green-500 text-green-700 ring-1 ring-green-500 dark:bg-green-900/20 dark:text-green-300":"bg-background border-border text-muted-foreground hover:bg-muted/50"}`,children:["New Task",C==="NEW"&&e.jsx(Q,{size:16,className:"text-green-600"})]}),e.jsxs("button",{type:"button",onClick:()=>a("nature","REWORK"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg border transition-all ${C==="REWORK"?"bg-red-50 border-red-500 text-red-700 ring-1 ring-red-500 dark:bg-red-900/20 dark:text-red-300":"bg-background border-border text-muted-foreground hover:bg-muted/50"}`,children:[e.jsx(ue,{size:14,className:C==="REWORK"?"text-red-600":"text-gray-400"}),"Rework",C==="REWORK"&&e.jsx(Q,{size:16,className:"text-red-600"})]})]}),e.jsx("input",{type:"hidden",...p("nature")})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground",children:["Task Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...p("title"),className:"w-full px-4 py-2.5 border border-input bg-background rounded-lg focus:ring-2 focus:ring-purple-200 focus:border-purple-500 outline-none transition-shadow text-foreground placeholder:text-muted-foreground",placeholder:"e.g. Design Holiday Banner"}),l.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.title.message})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Description"}),e.jsx("textarea",{...p("description"),className:"w-full px-4 py-2.5 border border-input bg-background rounded-lg focus:ring-2 focus:ring-purple-200 focus:border-purple-500 outline-none transition-shadow min-h-[100px] resize-y text-foreground placeholder:text-muted-foreground",placeholder:"Detailed task description & requirements..."})]}),!t&&e.jsxs("div",{className:"space-y-2 border border-border rounded-lg p-4 bg-muted/30",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(ge,{size:16})," Reference Attachments"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs("label",{className:"cursor-pointer bg-background border border-border text-foreground px-3 py-1.5 rounded text-sm hover:bg-muted flex items-center gap-2 transition-colors shadow-sm",children:[e.jsx(fe,{size:14})," Upload File",e.jsx("input",{type:"file",className:"hidden",multiple:!0,onChange:s=>{s.target.files&&h([...o,...Array.from(s.target.files)])}})]}),e.jsxs("button",{type:"button",onClick:()=>L(!0),className:"bg-background border border-border text-foreground px-3 py-1.5 rounded text-sm hover:bg-muted flex items-center gap-2 transition-colors shadow-sm",children:[e.jsx(te,{size:14})," Add Link"]})]}),R&&e.jsxs("div",{className:"flex gap-2 items-center mb-3 animate-in fade-in slide-in-from-top-1",children:[e.jsx("input",{type:"text",className:"flex-1 px-3 py-1.5 text-sm border border-input rounded bg-background shadow-sm outline-none focus:ring-1 focus:ring-purple-500 text-foreground",placeholder:"Paste URL (e.g. Drive link, Figma...)",value:d,onChange:s=>u(s.target.value),onKeyDown:s=>s.key==="Enter"&&(s.preventDefault(),F()),autoFocus:!0}),e.jsx("button",{type:"button",onClick:F,className:"text-xs bg-purple-600 text-white px-3 py-1.5 rounded hover:bg-purple-700",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>L(!1),className:"text-muted-foreground hover:text-foreground",children:e.jsx(W,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 mt-3",children:[o.map((s,f)=>{const A=s.type.startsWith("image/"),E=s.type.startsWith("video/"),b=URL.createObjectURL(s);return e.jsxs("div",{className:"group relative border border-border rounded-lg overflow-hidden bg-card shadow-sm h-32 flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-hidden relative bg-muted flex items-center justify-center",children:[A?e.jsx("img",{src:b,className:"w-full h-full object-cover",alt:"Preview"}):E?e.jsx("video",{src:b,className:"w-full h-full object-cover opacity-80"}):e.jsx(he,{size:32,className:"text-muted-foreground"}),e.jsx("button",{type:"button",onClick:()=>h(o.filter((V,B)=>B!==f)),className:"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx(W,{size:12})})]}),e.jsx("div",{className:"px-2 py-1 bg-card text-[10px] truncate border-t border-border font-medium text-foreground",title:s.name,children:s.name})]},`file-${f}`)}),c.map((s,f)=>e.jsx("div",{className:"group relative border border-border rounded-lg overflow-hidden bg-card shadow-sm h-32 flex flex-col",children:e.jsxs("div",{className:"flex-1 relative bg-blue-50 dark:bg-blue-900/20 flex flex-col items-center justify-center p-2 text-center",children:[e.jsx(te,{size:24,className:"text-blue-500 mb-1"}),e.jsx("span",{className:"text-[10px] text-blue-600 dark:text-blue-400 line-clamp-2 break-all",children:s}),e.jsx("button",{type:"button",onClick:()=>N(c.filter((A,E)=>E!==f)),className:"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(W,{size:12})})]})},`link-${f}`))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Task Type"}),e.jsxs("select",{...p("type"),className:"w-full px-4 py-2.5 border border-input rounded-lg bg-background text-foreground focus:ring-2 focus:ring-purple-200 outline-none",children:[e.jsx("option",{value:"GENERIC",children:"Generic"}),e.jsx("option",{value:"GRAPHIC",children:"Graphic Design"}),e.jsx("option",{value:"VIDEO",children:"Video Editing"}),e.jsx("option",{value:"COPY",children:"Copywriting"}),e.jsx("option",{value:"STRATEGY",children:"Strategy"}),e.jsx("option",{value:"DEV",children:"Development"}),e.jsx("option",{value:"CONTENT_SHOOTING",children:"Content Shooting"})," "]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Priority"}),e.jsxs("select",{...p("priority"),className:"w-full px-4 py-2.5 border border-input rounded-lg bg-background text-foreground focus:ring-2 focus:ring-purple-200 outline-none",children:[e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"}),e.jsx("option",{value:"URGENT",children:"Urgent"}),e.jsx("option",{value:"LOW",children:"Low"})]})]})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-xl border border-border space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground flex justify-between",children:[e.jsxs("span",{children:["Select Client ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("button",{type:"button",onClick:()=>i(!0),className:"text-xs text-purple-600 dark:text-purple-400 font-semibold hover:underline flex items-center gap-1",children:[e.jsx(de,{size:12})," Add New Client"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-3 text-muted-foreground",size:18}),e.jsxs("select",{...p("client_id"),className:`w-full pl-10 pr-4 py-2.5 border rounded-lg appearance-none bg-background text-foreground focus:ring-2 focus:ring-purple-200 outline-none ${l.client_id?"border-red-300":"border-input"}`,onChange:s=>{a("client_id",s.target.value),a("campaign_id","")},children:[e.jsx("option",{value:"",children:"-- Choose Client --"}),(v==="INTERNAL"||v==="CAMPAIGN")&&e.jsx("option",{value:"GENERAL",children:"General (Walk-in / No Client)"}),k==null?void 0:k.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),l.client_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.client_id.message})]}),P&&e.jsxs("div",{className:"space-y-1 animate-in fade-in slide-in-from-top-1",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground",children:["Content Type (Strategy) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-3 text-muted-foreground",size:18}),e.jsxs("select",{...p("content_type"),className:"w-full pl-10 pr-4 py-2.5 border rounded-lg appearance-none bg-background text-foreground focus:ring-2 focus:ring-purple-200 outline-none border-input",children:[e.jsx("option",{value:"",children:"-- Select Content Type --"}),(Z=(X=k==null?void 0:k.find(s=>s.id===P))==null?void 0:X.content_strategies)==null?void 0:Z.map(s=>e.jsxs("option",{value:s.type,children:[s.type," (Qty: ",s.quantity,")"]},s.type)),e.jsx("option",{value:"General",children:"General / Other"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select from agreed monthly deliverables."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground",children:["Assigned To ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-3 text-muted-foreground",size:18}),e.jsxs("select",{...p("assignee_id"),className:`w-full pl-10 pr-4 py-2.5 border rounded-lg appearance-none bg-background text-foreground focus:ring-2 focus:ring-purple-200 outline-none ${l.assignee_id?"border-red-300":"border-input"}`,children:[e.jsx("option",{value:"",children:"-- Select Staff --"}),q==null?void 0:q.filter(s=>s.role!=="CLIENT"&&!["9c2c3b09-1a4d-4e9f-a00a-fdcae89806a1","0f602110-d76e-4f21-8bcf-c71959dd4015"].includes(s.id)).map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.department||"General",")"]},s.id))]})]}),l.assignee_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.assignee_id.message})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Due Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-3 text-muted-foreground",size:18}),e.jsx("input",{type:"date",...p("due_date"),className:"w-full pl-10 pr-4 py-2.5 border border-input bg-background text-foreground rounded-lg focus:ring-2 focus:ring-purple-200 outline-none"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-border mt-4 sticky bottom-0 bg-background z-10 pb-4",children:[e.jsx("button",{type:"button",onClick:x,className:"px-5 py-2.5 text-muted-foreground font-medium hover:bg-muted rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:M.isPending,className:"px-6 py-2.5 bg-purple-600 text-white font-medium rounded-lg hover:bg-purple-700 disabled:opacity-50 flex items-center gap-2 shadow-sm transition-all hover:shadow-md",children:M.isPending?t?"Saving...":"Creating...":t?"Save Changes":"Create Task"})]})]})})}),e.jsx(Ce,{isOpen:j,onClose:()=>i(!1),onSuccess:K})]})},qe=({isOpen:g,onClose:x})=>{const[t,_]=y.useState(""),[w,j]=y.useState(!1),i=J(),{data:o,isLoading:h}=z({queryKey:["task-clearance-stats"],queryFn:async()=>(await m.get("/tasks/bulk/stats")).data,enabled:g}),c=O({mutationFn:async()=>(await m.post("/tasks/bulk/clear-all",{password:t})).data,onSuccess:d=>{i.invalidateQueries({queryKey:["tasks"]}),i.invalidateQueries({queryKey:["my-tasks"]}),i.invalidateQueries({queryKey:["task-board"]}),i.invalidateQueries({queryKey:["dashboard-stats"]}),i.invalidateQueries({queryKey:["executive-dashboard"]}),i.invalidateQueries({queryKey:["manager-dashboard"]}),i.invalidateQueries({queryKey:["team-performance"]}),i.invalidateQueries({queryKey:["task-reports"]}),i.invalidateQueries({queryKey:["productivity-reports"]}),i.invalidateQueries({queryKey:["user-activity"]}),i.invalidateQueries({queryKey:["time-logs"]}),i.invalidateQueries({queryKey:["notifications"]}),i.invalidateQueries({queryKey:["client-tasks"]}),i.invalidateQueries({queryKey:["campaign-tasks"]}),S.fire({icon:"success",title:"Tasks Cleared",text:d.message,confirmButtonColor:"#10b981"}),x(),_(""),j(!1)},onError:d=>{var u,R;S.fire({icon:"error",title:"Error",text:((R=(u=d.response)==null?void 0:u.data)==null?void 0:R.message)||"Failed to clear tasks",confirmButtonColor:"#ef4444"})}}),N=d=>{if(d.preventDefault(),!w){S.fire({icon:"warning",title:"Confirmation Required",text:"Please check the confirmation checkbox",confirmButtonColor:"#f59e0b"});return}if(!t.trim()){S.fire({icon:"warning",title:"Password Required",text:"Please enter your password to confirm",confirmButtonColor:"#f59e0b"});return}S.fire({title:"Are you absolutely sure?",html:`
                <p class="text-red-600 font-bold">This will permanently delete ALL task data!</p>
                <p class="mt-2">This action CANNOT be undone.</p>
            `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, clear all tasks",cancelButtonText:"Cancel"}).then(u=>{u.isConfirmed&&c.mutate()})};return g?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-background rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border-2 border-red-500",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-red-500/30 bg-red-500/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"text-red-500",size:24}),e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Clear All Tasks"})]}),e.jsx("button",{onClick:x,className:"p-1 hover:bg-muted rounded-full transition-colors",disabled:c.isPending,children:e.jsx(W,{size:20,className:"text-muted-foreground"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-6",children:[e.jsxs("h3",{className:"font-bold text-red-600 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(ee,{size:20}),"DANGER: Irreversible Action"]}),e.jsxs("p",{className:"text-sm text-foreground/80",children:["This action will ",e.jsx("strong",{children:"permanently delete ALL task-related data"})," from the system. This includes all tasks regardless of status (planned, in-progress, completed), and cannot be undone."]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"What will be deleted:"}),h?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading statistics..."}):o?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:o.tasks}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Tasks"})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:o.comments}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Comments"})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:o.assets}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Assets/Files"})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:o.timeLogs}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Time Logs"})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:o.dependencies}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Dependencies"})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:o.notifications}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Notifications"})]})]}):null]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Affected areas:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"All Dashboards (Executive, Manager, Team Performance)"}),e.jsx("li",{children:"My Tasks"}),e.jsx("li",{children:"Task Board"}),e.jsx("li",{children:"Task Reports & Analytics"}),e.jsx("li",{children:"User Activity History"}),e.jsx("li",{children:"Client Task Lists"}),e.jsx("li",{children:"Campaign Task Lists"})]})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:d=>j(d.target.checked),className:"mt-1 h-4 w-4 rounded border-gray-300 text-red-600 focus:ring-red-500",disabled:c.isPending}),e.jsxs("span",{className:"text-sm text-foreground",children:["I understand that this action is ",e.jsx("strong",{children:"permanent and cannot be undone"}),". All task data will be permanently deleted from the system."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Enter your password to confirm:"}),e.jsx("input",{type:"password",value:t,onChange:d=>_(d.target.value),className:"w-full px-3 py-2 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-red-500",placeholder:"Your password",disabled:c.isPending})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t bg-muted/30",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 text-sm font-medium bg-muted text-foreground hover:bg-muted/80 rounded-md transition-colors",disabled:c.isPending,children:"Cancel"}),e.jsxs("button",{onClick:N,disabled:!w||!t.trim()||c.isPending,className:"px-6 py-2 text-sm font-medium bg-red-600 text-white hover:bg-red-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[e.jsx(Y,{size:16}),c.isPending?"Clearing...":"Clear All Tasks"]})]})]})}):null},ze=[{id:"PLANNED",label:"Planned"},{id:"ASSIGNED",label:"Assigned"},{id:"IN_PROGRESS",label:"In Progress"},{id:"REVIEW",label:"Review"},{id:"REVISION_REQUESTED",label:"Revision"},{id:"COMPLETED",label:"Completed"}],Oe=()=>{const g=J(),{user:x}=ae(),[t,_]=y.useState(null),[w,j]=y.useState(null),[i,o]=y.useState(!1),{data:h,isLoading:c}=z({queryKey:["tasks"],queryFn:async()=>{const{data:r}=await m.get("/tasks");return r}}),N=O({mutationFn:async({id:r,status:a})=>await m.put(`/tasks/${r}`,{status:a}),onSuccess:()=>{g.invalidateQueries({queryKey:["tasks"]})}}),d=O({mutationFn:async r=>{await m.delete(`/tasks/${r}`)},onSuccess:()=>{g.invalidateQueries({queryKey:["tasks"]}),j(null)}});O({mutationFn:async()=>await m.delete("/tasks/clear-active"),onSuccess:r=>{g.invalidateQueries({queryKey:["tasks"]}),S.fire("Cleared!",r.message||"Active tasks have been wiped.","success")},onError:r=>{var a,l;S.fire("Error",((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to clear tasks","error")}});const u=h==null?void 0:h.reduce((r,a)=>{const l=a.status;return r[l]||(r[l]=[]),r[l].push(a),r},{}),[R,L]=xe(),D=R.get("action")==="new",k=()=>{L({}),_(null)};if(c)return e.jsx("div",{children:"Loading tasks..."});const H=(r,a)=>{r.dataTransfer.setData("taskId",a)},q=(r,a)=>{const l=r.dataTransfer.getData("taskId");l&&N.mutate({id:l,status:a})},p=r=>{r.preventDefault()},$=r=>{var a;return x?!!(["ADMIN","MANAGER","DEVELOPER_ADMIN"].includes(x.role)||((a=r.assigned_by)==null?void 0:a.id)===x.id):!1};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Task Board"}),e.jsxs("div",{className:"flex gap-2",children:[(x==null?void 0:x.role)==="DEVELOPER_ADMIN"&&e.jsxs("button",{onClick:()=>o(!0),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium text-sm flex items-center gap-2 transition-colors shadow-sm",children:[e.jsx(Y,{size:16})," Clear All Tasks"]}),e.jsxs(se,{to:"?action=new",className:"bg-primary text-primary-foreground px-4 py-2 rounded-md font-medium text-sm flex items-center gap-2",children:[e.jsx(de,{size:16})," New Task"]})]})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 flex-1",children:ze.map(r=>{var a,l;return e.jsxs("div",{className:"min-w-[300px] w-[300px] flex flex-col bg-muted/30 rounded-lg border border-border",onDrop:n=>q(n,r.id),onDragOver:p,children:[e.jsxs("div",{className:"p-4 font-semibold text-sm flex justify-between items-center border-b bg-card rounded-t-lg",children:[r.label,e.jsx("span",{className:"bg-muted text-xs px-2 py-1 rounded-full",children:((a=u==null?void 0:u[r.id])==null?void 0:a.length)||0})]}),e.jsx("div",{className:"p-3 space-y-3 flex-1 overflow-y-auto",children:(l=u==null?void 0:u[r.id])==null?void 0:l.map(n=>{var T,v,C,P,M,G,K;return e.jsxs("div",{draggable:!0,onDragStart:F=>H(F,n.id),className:"bg-card p-3 rounded-lg border shadow-sm cursor-move hover:border-primary/50 transition-colors group relative flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded font-bold uppercase tracking-wider 
                                            ${n.type==="GRAPHIC"?"bg-purple-100 text-purple-700":n.type==="VIDEO"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:n.type}),n.priority==="URGENT"&&e.jsx(Re,{size:12,className:"text-red-500"})]}),$(n)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(Te,{children:[e.jsx(Ae,{className:"text-muted-foreground hover:text-foreground opacity-0 group-hover:opacity-100 transition-opacity outline-none bg-white/80 p-1 rounded-full",children:e.jsx(Pe,{size:14})}),e.jsxs(Ie,{align:"end",children:[e.jsxs(ne,{onClick:()=>{_(n),L({action:"new"})},children:[e.jsx(Le,{className:"mr-2 h-4 w-4"})," Modify"]}),e.jsx(Se,{}),e.jsxs(ne,{onClick:()=>j(n.id),className:"text-red-600 focus:text-red-600",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})})]}),e.jsx(se,{to:`/dashboard/tasks/${n.id}`,className:"font-semibold text-sm hover:text-primary leading-tight line-clamp-2",title:n.title,children:n.title}),e.jsxs("div",{className:"text-[10px] text-muted-foreground font-mono flex items-center gap-1",children:[e.jsx("span",{children:new Date(n.createdAt).toLocaleDateString()}),e.jsx("span",{className:"text-gray-300",children:"â€¢"}),e.jsx("span",{children:new Date(n.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-gray-500",children:[e.jsx("span",{className:"text-[9px] uppercase tracking-wide opacity-70",children:"By"}),e.jsxs("div",{className:"flex items-center gap-1",title:`Assigned By: ${((T=n.assigned_by)==null?void 0:T.full_name)||"System"}`,children:[(v=n.assigned_by)!=null&&v.avatar_url?e.jsx("img",{src:n.assigned_by.avatar_url,className:"w-4 h-4 rounded-full object-cover"}):e.jsx("div",{className:"w-4 h-4 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600",children:((P=(C=n.assigned_by)==null?void 0:C.full_name)==null?void 0:P.charAt(0))||"?"}),e.jsx("span",{className:"truncate max-w-[60px]",children:(G=(M=n.assigned_by)==null?void 0:M.full_name)==null?void 0:G.split(" ")[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-gray-500",children:[e.jsx("span",{className:"text-[9px] uppercase tracking-wide opacity-70",children:"To"}),e.jsx("div",{className:"flex items-center gap-1",title:`Assigned To: ${((K=n.assignee)==null?void 0:K.full_name)||"Unassigned"}`,children:n.assignee?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"truncate max-w-[60px] font-medium text-gray-700",children:n.assignee.full_name.split(" ")[0]}),n.assignee.avatar_url?e.jsx("img",{src:n.assignee.avatar_url,className:"w-5 h-5 rounded-full object-cover ring-1 ring-white shadow-sm"}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-100 text-purple-700 flex items-center justify-center font-bold ring-1 ring-white shadow-sm",children:n.assignee.full_name.charAt(0)})]}):e.jsx("span",{className:"italic text-gray-400",children:"Unassigned"})})]})]})]},n.id)})})]},r.id)})}),e.jsx(De,{isOpen:D||!!t,onClose:k,initialData:t}),e.jsx(le,{open:!!w,onOpenChange:r=>!r&&j(null),children:e.jsxs(ie,{children:[e.jsxs(Ne,{children:[e.jsx(ve,{children:"Delete Task?"}),e.jsx(we,{children:"Are you sure you want to delete this task? This action cannot be undone."})]}),e.jsxs(ke,{children:[e.jsx("button",{onClick:()=>j(null),className:"px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:()=>w&&d.mutate(w),className:"px-4 py-2 text-sm bg-red-600 text-white hover:bg-red-700 rounded-md flex items-center gap-2",disabled:d.isPending,children:d.isPending?"Deleting...":"Delete"})]})]})}),e.jsx(qe,{isOpen:i,onClose:()=>o(!1)})]})},Ye=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"}));export{De as N,Oe as T,Ye as a};
