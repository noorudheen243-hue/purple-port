import{v as R,q as G,r as S,x as E,j as e,J as V,a as z,u as $}from"./index-CVFz3GnQ.js";import{a1 as q,a2 as F,i as U,S as C,I as N,B as m,P as W,u as D}from"./index-MXZ1Fyy1.js";import{L as j}from"./label-BDi2E6m5.js";import{S as B,a as P,b as J,c as K,d as h}from"./select-CRNC5CBq.js";import{C as k,a as M,b as T,c as A,d as Q}from"./card-L7c9AA96.js";import{T as X}from"./trash-C_jM1Hr1.js";import{S as Y}from"./save-Ch7_aoOB.js";import{B as H}from"./badge-DB3i4Vcz.js";import{A as Z}from"./arrow-left-BOi8SXvp.js";import{E as I}from"./external-link-CrZT27eC.js";import{C as ee}from"./check-circle-C7q7Y3EO.js";import{C as se}from"./clock-DRstIMdH.js";import{C as ae}from"./circle-ByjxmAD-.js";import"./index-C_y8q7n2.js";import"./index-COFXZIMB.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=R("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]),le=({clientId:b,existingProject:s,onSuccess:a})=>{const f=G(),[x,w]=S.useState((s==null?void 0:s.status)||"PLANNING"),{register:o,control:r,handleSubmit:p,reset:u,setValue:i}=q({defaultValues:{project_name:(s==null?void 0:s.project_name)||"",staging_url:(s==null?void 0:s.staging_url)||"",live_url:(s==null?void 0:s.live_url)||"",milestones:s!=null&&s.milestones_json?typeof s.milestones_json=="string"?JSON.parse(s.milestones_json):s.milestones_json:[{name:"Design Phase",status:"PENDING",date:""}]}}),{fields:v,append:y,remove:_}=F({control:r,name:"milestones"});S.useEffect(()=>{if(s){i("project_name",s.project_name),i("staging_url",s.staging_url),i("live_url",s.live_url);const t=typeof s.milestones_json=="string"?JSON.parse(s.milestones_json):s.milestones_json;i("milestones",t||[])}},[s,i]);const l=U({mutationFn:async t=>{const d={client_id:b,project_name:t.project_name,status:x,staging_url:t.staging_url,live_url:t.live_url,milestones_json:t.milestones,timeline_json:[]};return s!=null&&s.id?await E.patch(`/client-portal/tracking/web-dev/${s.id}`,d):await E.post("/client-portal/tracking/web-dev",d)},onSuccess:()=>{f.invalidateQueries({queryKey:["web-dev-projects"]}),C.fire("Saved","Project updated successfully","success"),s||u(),a&&a()},onError:t=>{var d,g;C.fire("Error",((g=(d=t.response)==null?void 0:d.data)==null?void 0:g.message)||"Failed to save","error")}}),n=t=>{l.mutate(t)};return e.jsxs(k,{className:"mb-8 border-primary/20 bg-primary/5",children:[e.jsx(M,{children:e.jsx(T,{className:"text-lg",children:s?"Edit Project":"Add New Project"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:p(n),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Project Name"}),e.jsx(N,{...o("project_name"),placeholder:"e.g. E-Commerce Website Redesign",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Overall Status"}),e.jsxs(B,{onValueChange:w,defaultValue:x,children:[e.jsx(P,{children:e.jsx(J,{placeholder:"Status"})}),e.jsxs(K,{children:[e.jsx(h,{value:"PLANNING",children:"Planning"}),e.jsx(h,{value:"DESIGN",children:"Design"}),e.jsx(h,{value:"DEVELOPMENT",children:"Development"}),e.jsx(h,{value:"AMENDS",children:"Amends / QA"}),e.jsx(h,{value:"TESTING",children:"Testing"}),e.jsx(h,{value:"DEPLOYED",children:"Deployed"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Staging URL (Dev)"}),e.jsx(N,{...o("staging_url"),placeholder:"https://dev.example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Live URL (Prod)"}),e.jsx(N,{...o("live_url"),placeholder:"https://example.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{children:"Project Milestones & Timeline"}),e.jsx(m,{type:"button",size:"sm",variant:"ghost",onClick:()=>y({name:"",status:"PENDING",date:""}),children:e.jsx(W,{size:16})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs font-semibold text-muted-foreground px-1",children:[e.jsx("div",{className:"col-span-5",children:"Milestone Name"}),e.jsx("div",{className:"col-span-3",children:"Status"}),e.jsx("div",{className:"col-span-3",children:"Date (Due/Done)"}),e.jsx("div",{className:"col-span-1"})]}),v.map((t,d)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-5",children:e.jsx(N,{...o(`milestones.${d}.name`),placeholder:"e.g. Wireframes Approval",required:!0})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("select",{...o(`milestones.${d}.status`),className:"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"COMPLETED",children:"Completed"})]})}),e.jsx("div",{className:"col-span-3",children:e.jsx(N,{type:"date",...o(`milestones.${d}.date`)})}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500",onClick:()=>_(d),children:e.jsx(X,{size:14})})})]},t.id))]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs(m,{type:"submit",disabled:l.isPending,children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),l.isPending?"Saving...":"Save Project Details"]})})]})})]})},be=()=>{const[b]=V(),s=z(),{user:a}=$(),[f,x]=S.useState(null),w=b.get("clientId"),o=b.get("mode"),r=(a==null?void 0:a.role)==="CLIENT"?a==null?void 0:a.linked_client_id:w,p=(a==null?void 0:a.role)==="ADMIN"||(a==null?void 0:a.role)==="MANAGER"||(a==null?void 0:a.role)==="DEVELOPER_ADMIN"||(a==null?void 0:a.role)==="MARKETING_EXEC"||(a==null?void 0:a.role)==="DM_EXECUTIVE"||(a==null?void 0:a.role)==="WEB_SEO_EXECUTIVE"||(a==null?void 0:a.role)==="CREATIVE_DESIGNER"||(a==null?void 0:a.role)==="OPERATIONS_EXECUTIVE",u=p&&o==="manage",{data:i,isLoading:v}=D({queryKey:["web-dev-projects",r],queryFn:async()=>{if(!r)return[];const{data:l}=await E.get(`/client-portal/tracking/web-dev?clientId=${r}`);return l},enabled:!!r}),{data:y}=D({queryKey:["client-details-web",r],queryFn:async()=>(await E.get(`/clients/${r}`)).data,enabled:!!r});if(!r)return e.jsx("div",{className:"p-8 text-center",children:"No Client Selected"});const _=l=>{switch(l){case"PLANNING":return"bg-gray-100 text-gray-800";case"DESIGN":return"bg-purple-100 text-purple-800";case"DEVELOPMENT":return"bg-blue-100 text-blue-800";case"AMENDS":return"bg-orange-100 text-orange-800";case"TESTING":return"bg-yellow-100 text-yellow-800";case"DEPLOYED":return"bg-green-100 text-green-800";default:return"bg-gray-100"}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>s(-1),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"})," Back"]}),e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Web Development Projects"}),y&&e.jsx("p",{className:"text-muted-foreground",children:y.name})]})})]}),p&&!u&&e.jsx(m,{variant:"outline",onClick:()=>s(`?mode=manage&clientId=${r}`),children:"Add Entry / Manage"}),u&&e.jsx("div",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded text-xs font-bold uppercase tracking-wider",children:"Management Mode"})]}),u&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:f&&e.jsx(m,{variant:"ghost",onClick:()=>x(null),className:"mr-2",children:"Cancel Edit"})}),e.jsx(le,{clientId:r,existingProject:f,onSuccess:()=>x(null)})]}),e.jsxs("div",{className:"space-y-6",children:[v&&e.jsx("div",{className:"text-center py-8",children:"Loading projects..."}),i==null?void 0:i.map(l=>{const n=typeof l.milestones_json=="string"?JSON.parse(l.milestones_json):l.milestones_json,t=(n==null?void 0:n.length)||0,d=(n==null?void 0:n.filter(c=>c.status==="COMPLETED").length)||0,g=t===0?0:Math.round(d/t*100);return e.jsxs(k,{className:"overflow-hidden border-l-4 border-l-blue-500",children:[e.jsxs(M,{className:"bg-gray-50/50 border-b flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsxs(T,{className:"text-xl flex items-center gap-2",children:[e.jsx(L,{size:20,className:"text-blue-500"})," ",l.project_name]}),e.jsx(H,{variant:"secondary",className:`${_(l.status)}`,children:l.status.replace("_"," ")})]}),e.jsxs(Q,{children:["Started on ",new Date(l.createdAt).toLocaleDateString()]})]}),u&&e.jsx(m,{size:"sm",variant:"outline",onClick:()=>{x(l),window.scrollTo(0,0)},children:"Edit"})]}),e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider",children:"Parameters"}),e.jsxs("div",{className:"flex items-center justify-between bg-white border p-3 rounded-md",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progress"}),e.jsxs("div",{className:"flex items-center gap-3 w-1/2",children:[e.jsx("div",{className:"h-2 w-full bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-1000",style:{width:`${g}%`}})}),e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:[g,"%"]})]})]}),l.staging_url&&e.jsxs("div",{className:"flex items-center justify-between bg-white border p-3 rounded-md hover:border-blue-300 transition-colors",children:[e.jsx("span",{className:"text-sm font-medium",children:"Staging URL"}),e.jsxs("a",{href:l.staging_url,target:"_blank",rel:"noreferrer",className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:["Visit ",e.jsx(I,{size:12})]})]}),l.live_url&&e.jsxs("div",{className:"flex items-center justify-between bg-green-50 border border-green-200 p-3 rounded-md",children:[e.jsx("span",{className:"text-sm font-medium text-green-900",children:"Live URL"}),e.jsxs("a",{href:l.live_url,target:"_blank",rel:"noreferrer",className:"text-sm text-green-700 hover:underline flex items-center gap-1 font-bold",children:["Visit Live ",e.jsx(I,{size:12})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4",children:"Milestone Timeline"}),e.jsxs("div",{className:"space-y-0 relative border-l-2 border-gray-100 ml-3",children:[n==null?void 0:n.map((c,O)=>e.jsxs("div",{className:"mb-6 ml-6 relative",children:[e.jsx("span",{className:`absolute -left-[31px] top-1 h-4 w-4 rounded-full border-2 ${c.status==="COMPLETED"?"bg-green-500 border-green-500":c.status==="IN_PROGRESS"?"bg-white border-blue-500 animate-pulse":"bg-white border-gray-300"}`}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:`text-sm font-medium ${c.status==="COMPLETED"?"text-gray-900 line-through opacity-70":"text-gray-900"}`,children:c.name}),c.date&&e.jsx("span",{className:"text-xs text-gray-400",children:new Date(c.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[c.status==="COMPLETED"&&e.jsxs("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded flex items-center gap-1",children:[e.jsx(ee,{size:10})," Completed"]}),c.status==="IN_PROGRESS"&&e.jsxs("span",{className:"text-[10px] bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded flex items-center gap-1",children:[e.jsx(se,{size:10})," In Progress"]}),c.status==="PENDING"&&e.jsxs("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded flex items-center gap-1",children:[e.jsx(ae,{size:10})," Pending"]})]})]},O)),(!n||n.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground ml-6 italic",children:"No milestones defined."})]})]})]})})]},l.id)}),(i==null?void 0:i.length)===0&&!v&&e.jsxs("div",{className:"text-center py-12 bg-muted/20 rounded-lg border border-dashed",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-gray-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No Web Projects Tracking"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-sm mx-auto mt-2",children:"Activate a new project in management mode to start tracking milestones and progress."}),p&&!u&&e.jsx(m,{className:"mt-4",onClick:()=>s(`?mode=manage&clientId=${r}`),children:"Add First Project"})]})]})]})};export{be as default};
