import{v as M,r,x as k,j as e,E as ae,D as E,u as te}from"./index-CVFz3GnQ.js";import{C as j,a as y,b as w,d as C,c as N}from"./card-L7c9AA96.js";import{aL as re,B as D,m as q,a3 as Q,S as l,R as A,ag as $,aM as le,I as U,aN as Y,U as ne,n as ce}from"./index-MXZ1Fyy1.js";import{L as O}from"./label-BDi2E6m5.js";import{T as W,a as Z,b as f,c as b}from"./tabs-Dihxgigl.js";import ie from"./SystemRoleManagement-DeYm7YYH.js";import oe from"./PayrollSettings-DmLSJFTA.js";import de from"./DataSync-nr37r6wP.js";import{S as me}from"./server--RVtmQe6.js";import{C as _}from"./clock-DRstIMdH.js";import{R as G}from"./rotate-ccw-C9aK5e8d.js";import{A as J}from"./alert-circle-DVBvcfOk.js";import"./index-CGf8YfUr.js";import"./index-C_y8q7n2.js";import"./loader-2-BN6j0axX.js";import"./table-DEHLnAz_.js";import"./save-Ch7_aoOB.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=M("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=M("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=M("HardDriveDownload",[["path",{d:"M12 2v8",key:"1q4o3n"}],["path",{d:"m16 6-4 4-4-4",key:"6wukr"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",key:"w68u3i"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 18h.01",key:"h775k"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=M("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=M("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),L=typeof window<"u"&&!["localhost","127.0.0.1"].includes(window.location.hostname),ge=()=>{const[a,P]=r.useState([]),[v,p]=r.useState(!1),[B,S]=r.useState(!1),[R,T]=r.useState(!1),[c,h]=r.useState(""),[i,m]=r.useState(!1),[z,n]=r.useState(!1),[o,g]=r.useState(null),[x,I]=r.useState(""),F=r.useCallback(async()=>{var s;p(!0);try{const t=await k.get("/backup/list-local");P(t.data.backups||[]),I(t.data.backupDir||""),((s=t.data.backups)==null?void 0:s.length)>0&&(g(t.data.backups[0]),c||h(t.data.backups[0].filename))}catch(t){console.error("Failed to list backups:",t)}finally{p(!1)}},[]),V=r.useCallback(async()=>{try{const s=await k.get("/backup/auto-backup-setting");m(s.data.enabled)}catch{}},[]);r.useEffect(()=>{F(),L&&V()},[F,V]);const X=async()=>{var t,u;if((await l.fire({title:"Create Backup?",html:`This will save a full backup of<br><b>all data, files & settings</b> to:<br><code style="font-size:12px;background:#f3f4f6;padding:3px 8px;border-radius:4px;">${x||"backup folder"}</code>`,icon:"question",showCancelButton:!0,confirmButtonColor:"#7c3aed",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, Backup Now",cancelButtonText:"Cancel"})).isConfirmed){S(!0);try{const d=await k.post("/backup/save-to-disk");await F(),l.fire({icon:"success",title:"Backup Saved!",html:`<b>${d.data.filename}</b><br>Size: ${d.data.sizeKB} KB`,confirmButtonColor:"#7c3aed",timer:4e3,timerProgressBar:!0})}catch(d){l.fire({icon:"error",title:"Backup Failed",text:((u=(t=d.response)==null?void 0:t.data)==null?void 0:u.message)||d.message||"Unknown error",confirmButtonColor:"#7c3aed"})}finally{S(!1)}}},ee=async()=>{var t,u;if(!c){l.fire({icon:"warning",title:"No Backup Selected",text:"Please select a backup file to restore.",confirmButtonColor:"#7c3aed"});return}if((await l.fire({title:"‚ö†Ô∏è Confirm Restore",html:`<p>This will <b>permanently replace ALL current data</b> with:</p>
                   <code style="font-size:12px;background:#fef2f2;color:#991b1b;padding:4px 10px;border-radius:4px;display:block;margin:8px 0;">${c}</code>
                   <p style="color:#6b7280;font-size:13px;">This action cannot be undone.</p>`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"üîÑ Yes, Restore Now",cancelButtonText:"Cancel"})).isConfirmed){T(!0);try{await k.post("/backup/restore-from-disk",{filename:c},{timeout:18e5}),l.fire({icon:"success",title:"Restore Complete!",text:"The application has been restored. Page will reload now.",confirmButtonColor:"#7c3aed",timer:3e3,timerProgressBar:!0}).then(()=>window.location.reload())}catch(d){l.fire({icon:"error",title:"Restore Failed",text:((u=(t=d.response)==null?void 0:t.data)==null?void 0:u.message)||d.message||"Unknown error",confirmButtonColor:"#7c3aed"})}finally{T(!1)}}},se=async()=>{var t,u;const s=!i;n(!0);try{await k.post("/backup/auto-backup-setting",{enabled:s}),m(s)}catch(d){l.fire({icon:"error",title:"Failed to toggle auto-backup",text:((u=(t=d.response)==null?void 0:t.data)==null?void 0:u.message)||d.message,confirmButtonColor:"#7c3aed"})}finally{n(!1)}},K=s=>{try{return new Date(s).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return s}};return e.jsxs("div",{className:"space-y-6 max-w-4xl",children:[e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 rounded-xl border text-sm font-medium ${L?"bg-violet-50 border-violet-200 text-violet-800":"bg-emerald-50 border-emerald-200 text-emerald-800"}`,children:[L?e.jsx(me,{className:"h-4 w-4"}):e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:L?"üì° Online Server (www.qixport.com)":"üíª Local Development (localhost)"}),e.jsxs("span",{className:"ml-auto text-xs opacity-70",children:["Backup folder: ",e.jsx("code",{className:"bg-white/70 px-1 rounded",children:x||"..."})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(j,{className:"border-violet-100 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(y,{className:"pb-3",children:[e.jsxs(w,{className:"flex items-center gap-2 text-violet-700",children:[e.jsx("div",{className:"p-2 bg-violet-100 rounded-lg",children:e.jsx(H,{className:"h-5 w-5 text-violet-600"})}),"Backup"]}),e.jsx(C,{children:"Save a complete snapshot of all data, uploads and settings to the backup folder."})]}),e.jsxs(N,{className:"space-y-4",children:[o&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-violet-50 rounded-lg text-xs text-violet-700",children:[e.jsx(_,{className:"h-4 w-4 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Last backup"}),e.jsx("p",{className:"opacity-80",children:K(o.createdAt)}),e.jsxs("p",{className:"opacity-70",children:[o.filename," ¬∑ ",o.sizeKB," KB"]})]})]}),!o&&!v&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg text-xs text-gray-500",children:[e.jsx(ae,{className:"h-4 w-4"}),"No backups found yet. Create your first backup below."]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(he,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"truncate",children:x||"Loading..."})]}),e.jsx(D,{onClick:X,disabled:B,className:"w-full bg-violet-600 hover:bg-violet-700 text-white",children:B?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2 animate-spin"})," Backing up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2"})," Backup Now"]})})]})]}),e.jsxs(j,{className:"border-red-100 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(y,{className:"pb-3",children:[e.jsxs(w,{className:"flex items-center gap-2 text-red-700",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(G,{className:"h-5 w-5 text-red-600"})}),"Restore"]}),e.jsx(C,{children:"Roll back the entire application to a previous backup."})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-100 rounded-lg text-xs text-red-700",children:[e.jsx(q,{className:"h-4 w-4 shrink-0 mt-0.5"}),e.jsxs("p",{children:[e.jsx("b",{children:"Warning:"})," Restoring will permanently overwrite all current data with the selected backup. This cannot be undone."]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Select backup to restore:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:c,onChange:s=>h(s.target.value),className:"flex-1 text-sm border border-gray-200 rounded-lg px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-red-300",children:[a.length===0&&e.jsx("option",{value:"",children:"No backups available"}),a.map(s=>e.jsxs("option",{value:s.filename,children:[K(s.createdAt)," ¬∑ ",s.sizeKB," KB"]},s.filename))]}),e.jsx(D,{variant:"outline",size:"icon",onClick:F,disabled:v,className:"shrink-0",title:"Refresh list",children:e.jsx(E,{className:`h-4 w-4 ${v?"animate-spin":""}`})})]})]}),e.jsx(D,{onClick:ee,disabled:R||!c||a.length===0,variant:"destructive",className:"w-full",children:R?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2 animate-spin"})," Restoring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"})," Restore Selected Backup"]})})]})]})]}),L&&e.jsxs(j,{className:"border-blue-100 shadow-sm",children:[e.jsxs(y,{className:"pb-3",children:[e.jsxs(w,{className:"flex items-center gap-2 text-blue-700",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(xe,{className:"h-5 w-5 text-blue-600"})}),"Daily Auto-Backup",e.jsx("span",{className:`ml-auto text-xs px-2 py-0.5 rounded-full font-semibold ${i?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:i?"Active":"Inactive"})]}),e.jsx(C,{children:"Automatically saves a backup every day at midnight (IST) to the server's backup folder. Old backups are pruned after 30 are stored."})]}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-800",children:"Schedule: Every day at 12:00 AM IST"}),e.jsxs("p",{className:"text-xs text-blue-600",children:["Saves to: ",e.jsxs("code",{className:"bg-white/80 px-1 rounded",children:[x,"/auto-backup-*.zip"]})]}),e.jsx("p",{className:"text-xs text-blue-500",children:"Retains last 30 backups automatically"})]}),e.jsx("button",{onClick:se,disabled:z,className:"flex items-center gap-2 text-sm font-medium focus:outline-none",title:i?"Click to disable":"Click to enable",children:z?e.jsx(E,{className:"h-6 w-6 animate-spin text-blue-400"}):i?e.jsx(pe,{className:"h-10 w-10 text-green-500"}):e.jsx(ue,{className:"h-10 w-10 text-gray-400"})})]})})]}),a.length>0&&e.jsxs(j,{className:"border-gray-100 shadow-sm",children:[e.jsx(y,{className:"pb-2",children:e.jsxs(w,{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Backup History (",a.length," files)"]})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:a.map((s,t)=>e.jsxs("div",{onClick:()=>h(s.filename),className:`flex items-center justify-between p-3 rounded-lg border text-xs cursor-pointer transition-colors
                                        ${c===s.filename?"bg-violet-50 border-violet-300":"bg-gray-50 border-gray-100 hover:bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c===s.filename&&e.jsx(Q,{className:"h-3.5 w-3.5 text-violet-500 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:s.filename}),e.jsx("p",{className:"text-gray-400",children:K(s.createdAt)})]})]}),e.jsxs("div",{className:"text-right shrink-0 ml-2",children:[e.jsxs("p",{className:"text-gray-500",children:[s.sizeKB," KB"]}),t===0&&e.jsx("span",{className:"text-violet-500 font-semibold",children:"Latest"})]})]},s.filename))})})]})]})},Pe=()=>{const{user:a}=te(),[P,v]=r.useState(""),[p,B]=r.useState(""),[S,R]=r.useState(""),[T,c]=r.useState(!1),[h,i]=r.useState(null),m=(a==null?void 0:a.role)===A.DEVELOPER_ADMIN,z=async n=>{var o,g;if(n.preventDefault(),i(null),p!==S){i({type:"error",text:"New passwords don't match"});return}if(p.length<6){i({type:"error",text:"Password must be at least 6 characters"});return}try{c(!0),await k.post("/auth/change-password",{currentPassword:P,newPassword:p}),i({type:"success",text:"Password changed successfully!"}),v(""),B(""),R("")}catch(x){i({type:"error",text:((g=(o=x.response)==null?void 0:o.data)==null?void 0:g.message)||"Failed to change password"})}finally{c(!1)}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account and system preferences."})]}),e.jsxs(W,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(Z,{className:"bg-muted p-1 rounded-lg",children:[e.jsxs(f,{value:"profile",className:"flex items-center gap-2",children:[e.jsx($,{size:16})," My Security"]}),m&&e.jsxs(f,{value:"system",className:"flex items-center gap-2",children:[e.jsx(q,{size:16})," System Control"]}),(m||(a==null?void 0:a.role)===A.ADMIN)&&e.jsxs(f,{value:"maintenance",className:"flex items-center gap-2",children:[e.jsx(le,{size:16})," Maintenance"]}),(m||(a==null?void 0:a.role)===A.ADMIN)&&e.jsxs(f,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(H,{size:16})," Backup & Restore"]})]}),e.jsx(b,{value:"profile",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-purple-600"}),"Change Password"]}),e.jsx(C,{children:"Update your password to keep your account secure."})]}),e.jsx(N,{children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[h&&e.jsxs("div",{className:`p-3 rounded-md text-sm flex items-center gap-2 ${h.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[h.type==="success"?e.jsx(Q,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"}),h.text]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"current",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(U,{id:"current",type:"password",className:"pl-9",value:P,onChange:n=>v(n.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"new",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(U,{id:"new",type:"password",className:"pl-9",value:p,onChange:n=>B(n.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"confirm",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(U,{id:"confirm",type:"password",className:"pl-9",value:S,onChange:n=>R(n.target.value),required:!0})]})]}),e.jsx(D,{type:"submit",disabled:T,className:"w-full",children:T?"Updating...":"Change Password"})]})})]})})}),(m||(a==null?void 0:a.role)===A.ADMIN)&&e.jsx(b,{value:"maintenance",children:e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2 text-orange-700",children:[e.jsx(J,{className:"h-5 w-5"}),"System Maintenance"]}),e.jsx(C,{children:"Perform critical system operations to ensure application health."})]}),e.jsx(N,{className:"space-y-6",children:e.jsxs("div",{className:"p-4 border border-orange-200 bg-orange-50 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[e.jsx(Y,{size:18}),"Clear Application Cache"]}),e.jsx("p",{className:"text-sm text-orange-700 mb-4",children:"Use this if you are experiencing synchronization issues, missing features after an update, or display errors. This will force a reload of the application and clear local data."}),e.jsx(D,{variant:"destructive",onClick:()=>{l.fire({title:"Clear System Cache?",text:"This will clear local storage, session data, and force a hard reload. You may be logged out.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, Clear & Reload"}).then(n=>{if(n.isConfirmed){const o=localStorage.getItem("theme");localStorage.clear(),o&&localStorage.setItem("theme",o),sessionStorage.clear();let g;l.fire({title:"Clearing Cache...",html:"Reloading system in <b></b> milliseconds.",timer:1500,timerProgressBar:!0,didOpen:()=>{var I;l.showLoading();const x=(I=l.getHtmlContainer())==null?void 0:I.querySelector("b");g=setInterval(()=>{x&&(x.textContent=String(l.getTimerLeft()))},100)},willClose:()=>{clearInterval(g)}}).then(()=>{window.location.reload()})}})},children:"Clear Cache & Reload"})]})})]})}),(m||(a==null?void 0:a.role)===A.ADMIN)&&e.jsx(b,{value:"backup",children:e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-violet-600"}),"Backup & Restore"]}),e.jsx(C,{children:"Save a complete backup of all application data, uploads, and settings to disk. Restore any previous backup with one click."})]}),e.jsx(N,{children:e.jsx(ge,{})})]})}),m&&e.jsxs(b,{value:"system",className:"space-y-6",children:[e.jsxs("div",{className:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 mb-6 flex gap-3 text-yellow-800 text-sm",children:[e.jsx(q,{className:"h-5 w-5 shrink-0"}),e.jsxs("p",{children:[e.jsx("strong",{children:"System Control Zone:"})," Changes made here affect the entire system structure. Use with caution."]})]}),e.jsxs(W,{defaultValue:"roles",className:"w-full",children:[e.jsxs(Z,{className:"w-full justify-start border-b rounded-none bg-transparent p-0 mb-6 h-auto",children:[e.jsxs(f,{value:"roles",className:"data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none border-b-2 border-transparent rounded-none pb-2 px-4 font-medium",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Role Management"]}),e.jsxs(f,{value:"payroll",className:"data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none border-b-2 border-transparent rounded-none pb-2 px-4 font-medium",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Payroll Config"]}),e.jsxs(f,{value:"sync",className:"data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none border-b-2 border-transparent rounded-none pb-2 px-4 font-medium",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Data Sync"]})]}),e.jsx(b,{value:"roles",className:"mt-0",children:e.jsx(ie,{})}),e.jsx(b,{value:"payroll",className:"mt-0",children:e.jsx(oe,{})}),e.jsx(b,{value:"sync",className:"mt-0",children:e.jsx(de,{})})]})]})]})]})};export{Pe as default};
