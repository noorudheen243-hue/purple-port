import{r as N,j as e,x as B}from"./index-CVFz3GnQ.js";import{az as P,u as V,C as W,U as Y,B as A,Y as E,aP as H,aA as U,aI as _}from"./index-MXZ1Fyy1.js";import{C as h,a as j,b as u,c as f}from"./card-L7c9AA96.js";import{S as w,a as v,b as y,c as b,d as l}from"./select-CRNC5CBq.js";import{T as $,a as F,b as p,c as o,d as M,e as n}from"./table-DEHLnAz_.js";import{B as S}from"./building-2-YASNNcnB.js";import{B as g}from"./bar-chart-3-CS_6Br8k.js";import{s as q}from"./startOfMonth-C0iE2rZu.js";import{e as L}from"./endOfWeek-D821bHIH.js";import"./index-C_y8q7n2.js";import"./index-COFXZIMB.js";function z(a){const d=P(a),c=d.getFullYear();return d.setFullYear(c+1,0,0),d.setHours(23,59,59,999),d}const le=()=>{const[a,d]=N.useState("staff"),[c,C]=N.useState("month"),T=()=>{const s=new Date;switch(c){case"today":return{start:new Date().toISOString(),end:new Date().toISOString()};case"week":return{start:_(s).toISOString(),end:L(s).toISOString()};case"month":return{start:q(s).toISOString(),end:U(s).toISOString()};case"year":return{start:H(s).toISOString(),end:z(s).toISOString()};default:return{start:"",end:""}}},{start:k,end:O}=T(),{data:t,isLoading:x}=V({queryKey:["task-stats",a,c],queryFn:async()=>(await B.get("/tasks/stats",{params:{view:a,start:k,end:O}})).data}),I=()=>{if(!t)return;const s=["Name","Total Tasks","Completed","Pending","Overdue","Completion Rate (%)"],r=t.map(i=>[i.name,i.total,i.completed,i.pending,i.overdue,i.rate].join(",")),D="data:text/csv;charset=utf-8,"+[s.join(","),...r].join(`
`),R=encodeURI(D),m=document.createElement("a");m.setAttribute("href",R),m.setAttribute("download",`task_report_${a}_${c}.csv`),document.body.appendChild(m),m.click(),document.body.removeChild(m)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Task Reports"}),e.jsx("p",{className:"text-muted-foreground",children:"Generate reports by Staff, Department, or Client."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{value:c,onValueChange:s=>C(s),children:[e.jsxs(v,{className:"w-[150px]",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),e.jsx(y,{placeholder:"Period"})]}),e.jsxs(b,{children:[e.jsx(l,{value:"today",children:"Today"}),e.jsx(l,{value:"week",children:"This Week"}),e.jsx(l,{value:"month",children:"This Month"}),e.jsx(l,{value:"year",children:"This Year"}),e.jsx(l,{value:"all",children:"All Time"})]})]}),e.jsxs(w,{value:a,onValueChange:s=>d(s),children:[e.jsxs(v,{className:"w-[180px]",children:[a==="staff"&&e.jsx(Y,{className:"mr-2 h-4 w-4"}),a==="department"&&e.jsx(S,{className:"mr-2 h-4 w-4"}),a==="client"&&e.jsx(S,{className:"mr-2 h-4 w-4"})," ",e.jsx(y,{placeholder:"Report Type"})]}),e.jsxs(b,{children:[e.jsx(l,{value:"staff",children:"Staff Wise"}),e.jsx(l,{value:"department",children:"Department Wise"}),e.jsx(l,{value:"client",children:"Client Wise"})]})]}),e.jsxs(A,{variant:"outline",onClick:I,children:[e.jsx(E,{className:"mr-2 h-4 w-4"})," Export CSV"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Tasks"}),e.jsx(g,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:x?"...":t==null?void 0:t.reduce((s,r)=>s+r.total,0)})})]}),e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Completed"}),e.jsx(g,{className:"h-4 w-4 text-green-500"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:x?"...":t==null?void 0:t.reduce((s,r)=>s+r.completed,0)})})]}),e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Pending"}),e.jsx(g,{className:"h-4 w-4 text-yellow-500"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:x?"...":t==null?void 0:t.reduce((s,r)=>s+r.pending,0)})})]}),e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Overdue"}),e.jsx(g,{className:"h-4 w-4 text-red-500"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:x?"...":t==null?void 0:t.reduce((s,r)=>s+r.overdue,0)})})]})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(u,{children:"Detailed Breakdown"})}),e.jsx(f,{children:e.jsxs($,{children:[e.jsx(F,{children:e.jsxs(p,{children:[e.jsx(o,{className:"w-[200px]",children:"Name"}),e.jsx(o,{className:"text-right",children:"Total Tasks"}),e.jsx(o,{className:"text-right",children:"Completed"}),e.jsx(o,{className:"text-right",children:"Pending"}),e.jsx(o,{className:"text-right text-red-500",children:"Overdue"}),e.jsx(o,{className:"text-right",children:"Completion Rate"})]})}),e.jsx(M,{children:x?e.jsx(p,{children:e.jsx(n,{colSpan:6,className:"text-center py-10",children:"Loading reports..."})}):(t==null?void 0:t.length)===0?e.jsx(p,{children:e.jsx(n,{colSpan:6,className:"text-center py-10",children:"No data found for this period."})}):t==null?void 0:t.map(s=>e.jsxs(p,{children:[e.jsx(n,{className:"font-medium",children:s.name}),e.jsx(n,{className:"text-right",children:s.total}),e.jsx(n,{className:"text-right text-green-600 font-medium",children:s.completed}),e.jsx(n,{className:"text-right text-yellow-600",children:s.pending}),e.jsx(n,{className:"text-right text-red-600 font-medium",children:s.overdue}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("div",{className:"w-16 h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${s.rate>=80?"bg-green-500":s.rate>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${s.rate}%`}})}),e.jsxs("span",{className:"text-xs w-8",children:[s.rate,"%"]})]})})]},s.name))})]})})]})]})};export{le as default};
