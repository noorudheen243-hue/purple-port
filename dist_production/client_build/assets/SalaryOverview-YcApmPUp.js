import{v as f,q as w,r as d,j as e,w as p}from"./index-W29iofZb.js";import{u as N,d as b,X as S}from"./index-BJPAJU8j.js";import{L as j}from"./loader-2-CWSgfRxb.js";import{S as D}from"./save-BK4gaAHr.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=f("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),k=({isOpen:c,onClose:r,staff:l,month:i,year:y,onSave:o})=>{const[s,n]=d.useState({basic:0,hra:0,allowances:0,conveyance:0,accommodation:0,incentives:0,leaveDeduction:0,advance:0});d.useEffect(()=>{l&&n({basic:l.basic||0,hra:l.hra||0,allowances:l.allowances||0,conveyance:l.conveyance||0,accommodation:l.accommodation||0,incentives:l.incentives||0,leaveDeduction:l.leaveDeduction||0,advance:l.advance||0})},[l]);const m=()=>{const t=s.basic+s.hra+s.allowances+s.conveyance+s.accommodation+s.incentives,u=s.leaveDeduction+s.advance;return{gross:t,net:t-u}};return c?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl shadow-xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b pb-2",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Edit Salary: ",l.name]}),e.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-700",children:e.jsx(S,{size:24})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-green-700 border-b pb-1",children:"Earnings"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Basic Salary"}),e.jsx("input",{type:"number",className:"mt-1 w-full rounded-md border-gray-300 shadow-sm border p-2",value:s.basic,onChange:t=>n({...s,basic:parseFloat(t.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"HRA"}),e.jsx("input",{type:"number",className:"mt-1 w-full rounded-md border-gray-300 shadow-sm border p-2",value:s.hra,onChange:t=>n({...s,hra:parseFloat(t.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Allowances"}),e.jsx("input",{type:"number",className:"mt-1 w-full rounded-md border-gray-300 shadow-sm border p-2",value:s.allowances,onChange:t=>n({...s,allowances:parseFloat(t.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Conveyance Allowance"}),e.jsx("input",{type:"number",className:"mt-1 w-full rounded-md border-gray-300 shadow-sm border p-2",value:s.conveyance,onChange:t=>n({...s,conveyance:parseFloat(t.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Accommodation Allowance"}),e.jsx("input",{type:"number",className:"mt-1 w-full rounded-md border-gray-300 shadow-sm border p-2",value:s.accommodation,onChange:t=>n({...s,accommodation:parseFloat(t.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Incentives & Bonus"}),e.jsx("input",{type:"number",className:"mt-1 w-full rounded-md border-gray-300 shadow-sm border p-2 bg-yellow-50",value:s.incentives,onChange:t=>n({...s,incentives:parseFloat(t.target.value)||0})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-red-700 border-b pb-1",children:"Deductions"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Leave Amount"}),e.jsx("input",{type:"number",className:"mt-1 w-full rounded-md border-gray-300 shadow-sm border p-2",value:s.leaveDeduction,onChange:t=>n({...s,leaveDeduction:parseFloat(t.target.value)||0})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Calculated based on ",l.effectiveLeaveDays," LOP days"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Salary Advance"}),e.jsx("input",{type:"number",className:"mt-1 w-full rounded-md border-gray-300 shadow-sm border p-2 bg-yellow-50",value:s.advance,onChange:t=>n({...s,advance:parseFloat(t.target.value)||0})})]}),e.jsxs("div",{className:"mt-8 pt-4 border-t space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Gross Earnings:"}),e.jsxs("span",{className:"font-semibold",children:["₹",m().gross.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold text-indigo-700 bg-indigo-50 p-2 rounded",children:[e.jsx("span",{children:"Net Payable:"}),e.jsxs("span",{children:["₹",m().net.toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md",children:"Cancel"}),e.jsxs("button",{onClick:()=>o(s),className:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(D,{size:18})," Save Changes"]}),e.jsx("p",{className:"text-xs text-gray-400 self-center",children:"* Updates Master Data & Payroll Draft"})]})]})}):null},P=()=>{const c=w(),[r,l]=d.useState(new Date().getMonth()+1),[i,y]=d.useState(new Date().getFullYear()),[o,s]=d.useState(null),{data:n,isLoading:m,error:t}=N({queryKey:["payroll-preview",r,i],queryFn:async()=>(await p.get(`/payroll/preview?month=${r}&year=${i}`)).data}),u=b({mutationFn:async a=>{await p.post("/payroll/slip/save",{month:r,year:i,userId:o.user_id,data:a})},onSuccess:()=>{s(null),c.invalidateQueries({queryKey:["payroll-preview"]})},onError:a=>alert(a.message)}),h=b({mutationFn:async()=>{await p.post("/payroll/process",{month:r,year:i,confirmedData:n.previews})},onSuccess:()=>{alert("Payroll Processed Successfully!"),c.invalidateQueries({queryKey:["payroll-preview"]})},onError:a=>{var x,v;alert("Failed to process payroll: "+((v=(x=a.response)==null?void 0:x.data)==null?void 0:v.message))}});if(m)return e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(j,{className:"animate-spin text-indigo-600"})});if(t)return e.jsx("div",{className:"p-10 text-red-600",children:"Failed to load payroll data."});const g=(n==null?void 0:n.previews)||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium",children:"Salary Overview"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[g.length," Active Staff Members for ",new Date(0,r-1).toLocaleString("default",{month:"long"})," ",i]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("select",{value:r,onChange:a=>l(parseInt(a.target.value)),className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border",children:Array.from({length:12},(a,x)=>x+1).map(a=>e.jsx("option",{value:a,children:new Date(0,a-1).toLocaleString("default",{month:"long"})},a))}),e.jsxs("select",{value:i,onChange:a=>y(parseInt(a.target.value)),className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:2024,children:"2024"}),e.jsx("option",{value:2025,children:"2025"})]}),e.jsxs("button",{onClick:()=>{window.confirm("Are you sure you want to process payroll for this month? This will lock the data and post journal entries.")&&h.mutate()},disabled:h.isPending||g.length===0,className:"bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 disabled:bg-gray-400 flex items-center gap-2",children:[h.isPending&&e.jsx(j,{className:"animate-spin",size:16}),"Process Payroll"]})]})]}),e.jsx("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900",children:"Employee"}),e.jsx("th",{className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Earnings"}),e.jsx("th",{className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Deductions"}),e.jsx("th",{className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Net Pay"}),e.jsx("th",{className:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:g.map(a=>e.jsxs("tr",{className:a.isDraft?"bg-indigo-50/30":"",children:[e.jsxs("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900",children:[a.name,e.jsx("div",{className:"text-gray-500 text-xs",children:a.designation}),a.isDraft&&e.jsx("span",{className:"text-[10px] text-indigo-600 font-bold bg-indigo-100 px-1 rounded ml-2",children:"EDITED"})]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.jsxs("div",{className:"flex flex-col text-xs space-y-0.5",children:[e.jsxs("span",{children:["Basic: ",a.basic.toLocaleString()]}),e.jsxs("span",{children:["HRA: ",a.hra.toLocaleString()]}),a.incentives>0&&e.jsxs("span",{className:"text-green-600 font-semibold",children:["Bonus: ",a.incentives.toLocaleString()]})]})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.jsxs("div",{className:"flex flex-col text-xs space-y-0.5",children:[e.jsxs("span",{className:"text-red-500",children:["Leave: ",a.leaveDeduction.toFixed(0)]}),a.advance>0&&e.jsxs("span",{className:"text-red-500",children:["Adv: ",a.advance.toLocaleString()]})]})}),e.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm font-bold text-gray-900",children:["₹",a.netPay.toLocaleString("en-IN",{maximumFractionDigits:0})]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-right",children:e.jsx("button",{onClick:()=>s(a),className:"text-indigo-600 hover:text-indigo-900 p-2 hover:bg-indigo-50 rounded-full transition",children:e.jsx(C,{size:16})})})]},a.staff_id))})]})}),e.jsx(k,{isOpen:!!o,staff:o,onClose:()=>s(null),onSave:u.mutate})]})};export{P as default};
