import{q as A,r as g,w as h,j as e,H as S}from"./index-CYovX-18.js";import{u as w,d as N,P as k,w as L,b as T,c as _,o as q,X as F,F as I,s as j}from"./index-DG6laMbl.js";import{f as M}from"./format-D4js0obD.js";import{S as O}from"./search-U1j7VZT8.js";import{P}from"./pencil-DILtGXJ2.js";const R=q({name:j().min(3,"Name must be at least 3 characters"),head_id:j().uuid("Account Head is required"),entity_type:j().min(1,"Type is required"),description:j().optional(),opening_balance:I().optional()}),B=()=>{const m=A(),[r,t]=g.useState(""),[y,o]=g.useState(!1),[l,i]=g.useState(null),[a,x]=g.useState(null),{data:n,isLoading:p}=w({queryKey:["ledgers"],queryFn:async()=>(await h.get("/accounting/ledgers")).data}),{data:C}=w({queryKey:["accountHeads"],queryFn:async()=>(await h.get("/accounting/heads")).data}),f=N({mutationFn:s=>h.post("/accounting/ledgers",s),onSuccess:()=>{m.invalidateQueries({queryKey:["ledgers"]}),o(!1)},onError:s=>{var d,c;return alert("Failed to create: "+(((c=(d=s.response)==null?void 0:d.data)==null?void 0:c.message)||s.message))}}),v=N({mutationFn:s=>h.put(`/accounting/ledgers/${s.id}`,s.payload),onSuccess:()=>{m.invalidateQueries({queryKey:["ledgers"]}),i(null)},onError:s=>{var d,c;return alert("Failed to update: "+(((c=(d=s.response)==null?void 0:d.data)==null?void 0:c.message)||s.message))}}),b=N({mutationFn:s=>h.delete(`/accounting/ledgers/${s}`),onSuccess:()=>{m.invalidateQueries({queryKey:["ledgers"]}),x(null)},onError:s=>{var d,c;return alert("Failed to delete: "+(((c=(d=s.response)==null?void 0:d.data)==null?void 0:c.message)||s.message))}}),u=n==null?void 0:n.filter(s=>s.name.toLowerCase().includes(r.toLowerCase())||s.head.name.toLowerCase().includes(r.toLowerCase())),E=s=>s>=0?"text-green-600":"text-red-600";return p?e.jsx("div",{children:"Loading Ledgers..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Ledger Master List"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your chart of accounts."})]}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90",children:[e.jsx(k,{className:"w-4 h-4"})," Create Account"]})]}),e.jsxs("div",{className:"flex gap-4 items-center bg-card p-4 rounded-lg border",children:[e.jsx(O,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search ledgers...",className:"bg-transparent outline-none flex-1",value:r,onChange:s=>t(s.target.value)})]}),e.jsx("div",{className:"bg-card rounded-lg border shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted text-muted-foreground font-medium border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Account Name"}),e.jsx("th",{className:"px-4 py-3",children:"Group (Head)"}),e.jsx("th",{className:"px-4 py-3",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Balance"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[u==null?void 0:u.map(s=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground",children:s.head.name}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-xs uppercase",children:s.entity_type}),e.jsx("td",{className:`px-4 py-3 text-right font-mono ${E(s.balance)}`,children:M(s.balance)}),e.jsxs("td",{className:"px-4 py-3 text-right flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i(s),className:"p-1 hover:bg-secondary rounded text-blue-600",title:"Edit",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x(s),className:"p-1 hover:bg-secondary rounded text-red-600",title:"Delete",children:e.jsx(L,{className:"w-4 h-4"})})]})]},s.id)),!(u!=null&&u.length)&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-muted-foreground",children:"No ledgers found."})})]})]})}),(y||l)&&e.jsx(H,{isOpen:!0,mode:l?"EDIT":"CREATE",initialData:l||void 0,heads:C||[],onClose:()=>{o(!1),i(null)},onSubmit:s=>{l?v.mutate({id:l.id,payload:s}):f.mutate(s)},isLoading:f.isPending||v.isPending}),a&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card w-full max-w-md rounded-lg shadow-lg border p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-destructive",children:[e.jsx(S,{className:"w-6 h-6"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Delete Account?"})]}),e.jsxs("p",{className:"text-muted-foreground",children:["Are you sure you want to delete ",e.jsx("strong",{children:a.name}),"? This action cannot be undone. If there are existing transactions, deletion will fail."]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:()=>x(null),className:"px-4 py-2 rounded-md hover:bg-muted",children:"Cancel"}),e.jsx("button",{onClick:()=>b.mutate(a.id),disabled:b.isPending,className:"px-4 py-2 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90",children:b.isPending?"Deleting...":"Confirm Delete"})]})]})})]})},H=({isOpen:m,mode:r,initialData:t,heads:y,onClose:o,onSubmit:l,isLoading:i})=>{const{register:a,handleSubmit:x,formState:{errors:n}}=T({resolver:_(R),defaultValues:{name:(t==null?void 0:t.name)||"",head_id:(t==null?void 0:t.head.id)||"",entity_type:(t==null?void 0:t.entity_type)||"INCOME",description:(t==null?void 0:t.description)||"",opening_balance:(t==null?void 0:t.balance)||0}});return m?e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card w-full max-w-2xl rounded-lg shadow-lg border p-6 space-y-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-lg",children:r==="CREATE"?"New Account":"Edit Account"}),e.jsx("button",{onClick:o,children:e.jsx(F,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsxs("form",{onSubmit:x(l),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Account Name"}),e.jsx("input",{className:"w-full bg-background border rounded-md px-3 py-2",...a("name"),placeholder:"e.g. Office Rent"}),n.name&&e.jsx("span",{className:"text-destructive text-xs",children:n.name.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Account Group (Head)"}),e.jsxs("select",{className:"w-full bg-background border rounded-md px-3 py-2",...a("head_id"),children:[e.jsx("option",{value:"",children:"Select Group..."}),y.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]}),n.head_id&&e.jsx("span",{className:"text-destructive text-xs",children:n.head_id.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Type"}),e.jsxs("select",{className:"w-full bg-background border rounded-md px-3 py-2",...a("entity_type"),children:[e.jsx("option",{value:"INCOME",children:"Income"}),e.jsx("option",{value:"EXPENSE",children:"Expense"}),e.jsx("option",{value:"ASSET",children:"Asset (Fixed/Current)"}),e.jsx("option",{value:"LIABILITY",children:"Liability"}),e.jsx("option",{value:"EQUITY",children:"Equity"}),e.jsx("option",{value:"BANK",children:"Bank"}),e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"VENDOR",children:"Vendor"})]}),n.entity_type&&e.jsx("span",{className:"text-destructive text-xs",children:n.entity_type.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("input",{className:"w-full bg-background border rounded-md px-3 py-2",...a("description"),placeholder:"Optional description"})]}),e.jsxs("div",{className:"space-y-2 bg-muted/50 p-3 rounded-md",children:[e.jsx("label",{className:"text-sm font-medium",children:r==="CREATE"?"Opening Balance":"Current Balance (Adjustment)"}),e.jsx("input",{type:"number",className:"w-full bg-background border rounded-md px-3 py-2",...a("opening_balance",{valueAsNumber:!0}),placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r==="CREATE"?"Will create an opening journal entry.":"Updating this will create a manual adjustment transaction."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 hover:bg-muted rounded-md text-sm",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-primary text-primary-foreground rounded-md text-sm hover:bg-primary/90",children:i?"Saving...":r==="CREATE"?"Create Account":"Update Account"})]})]})]})}):null},$=()=>e.jsx("div",{className:"space-y-8",children:e.jsx(B,{})});export{$ as default};
