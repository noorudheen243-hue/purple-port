import{q as V,r as i,j as e,w as v}from"./index-CYovX-18.js";import{u as E,b as K,d as Q,a2 as r,I as Y}from"./index-DG6laMbl.js";import{C as u,a as _,b as S,c as h}from"./card-2RwEr_MJ.js";import{L as n}from"./label-DCn_cjj0.js";import{S as w,a as C,b as D,c as k,d as j}from"./select-DjY4TWpW.js";import{D as $}from"./dollar-sign-BdeFNfPA.js";import{A as B}from"./alert-circle-V7EQjuNI.js";import{S as H}from"./save-DIsemnYH.js";const Z=()=>{const I=V(),[c,M]=i.useState(""),[o,L]=i.useState(new Date().getMonth()+1),[m,P]=i.useState(new Date().getFullYear()),{data:p}=E({queryKey:["staff"],queryFn:()=>v.get("/team/staff").then(s=>s.data)}),{data:d}=E({queryKey:["payroll-draft",c,o,m],queryFn:()=>v.get(`/payroll/draft?userId=${c}&month=${o}&year=${m}`).then(s=>s.data),enabled:!!c}),{register:t,handleSubmit:q,setValue:y,watch:g,reset:b}=K({defaultValues:{basic_salary:0,hra:0,allowances:0,conveyance_allowance:0,accommodation_allowance:0,incentives:0,advance_salary:0,other_deductions:0,lop_days:0,lop_deduction:0,net_pay:0}}),a=g();i.useEffect(()=>{d&&(d.isDraft,b(d))},[d,b]),i.useEffect(()=>{const s=Number(a.basic_salary)+Number(a.hra)+Number(a.allowances)+Number(a.conveyance_allowance)+Number(a.accommodation_allowance)+Number(a.incentives),x=(Number(a.basic_salary)+Number(a.hra)+Number(a.conveyance_allowance)+Number(a.accommodation_allowance))/30,f=Math.round(x*Number(a.lop_days));f!==a.lop_deduction&&y("lop_deduction",f);const O=f+Number(a.advance_salary)+Number(a.other_deductions),A=s-O;A!==a.net_pay&&y("net_pay",A)},[a.basic_salary,a.hra,a.allowances,a.conveyance_allowance,a.accommodation_allowance,a.incentives,a.advance_salary,a.other_deductions,a.lop_days,y]);const N=Q({mutationFn:s=>v.post("/payroll/slip",{month:o,year:m,userId:c,data:s}),onSuccess:()=>{alert("Payroll Stub Saved"),I.invalidateQueries({queryKey:["payroll-draft"]})},onError:s=>{var l,x;return alert(((x=(l=s.response)==null?void 0:l.data)==null?void 0:x.message)||"Failed to save")}}),F=s=>{N.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Salary Calculator"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{value:o.toString(),onValueChange:s=>L(parseInt(s)),children:[e.jsx(C,{className:"w-[120px] bg-background",children:e.jsx(D,{placeholder:"Month"})}),e.jsx(k,{children:Array.from({length:12},(s,l)=>e.jsx(j,{value:(l+1).toString(),children:new Date(0,l).toLocaleString("default",{month:"long"})},l+1))})]}),e.jsxs(w,{value:m.toString(),onValueChange:s=>P(parseInt(s)),children:[e.jsx(C,{className:"w-[100px] bg-background",children:e.jsx(D,{placeholder:"Year"})}),e.jsxs(k,{children:[e.jsx(j,{value:"2024",children:"2024"}),e.jsx(j,{value:"2025",children:"2025"})]})]})]})]}),e.jsxs(u,{children:[e.jsx(_,{children:e.jsx(S,{children:"Staff Selection"})}),e.jsx(h,{children:e.jsxs(w,{value:c,onValueChange:M,children:[e.jsx(C,{children:e.jsx(D,{placeholder:"Select Staff Member"})}),e.jsx(k,{children:p==null?void 0:p.map(s=>e.jsxs(j,{value:s.user_id,children:[s.user.full_name," - ",s.designation]},s.user_id))})]})})]}),c&&e.jsxs("form",{onSubmit:q(F),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(u,{className:"border-green-200 dark:border-green-900",children:[e.jsx(_,{className:"bg-green-50 dark:bg-green-950/20",children:e.jsxs(S,{className:"text-green-700 dark:text-green-400 flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"})," Earnings"]})}),e.jsx(h,{className:"space-y-4 pt-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Basic Salary"}),e.jsx(r,{type:"number",...t("basic_salary")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"HRA"}),e.jsx(r,{type:"number",...t("hra")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Conveyance"}),e.jsx(r,{type:"number",...t("conveyance_allowance")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Accommodation"}),e.jsx(r,{type:"number",...t("accommodation_allowance")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Allowances (Misc)"}),e.jsx(r,{type:"number",...t("allowances")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Incentives"}),e.jsx(r,{type:"number",...t("incentives")})]})]})})]}),e.jsxs(u,{className:"border-red-200 dark:border-red-900",children:[e.jsx(_,{className:"bg-red-50 dark:bg-red-950/20",children:e.jsxs(S,{className:"text-red-700 dark:text-red-400 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"})," Deductions"]})}),e.jsxs(h,{className:"space-y-4 pt-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"p-4 bg-red-100 dark:bg-red-900/30 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block font-semibold text-red-900 dark:text-red-200",children:"Auto-LOP Days"}),e.jsx("span",{className:"text-xs text-red-700 dark:text-red-300",children:"Derived from Attendance"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-700 dark:text-red-400",children:Number(g("lop_days"))}),e.jsx("input",{type:"hidden",...t("lop_days")})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"LOP Deduction (Auto)"}),e.jsx(r,{type:"number",...t("lop_deduction"),readOnly:!0,className:"bg-muted"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Calculated based on LOP Days"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Salary Advance (Ledger)"}),e.jsx(r,{type:"number",...t("advance_salary"),readOnly:!0,className:"bg-muted"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Fetched from Accounting Ledger"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Other Deductions"}),e.jsx(r,{type:"number",...t("other_deductions")})]})]})]})]}),e.jsx(u,{className:"md:col-span-2 bg-slate-900 text-white",children:e.jsxs(h,{className:"p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-slate-300",children:"Net Payable"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Earnings - Deductions"})]}),e.jsxs("div",{className:"text-4xl font-bold text-white",children:["â‚¹ ",Math.max(0,Number(g("net_pay"))).toLocaleString("en-IN")]}),e.jsxs(Y,{size:"lg",className:"bg-green-500 hover:bg-green-600 text-white",disabled:N.isPending,children:[e.jsx(H,{className:"w-5 h-5 mr-2"}),N.isPending?"Saving...":"Save Payroll Stub"]})]})})]})]})};export{Z as default};
