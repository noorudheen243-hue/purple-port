import{q as _,u as w,r as N,w as b,j as e}from"./index-CYovX-18.js";import{u as D,b as A,c as C,o as T,d as R,D as M,e as O,f as P,g as L,s as y,_ as S,C as G,w as q}from"./index-DG6laMbl.js";import{F as V}from"./FormErrorAlert-CXCprUnH.js";import{S as I}from"./square-pen-CmKeEUO5.js";import"./alert-circle-V7EQjuNI.js";const F=T({title:y().min(3,"Title is required"),description:y().optional(),type:S(["GENERIC","GRAPHIC","VIDEO","COPY","STRATEGY","DEV"]),priority:S(["LOW","MEDIUM","HIGH","URGENT"]),status:S(["PLANNED","ASSIGNED","IN_PROGRESS","REVIEW","REVISION_REQUESTED","COMPLETED"]),due_date:y().optional(),assignee_id:y().optional()}),U=({isOpen:u,onClose:x,task:a})=>{const E=_(),{user:h}=w(),{data:g}=D({queryKey:["users"],queryFn:()=>b.get("/users").then(t=>t.data)}),{register:r,handleSubmit:f,setValue:n,formState:{errors:m},reset:d}=A({resolver:C(F),defaultValues:{title:"",priority:"MEDIUM",status:"PLANNED",type:"GENERIC"}});N.useEffect(()=>{a&&d({title:a.title,description:a.description,type:a.type,priority:a.priority,status:a.status,assignee_id:a.assignee_id,due_date:a.due_date?new Date(a.due_date).toISOString().slice(0,10):""})},[a,d]);const c=R({mutationFn:async t=>{const l={...t};return t.due_date&&(l.due_date=new Date(t.due_date)),await b.put(`/tasks/${a.id}`,l)},onSuccess:()=>{E.invalidateQueries({queryKey:["tasks"]}),x()},onError:t=>{var l,s;alert("Failed to update task: "+(((s=(l=t.response)==null?void 0:l.data)==null?void 0:s.message)||t.message))}}),v=t=>{c.mutate(t)};return e.jsx(M,{open:u,onOpenChange:x,children:e.jsxs(O,{className:"max-w-xl bg-white p-0 gap-0",children:[e.jsx(P,{className:"p-6 pb-2 border-b",children:e.jsxs(L,{className:"text-xl font-bold flex items-center gap-2 text-gray-800",children:[e.jsx(I,{className:"text-blue-600"}),"Edit Task"]})}),e.jsxs("form",{onSubmit:f(v),className:"p-6 space-y-4",children:[e.jsx(V,{errors:m}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Task Title"}),e.jsx("input",{...r("title"),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-200 outline-none"}),m.title&&e.jsx("p",{className:"text-red-500 text-xs",children:m.title.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{...r("status"),className:"w-full px-4 py-2 border rounded-lg bg-white",children:[e.jsx("option",{value:"PLANNED",children:"Planned"}),e.jsx("option",{value:"ASSIGNED",children:"Assigned"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"REVIEW",children:"Review"}),e.jsx("option",{value:"REVISION_REQUESTED",children:"Revision Requested"}),e.jsx("option",{value:"COMPLETED",children:"Completed"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Priority"}),e.jsxs("select",{...r("priority"),className:"w-full px-4 py-2 border rounded-lg bg-white",children:[e.jsx("option",{value:"LOW",children:"Low"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"}),e.jsx("option",{value:"URGENT",children:"Urgent"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Assigned To"}),e.jsxs("select",{...r("assignee_id"),className:"w-full px-4 py-2 border rounded-lg bg-white",children:[e.jsx("option",{value:"",children:"Unassigned"}),g==null?void 0:g.map(t=>e.jsxs("option",{value:t.id,children:[t.full_name," (",t.department,")"]},t.id))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Due Date"}),e.jsx("input",{type:"date",...r("due_date"),className:"w-full px-4 py-2 border rounded-lg"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:c.isPending?"Saving...":"Save Changes"})]})]})]})})},$=()=>{const[u,x]=N.useState(new Date().toISOString().slice(0,7)),[a,E]=N.useState("ALL"),{data:h,isLoading:g}=D({queryKey:["tasks","board",u,a],queryFn:async()=>(await b.get("/tasks")).data}),r=h==null?void 0:h.filter(s=>{var p;const i=(s.actual_start_date||s.createdAt).startsWith(u),j=a==="ALL"?!0:((p=s.assignee)==null?void 0:p.department)===a;return i&&j}),f=s=>{switch(s){case"COMPLETED":return"text-green-600 bg-green-50 border-green-200";case"IN_PROGRESS":return"text-blue-600 bg-blue-50 border-blue-200";case"REVIEW":return"text-purple-600 bg-purple-50 border-purple-200";case"PLANNED":return"text-gray-500 bg-gray-50 border-gray-200";default:return"text-gray-500 bg-gray-50 border-gray-200"}},{user:n}=w(),m=_(),[d,c]=N.useState(null),v=R({mutationFn:async s=>await b.delete(`/tasks/${s}`),onSuccess:()=>{m.invalidateQueries({queryKey:["tasks"]})},onError:s=>{var o,i;alert(((i=(o=s.response)==null?void 0:o.data)==null?void 0:i.message)||"Failed to delete task")}}),t=s=>{window.confirm("Are you sure you want to delete this task?")&&v.mutate(s)},l=(n==null?void 0:n.department)!=="CREATIVE"&&(n==null?void 0:n.role)!=="CREATIVE_DESIGNER";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(G,{className:"text-purple-600"}),"Task Board History"]}),e.jsx("input",{type:"month",value:u,onChange:s=>x(s.target.value),className:"bg-gray-50 border border-gray-200 rounded-md px-3 py-1.5 text-sm"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:a,onChange:s=>E(s.target.value),className:"bg-gray-100 text-gray-700 rounded-md text-sm font-medium px-4 py-2 border-none outline-none",children:[e.jsx("option",{value:"ALL",children:"All Departments"}),e.jsx("option",{value:"MARKETING",children:"Marketing"}),e.jsx("option",{value:"CREATIVE",children:"Creative"}),e.jsx("option",{value:"WEB",children:"Web"})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm whitespace-nowrap",children:[e.jsx("thead",{className:"bg-gray-50/50 border-b border-gray-200 font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Date"}),e.jsx("th",{className:"p-4",children:"Client / Campaign"}),e.jsx("th",{className:"p-4",children:"Task Name"}),e.jsx("th",{className:"p-4",children:"Type / Nature"}),e.jsx("th",{className:"p-4",children:"Assigned To"}),e.jsx("th",{className:"p-4",children:"Status"}),e.jsx("th",{className:"p-4",children:"Est. vs Actual"}),l&&e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[r==null?void 0:r.map(s=>{var o,i,j,p;return e.jsxs("tr",{className:"hover:bg-gray-50/30",children:[e.jsx("td",{className:"p-4 text-gray-500",children:(s.actual_start_date||s.createdAt).slice(0,10)}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-gray-800",children:(i=(o=s.campaign)==null?void 0:o.client)==null?void 0:i.name}),e.jsx("div",{className:"text-xs text-gray-400",children:(j=s.campaign)==null?void 0:j.title})]}),e.jsx("td",{className:"p-4 font-medium text-gray-900",children:s.title}),e.jsxs("td",{className:"p-4",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 mr-2",children:s.type}),s.nature==="REWORK"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"REWORK"})]}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center gap-2",children:s.assignee?e.jsxs(e.Fragment,{children:[s.assignee.avatar_url?e.jsx("img",{src:s.assignee.avatar_url,className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs font-bold",children:((p=s.assignee.full_name)==null?void 0:p.charAt(0))||"?"}),e.jsx("span",{className:"text-gray-700",children:s.assignee.full_name.split(" ")[0]})]}):e.jsx("span",{className:"text-gray-400 italic",children:"Unassigned"})})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold border ${f(s.status)}`,children:s.status.replace("_"," ")})}),e.jsxs("td",{className:"p-4 text-gray-600",children:[s.actual_time_minutes>0?e.jsxs("span",{className:s.actual_time_minutes>s.estimated_hours*60?"text-red-600":"text-green-600",children:[s.actual_time_minutes,"m"]}):"-",e.jsx("span",{className:"text-gray-400 mx-1",children:"/"}),e.jsx("span",{className:"text-gray-400",children:s.estimated_hours?Math.round(s.estimated_hours*60)+"m":"N/A"})]}),l&&e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>c(s),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition-colors",title:"Edit Task",children:e.jsx(I,{size:16})}),e.jsx("button",{onClick:()=>t(s.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded-md transition-colors",title:"Delete Task",children:e.jsx(q,{size:16})})]})})]},s.id)}),(r==null?void 0:r.length)===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:l?8:7,className:"p-8 text-center text-gray-500",children:"No history for this month."})})]})]})}),d&&e.jsx(U,{isOpen:!!d,onClose:()=>c(null),task:d})]})};export{$ as default};
