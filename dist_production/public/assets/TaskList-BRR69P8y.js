import{v as A,q as M,u as L,r as q,w as p,j as e,E as z,F,L as D}from"./index-CYovX-18.js";import{u as N,b as W,c as H,o as K,d as G,D as V,e as $,f as U,g as Q,h as f,P,U as Y,C as B,s as c,_ as j}from"./index-DG6laMbl.js";import{C as Z}from"./ClientFormModal-CH-QHucO.js";import{F as J}from"./FormErrorAlert-CXCprUnH.js";import{B as X}from"./ImageUpload-CZXxhHEG.js";import"./building-D0HYo3ZX.js";import"./target-BoILNFZG.js";import"./dollar-sign-BdeFNfPA.js";import"./save-DIsemnYH.js";import"./alert-circle-V7EQjuNI.js";import"./loader-2-CtimSdx4.js";import"./upload-WY1TDvjd.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=A("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=A("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),se=K({title:c().min(3,"Title is required"),description:c().optional(),type:j(["GENERIC","GRAPHIC","VIDEO","COPY","STRATEGY","DEV"]),priority:j(["LOW","MEDIUM","HIGH","URGENT"]),category:j(["CAMPAIGN","INTERNAL"]),nature:j(["NEW","REWORK"]),campaign_id:c().optional(),client_id:c().min(1,"Client is required"),assignee_id:c().min(1,"Assigned To is required"),due_date:c().optional()}),te=({isOpen:v,onClose:o})=>{const C=M(),{user:m}=L(),[d,b]=q.useState(!1),{data:x}=N({queryKey:["campaigns"],queryFn:()=>p.get("/campaigns").then(s=>s.data)}),{data:u,refetch:w}=N({queryKey:["clients"],queryFn:()=>p.get("/clients").then(s=>s.data)}),{data:g}=N({queryKey:["users"],queryFn:()=>p.get("/users").then(s=>s.data)}),{register:n,handleSubmit:E,watch:t,setValue:r,formState:{errors:a,isValid:i},reset:_}=W({resolver:H(se),mode:"onChange",defaultValues:{priority:"MEDIUM",type:"GENERIC",category:"CAMPAIGN",nature:"NEW",description:""}}),h=t("category"),y=t("nature"),I=t("client_id"),S=(x==null?void 0:x.filter(s=>s.client_id===I))||[],R=G({mutationFn:async s=>{const l={...s};return s.campaign_id&&(l.campaign={connect:{id:s.campaign_id}},delete l.campaign_id),s.campaign_id&&(l.campaign={connect:{id:s.campaign_id}},delete l.campaign_id),l.assignee={connect:{id:s.assignee_id}},delete l.assignee_id,l.reporter={connect:{id:m==null?void 0:m.id}},s.due_date&&(l.due_date=new Date(s.due_date)),await p.post("/tasks",l)},onSuccess:()=>{C.invalidateQueries({queryKey:["tasks"]}),_(),o()}}),k=s=>{R.mutate(s)},O=s=>{w().then(()=>{r("client_id",s.id)})};return e.jsxs(e.Fragment,{children:[e.jsx(V,{open:v,onOpenChange:o,children:e.jsxs($,{className:"max-w-2xl bg-white p-0 overflow-hidden gap-0",children:[e.jsx(U,{className:"p-6 pb-2",children:e.jsxs(Q,{className:"text-xl font-bold flex items-center gap-2 text-gray-800",children:[e.jsx(T,{className:"text-purple-600"}),"Create New Task"]})}),e.jsxs("form",{onSubmit:E(k,s=>{console.error("Task Validation Failed:",s)}),className:"p-6 pt-2 space-y-5",children:[e.jsx(J,{errors:a}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Category"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>r("category","CAMPAIGN"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg border transition-all ${h==="CAMPAIGN"?"bg-purple-50 border-purple-500 text-purple-700 ring-1 ring-purple-500":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:["Campaign",h==="CAMPAIGN"&&e.jsx(f,{size:16,className:"text-purple-600"})]}),e.jsxs("button",{type:"button",onClick:()=>r("category","INTERNAL"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg border transition-all ${h==="INTERNAL"?"bg-blue-50 border-blue-500 text-blue-700 ring-1 ring-blue-500":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:["Internal",h==="INTERNAL"&&e.jsx(f,{size:16,className:"text-blue-600"})]})]}),e.jsx("input",{type:"hidden",...n("category")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Nature"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>r("nature","NEW"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg border transition-all ${y==="NEW"?"bg-green-50 border-green-500 text-green-700 ring-1 ring-green-500":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:["New Task",y==="NEW"&&e.jsx(f,{size:16,className:"text-green-600"})]}),e.jsxs("button",{type:"button",onClick:()=>r("nature","REWORK"),className:`flex-1 flex items-center justify-center gap-2 py-2.5 text-sm font-medium rounded-lg border transition-all ${y==="REWORK"?"bg-red-50 border-red-500 text-red-700 ring-1 ring-red-500":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(z,{size:14,className:y==="REWORK"?"text-red-600":"text-gray-400"}),"Rework",y==="REWORK"&&e.jsx(f,{size:16,className:"text-red-600"})]})]}),e.jsx("input",{type:"hidden",...n("nature")})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Task Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...n("title"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-200 focus:border-purple-500 outline-none transition-shadow",placeholder:"e.g. Design Holiday Banner"}),a.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.title.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Task Type"}),e.jsxs("select",{...n("type"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-purple-200 outline-none",children:[e.jsx("option",{value:"GENERIC",children:"Generic"}),e.jsx("option",{value:"GRAPHIC",children:"Graphic Design"}),e.jsx("option",{value:"VIDEO",children:"Video Editing"}),e.jsx("option",{value:"COPY",children:"Copywriting"}),e.jsx("option",{value:"STRATEGY",children:"Strategy"}),e.jsx("option",{value:"DEV",children:"Development"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Priority"}),e.jsxs("select",{...n("priority"),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-purple-200 outline-none",children:[e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"}),e.jsx("option",{value:"URGENT",children:"Urgent"}),e.jsx("option",{value:"LOW",children:"Low"})]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-100 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex justify-between",children:[e.jsxs("span",{children:["Select Client ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("button",{type:"button",onClick:()=>b(!0),className:"text-xs text-purple-600 font-semibold hover:underline flex items-center gap-1",children:[e.jsx(P,{size:12})," Add New Client"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsxs("select",{...n("client_id"),className:`w-full pl-10 pr-4 py-2.5 border rounded-lg appearance-none bg-white focus:ring-2 focus:ring-purple-200 outline-none ${a.client_id?"border-red-300":"border-gray-300"}`,onChange:s=>{r("client_id",s.target.value),r("campaign_id","")},children:[e.jsx("option",{value:"",children:"-- Choose Client --"}),u==null?void 0:u.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),a.client_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.client_id.message})]}),h==="CAMPAIGN"&&e.jsxs("div",{className:"space-y-1 animate-in fade-in slide-in-from-top-1",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Select Campaign ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsxs("select",{...n("campaign_id"),disabled:!I,className:`w-full pl-10 pr-4 py-2.5 border rounded-lg appearance-none bg-white focus:ring-2 focus:ring-purple-200 outline-none ${a.campaign_id?"border-red-300":"border-gray-300"} disabled:bg-gray-100 disabled:text-gray-400`,children:[e.jsx("option",{value:"",children:I?"-- Choose Campaign --":"-- Select Client First --"}),S.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]})]}),a.campaign_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.campaign_id.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Assigned To ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsxs("select",{...n("assignee_id"),className:`w-full pl-10 pr-4 py-2.5 border rounded-lg appearance-none bg-white focus:ring-2 focus:ring-purple-200 outline-none ${a.assignee_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Select Staff --"}),g==null?void 0:g.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.department||"General",")"]},s.id))]})]}),a.assignee_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.assignee_id.message})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Due Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-3 text-gray-400",size:18}),e.jsx("input",{type:"date",...n("due_date"),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-200 outline-none"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t mt-4",children:[e.jsx("button",{type:"button",onClick:o,className:"px-5 py-2.5 text-gray-600 font-medium hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:R.isPending,className:"px-6 py-2.5 bg-purple-600 text-white font-medium rounded-lg hover:bg-purple-700 disabled:opacity-50 flex items-center gap-2 shadow-sm transition-all hover:shadow-md",children:R.isPending?"Creating...":"Create Task"})]})]})]})}),e.jsx(Z,{isOpen:d,onClose:()=>b(!1),onSuccess:O})]})},ae=[{id:"PLANNED",label:"Planned"},{id:"ASSIGNED",label:"Assigned"},{id:"IN_PROGRESS",label:"In Progress"},{id:"REVIEW",label:"Review"},{id:"COMPLETED",label:"Completed"}],he=()=>{const v=M(),{data:o,isLoading:C}=N({queryKey:["tasks"],queryFn:async()=>{const{data:t}=await p.get("/tasks");return t}}),m=G({mutationFn:async({id:t,status:r})=>await p.put(`/tasks/${t}`,{status:r}),onSuccess:()=>{v.invalidateQueries({queryKey:["tasks"]})}}),d=o==null?void 0:o.reduce((t,r)=>{const a=r.status;return t[a]||(t[a]=[]),t[a].push(r),t},{}),[b,x]=F(),u=b.get("action")==="new",w=()=>{x({})};if(C)return e.jsx("div",{children:"Loading tasks..."});const g=(t,r)=>{t.dataTransfer.setData("taskId",r)},n=(t,r)=>{const a=t.dataTransfer.getData("taskId");a&&m.mutate({id:a,status:r})},E=t=>{t.preventDefault()};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Task Board"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(D,{to:"?action=new",className:"bg-primary text-primary-foreground px-4 py-2 rounded-md font-medium text-sm flex items-center gap-2",children:[e.jsx(P,{size:16})," New Task"]})})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 flex-1",children:ae.map(t=>{var r,a;return e.jsxs("div",{className:"min-w-[300px] w-[300px] flex flex-col bg-muted/30 rounded-lg border border-border",onDrop:i=>n(i,t.id),onDragOver:E,children:[e.jsxs("div",{className:"p-4 font-semibold text-sm flex justify-between items-center border-b bg-card rounded-t-lg",children:[t.label,e.jsx("span",{className:"bg-muted text-xs px-2 py-1 rounded-full",children:((r=d==null?void 0:d[t.id])==null?void 0:r.length)||0})]}),e.jsx("div",{className:"p-3 space-y-3 flex-1 overflow-y-auto",children:(a=d==null?void 0:d[t.id])==null?void 0:a.map(i=>e.jsxs("div",{draggable:!0,onDragStart:_=>g(_,i.id),className:"bg-card p-4 rounded border shadow-sm cursor-move hover:border-primary/50 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded font-medium 
                                            ${i.type==="GRAPHIC"?"bg-purple-100 text-purple-700":i.type==="VIDEO"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:i.type}),e.jsx("button",{className:"text-muted-foreground hover:text-foreground opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ee,{size:16})})]}),e.jsx(D,{to:`/dashboard/tasks/${i.id}`,className:"font-medium hover:underline block mb-2",children:i.title}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsx("div",{className:"flex -space-x-2",children:i.assignee?e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center text-[10px] font-bold ring-2 ring-background",title:i.assignee.full_name,children:i.assignee.full_name.charAt(0)}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-muted border border-dashed flex items-center justify-center text-[10px]",children:"?"})}),e.jsx("span",{className:`text-xs ${i.priority==="URGENT"?"text-red-500 font-bold":"text-muted-foreground"}`,children:i.priority})]})]},i.id))})]},t.id)})}),e.jsx(te,{isOpen:u,onClose:w})]})};export{he as default};
