import{j as e,H as O,r as l,E as R,w as j}from"./index-CYovX-18.js";import{X as C,u as P,d as N,l as A,w as L}from"./index-DG6laMbl.js";import{f as v}from"./format-D4js0obD.js";import{C as z,c as H}from"./card-2RwEr_MJ.js";import{F as _}from"./filter-DivwszFh.js";import{P as $}from"./pencil-DILtGXJ2.js";import{S as q}from"./save-DIsemnYH.js";const w=({isOpen:a,onClose:i,onConfirm:r,title:u,message:h,confirmLabel:c="Delete",cancelLabel:d="Cancel",isDestructive:m=!0})=>a?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-sm overflow-hidden transform transition-all scale-100",children:[e.jsxs("div",{className:"flex justify-between items-start p-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m&&e.jsx("div",{className:"p-2 bg-red-100 rounded-full text-red-600",children:e.jsx(O,{size:20})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u})]}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(C,{size:20})})]}),e.jsx("div",{className:"p-4",children:e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:h})}),e.jsxs("div",{className:"p-4 bg-gray-50 flex justify-end gap-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-gray-200 transition-colors",children:d}),e.jsx("button",{onClick:r,className:`px-4 py-2 text-sm font-medium text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-1 transition-colors ${m?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-primary hover:bg-primary/90 focus:ring-primary"}`,children:c})]})]})}):null,J=()=>{const[a,i]=l.useState({start:"",end:""}),[r,u]=l.useState({limit:20,start:"",end:""}),[h,c]=l.useState(!1),[d,m]=l.useState(null),[k,x]=l.useState(!1),[t,o]=l.useState(null),[D,f]=l.useState(!1),{data:n,isLoading:b,refetch:p}=P({queryKey:["transactions",r],queryFn:async()=>{const s={limit:r.limit};return r.start&&(s.start_date=r.start),r.end&&(s.end_date=r.end),(await j.get("/accounting/transactions",{params:s})).data}}),y=N({mutationFn:async s=>j.delete(`/accounting/transactions/${s}`),onSuccess:()=>{c(!1),m(null),p()},onError:s=>alert("Failed to delete: "+s.message)}),g=N({mutationFn:async s=>j.put(`/accounting/transactions/${s.id}`,s),onSuccess:()=>{f(!1),x(!1),o(null),p()},onError:s=>alert("Failed to update: "+s.message)}),S=()=>{u({limit:100,start:a.start,end:a.end}),setTimeout(p,100)},T=s=>{m(s),c(!0)},E=s=>{o({id:s.id,description:s.description,date:s.date.split("T")[0],reference:s.reference,amount:s.amount}),x(!0)},F=()=>{t&&f(!0)},M=()=>{g.mutate({id:t.id,description:t.description,date:new Date(t.date).toISOString(),reference:t.reference,amount:parseFloat(t.amount)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Transaction History"}),e.jsx(z,{children:e.jsxs(H,{className:"p-4 flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"From Date"}),e.jsx("input",{type:"date",className:"w-full bg-background border rounded-md px-3 py-2",value:a.start,onChange:s=>i({...a,start:s.target.value})})]}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"To Date"}),e.jsx("input",{type:"date",className:"w-full bg-background border rounded-md px-3 py-2",value:a.end,onChange:s=>i({...a,end:s.target.value})})]}),e.jsxs("button",{onClick:S,className:"bg-primary text-primary-foreground px-6 py-2 rounded-md hover:bg-primary/90 flex items-center gap-2 h-10",children:[e.jsx(_,{className:"w-4 h-4"})," Generate History"]}),e.jsxs("button",{onClick:()=>{i({start:"",end:""}),u({limit:20,start:"",end:""}),p()},className:"border px-4 py-2 rounded-md hover:bg-secondary flex items-center gap-2 h-10",title:"Reset to Last 20",children:[e.jsx(R,{className:"w-4 h-4"})," Reset"]})]})}),e.jsx("div",{className:"bg-card rounded-lg border shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted text-muted-foreground font-medium border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3",children:"Description"}),e.jsx("th",{className:"px-4 py-3",children:"Type"}),e.jsx("th",{className:"px-4 py-3",children:"Debit (To)"}),e.jsx("th",{className:"px-4 py-3",children:"Credit (From)"}),e.jsx("th",{className:"px-4 py-3",children:"Ref"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-8 text-center text-muted-foreground",children:"Loading transactions..."})}):(n==null?void 0:n.length)===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-8 text-center text-muted-foreground",children:"No transactions found."})}):n==null?void 0:n.map(s=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:A(new Date(s.date),"dd/MM/yyyy")}),e.jsx("td",{className:"px-4 py-3 font-medium",children:s.description}),e.jsx("td",{className:"px-4 py-3 text-xs uppercase badge",children:e.jsx("span",{className:"bg-secondary px-2 py-0.5 rounded text-foreground/80",children:s.type})}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground",children:s.debit_ledgers}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground",children:s.credit_ledgers}),e.jsx("td",{className:"px-4 py-3 text-xs font-mono",children:s.reference||"-"}),e.jsx("td",{className:"px-4 py-3 text-right font-mono font-bold",children:v(s.amount)}),e.jsxs("td",{className:"px-4 py-3 text-center flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>E(s),className:"p-1.5 hover:bg-blue-100 text-blue-600 rounded transition-colors",title:"Edit Details",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>T(s),className:"p-1.5 hover:bg-red-100 text-red-600 rounded transition-colors",title:"Delete (Reverse Transaction)",children:e.jsx(L,{className:"w-4 h-4"})})]})]},s.id))})]})}),!b&&(n==null?void 0:n.length)>=20&&!a.start&&e.jsx("div",{className:"text-center text-xs text-muted-foreground pt-2",children:"Showing last 20 transactions. Use date filters to see more."}),k&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background p-6 rounded-lg w-full max-w-md space-y-4 shadow-lg border",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Edit Transaction"}),e.jsx("button",{onClick:()=>x(!1),children:e.jsx(C,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date"}),e.jsx("input",{type:"date",className:"w-full border rounded p-2 bg-background",value:t.date,onChange:s=>o({...t,date:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("input",{className:"w-full border rounded p-2 bg-background",value:t.description,onChange:s=>o({...t,description:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Reference"}),e.jsx("input",{className:"w-full border rounded p-2 bg-background",value:t.reference||"",onChange:s=>o({...t,reference:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Amount"}),e.jsx("input",{type:"number",className:"w-full border rounded p-2 bg-background font-mono",value:t.amount,onChange:s=>o({...t,amount:s.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Changing this updates associated ledger balances."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 border rounded hover:bg-secondary",children:"Cancel"}),e.jsxs("button",{onClick:F,disabled:g.isPending,className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90 flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"})," Save Changes"]})]})]})}),e.jsx(w,{isOpen:h,onClose:()=>c(!1),onConfirm:()=>y.mutate(d.id),title:"Delete Transaction?",message:`Are you sure you want to delete this transaction for ${v(d==null?void 0:d.amount)}? This will reverse the balances in the ledgers.`,confirmLabel:y.isPending?"Deleting...":"Delete Permanently",isDestructive:!0}),e.jsx(w,{isOpen:D,onClose:()=>f(!1),onConfirm:M,title:"Confirm Changes",message:"Are you sure you want to edit this transaction? Changing financial details will automatically update the linked ledger balances.",confirmLabel:g.isPending?"Saving...":"Confim & Save",isDestructive:!1})]})};export{J as default};
