import{r as n,j as e,w as _}from"./index-CYovX-18.js";import{t as F,a4 as i,u as P,C as Y,v as E,I as $,a5 as w,a6 as A,m as M,n as U}from"./index-DG6laMbl.js";import{C as f,a as u,b as p,c as N}from"./card-2RwEr_MJ.js";import{S as b,a as y,b as v,c as T,d as o}from"./select-DjY4TWpW.js";import{B as S}from"./building-2-C7JxWd9d.js";import{D as q}from"./download-B23IOqDP.js";import{s as L,e as G}from"./endOfWeek-Deq60kZA.js";function K(t){const a=F(t),r=a.getFullYear();return a.setFullYear(r+1,0,0),a.setHours(23,59,59,999),a}const C=n.forwardRef(({className:t,...a},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:i("w-full caption-bottom text-sm",t),...a})}));C.displayName="Table";const k=n.forwardRef(({className:t,...a},r)=>e.jsx("thead",{ref:r,className:i("[&_tr]:border-b",t),...a}));k.displayName="TableHeader";const R=n.forwardRef(({className:t,...a},r)=>e.jsx("tbody",{ref:r,className:i("[&_tr:last-child]:border-0",t),...a}));R.displayName="TableBody";const Q=n.forwardRef(({className:t,...a},r)=>e.jsx("tfoot",{ref:r,className:i("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...a}));Q.displayName="TableFooter";const g=n.forwardRef(({className:t,...a},r)=>e.jsx("tr",{ref:r,className:i("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...a}));g.displayName="TableRow";const x=n.forwardRef(({className:t,...a},r)=>e.jsx("th",{ref:r,className:i("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...a}));x.displayName="TableHead";const c=n.forwardRef(({className:t,...a},r)=>e.jsx("td",{ref:r,className:i("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...a}));c.displayName="TableCell";const z=n.forwardRef(({className:t,...a},r)=>e.jsx("caption",{ref:r,className:i("mt-4 text-sm text-muted-foreground",t),...a}));z.displayName="TableCaption";const re=()=>{const[t,a]=n.useState("staff"),[r,O]=n.useState("month"),I=()=>{const s=new Date;switch(r){case"today":return{start:new Date().toISOString(),end:new Date().toISOString()};case"week":return{start:U(s).toISOString(),end:G(s).toISOString()};case"month":return{start:L(s).toISOString(),end:M(s).toISOString()};case"year":return{start:A(s).toISOString(),end:K(s).toISOString()};default:return{start:"",end:""}}},{start:D,end:B}=I(),{data:l,isLoading:h}=P({queryKey:["task-stats",t,r],queryFn:async()=>(await _.get("/tasks/stats",{params:{view:t,start:D,end:B}})).data}),H=()=>{if(!l)return;const s=["Name","Total Tasks","Completed","Pending","Overdue","Completion Rate (%)"],d=l.map(m=>[m.name,m.total,m.completed,m.pending,m.overdue,m.rate].join(",")),V="data:text/csv;charset=utf-8,"+[s.join(","),...d].join(`
`),W=encodeURI(V),j=document.createElement("a");j.setAttribute("href",W),j.setAttribute("download",`task_report_${t}_${r}.csv`),document.body.appendChild(j),j.click(),document.body.removeChild(j)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Task Reports"}),e.jsx("p",{className:"text-muted-foreground",children:"Generate reports by Staff, Department, or Client."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{value:r,onValueChange:s=>O(s),children:[e.jsxs(y,{className:"w-[150px]",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),e.jsx(v,{placeholder:"Period"})]}),e.jsxs(T,{children:[e.jsx(o,{value:"today",children:"Today"}),e.jsx(o,{value:"week",children:"This Week"}),e.jsx(o,{value:"month",children:"This Month"}),e.jsx(o,{value:"year",children:"This Year"}),e.jsx(o,{value:"all",children:"All Time"})]})]}),e.jsxs(b,{value:t,onValueChange:s=>a(s),children:[e.jsxs(y,{className:"w-[180px]",children:[t==="staff"&&e.jsx(E,{className:"mr-2 h-4 w-4"}),t==="department"&&e.jsx(S,{className:"mr-2 h-4 w-4"}),t==="client"&&e.jsx(S,{className:"mr-2 h-4 w-4"})," ",e.jsx(v,{placeholder:"Report Type"})]}),e.jsxs(T,{children:[e.jsx(o,{value:"staff",children:"Staff Wise"}),e.jsx(o,{value:"department",children:"Department Wise"}),e.jsx(o,{value:"client",children:"Client Wise"})]})]}),e.jsxs($,{variant:"outline",onClick:H,children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Export CSV"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(f,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Total Tasks"}),e.jsx(w,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:h?"...":l==null?void 0:l.reduce((s,d)=>s+d.total,0)})})]}),e.jsxs(f,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Completed"}),e.jsx(w,{className:"h-4 w-4 text-green-500"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:h?"...":l==null?void 0:l.reduce((s,d)=>s+d.completed,0)})})]}),e.jsxs(f,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Pending"}),e.jsx(w,{className:"h-4 w-4 text-yellow-500"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:h?"...":l==null?void 0:l.reduce((s,d)=>s+d.pending,0)})})]}),e.jsxs(f,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Overdue"}),e.jsx(w,{className:"h-4 w-4 text-red-500"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:h?"...":l==null?void 0:l.reduce((s,d)=>s+d.overdue,0)})})]})]}),e.jsxs(f,{children:[e.jsx(u,{children:e.jsx(p,{children:"Detailed Breakdown"})}),e.jsx(N,{children:e.jsxs(C,{children:[e.jsx(k,{children:e.jsxs(g,{children:[e.jsx(x,{className:"w-[200px]",children:"Name"}),e.jsx(x,{className:"text-right",children:"Total Tasks"}),e.jsx(x,{className:"text-right",children:"Completed"}),e.jsx(x,{className:"text-right",children:"Pending"}),e.jsx(x,{className:"text-right text-red-500",children:"Overdue"}),e.jsx(x,{className:"text-right",children:"Completion Rate"})]})}),e.jsx(R,{children:h?e.jsx(g,{children:e.jsx(c,{colSpan:6,className:"text-center py-10",children:"Loading reports..."})}):(l==null?void 0:l.length)===0?e.jsx(g,{children:e.jsx(c,{colSpan:6,className:"text-center py-10",children:"No data found for this period."})}):l==null?void 0:l.map(s=>e.jsxs(g,{children:[e.jsx(c,{className:"font-medium",children:s.name}),e.jsx(c,{className:"text-right",children:s.total}),e.jsx(c,{className:"text-right text-green-600 font-medium",children:s.completed}),e.jsx(c,{className:"text-right text-yellow-600",children:s.pending}),e.jsx(c,{className:"text-right text-red-600 font-medium",children:s.overdue}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("div",{className:"w-16 h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${s.rate>=80?"bg-green-500":s.rate>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${s.rate}%`}})}),e.jsxs("span",{className:"text-xs w-8",children:[s.rate,"%"]})]})})]},s.name))})]})})]})]})};export{re as default};
