import{u as R,r as P,j as e,x as j}from"./index-DTs_gUpQ.js";import{C as d,a as c,b as i,c as o}from"./card-CkON84C3.js";import{T as I,a as T,b as h,c as u,d as U,e as n}from"./table-D4yQmoYa.js";import{B as x}from"./badge-CAnxudGq.js";import{S as O,a as V,b as k,c as q,d as S}from"./select-MX7Oli-8.js";import{u as f,k as A}from"./index-BPHe9uWR.js";import"./index-Bs76HOJd.js";import"./index-D_f1ssGG.js";const Y=()=>{var N;const{user:a}=R(),m=(a==null?void 0:a.role)==="ADMIN"||(a==null?void 0:a.role)==="MANAGER"||(a==null?void 0:a.role)==="DEVELOPER_ADMIN",[t,p]=P.useState("me");P.useEffect(()=>{a&&!m&&p("me")},[a,m]);const{data:E=[]}=f({queryKey:["staff-list"],queryFn:async()=>(await j.get("/team/staff")).data,enabled:m}),{data:_=[],isLoading:D}=f({queryKey:["leave-summary",t],queryFn:async()=>{const s=t==="me"?a==null?void 0:a.id:t;return s?(await j.get(`/team/leaves?userId=${s}`)).data:[]},enabled:!!(t==="me"?a!=null&&a.id:t)}),{data:w=[]}=f({queryKey:["my-allocations",t],queryFn:async()=>{const s=t==="me"?a==null?void 0:a.id:t;if(!s)return[];const b=new Date().getFullYear();return(await j.get(`/attendance/planner/allocations?year=${b}&userId=${s}`)).data},enabled:!!(t==="me"?a!=null&&a.id:t)}),l=((N=w[0])==null?void 0:N.allocation)||{casual_leave:12,sick_leave:7,earned_leave:0,unpaid_leave:0},r=_.filter(s=>!0),L=s=>{switch(s){case"APPROVED":return e.jsx(x,{className:"bg-green-500 hover:bg-green-600",children:"Approved"});case"PENDING":return e.jsx(x,{className:"bg-yellow-500 hover:bg-yellow-600",children:"Pending"});case"REJECTED":return e.jsx(x,{className:"bg-red-500 hover:bg-red-600",children:"Rejected"});default:return e.jsx(x,{variant:"outline",children:"Unknown"})}},v=r.filter(s=>s.type==="CASUAL"&&s.status==="APPROVED").length,g=r.filter(s=>s.type==="SICK"&&s.status==="APPROVED").length,C=r.filter(s=>(s.type==="UNPAID"||s.type==="LOP")&&s.status==="APPROVED").length,y=r.filter(s=>s.type==="EARNED"&&s.status==="APPROVED").length;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Leave Summary"}),m&&e.jsx("div",{className:"w-[300px]",children:e.jsxs(O,{value:t,onValueChange:p,children:[e.jsx(V,{children:e.jsx(k,{placeholder:"Select Staff Member"})}),e.jsxs(q,{children:[e.jsx(S,{value:"me",children:"My Summary"}),E.map(s=>e.jsx(S,{value:s.user_id,children:s.user.full_name},s.user_id))]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(d,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(i,{className:"text-sm font-medium",children:"Casual Leave"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[v," / ",l.casual_leave]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Available: ",l.casual_leave-v]})]})]}),e.jsxs(d,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(i,{className:"text-sm font-medium",children:"Sick Leave"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[g," / ",l.sick_leave]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Available: ",l.sick_leave-g]})]})]}),e.jsxs(d,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(i,{className:"text-sm font-medium",children:"Unpaid/LOP"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:C}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Limit: ",l.unpaid_leave>0?l.unpaid_leave:"âˆž"]})]})]}),e.jsxs(d,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(i,{className:"text-sm font-medium",children:"Earned Leave"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[y," / ",l.earned_leave]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Available: ",l.earned_leave-y]})]})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(i,{children:"History"})}),e.jsx(o,{children:e.jsxs(I,{children:[e.jsx(T,{children:e.jsxs(h,{children:[e.jsx(u,{children:"Type"}),e.jsx(u,{children:"Dates"}),e.jsx(u,{children:"Reason"}),e.jsx(u,{children:"Status"})]})}),e.jsx(U,{children:D?e.jsx(h,{children:e.jsx(n,{colSpan:4,className:"text-center h-24 text-muted-foreground",children:"Loading..."})}):r.length===0?e.jsx(h,{children:e.jsx(n,{colSpan:4,className:"text-center h-24 text-muted-foreground",children:"No leave history found."})}):r.map(s=>e.jsxs(h,{children:[e.jsx(n,{children:e.jsx(x,{variant:"outline",children:s.type})}),e.jsx(n,{children:e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{children:[A(new Date(s.start_date),"PP")," - ",A(new Date(s.end_date),"PP")]})})}),e.jsx(n,{className:"max-w-[200px] truncate",title:s.reason,children:s.reason}),e.jsx(n,{children:L(s.status)})]},s.id))})]})})]})]})};export{Y as default};
