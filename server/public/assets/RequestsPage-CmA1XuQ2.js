import{u as v,q as E,r as f,j as e,E as y,x as m}from"./index-DTs_gUpQ.js";import{u as b,j as T,k as C,B as j,X as D,g as P}from"./index-BPHe9uWR.js";import{C as R,a as A,b as w,c as M}from"./card-CkON84C3.js";import{T as I,a as S,b as o,c as G}from"./tabs-B5Xndk5l.js";import{T as V,a as k,b as c,c as r,d as B,e as t}from"./table-D4yQmoYa.js";import{B as p}from"./badge-CAnxudGq.js";import"./index-osOQW184.js";import"./index-Bs76HOJd.js";function K(){const{user:a}=v(),x=E(),[l,g]=f.useState("PENDING"),u=(a==null?void 0:a.role)==="ADMIN"||(a==null?void 0:a.role)==="MANAGER"||(a==null?void 0:a.role)==="DEVELOPER_ADMIN",{data:n,isLoading:N}=b({queryKey:["regularisation-requests",l],queryFn:async()=>(await m.get(`/attendance/regularisation/requests?status=${l}`)).data,enabled:u}),h=T({mutationFn:async({id:s,status:i})=>{await m.patch(`/attendance/regularisation/${s}/status`,{status:i})},onSuccess:()=>{x.invalidateQueries({queryKey:["regularisation-requests"]}),x.invalidateQueries({queryKey:["biometric-logs"]})},onError:s=>{var i,d;alert(((d=(i=s.response)==null?void 0:i.data)==null?void 0:d.message)||"Failed to update status")}});return u?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Approvals"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage attendance regularization requests"})]})}),e.jsxs(I,{defaultValue:"PENDING",onValueChange:g,children:[e.jsxs(S,{children:[e.jsx(o,{value:"PENDING",children:"Pending"}),e.jsx(o,{value:"APPROVED",children:"Approved"}),e.jsx(o,{value:"REJECTED",children:"Rejected"})]}),e.jsx(G,{value:l,className:"mt-4",children:e.jsxs(R,{children:[e.jsx(A,{children:e.jsx(w,{children:l==="PENDING"?"Pending Requests":`${l} History`})}),e.jsx(M,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(V,{children:[e.jsx(k,{children:e.jsxs(c,{children:[e.jsx(r,{children:"Date"}),e.jsx(r,{children:"Employee"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Reason"}),e.jsx(r,{children:"Status"}),e.jsx(r,{className:"text-right",children:"Actions"})]})}),e.jsx(B,{children:N?e.jsx(c,{children:e.jsx(t,{colSpan:6,className:"text-center h-24",children:"Loading..."})}):(n==null?void 0:n.length)===0?e.jsx(c,{children:e.jsx(t,{colSpan:6,className:"text-center h-24",children:"No requests found."})}):n==null?void 0:n.map(s=>{var i,d;return e.jsxs(c,{children:[e.jsx(t,{children:C(new Date(s.date),"MMM dd, yyyy")}),e.jsxs(t,{children:[e.jsx("div",{className:"font-medium",children:(i=s.user)==null?void 0:i.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(d=s.user)==null?void 0:d.department})]}),e.jsx(t,{children:e.jsx(p,{variant:"outline",children:s.type.replace(/_/g," ")})}),e.jsx(t,{className:"max-w-xs",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"truncate",title:s.reason,children:s.reason}),s.exceeds_limit&&e.jsxs("span",{className:"flex items-center text-xs text-amber-600 font-semibold gap-1",children:[e.jsx(y,{className:"w-3 h-3"}),"Limit Exceeded"]})]})}),e.jsx(t,{children:e.jsx(p,{variant:s.status==="APPROVED"?"default":s.status==="REJECTED"?"destructive":"secondary",children:s.status})}),e.jsx(t,{className:"text-right",children:s.status==="PENDING"&&e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>h.mutate({id:s.id,status:"REJECTED"}),title:"Reject",children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx(j,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",onClick:()=>h.mutate({id:s.id,status:"APPROVED"}),title:"Approve",children:e.jsx(P,{className:"w-4 h-4"})})]})})]},s.id)})})]})})})]})})]})]}):e.jsx("div",{className:"p-6",children:"You do not have permission to view this page."})}export{K as default};
