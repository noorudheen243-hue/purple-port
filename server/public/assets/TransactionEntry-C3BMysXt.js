import{v as R,q as I,C as P,j as e,x as y}from"./index-DTs_gUpQ.js";import{a2 as V,k as j,a5 as L,u as N,j as k,C as M,a6 as q,a7 as G,a8 as m,a9 as A,aa as T}from"./index-BPHe9uWR.js";import{A as $}from"./arrow-down-circle-DCzZBLUV.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=R("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),K=G({date:m(),description:m().min(3,"Description is required"),amount:T().min(1,"Amount must be positive"),type:A(["EXPENSE","INCOME"]),payment_mode_id:m().min(1,"Payment Mode is required"),category_id:m().optional(),reference:m().optional(),nature:A(["GENERAL","ADVANCE_RECEIVED","ADVANCE_PAID"]),entity_id:m().optional()}),B=()=>{const b=I(),{register:n,handleSubmit:_,watch:h,setValue:x,reset:v,formState:{errors:c}}=V({resolver:L(K),defaultValues:{date:j(new Date,"yyyy-MM-dd"),type:"EXPENSE",nature:"GENERAL",amount:0}}),s=h("nature"),i=h("type")==="EXPENSE",{data:a,isLoading:C}=N({queryKey:["ledgers"],queryFn:async()=>(await y.get("/accounting/ledgers")).data}),{data:f}=N({queryKey:["clients"],queryFn:async()=>(await y.get("/clients")).data,enabled:s==="ADVANCE_RECEIVED"}),{data:g}=N({queryKey:["users"],queryFn:async()=>(await y.get("/users")).data.filter(r=>r.role!=="CLIENT"),enabled:s==="ADVANCE_PAID"}),E=k({mutationFn:t=>y.post("/accounting/transactions",t),onSuccess:t=>{b.invalidateQueries({queryKey:["ledgers"]}),b.invalidateQueries({queryKey:["transactions"]});const r=t.data.transaction_number||"Recorded";alert(`Transaction ${r} Recorded Successfully!`),v({date:j(new Date,"yyyy-MM-dd"),type:"EXPENSE",nature:"GENERAL",amount:0,description:"",reference:""})},onError:t=>{var u,p,d,l;const r=((p=(u=t.response)==null?void 0:u.data)==null?void 0:p.message)||"Transaction Failed",o=((l=(d=t.response)==null?void 0:d.data)==null?void 0:l.error)||t.message;alert(`❌ Error: ${r}
Details: ${o}`)}});P.useEffect(()=>{s==="ADVANCE_RECEIVED"?x("type","INCOME"):s==="ADVANCE_PAID"&&x("type","EXPENSE")},[s,x]);const D=(a==null?void 0:a.filter(t=>["BANK","CASH"].includes(t.entity_type)))||[],w=(a==null?void 0:a.filter(t=>!["BANK","CASH"].includes(t.entity_type)))||[],S=async t=>{let r="",o="",u=t.entity_id;if(t.nature==="GENERAL"){if(!t.category_id){alert("Please select a Ledger Account for General transactions.");return}r=i?t.payment_mode_id:t.category_id,o=i?t.category_id:t.payment_mode_id}else if(t.nature==="ADVANCE_RECEIVED"){if(!t.entity_id){alert("Please select a Client.");return}const d=a==null?void 0:a.find(l=>l.entity_type==="CLIENT"&&l.entity_id===t.entity_id);if(!d){alert("Ledger not found for selected Client. Please ensure client ledger exists.");return}r=d.id,o=t.payment_mode_id}else if(t.nature==="ADVANCE_PAID"){if(!t.entity_id){alert("Please select a Staff Member.");return}const d=a==null?void 0:a.find(l=>l.entity_type==="USER"&&l.entity_id===t.entity_id);if(!d){alert("Ledger not found for selected Staff. Please ensure staff ledger exists.");return}r=t.payment_mode_id,o=d.id}const p={date:t.date,description:t.description,amount:t.amount,type:t.type,reference:t.reference,nature:t.nature,entity_id:u,from_ledger_id:r,to_ledger_id:o};E.mutate(p)};return C?e.jsx("div",{children:"Loading System Data..."}):e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Record Transaction"}),e.jsx("p",{className:"text-muted-foreground",children:"Record Income, Expenses, and Advances."})]}),e.jsx("div",{className:"bg-card border rounded-lg p-6 shadow-sm",children:e.jsxs("form",{onSubmit:_(S),className:"space-y-6",children:[e.jsx("div",{className:`grid grid-cols-2 gap-4 ${s!=="GENERAL"?"opacity-50 pointer-events-none":""}`,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Accounting Entry Type"}),e.jsxs("div",{className:"flex gap-4 p-1 bg-muted rounded-lg",children:[e.jsxs("label",{className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-md cursor-pointer transition-all ${i?"bg-background shadow-sm text-red-600 font-medium":"text-muted-foreground"}`,children:[e.jsx("input",{type:"radio",value:"EXPENSE",...n("type"),className:"hidden"}),e.jsx(F,{className:"w-4 h-4"}),"Expense (Out)"]}),e.jsxs("label",{className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-md cursor-pointer transition-all ${i?"text-muted-foreground":"bg-background shadow-sm text-green-600 font-medium"}`,children:[e.jsx("input",{type:"radio",value:"INCOME",...n("type"),className:"hidden"}),e.jsx($,{className:"w-4 h-4"}),"Income (In)"]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium block",children:"Transaction Type"}),e.jsx("div",{className:"flex gap-4 p-1 bg-muted rounded-lg",children:[{value:"GENERAL",label:"General"},{value:"ADVANCE_RECEIVED",label:"Advance Received (Client)"},{value:"ADVANCE_PAID",label:"Advance Paid (Staff)"}].map(t=>e.jsxs("label",{className:`flex-1 flex items-center justify-center py-2 text-sm rounded-md cursor-pointer transition-all ${s===t.value?"bg-background shadow-sm font-medium text-primary":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx("input",{type:"radio",value:t.value,...n("nature"),className:"hidden"}),t.label]},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Date"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",className:"w-full bg-background border rounded-md px-3 py-2 pl-10",...n("date")}),e.jsx(M,{className:"w-4 h-4 absolute left-3 top-3 text-muted-foreground"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Amount (","₹",")"]}),e.jsx("input",{type:"number",step:"0.01",className:"w-full bg-background border rounded-md px-3 py-2 font-mono",...n("amount",{valueAsNumber:!0})}),c.amount&&e.jsx("span",{className:"text-destructive text-xs",children:c.amount.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("input",{type:"text",className:"w-full bg-background border rounded-md px-3 py-2",...n("description")}),c.description&&e.jsx("span",{className:"text-destructive text-xs",children:c.description.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),i?"Paid From (Source)":"Deposit To (Destination)"]}),e.jsxs("select",{className:"w-full bg-background border rounded-md px-3 py-2",...n("payment_mode_id"),children:[e.jsx("option",{value:"",children:"Select Bank / Cash"}),D.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.entity_type,")"]},t.id))]}),c.payment_mode_id&&e.jsx("span",{className:"text-destructive text-xs",children:c.payment_mode_id.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:s==="ADVANCE_RECEIVED"?"Select Client":s==="ADVANCE_PAID"?"Select Staff Member":i?"Expense Account":"Income Account"}),s==="GENERAL"&&e.jsxs("select",{className:"w-full bg-background border rounded-md px-3 py-2",...n("category_id"),children:[e.jsx("option",{value:"",children:"Select Ledger Account"}),w.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.head.name,")"]},t.id))]}),s==="ADVANCE_RECEIVED"&&e.jsxs("select",{className:"w-full bg-background border rounded-md px-3 py-2",...n("entity_id"),children:[e.jsx("option",{value:"",children:"Select Client"}),f==null?void 0:f.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),s==="ADVANCE_PAID"&&e.jsxs("select",{className:"w-full bg-background border rounded-md px-3 py-2",...n("entity_id"),children:[e.jsx("option",{value:"",children:"Select Staff"}),g==null?void 0:g.map(t=>e.jsx("option",{value:t.id,children:t.full_name},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Reference (Optional)"}),e.jsx("input",{type:"text",placeholder:"Cheque # / UPI Ref",className:"w-full bg-background border rounded-md px-3 py-2",...n("reference")})]}),e.jsx("button",{type:"submit",disabled:E.isPending,className:`w-full py-2 rounded-md font-medium text-white transition-colors disabled:opacity-50 ${i?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,children:E.isPending?"Processing...":s!=="GENERAL"?"Record Advance":i?"Record Expense":"Record Income"})]})})]})};export{B as default};
