import{v as de,q as ne,r as l,x as I,j as e}from"./index-DTs_gUpQ.js";import{T as ue,a as me,b as te,c as ae}from"./tabs-B5Xndk5l.js";import{k as L,u as le,j as Y,I as v,B as h,m as ie,P as he,D as xe,d as pe,W as je,a as ye,Z as ge,ah as ve,_ as be,X as fe,N as Ne}from"./index-BPHe9uWR.js";import{C as B,a as q,b as O,c as $}from"./card-CkON84C3.js";import{L as b}from"./label-CYspnl4A.js";import{S as H,a as K,b as Z,c as X,d as E}from"./select-MX7Oli-8.js";import{S as we}from"./save-dY_yXBe1.js";import{B as Ce}from"./badge-CAnxudGq.js";import{T as De,a as Se,b as J,c as C,d as Ie,e as f}from"./table-D4yQmoYa.js";import{f as F}from"./format-D4js0obD.js";import{I as Te}from"./InvoiceTemplate-B66Kyjs5.js";import _e from"./html2canvas.esm-CBrSDip1.js";import{E as Ae}from"./jspdf.es.min-QMgCvEf6.js";import{C as ke}from"./check-circle-CR2qGfs6.js";import{P as Pe}from"./printer-7BmkHmUH.js";import"./index-osOQW184.js";import"./index-Bs76HOJd.js";import"./index-D_f1ssGG.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=de("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),Re=["Service Charges – Meta","Service Charges – Google Ads","Service Charges – SEO","Website Development","Website Modification","Creatives","Printables","Branding Assets","Logo Design / Branding Package","Video Production","Studio Charge","Equipment Rent","Anchor Charge","Motion Graphic Production","AI Video Production","Poster Design","Other"],Ee=()=>{const T=ne(),[r,_]=l.useState("ONBOARDED"),[d,x]=l.useState(""),[p,D]=l.useState(""),[N,A]=l.useState(L(new Date,"yyyy-MM-dd")),[S,z]=l.useState("");l.useEffect(()=>{if(N){const t=new Date(N);t.setDate(t.getDate()+7),z(L(t,"yyyy-MM-dd"))}},[N]);const[m,w]=l.useState([{sl_no:1,particulars:"",description:"",quantity:1,rate:0,amount:0,ledger_id:""}]),[j,k]=l.useState(0),[g,W]=l.useState(0),[G,s]=l.useState("Previous Balance"),[n,c]=l.useState(0),[o,P]=l.useState("Advance Received"),[M,U]=l.useState(0),{data:Q=[]}=le({queryKey:["clients"],queryFn:async()=>{const{data:t}=await I.get("/clients");return t},enabled:r==="ONBOARDED"}),[y,ee]=l.useState(0);l.useEffect(()=>{if(r==="ONBOARDED"&&d){const t=Q.find(a=>a.id===d);if(t){D(t.company_name||t.name);const a=t.advance_balance||0;ee(a),a>0?c(a):c(0)}}else ee(0),c(0)},[d,r,Q]),l.useEffect(()=>{m.map(t=>{const a=t.quantity*t.rate;return{...t,amount:a}})},[]);const R=(t,a,i)=>{const u=[...m];u[t]={...u[t],[a]:i},(a==="quantity"||a==="rate")&&(u[t].amount=Number(u[t].quantity)*Number(u[t].rate)),w(u),se(u)},se=t=>{const a=t.reduce((i,u)=>i+u.amount,0);k(a),U(a+Number(g)-Number(n))};l.useEffect(()=>{U(j+Number(g)-Number(n))},[j,g,n]);const re=()=>{w([...m,{sl_no:m.length+1,particulars:"",description:"",quantity:1,rate:0,amount:0,ledger_id:""}])},ce=t=>{if(m.length===1)return;const a=m.filter((i,u)=>u!==t).map((i,u)=>({...i,sl_no:u+1}));w(a),se(a)},V=Y({mutationFn:async t=>await I.post("/billing/invoices",t),onSuccess:()=>{alert("Invoice Generated Successfully!"),T.invalidateQueries({queryKey:["invoices"]}),w([{sl_no:1,particulars:"",description:"",quantity:1,rate:0,amount:0,ledger_id:""}]),k(0),U(0)},onError:t=>{alert("Failed to generate invoice."),console.error(t)}}),oe=()=>{if(!p){alert("Client Name is required");return}const t={client_type:r,client_id:r==="ONBOARDED"?d:null,client_name:p,invoice_date:N,due_date:S,items:m,sub_total:j,additions_total:g,additions_desc:G,deductions_total:n,deductions_desc:o,net_payable:M};V.mutate(t)};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(B,{children:[e.jsx(q,{children:e.jsx(O,{children:"Invoice Details"})}),e.jsxs($,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Client Type"}),e.jsxs(H,{value:r,onValueChange:t=>_(t),children:[e.jsx(K,{children:e.jsx(Z,{})}),e.jsxs(X,{children:[e.jsx(E,{value:"ONBOARDED",children:"Onboarded Client"}),e.jsx(E,{value:"WALKIN",children:"Walk-in Client"})]})]})]}),r==="ONBOARDED"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Select Client"}),e.jsxs(H,{value:d,onValueChange:x,children:[e.jsx(K,{children:e.jsx(Z,{placeholder:"Search Client..."})}),e.jsx(X,{children:Q.map(t=>e.jsx(E,{value:t.id,children:t.company_name||t.name},t.id))})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Client Name"}),e.jsx(v,{value:p,onChange:t=>D(t.target.value),placeholder:"Type client name..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Invoice Date"}),e.jsx(v,{type:"date",value:N,onChange:t=>A(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Due Date"}),e.jsx(v,{type:"date",value:S,readOnly:!0,className:"bg-muted"})]})]})]}),e.jsxs(B,{children:[e.jsx(q,{children:e.jsx(O,{children:"Items"})}),e.jsxs($,{className:"space-y-4",children:[m.map((t,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-start border-b pb-4",children:[e.jsx("div",{className:"col-span-1 text-center pt-3 text-sm font-medium text-gray-500",children:t.sl_no}),e.jsxs("div",{className:"col-span-4 space-y-2",children:[e.jsxs(H,{value:t.particulars,onValueChange:i=>R(a,"particulars",i),children:[e.jsx(K,{children:e.jsx(Z,{placeholder:"Select Service"})}),e.jsx(X,{children:Re.map(i=>e.jsx(E,{value:i,children:i},i))})]}),e.jsx(v,{placeholder:"Description (Optional)",value:t.description,onChange:i=>R(a,"description",i.target.value),className:"text-xs h-8"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(v,{type:"number",placeholder:"Qty",value:t.quantity,onChange:i=>R(a,"quantity",parseFloat(i.target.value)||0)})}),e.jsx("div",{className:"col-span-2",children:e.jsx(v,{type:"number",placeholder:"Rate",value:t.rate,onChange:i=>R(a,"rate",parseFloat(i.target.value)||0)})}),e.jsx("div",{className:"col-span-2 text-right pt-2 font-bold font-mono",children:t.amount.toFixed(2)}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>ce(a),disabled:m.length===1,className:"text-destructive hover:text-red-600",children:e.jsx(ie,{className:"h-4 w-4"})})})]},a)),e.jsxs(h,{variant:"outline",size:"sm",onClick:re,className:"w-full border-dashed",children:[e.jsx(he,{className:"h-4 w-4 mr-2"})," Add Item"]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(B,{children:[e.jsx(q,{children:e.jsx(O,{children:"Summary"})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Sub Total"}),e.jsx("span",{className:"font-bold",children:j.toFixed(2)})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx(b,{className:"text-gray-600 font-normal",children:"Additions (Previous Balance)"}),e.jsx(v,{type:"number",placeholder:"0.00",value:g||"",onChange:t=>W(parseFloat(t.target.value)||0),className:"w-32 text-right h-8"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs(b,{className:"text-gray-600 font-normal",children:["Deductions (Advance Received)",r==="ONBOARDED"&&d&&e.jsxs("div",{className:"text-xs text-green-600 font-medium mt-1",children:["Available: ","₹",(y==null?void 0:y.toFixed(2))||"0.00",y>0&&e.jsx("button",{onClick:()=>c(Math.min(y,j+g)),className:"ml-2 underline text-blue-600 cursor-pointer hover:text-blue-800",children:"Apply Max"})]})]}),e.jsx(v,{type:"number",placeholder:"0.00",value:n||"",onChange:t=>{const a=parseFloat(t.target.value)||0;y>0&&a>y?(alert(`Cannot deduct more than available advance (${y})`),c(y)):c(a)},className:"w-32 text-right h-8"})]})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold border-t pt-4 text-purple-900",children:[e.jsx("span",{children:"Net Payable"}),e.jsx("span",{children:M.toFixed(2)})]}),e.jsxs(h,{className:"w-full",size:"lg",onClick:oe,disabled:V.isPending,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),V.isPending?"Generating...":"Save & Generate Invoice"]})]})]})})]})},Fe=()=>{const T=ne(),[r,_]=l.useState(null),[d,x]=l.useState(null),p=l.useRef(null),{data:D=[],isLoading:N}=le({queryKey:["invoices"],queryFn:async()=>{const{data:s}=await I.get("/billing/invoices");return s}}),A=Y({mutationFn:async({id:s,status:n})=>await I.patch(`/billing/invoices/${s}/status`,{status:n}),onSuccess:()=>{alert("Invoice Updated Successfully"),T.invalidateQueries({queryKey:["invoices"]})}}),S=Y({mutationFn:async s=>await I.delete(`/billing/invoices/${s}`),onSuccess:()=>{alert("Invoice Deleted Successfully"),T.invalidateQueries({queryKey:["invoices"]})},onError:s=>{var c,o;const n=((o=(c=s==null?void 0:s.response)==null?void 0:c.data)==null?void 0:o.error)||"Failed to delete invoice.";alert(`Error: ${n}`)}}),z=s=>{window.confirm(`Are you sure you want to delete invoice ${s.invoice_number}? This action cannot be undone.`)&&S.mutate(s.id)},m=()=>{if(p.current){const s=window.open("","","height=800,width=1000");if(s){s.document.write("<html><head><title>Print Invoice</title>"),Array.from(document.styleSheets).forEach(o=>{try{if(o.href)s.document.write(`<link rel="stylesheet" type="text/css" href="${o.href}">`);else if(o.cssRules){const P=Array.from(o.cssRules).map(M=>M.cssText).join("");s.document.write(`<style>${P}</style>`)}}catch(P){console.warn("Could not copy stylesheet",P)}});const c=document.getElementsByTagName("style");for(let o=0;o<c.length;o++)s.document.write(c[o].outerHTML);s.document.write('<script src="https://cdn.tailwindcss.com"><\/script>'),s.document.write('</head><body class="bg-white">'),s.document.write(p.current.innerHTML),s.document.write("</body></html>"),s.document.close(),s.focus(),setTimeout(()=>{s.print()},1e3)}}},w=async s=>{const n=s||r;if(n){if(!r||r.id!==n.id){_(n),setTimeout(()=>j(n),600);return}j(n)}},j=async s=>{if(p.current){document.body.classList.add("pdf-mode");const n=await _e(p.current,{scale:2,useCORS:!0,logging:!1,width:794,height:1123,windowWidth:794});document.body.classList.remove("pdf-mode");const c=n.toDataURL("image/png"),o=new Ae({orientation:"portrait",unit:"mm",format:"a4"});o.addImage(c,"PNG",0,0,210,297),o.save(`Invoice_${s.invoice_number}.pdf`)}},k=s=>{const n=`Dear Customer,

Please find your Invoice ${s.invoice_number} for Amount ${F(s.net_payable)}.

Thank you for your business!`;window.open(`https://wa.me/?text=${encodeURIComponent(n)}`,"_blank"),x(null)},g=s=>{const n=`Dear Customer,

Please find your Invoice ${s.invoice_number} for Amount ${F(s.net_payable)}.

Thank you for your business!`;window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(n)}`,"_blank"),x(null)},W=s=>{const n=`Invoice ${s.invoice_number} from Qix Ads`,c=`Dear Customer,

Please find your Invoice ${s.invoice_number} for Amount ${F(s.net_payable)}.

Due Date: ${L(new Date(s.due_date||s.invoice_date),"dd MMM yyyy")}

Thank you for your business!

Regards,
Qix Ads Team`;window.location.href=`mailto:?subject=${encodeURIComponent(n)}&body=${encodeURIComponent(c)}`,x(null)},G=s=>{x(null),w(s)};return e.jsxs(B,{children:[e.jsx(q,{children:e.jsx(O,{children:"Generated Invoices"})}),e.jsx($,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(De,{children:[e.jsx(Se,{children:e.jsxs(J,{children:[e.jsx(C,{children:"Invoice #"}),e.jsx(C,{children:"Client"}),e.jsx(C,{children:"Date"}),e.jsx(C,{children:"Status"}),e.jsx(C,{className:"text-right",children:"Amount"}),e.jsx(C,{className:"text-right",children:"Actions"})]})}),e.jsx(Ie,{children:D.length===0?e.jsx(J,{children:e.jsx(f,{colSpan:6,className:"text-center py-8",children:"No invoices generated yet."})}):D.map(s=>e.jsxs(J,{children:[e.jsx(f,{className:"font-mono font-medium",children:s.invoice_number}),e.jsx(f,{children:s.client_name}),e.jsx(f,{children:L(new Date(s.invoice_date),"dd MMM yyyy")}),e.jsx(f,{children:e.jsx(Ce,{variant:"outline",className:s.status==="PAID"||s.status==="SUBMITTED"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",children:s.status})}),e.jsx(f,{className:"text-right font-bold",children:F(s.net_payable)}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1 items-center",children:[s.status==="DRAFT"&&e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>A.mutate({id:s.id,status:"SUBMITTED"}),className:"text-blue-600 border-blue-200 hover:bg-blue-50 hover:text-blue-700 h-8 px-2",children:[e.jsx(ke,{className:"h-3.5 w-3.5 mr-1"})," Submit"]}),e.jsxs(xe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>_(s),children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsx(ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-end gap-2 border-b pb-4",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:m,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"})," Print"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>j(r),children:[e.jsx(ge,{className:"h-4 w-4 mr-2"})," Download PDF"]}),r.status==="DRAFT"&&e.jsxs(h,{size:"sm",onClick:()=>A.mutate({id:r.id,status:"SUBMITTED"}),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"})," Submit & Lock"]})]}),e.jsx("div",{className:"border p-1 bg-gray-50 flex justify-center",children:e.jsx("div",{className:"scale-90 origin-top",children:e.jsx(Te,{ref:p,data:r})})})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>x((d==null?void 0:d.id)===s.id?null:s),title:"Share Invoice",children:e.jsx(be,{className:"h-4 w-4"})}),(d==null?void 0:d.id)===s.id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>x(null)}),e.jsxs("div",{className:"absolute right-0 mt-1 w-52 rounded-lg border bg-white shadow-lg z-50 py-1 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Share Invoice"}),e.jsx("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(fe,{className:"h-3.5 w-3.5"})})]}),e.jsxs("button",{className:"flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-green-50 hover:text-green-700 transition-colors",onClick:()=>k(s),children:[e.jsx("span",{className:"flex items-center justify-center w-7 h-7 rounded-full bg-green-100 text-green-600 text-xs font-bold flex-shrink-0",children:"WA"}),e.jsx("span",{children:"WhatsApp"})]}),e.jsxs("button",{className:"flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-teal-50 hover:text-teal-700 transition-colors",onClick:()=>g(s),children:[e.jsx("span",{className:"flex items-center justify-center w-7 h-7 rounded-full bg-teal-100 text-teal-600 text-xs font-bold flex-shrink-0",children:"WB"}),e.jsx("span",{children:"WhatsApp Business"})]}),e.jsxs("button",{className:"flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 transition-colors",onClick:()=>W(s),children:[e.jsx("span",{className:"flex items-center justify-center w-7 h-7 rounded-full bg-blue-100 text-blue-600 flex-shrink-0",children:e.jsx(Ne,{className:"h-3.5 w-3.5"})}),e.jsx("span",{children:"Email"})]}),e.jsxs("button",{className:"flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-red-50 hover:text-red-700 transition-colors",onClick:()=>G(s),children:[e.jsx("span",{className:"flex items-center justify-center w-7 h-7 rounded-full bg-red-100 text-red-600 flex-shrink-0",children:e.jsx(Me,{className:"h-3.5 w-3.5"})}),e.jsx("span",{children:"Download as PDF"})]})]})]})]}),s.status==="DRAFT"&&e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>z(s),disabled:S.isPending,className:"text-red-500 hover:text-red-700 hover:bg-red-50",title:"Delete Invoice",children:e.jsx(ie,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]})},ss=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Client Invoices"}),e.jsx("p",{className:"text-muted-foreground",children:"Generate and manage client invoices."})]}),e.jsxs(ue,{defaultValue:"generate",className:"space-y-4",children:[e.jsxs(me,{className:"bg-transparent gap-2 p-0",children:[e.jsx(te,{value:"generate",className:"data-[state=active]:bg-purple-900 data-[state=active]:text-yellow-400 data-[state=inactive]:bg-yellow-400 data-[state=inactive]:text-purple-900 px-6 py-2 rounded-md font-bold transition-all shadow-sm border-2 border-transparent data-[state=active]:border-yellow-400",children:"Generate New Invoice"}),e.jsx(te,{value:"process",className:"data-[state=active]:bg-purple-900 data-[state=active]:text-yellow-400 data-[state=inactive]:bg-yellow-400 data-[state=inactive]:text-purple-900 px-6 py-2 rounded-md font-bold transition-all shadow-sm border-2 border-transparent data-[state=active]:border-yellow-400",children:"Invoice Process"})]}),e.jsx(ae,{value:"generate",className:"space-y-4",children:e.jsx(Ee,{})}),e.jsx(ae,{value:"process",className:"space-y-4",children:e.jsx(Fe,{})})]})]});export{ss as default};
