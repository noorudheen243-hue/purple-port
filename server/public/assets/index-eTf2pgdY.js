import{v as F,r,x as N,j as e,E as se,D as z,q as ge,u as de,N as je}from"./index-DTs_gUpQ.js";import{C as k,a as C,b as S,d as A,c as B}from"./card-CkON84C3.js";import{aK as fe,B as v,n as H,a4 as me,S as n,u as ye,j as be,q as we,I as O,K as Ne,D as ve,a as ke,e as Ce,f as Se,az as Be,l as Re,R as q,ah as _,aL as Pe,aM as ae,U as Le,o as Me}from"./index-BPHe9uWR.js";import{L as G}from"./label-CYspnl4A.js";import{T as te,a as re,b as L,c as M}from"./tabs-B5Xndk5l.js";import Ae from"./SystemRoleManagement-bAWC7VK0.js";import De from"./PayrollSettings-12CzFmOQ.js";import Te from"./DataSync-CCywIvXV.js";import{S as ze}from"./server-Bao7YC6P.js";import{C as le}from"./clock-C1wc1VsE.js";import{R as ne}from"./rotate-ccw-60gywZiV.js";import{G as Fe}from"./globe-kndGuocV.js";import{A as Ie}from"./arrow-down-circle-DCzZBLUV.js";import{L as oe}from"./loader-2-DDF5548V.js";import{A as ce}from"./alert-circle-BoEunZjV.js";import"./index-osOQW184.js";import"./index-Bs76HOJd.js";import"./table-D4yQmoYa.js";import"./save-dY_yXBe1.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=F("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=F("DownloadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m8 17 4 4 4-4",key:"1ul180"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=F("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=F("HardDriveDownload",[["path",{d:"M12 2v8",key:"1q4o3n"}],["path",{d:"m16 6-4 4-4-4",key:"6wukr"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",key:"w68u3i"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 18h.01",key:"h775k"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=F("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=F("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=F("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),w=typeof window<"u"&&!["localhost","127.0.0.1"].includes(window.location.hostname),ie=w?(window.location.protocol==="https:","http://localhost:4001"):"https://qixport.com",Ue=()=>{const[t,I]=r.useState([]),[i,f]=r.useState(!1),[y,R]=r.useState(!1),[D,b]=r.useState(!1),[d,u]=r.useState(""),[o,h]=r.useState(!1),[E,m]=r.useState(!1),[c,g]=r.useState(null),[p,a]=r.useState(""),[P,T]=r.useState([]),[$,W]=r.useState(!1),[J,X]=r.useState(null),K=r.useCallback(async()=>{var s;f(!0);try{const l=await N.get("/backup/list-local");I(l.data.backups||[]),a(l.data.backupDir||""),((s=l.data.backups)==null?void 0:s.length)>0&&(g(l.data.backups[0]),d||u(l.data.backups[0].filename))}catch(l){console.error("Failed to list backups:",l)}finally{f(!1)}},[]),ee=r.useCallback(async()=>{try{const s=await N.get("/backup/auto-backup-setting");h(s.data.enabled)}catch{}},[]),Y=r.useCallback(async()=>{W(!0);try{const s=await N.get(`${ie}/api/backup/list-local`,{withCredentials:!0});T(s.data.backups||[])}catch(s){console.warn("Failed to fetch remote backups (unauthorized or network)",s)}finally{W(!1)}},[]);r.useEffect(()=>{K(),Y(),w&&ee()},[K,Y,ee]);const xe=async()=>{var l,j;if((await n.fire({title:"Create Backup?",html:`This will save a full backup of<br><b>all data, files & settings</b> to:<br><code style="font-size:12px;background:#f3f4f6;padding:3px 8px;border-radius:4px;">${p||"backup folder"}</code>`,icon:"question",showCancelButton:!0,confirmButtonColor:"#7c3aed",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, Backup Now",cancelButtonText:"Cancel"})).isConfirmed){R(!0);try{const x=await N.post("/backup/save-to-disk");await K(),n.fire({icon:"success",title:"Backup Saved!",html:`<b>${x.data.filename}</b><br>Size: ${x.data.sizeKB} KB`,confirmButtonColor:"#7c3aed",timer:4e3,timerProgressBar:!0})}catch(x){n.fire({icon:"error",title:"Backup Failed",text:((j=(l=x.response)==null?void 0:l.data)==null?void 0:j.message)||x.message||"Unknown error",confirmButtonColor:"#7c3aed"})}finally{R(!1)}}},he=async()=>{var l,j;if(!d){n.fire({icon:"warning",title:"No Backup Selected",text:"Please select a backup file to restore.",confirmButtonColor:"#7c3aed"});return}if((await n.fire({title:"‚ö†Ô∏è Confirm Restore",html:`<p>This will <b>permanently replace ALL current data</b> with:</p>
                   <code style="font-size:12px;background:#fef2f2;color:#991b1b;padding:4px 10px;border-radius:4px;display:block;margin:8px 0;">${d}</code>
                   <p style="color:#6b7280;font-size:13px;">This action cannot be undone.</p>`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"üîÑ Yes, Restore Now",cancelButtonText:"Cancel"})).isConfirmed){b(!0);try{await N.post("/backup/restore-from-disk",{filename:d},{timeout:18e5}),n.fire({icon:"success",title:"Restore Complete!",text:"The application has been restored. Page will reload now.",confirmButtonColor:"#7c3aed",timer:3e3,timerProgressBar:!0}).then(()=>window.location.reload())}catch(x){n.fire({icon:"error",title:"Restore Failed",text:((j=(l=x.response)==null?void 0:l.data)==null?void 0:j.message)||x.message||"Unknown error",confirmButtonColor:"#7c3aed"})}finally{b(!1)}}},ue=async()=>{var l,j;const s=!o;m(!0);try{await N.post("/backup/auto-backup-setting",{enabled:s}),h(s)}catch(x){n.fire({icon:"error",title:"Failed to toggle auto-backup",text:((j=(l=x.response)==null?void 0:l.data)==null?void 0:j.message)||x.message,confirmButtonColor:"#7c3aed"})}finally{m(!1)}},pe=async s=>{var j,x;if((await n.fire({title:"Pull Remote Backup?",text:`This will download "${s}" from the remote server to this environment and then let you restore it.`,icon:"question",showCancelButton:!0,confirmButtonColor:"#7c3aed",confirmButtonText:"Yes, Pull it"})).isConfirmed){X(s);try{const Z=localStorage.getItem("token");await N.post("/backup/download-from-remote",{remoteUrl:ie,filename:s,token:Z}),await K(),u(s),n.fire({icon:"success",title:"Pulled Successfully!",text:"The backup is now available in your local history. You can restore it now.",confirmButtonColor:"#7c3aed"})}catch(Z){n.fire({icon:"error",title:"Pull Failed",text:((x=(j=Z.response)==null?void 0:j.data)==null?void 0:x.message)||"Maybe you are not logged in on the remote server?",confirmButtonColor:"#7c3aed"})}finally{X(null)}}},U=s=>{try{return new Date(s).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return s}};return e.jsxs("div",{className:"space-y-6 max-w-4xl",children:[e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 rounded-xl border text-sm font-medium ${w?"bg-violet-50 border-violet-200 text-violet-800":"bg-emerald-50 border-emerald-200 text-emerald-800"}`,children:[w?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:w?"üì° Online Server (www.qixport.com)":"üíª Local Development (localhost)"}),e.jsxs("span",{className:"ml-auto text-xs opacity-70",children:["Backup folder: ",e.jsx("code",{className:"bg-white/70 px-1 rounded",children:p||"..."})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(k,{className:"border-violet-100 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(C,{className:"pb-3",children:[e.jsxs(S,{className:"flex items-center gap-2 text-violet-700",children:[e.jsx("div",{className:"p-2 bg-violet-100 rounded-lg",children:e.jsx(V,{className:"h-5 w-5 text-violet-600"})}),"Backup"]}),e.jsx(A,{children:"Save a complete snapshot of all data, uploads and settings to the backup folder."})]}),e.jsxs(B,{className:"space-y-4",children:[c&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-violet-50 rounded-lg text-xs text-violet-700",children:[e.jsx(le,{className:"h-4 w-4 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Last backup"}),e.jsx("p",{className:"opacity-80",children:U(c.createdAt)}),e.jsxs("p",{className:"opacity-70",children:[c.filename," ¬∑ ",c.sizeKB," KB"]})]})]}),!c&&!i&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg text-xs text-gray-500",children:[e.jsx(se,{className:"h-4 w-4"}),"No backups found yet. Create your first backup below."]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(qe,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"truncate",children:p||"Loading..."})]}),e.jsx(v,{onClick:xe,disabled:y,className:"w-full bg-violet-600 hover:bg-violet-700 text-white",children:y?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"})," Backing up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2"})," Backup Now"]})})]})]}),e.jsxs(k,{className:"border-red-100 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(C,{className:"pb-3",children:[e.jsxs(S,{className:"flex items-center gap-2 text-red-700",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(ne,{className:"h-5 w-5 text-red-600"})}),"Restore"]}),e.jsx(A,{children:"Roll back the entire application to a previous backup."})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-100 rounded-lg text-xs text-red-700",children:[e.jsx(H,{className:"h-4 w-4 shrink-0 mt-0.5"}),e.jsxs("p",{children:[e.jsx("b",{children:"Warning:"})," Restoring will permanently overwrite all current data with the selected backup. This cannot be undone."]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Select backup to restore:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:d,onChange:s=>u(s.target.value),className:"flex-1 text-sm border border-gray-200 rounded-lg px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-red-300",children:[t.length===0&&e.jsx("option",{value:"",children:"No backups available"}),t.map(s=>e.jsxs("option",{value:s.filename,children:[U(s.createdAt)," ¬∑ ",s.sizeKB," KB"]},s.filename))]}),e.jsx(v,{variant:"outline",size:"icon",onClick:K,disabled:i,className:"shrink-0",title:"Refresh list",children:e.jsx(z,{className:`h-4 w-4 ${i?"animate-spin":""}`})})]})]}),e.jsx(v,{onClick:he,disabled:D||!d||t.length===0,variant:"destructive",className:"w-full",children:D?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"})," Restoring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2"})," Restore Selected Backup"]})})]})]})]}),w&&e.jsxs(k,{className:"border-blue-100 shadow-sm",children:[e.jsxs(C,{className:"pb-3",children:[e.jsxs(S,{className:"flex items-center gap-2 text-blue-700",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ee,{className:"h-5 w-5 text-blue-600"})}),"Daily Auto-Backup",e.jsx("span",{className:`ml-auto text-xs px-2 py-0.5 rounded-full font-semibold ${o?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:o?"Active":"Inactive"})]}),e.jsx(A,{children:"Automatically saves a backup every day at midnight (IST) to the server's backup folder. Old backups are pruned after 30 are stored."})]}),e.jsx(B,{children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-800",children:"Schedule: Every day at 12:00 AM IST"}),e.jsxs("p",{className:"text-xs text-blue-600",children:["Saves to: ",e.jsxs("code",{className:"bg-white/80 px-1 rounded",children:[p,"/auto-backup-*.zip"]})]}),e.jsx("p",{className:"text-xs text-blue-500",children:"Retains last 30 backups automatically"})]}),e.jsx("button",{onClick:ue,disabled:E,className:"flex items-center gap-2 text-sm font-medium focus:outline-none",title:o?"Click to disable":"Click to enable",children:E?e.jsx(z,{className:"h-6 w-6 animate-spin text-blue-400"}):o?e.jsx($e,{className:"h-10 w-10 text-green-500"}):e.jsx(Oe,{className:"h-10 w-10 text-gray-400"})})]})})]}),e.jsxs(k,{className:"border-orange-100 shadow-sm transition-all hover:shadow-md",children:[e.jsxs(C,{className:"pb-3 text-orange-900 bg-orange-50/10 rounded-t-xl",children:[e.jsxs(S,{className:"flex items-center gap-2 text-orange-700",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg shadow-sm",children:e.jsx(Fe,{className:"h-5 w-5 text-orange-600"})}),w?"üíª Backups on Localhost":"üì° Backups on Online Server"]}),e.jsx(A,{className:"text-orange-600/80",children:w?"Access and pull backups stored on your local machine (F:\\Antigravity\\Backup).":"Access and pull backups stored on the production VPS (/var/backups/antigravity)."})]}),e.jsx(B,{className:"space-y-4 pt-4",children:$?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(z,{className:"h-6 w-6 animate-spin text-orange-400"})}):P.length>0?e.jsxs("div",{className:"grid gap-2",children:[P.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50/30 border border-orange-100 rounded-lg text-xs group hover:bg-orange-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-orange-800",children:s.filename}),e.jsxs("p",{className:"text-orange-600 opacity-70",children:[U(s.createdAt)," ¬∑ ",s.sizeKB," KB"]})]})]}),e.jsxs(v,{size:"sm",variant:"outline",className:"h-8 border-orange-200 text-orange-700 hover:bg-orange-600 hover:text-white transition-all shadow-sm",onClick:()=>pe(s.filename),disabled:J===s.filename,children:[J===s.filename?e.jsx(z,{className:"h-3 w-3 animate-spin mr-1"}):e.jsx(Ie,{className:"h-3 w-3 mr-1"}),"Pull to ",w?"VPS":"Local"]})]},s.filename)),P.length>5&&e.jsx("p",{className:"text-[10px] text-center text-orange-400 italic",children:"Showing latest 5 remote backups"})]}):e.jsxs("div",{className:"p-6 text-center bg-gray-50/50 rounded-xl border border-dashed border-gray-200",children:[e.jsx(se,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"No remote backups visible"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Make sure the ",w?"Local Server":"Online Server"," is running and you are logged in there too."]}),e.jsxs(v,{variant:"ghost",size:"sm",className:"mt-3 text-orange-600 h-8 hover:bg-orange-50",onClick:Y,children:[e.jsx(z,{className:"h-3 w-3 mr-1"})," Retry Connection"]})]})})]}),t.length>0&&e.jsxs(k,{className:"border-gray-100 shadow-sm",children:[e.jsx(C,{className:"pb-2",children:e.jsxs(S,{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Backup History (",t.length," files)"]})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:t.map((s,l)=>e.jsxs("div",{onClick:()=>u(s.filename),className:`flex items-center justify-between p-3 rounded-lg border text-xs cursor-pointer transition-colors
                                        ${d===s.filename?"bg-violet-50 border-violet-300":"bg-gray-50 border-gray-100 hover:bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d===s.filename&&e.jsx(me,{className:"h-3.5 w-3.5 text-violet-500 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:s.filename}),e.jsx("p",{className:"text-gray-400",children:U(s.createdAt)})]})]}),e.jsxs("div",{className:"text-right shrink-0 ml-2",children:[e.jsxs("p",{className:"text-gray-500",children:[s.sizeKB," KB"]}),l===0&&e.jsx("span",{className:"text-violet-500 font-semibold",children:"Latest"})]})]},s.filename))})})]})]})},_e=()=>{var p;ge();const[t,I]=r.useState(""),[i,f]=r.useState(null),[y,R]=r.useState(""),[D,b]=r.useState(!1),[d,u]=r.useState(!1),{data:o,isLoading:h}=ye({queryKey:["staff"],queryFn:async()=>(await N.get("/team/staff")).data}),E=be({mutationFn:async({userId:a,password:P})=>{await N.patch(`/users/reset-password/${a}`,{newPassword:P})},onSuccess:(a,P)=>{var T;b(!1),R(""),f(null),alert(`Password reset successfully for ${(T=i==null?void 0:i.user)==null?void 0:T.full_name}`)},onError:a=>{var T,$;const P=(($=(T=a.response)==null?void 0:T.data)==null?void 0:$.message)||a.message;alert("Failed to reset password: "+P)}}),m=async()=>{if(!y||y.length<6){alert("Password must be at least 6 characters");return}u(!0);try{await E.mutateAsync({userId:i.user.id,password:y})}finally{u(!1)}},{user:c}=de();if(h)return e.jsxs("div",{className:"p-8 text-center flex flex-col items-center gap-2",children:[e.jsx(oe,{className:"animate-spin text-primary"}),e.jsx("span",{children:"Loading staff list..."})]});if(!c||c.role!=="ADMIN"&&c.role!=="DEVELOPER_ADMIN")return e.jsx(je,{to:"/dashboard",replace:!0});const g=o==null?void 0:o.filter(a=>a.user.full_name.toLowerCase().includes(t.toLowerCase())||a.user.email.toLowerCase().includes(t.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Team Credential Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Securely reset passwords for your team members."})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:18}),e.jsx(O,{placeholder:"Search team...",className:"pl-10",value:t,onChange:a=>I(a.target.value)})]})]}),e.jsx("div",{className:"bg-card border rounded-lg overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50/50 text-gray-500 font-medium border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Employee"}),e.jsx("th",{className:"px-6 py-4",children:"Email"}),e.jsx("th",{className:"px-6 py-4",children:"Role"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y",children:g==null?void 0:g.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50/30",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs overflow-hidden",children:a.user.avatar_url?e.jsx("img",{src:Ne(a.user.avatar_url),alt:"Avatar",className:"w-full h-full object-cover"}):a.user.full_name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.user.full_name}),e.jsx("div",{className:"text-[10px] text-gray-500",children:a.department})]})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:a.user.email}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:a.user.role}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs(v,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>{f(a),b(!0)},children:[e.jsx(Q,{size:14}),"Reset Password"]})})]},a.id))})]})})}),e.jsx(ve,{open:D,onOpenChange:b,children:e.jsxs(ke,{className:"sm:max-w-[425px]",children:[e.jsxs(Ce,{children:[e.jsx(Se,{children:"Reset Password"}),e.jsxs(Be,{children:["Enter a new password for ",e.jsx("strong",{children:(p=i==null?void 0:i.user)==null?void 0:p.full_name}),"."]})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"New Password"}),e.jsx(O,{type:"password",placeholder:"Enter at least 6 characters",value:y,onChange:a=>R(a.target.value)})]})}),e.jsxs(Re,{children:[e.jsx(v,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(v,{onClick:m,disabled:d,children:[d?e.jsx(oe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Update Password"]})]})]})})]})},ds=()=>{const{user:t}=de(),[I,i]=r.useState(""),[f,y]=r.useState(""),[R,D]=r.useState(""),[b,d]=r.useState(!1),[u,o]=r.useState(null),h=(t==null?void 0:t.role)===q.DEVELOPER_ADMIN,E=async m=>{var c,g;if(m.preventDefault(),o(null),f!==R){o({type:"error",text:"New passwords don't match"});return}if(f.length<6){o({type:"error",text:"Password must be at least 6 characters"});return}try{d(!0),await N.post("/auth/change-password",{currentPassword:I,newPassword:f}),o({type:"success",text:"Password changed successfully!"}),i(""),y(""),D("")}catch(p){o({type:"error",text:((g=(c=p.response)==null?void 0:c.data)==null?void 0:g.message)||"Failed to change password"})}finally{d(!1)}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account and system preferences."})]}),e.jsxs(te,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(re,{className:"bg-muted p-1 rounded-lg",children:[e.jsxs(L,{value:"profile",className:"flex items-center gap-2",children:[e.jsx(_,{size:16})," My Security"]}),h&&e.jsxs(L,{value:"system",className:"flex items-center gap-2",children:[e.jsx(H,{size:16})," System Control"]}),(h||(t==null?void 0:t.role)===q.ADMIN)&&e.jsxs(L,{value:"maintenance",className:"flex items-center gap-2",children:[e.jsx(Pe,{size:16})," Maintenance"]}),h&&e.jsxs(L,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(V,{size:16})," Backup & Restore"]}),(h||(t==null?void 0:t.role)===q.ADMIN)&&e.jsxs(L,{value:"credentials",className:"flex items-center gap-2",children:[e.jsx(Q,{size:16})," Team Credential Management"]})]}),e.jsx(M,{value:"profile",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:e.jsxs(k,{children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-purple-600"}),"Change Password"]}),e.jsx(A,{children:"Update your password to keep your account secure."})]}),e.jsx(B,{children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[u&&e.jsxs("div",{className:`p-3 rounded-md text-sm flex items-center gap-2 ${u.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[u.type==="success"?e.jsx(me,{className:"h-4 w-4"}):e.jsx(ce,{className:"h-4 w-4"}),u.text]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"current",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(O,{id:"current",type:"password",className:"pl-9",value:I,onChange:m=>i(m.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"new",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(O,{id:"new",type:"password",className:"pl-9",value:f,onChange:m=>y(m.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"confirm",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(O,{id:"confirm",type:"password",className:"pl-9",value:R,onChange:m=>D(m.target.value),required:!0})]})]}),e.jsx(v,{type:"submit",disabled:b,className:"w-full",children:b?"Updating...":"Change Password"})]})})]})})}),(h||(t==null?void 0:t.role)===q.ADMIN)&&e.jsx(M,{value:"maintenance",children:e.jsxs(k,{children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2 text-orange-700",children:[e.jsx(ce,{className:"h-5 w-5"}),"System Maintenance"]}),e.jsx(A,{children:"Perform critical system operations to ensure application health."})]}),e.jsx(B,{className:"space-y-6",children:e.jsxs("div",{className:"p-4 border border-orange-200 bg-orange-50 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[e.jsx(ae,{size:18}),"Clear Application Cache"]}),e.jsx("p",{className:"text-sm text-orange-700 mb-4",children:"Use this if you are experiencing synchronization issues, missing features after an update, or display errors. This will force a reload of the application and clear local data."}),e.jsx(v,{variant:"destructive",onClick:()=>{n.fire({title:"Clear System Cache?",text:"This will clear local storage, session data, and force a hard reload. You may be logged out.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, Clear & Reload"}).then(m=>{if(m.isConfirmed){const c=localStorage.getItem("theme");localStorage.clear(),c&&localStorage.setItem("theme",c),sessionStorage.clear();let g;n.fire({title:"Clearing Cache...",html:"Reloading system in <b></b> milliseconds.",timer:1500,timerProgressBar:!0,didOpen:()=>{var a;n.showLoading();const p=(a=n.getHtmlContainer())==null?void 0:a.querySelector("b");g=setInterval(()=>{p&&(p.textContent=String(n.getTimerLeft()))},100)},willClose:()=>{clearInterval(g)}}).then(()=>{window.location.reload()})}})},children:"Clear Cache & Reload"})]})})]})}),h&&e.jsx(M,{value:"backup",children:e.jsxs(k,{children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-violet-600"}),"Backup & Restore"]}),e.jsx(A,{children:"Save a complete backup of all application data, uploads, and settings to disk. Restore any previous backup with one click."})]}),e.jsx(B,{children:e.jsx(Ue,{})})]})}),(h||(t==null?void 0:t.role)===q.ADMIN)&&e.jsx(M,{value:"credentials",children:e.jsxs(k,{children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-indigo-600"}),"Credential Management"]}),e.jsx(A,{children:"Reset passwords and manage login access for team members."})]}),e.jsx(B,{children:e.jsx(_e,{})})]})}),h&&e.jsxs(M,{value:"system",className:"space-y-6",children:[e.jsxs("div",{className:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 mb-6 flex gap-3 text-yellow-800 text-sm",children:[e.jsx(H,{className:"h-5 w-5 shrink-0"}),e.jsxs("p",{children:[e.jsx("strong",{children:"System Control Zone:"})," Changes made here affect the entire system structure. Use with caution."]})]}),e.jsxs(te,{defaultValue:"roles",className:"w-full",children:[e.jsxs(re,{className:"w-full justify-start border-b rounded-none bg-transparent p-0 mb-6 h-auto",children:[e.jsxs(L,{value:"roles",className:"data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none border-b-2 border-transparent rounded-none pb-2 px-4 font-medium",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Role Management"]}),e.jsxs(L,{value:"payroll",className:"data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none border-b-2 border-transparent rounded-none pb-2 px-4 font-medium",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Payroll Config"]}),e.jsxs(L,{value:"sync",className:"data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none border-b-2 border-transparent rounded-none pb-2 px-4 font-medium",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Data Sync"]})]}),e.jsx(M,{value:"roles",className:"mt-0",children:e.jsx(Ae,{})}),e.jsx(M,{value:"payroll",className:"mt-0",children:e.jsx(De,{})}),e.jsx(M,{value:"sync",className:"mt-0",children:e.jsx(Te,{})})]})]})]})]})};export{ds as default};
