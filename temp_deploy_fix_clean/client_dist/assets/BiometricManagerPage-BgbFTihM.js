import{v as ie,r as c,j as e,x as n,q as ne,C as le,D as H}from"./index-_K9dBzXA.js";import{X as ce,B as g,P as se,l as B,D as de,a as oe,d as me,e as xe,I as Q,j as K,k as he,S as M,u as R,i as $,U as ue,m as ge,a0 as ee}from"./index-C0_MxDCy.js";import{C as te}from"./clock-89fNMNOB.js";import{L as G}from"./label-Cxi2tPpM.js";import{C as P}from"./card-BJXC2BmV.js";import{A as fe}from"./activity-BIVplPpj.js";import{S as pe}from"./save-BPR9f-BE.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=ie("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),ye=({isOpen:u,onClose:L})=>{const[m,O]=c.useState([]),[A,E]=c.useState(!1),[l,p]=c.useState({name:"",start_time:"09:00",end_time:"18:00",default_grace_time:15}),[x,S]=c.useState(""),[h,_]=c.useState(null),j=async()=>{try{E(!0);const a=await n.get("/attendance/shifts");O(a.data)}catch(a){console.error(a)}finally{E(!1)}};c.useEffect(()=>{u&&(j(),N())},[u]);const N=()=>{p({name:"",start_time:"09:00",end_time:"18:00",default_grace_time:15}),_(null),S("")},D=async()=>{var a,y;if(!l.name)return S("Name is required");try{S(""),h?await n.put(`/attendance/shifts/${h}`,l):await n.post("/attendance/shifts",l),N(),j()}catch(b){S(((y=(a=b.response)==null?void 0:a.data)==null?void 0:y.error)||"Failed to save preset")}},k=a=>{p({name:a.name,start_time:a.start_time,end_time:a.end_time,default_grace_time:a.default_grace_time||15}),_(a.id),S("")},C=async a=>{if(confirm("Are you sure? This will not remove the shift from staff currently assigned to it, but will remove it from the list."))try{await n.delete(`/attendance/shifts/${a}`),h===a&&N(),j()}catch(y){console.error(y)}},v=a=>{if(!a)return"";const[y,b]=a.split(":"),I=parseInt(y),t=I>=12?"PM":"AM";return`${I%12||12}:${b} ${t}`};return u?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50",children:[e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(te,{size:16})," Shift Presets"]}),e.jsx("button",{onClick:L,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ce,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:`p-3 rounded-md border text-sm space-y-3 ${h?"bg-blue-50 border-blue-200":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:`font-medium ${h?"text-blue-700":"text-gray-700"}`,children:h?"Edit Preset":"Add New Preset"}),h&&e.jsx("button",{onClick:N,className:"text-xs text-blue-600 hover:underline",children:"Cancel"})]}),e.jsx("input",{type:"text",placeholder:"Shift Name (e.g. Morning Shift)",className:"w-full p-2 border rounded",value:l.name,onChange:a=>p({...l,name:a.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"Start Time"}),e.jsx("input",{type:"time",className:"w-full p-2 border rounded",value:l.start_time,onChange:a=>p({...l,start_time:a.target.value})})]}),e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"End Time"}),e.jsx("input",{type:"time",className:"w-full p-2 border rounded",value:l.end_time,onChange:a=>p({...l,end_time:a.target.value})})]}),e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"Grace (Min)"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded",value:l.default_grace_time,onChange:a=>p({...l,default_grace_time:parseInt(a.target.value)||0})})]})]}),x&&e.jsx("p",{className:"text-red-500 text-xs",children:x}),e.jsx(g,{size:"sm",onClick:D,className:`w-full ${h?"bg-blue-600 hover:bg-blue-700":""}`,children:h?"Update Preset":e.jsxs(e.Fragment,{children:[e.jsx(se,{size:14,className:"mr-1"})," Add Preset"]})})]}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[A?e.jsx("p",{className:"text-center text-gray-400 text-sm",children:"Loading..."}):m.map(a=>e.jsxs("div",{className:`flex justify-between items-center p-2 border rounded hover:bg-gray-50 ${h===a.id?"border-blue-300 bg-blue-50":""}`,children:[e.jsxs("div",{className:"cursor-pointer flex-1",onClick:()=>k(a),children:[e.jsx("p",{className:"font-medium text-sm text-gray-800",children:a.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[v(a.start_time)," - ",v(a.end_time)," â€¢ Grace: ",a.default_grace_time,"m"]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>C(a.id),className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(B,{size:14})})})]},a.id)),!A&&m.length===0&&e.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"No presets defined."})]})]})]})}):null},Ne=({isOpen:u,onClose:L,staffId:m,staffName:O,onSuccess:A})=>{const[E,l]=c.useState([]),[p,x]=c.useState([]),[S,h]=c.useState(!1),[_,j]=c.useState(""),[N,D]=c.useState(""),[k,C]=c.useState(""),[v,a]=c.useState("");c.useEffect(()=>{u&&m&&y()},[u,m]);const y=async()=>{try{h(!0);const[t,w]=await Promise.all([n.get("/attendance/shifts"),n.get(`/attendance/shifts/assignments/${m}`)]);l(t.data),x(w.data)}catch(t){console.error("Failed to fetch data",t)}finally{h(!1)}},b=async()=>{var t,w;if(!_||!N){M.fire("Error","Please select a shift and start date.","error");return}try{await n.post("/attendance/shifts/assign",{staff_id:m,shift_id:_,from_date:N,to_date:k||null,grace_time:v?parseInt(v):void 0}),M.fire({icon:"success",title:"Assigned!",text:"Shift assigned successfully.",timer:1500,showConfirmButton:!1}),j(""),D(""),C(""),a(""),y(),A()}catch(F){M.fire("Error",((w=(t=F.response)==null?void 0:t.data)==null?void 0:w.error)||"Assignment failed","error")}},I=async t=>{if(window.confirm("Are you sure you want to remove this assignment?"))try{await n.delete(`/attendance/shifts/assignments/${t}`),y(),A()}catch{M.fire("Error","Failed to delete assignment","error")}};return e.jsx(de,{open:u,onOpenChange:L,children:e.jsxs(oe,{className:"sm:max-w-[700px]",children:[e.jsx(me,{children:e.jsxs(xe,{children:["Manage Shift Assignments: ",O]})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200 space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-sm text-slate-700 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"})," New Assignment"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Shift"}),e.jsxs("select",{className:"w-full flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:_,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"",children:"Select Shift..."}),E.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.start_time," - ",t.end_time,")"]},t.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Grace Time Override (Min)"}),e.jsx(Q,{type:"number",placeholder:"Default",value:v,onChange:t=>a(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"From Date"}),e.jsx(Q,{type:"date",value:N,onChange:t=>D(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"To Date (Optional)"}),e.jsx(Q,{type:"date",value:k,onChange:t=>C(t.target.value)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Leave empty for indefinite assignment"})]})]}),e.jsx(g,{className:"w-full",onClick:b,children:"Assign Shift"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-slate-700 mb-3",children:"Assignment History"}),e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-600 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Shift"}),e.jsx("th",{className:"px-4 py-2",children:"Period"}),e.jsx("th",{className:"px-4 py-2",children:"Grace"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-slate-500",children:"No assignments found."})}):p.map(t=>e.jsxs("tr",{className:t.is_active?"":"opacity-50 bg-slate-50",children:[e.jsxs("td",{className:"px-4 py-2 font-medium",children:[t.shift.name,e.jsxs("span",{className:"text-xs text-slate-400 block",children:[t.shift.start_time," - ",t.shift.end_time]})]}),e.jsxs("td",{className:"px-4 py-2",children:[K(new Date(t.from_date),"MMM d, yyyy")," -> ",t.to_date?K(new Date(t.to_date),"MMM d, yyyy"):"Indefinite"]}),e.jsx("td",{className:"px-4 py-2",children:t.grace_time?`${t.grace_time}m (Override)`:`${t.shift.default_grace_time}m (Default)`}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx(g,{variant:"ghost",size:"sm",className:"h-8 w-8 text-red-500",onClick:()=>I(t.id),children:e.jsx(B,{className:"w-4 h-4"})})})]},t.id))})]})})]})]}),e.jsx(he,{children:e.jsx(g,{variant:"outline",onClick:L,children:"Close"})})]})})},be=async()=>(await n.get("/attendance/biometric/status")).data,ve=async()=>(await n.get("/attendance/biometric/users")).data,we=async()=>(await n.post("/attendance/biometric/sync-time")).data,Se=async()=>(await n.post("/attendance/biometric/restart")).data,_e=async()=>(await n.post("/attendance/biometric/clear-logs")).data,Ce=async u=>(await n.post("/attendance/biometric/users/add",u)).data,De=async u=>(await n.post("/attendance/biometric/users/delete",{uid:u})).data,Me=async()=>(await n.post("/attendance/biometric/users/upload")).data,Ae=async()=>(await n.post("/attendance/biometric/users/import")).data,Ee=async()=>(await n.get("/attendance/biometric/audit")).data,$e=async()=>(await n.get("/team/staff")).data,Le=async()=>(await n.get("/attendance/shifts")).data,Re=()=>{var W;ne();const[u,L]=c.useState([]),[m,O]=c.useState("console"),[A,E]=c.useState(!1),[l,p]=c.useState({isOpen:!1,staffId:"",staffName:""}),{data:x,isLoading:S,refetch:h,isRefetching:_}=R({queryKey:["biometric-info"],queryFn:be,refetchInterval:3e4}),j=le.useMemo(()=>{if(!(x!=null&&x.device_info))return{};try{return JSON.parse(x.device_info)}catch(s){return console.error("Failed to parse device info",s),{}}},[x==null?void 0:x.device_info]),N=(x==null?void 0:x.status)==="ONLINE",{data:D,isLoading:k,refetch:C}=R({queryKey:["biometric-users"],queryFn:ve}),{data:v,isLoading:a,refetch:y}=R({queryKey:["staff-list-policies"],queryFn:$e,enabled:m==="policies"}),{data:b,refetch:I}=R({queryKey:["shifts-list"],queryFn:Le,enabled:m==="policies"||m==="shifts"}),{data:t,isLoading:w,refetch:F,isRefetching:q}=R({queryKey:["biometric-audit"],queryFn:Ee,enabled:!1,staleTime:1/0}),d=s=>L(r=>[`[${new Date().toLocaleTimeString()}] ${s}`,...r]),Y=$({mutationFn:Se,onSuccess:s=>d(`Success: ${s.message}`),onError:s=>{var r,i;return d(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}}),J=$({mutationFn:we,onSuccess:s=>d(`Success: ${s.message}`),onError:s=>{var r,i;return d(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}}),X=$({mutationFn:_e,onSuccess:s=>d(`Success: ${s.message}`),onError:s=>{var r,i;return d(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}});$({mutationFn:Ce,onSuccess:s=>{d(`Success: ${s.message}`),C()},onError:s=>{var r,i;return d(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}});const ae=$({mutationFn:De,onSuccess:s=>{d(`Success: ${s.message}`),C(),F()},onError:s=>{var r,i;return d(`Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}});$({mutationFn:Me,onSuccess:s=>{d(`Upload Success: ${s.message}`),C(),F()},onError:s=>{var r,i;return d(`Upload Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}}),$({mutationFn:Ae,onSuccess:s=>{d(`Import Success: ${s.message}`),C(),F()},onError:s=>{var r,i;return d(`Import Error: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`)}});const V=s=>{if(!s||!s.includes(":"))return s;const[r,i]=s.split(":"),T=parseInt(r),o=T>=12?"PM":"AM";return`${T%12||12}:${i} ${o}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Biometric Device Console"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage ESSL device connection and data"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1 mr-4",children:[{id:"console",label:"CONSOLE"},{id:"audit",label:"Audit"},{id:"shifts",label:"Create Shift"},{id:"policies",label:"Shift Management"}].map(s=>e.jsx("button",{onClick:()=>O(s.id),className:`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${m===s.id?"bg-white shadow text-gray-900":"text-gray-500 hover:text-gray-700"}`,children:s.label},s.id))}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${N?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:N?"ONLINE":"OFFLINE"}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>h(),disabled:S||_,children:e.jsx(H,{className:`w-4 h-4 ${S||_?"animate-spin":""}`})})]})]}),m==="console"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"Device Specs"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Name:"}),e.jsx("span",{className:"font-medium text-gray-900",children:j.deviceName||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Serial:"}),e.jsx("span",{className:"font-medium text-gray-900",children:j.serialNumber||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Platform:"}),e.jsx("span",{className:"font-medium text-gray-900",children:j.platform||"-"})]})]})]}),e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ue,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"Capacity Stats"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:j.userCount||"-"}),e.jsx("div",{className:"text-xs text-purple-400",children:"Users Enrolled"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:j.logCount||"-"}),e.jsx("div",{className:"text-xs text-blue-400",children:"Attendance Logs"})]})]})]}),e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ge,{className:"w-5 h-5 text-orange-500"}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"Device Control"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(g,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-6 group",onClick:async()=>{try{d("Initiating Import All Logs..."),await n.post("/attendance/biometric/sync-all"),d("Import completed successfully."),M.fire("Success","Import All Logs Complete","success")}catch(s){d(`Import Failed: ${s.message}`),M.fire("Error","Import failed","error")}},children:[e.jsx(H,{className:"w-5 h-5 mr-2 group-hover:animate-spin"}),"IMPORT ALL LOGS (Direct)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(g,{variant:"outline",className:"text-xs",onClick:()=>J.mutate(),disabled:J.isPending,children:[e.jsx(te,{className:"w-3 h-3 mr-2"})," Sync Time"]}),e.jsxs(g,{variant:"outline",className:"text-xs text-red-600 px-0",onClick:()=>{window.confirm("Restart Device?")&&Y.mutate()},disabled:Y.isPending,children:[e.jsx(je,{className:"w-3 h-3 mr-2"})," Restart"]}),e.jsxs(g,{variant:"outline",className:"text-xs col-span-2 text-red-700",onClick:()=>{window.confirm("DANGER: Clear ALL logs?")&&X.mutate()},disabled:X.isPending,children:[e.jsx(B,{className:"w-3 h-3 mr-2"})," Clear Logs"]})]})]})]})]}),u.length>0&&e.jsxs("div",{className:"bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-xs max-h-40 overflow-y-auto shadow-inner",children:[e.jsx("div",{className:"font-bold text-gray-500 mb-2 uppercase tracking-wide",children:"Console Output"}),u.map((s,r)=>e.jsx("div",{children:s},r))]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-gray-700",children:"Enrolled Users"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Fetched directly from device memory"})]}),k?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading users from device..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"User ID"}),e.jsx("th",{className:"px-6 py-3",children:"Name"}),e.jsx("th",{className:"px-6 py-3",children:"Role"}),e.jsx("th",{className:"px-6 py-3",children:"UID"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:(W=D==null?void 0:D.data)==null?void 0:W.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-3 font-medium",children:s.userId}),e.jsx("td",{className:"px-6 py-3",children:s.name||"Unknown"}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.role===0?"bg-gray-100":"bg-purple-100 text-purple-700"}`,children:s.role===0?"User":"Admin"})}),e.jsx("td",{className:"px-6 py-3 text-gray-400",children:s.uid}),e.jsx("td",{className:"px-6 py-3 text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-800",onClick:()=>{window.confirm(`Delete ${s.userId}?`)&&ae.mutate(s.userId)},children:e.jsx(B,{className:"w-4 h-4"})})})})]},r))})]})})]})]}),m==="audit"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Synchronization Status"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Compare application staff with device users"})]}),e.jsxs(g,{onClick:()=>F(),disabled:q||w,children:[e.jsx(H,{className:`w-4 h-4 mr-2 ${q||w?"animate-spin":""}`}),q||w?"Scanning...":"Run Audit Scan"]})]}),!q&&(t==null?void 0:t.audit)&&e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"border border-yellow-200 bg-yellow-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-yellow-800 mb-2",children:["Missing on Device (",t.audit.missingOnDevice.length,")"]}),t.audit.missingOnDevice.length>0?e.jsx("div",{className:"text-sm text-yellow-700",children:'Run "Upload Users" in Console to fix this.'}):e.jsx("div",{className:"text-sm text-green-600",children:"All staff present on device."})]})})]})}),m==="shifts"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Shift Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Define shifts and their working hours"})]}),e.jsxs(g,{onClick:()=>E(!0),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"})," Add / Edit Shifts"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Shift Name"}),e.jsx("th",{className:"px-4 py-2",children:"Start Time"}),e.jsx("th",{className:"px-4 py-2",children:"End Time"}),e.jsx("th",{className:"px-4 py-2",children:"Default Grace"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[b==null?void 0:b.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:s.name}),e.jsx("td",{className:"px-4 py-3",children:V(s.start_time)}),e.jsx("td",{className:"px-4 py-3",children:V(s.end_time)}),e.jsxs("td",{className:"px-4 py-3",children:[s.default_grace_time," min"]})]},s.id)),(!b||b.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-gray-400",children:"No shifts defined"})})]})]})})]})}),m==="policies"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(P,{className:"p-6",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-6",children:"Staff Attendance Policies"})}),a?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading staff details..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Staff"}),e.jsx("th",{className:"px-4 py-2",children:"Current Shift (Date Range)"}),e.jsx("th",{className:"px-4 py-2",children:"Grace Time"}),e.jsx("th",{className:"px-4 py-2",children:"Manage Shift"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:v==null?void 0:v.map(s=>{var T;const r=(T=s.shift_assignments)==null?void 0:T.find(o=>{const f=new Date,U=new Date(o.from_date),z=o.to_date?new Date(o.to_date):null;return U<=f&&(!z||z>=f)}),i=r?(r.grace_time??r.shift.default_grace_time)+" min":"-";return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.user.full_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.staff_number})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex flex-col gap-1",children:s.shift_assignments&&s.shift_assignments.length>0?s.shift_assignments.filter(o=>{const f=new Date,U=new Date(f.getFullYear(),f.getMonth(),1),z=new Date(f.getFullYear(),f.getMonth()+1,0),re=new Date(o.from_date),Z=o.to_date?new Date(o.to_date):null;return re<=z&&(!Z||Z>=U)}).map((o,f)=>e.jsx("div",{className:"flex items-center justify-between text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded",children:e.jsxs("span",{children:[o.shift.name,e.jsxs("span",{className:"text-blue-400 ml-1",children:["(",K(new Date(o.from_date),"d MMM")," - ",o.to_date?K(new Date(o.to_date),"d MMM"):"Now",")"]})]})},f)):e.jsx("span",{className:"text-xs text-gray-400",children:"No Active Shift"})})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:i}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(g,{size:"sm",variant:"outline",className:"h-8 gap-2",onClick:()=>p({isOpen:!0,staffId:s.id,staffName:s.user.full_name}),children:[e.jsx(ee,{className:"w-3 h-3"})," Assign/Edit"]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs(g,{size:"sm",className:"h-8 bg-green-600 hover:bg-green-700 text-white gap-2",onClick:async()=>{var o,f;try{await n.post("/attendance/shifts/sync-logs",{staffId:s.user.id}),M.fire({icon:"success",title:"Synced!",text:"Attendance logs updated with current shift rules.",timer:2e3,showConfirmButton:!1})}catch(U){M.fire("Error",((f=(o=U.response)==null?void 0:o.data)==null?void 0:f.error)||"Sync failed","error")}},children:[e.jsx(pe,{className:"w-4 h-4"})," Save"]})})]},s.id)})})]})})]})}),e.jsx(ye,{isOpen:A,onClose:()=>{E(!1),I()}}),e.jsx(Ne,{isOpen:l.isOpen,onClose:()=>p({...l,isOpen:!1}),staffId:l.staffId,staffName:l.staffName,onSuccess:()=>{y()}})]})};export{Re as default};
