import{v as Q,u as Y,r as n,j as e,x as u}from"./index-_K9dBzXA.js";import{o as q,P as G,M as A,p as _,j as I,q as J,X as T,E as Z,r as ee,A as se,s as L,F as te,t as ae,V as le,v as ie,w as ne}from"./index-C0_MxDCy.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=Q("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),xe=()=>{var k,z,S;const{user:t}=Y(),{conversations:D,activeConversation:r,messages:p,fetchConversations:j,selectConversation:b,sendMessage:R}=q(),[c,x]=n.useState(""),[g,h]=n.useState(!1),[w,F]=n.useState(!1),[V,f]=n.useState(!1),[v,P]=n.useState([]),[N,m]=n.useState([]),[$,O]=n.useState(""),y=n.useRef(null);n.useEffect(()=>{j()},[]),n.useEffect(()=>{W()},[p,r]);const W=()=>{var s;(s=y.current)==null||s.scrollIntoView({behavior:"smooth"})},B=async()=>{f(!0);try{const[s,a]=await Promise.all([u.get("/users"),u.get("/clients")]),i=s.data.map(l=>({id:l.id,name:l.full_name,avatar:l.avatar_url,type:"STAFF",subtext:l.role})).filter(l=>l.id!==(t==null?void 0:t.id)),d=a.data.map(l=>({id:l.id,name:l.name,avatar:l.logo_url,type:"CLIENT",subtext:l.client_code})),o=[...i,...d];P(o),m(o)}catch(s){console.error("Failed to load contacts",s)}},H=s=>{O(s),m(s?v.filter(a=>{var i;return a.name.toLowerCase().includes(s.toLowerCase())||((i=a.subtext)==null?void 0:i.toLowerCase().includes(s.toLowerCase()))}):v)},K=async s=>{try{const a=await u.post("/chat/conversations",{type:"DIRECT",participantIds:[s.id]});await j(),b(a.data.id),f(!1)}catch(a){console.error("Failed to start chat",a)}},C=async s=>{s==null||s.preventDefault(),c.trim()&&(await R(c),x(""),h(!1))},U=s=>{x(a=>a+s.emoji)};return e.jsxs("div",{className:"flex h-screen bg-[#d1d7db] overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 w-full h-32 bg-[#00a884] z-0"})," ",e.jsxs("div",{className:"z-10 w-full h-full max-w-[1600px] mx-auto flex shadow-lg overflow-hidden bg-white xl:top-5 xl:h-[calc(100vh-40px)] xl:rounded-lg relative",children:[e.jsxs("div",{className:"w-[400px] flex flex-col bg-white border-r border-[#d1d7db]",children:[e.jsxs("div",{className:"h-16 bg-[#f0f2f5] flex items-center justify-between px-4 border-b border-[#d1d7db]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-300",children:t!=null&&t.avatar_url?e.jsx("img",{src:t.avatar_url,className:"w-full h-full object-cover"}):e.jsx("span",{className:"flex items-center justify-center h-full text-gray-500 font-bold",children:t==null?void 0:t.full_name[0]})}),e.jsxs("div",{className:"flex gap-4 text-[#54656f]",children:[e.jsx("button",{onClick:B,title:"New Chat",children:e.jsx(G,{size:24})}),e.jsx("button",{children:e.jsx(A,{size:24})})]})]}),e.jsx("div",{className:"p-2 border-b border-[#f0f2f5] bg-white",children:e.jsxs("div",{className:"bg-[#f0f2f5] rounded-lg px-4 py-2 flex items-center",children:[e.jsx(_,{size:20,className:"text-[#54656f] mr-4"}),e.jsx("input",{type:"text",placeholder:"Search or start new chat",className:"bg-transparent border-none focus:ring-0 w-full text-sm placeholder:text-[#54656f]"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-white",children:D.map(s=>{var l,E,M;const a=s.type==="DIRECT"?(l=s.participants.find(X=>X.user.id!==(t==null?void 0:t.id)))==null?void 0:l.user:null,i=s.name||(a==null?void 0:a.full_name)||"Unknown",d=s.type==="DIRECT"?a==null?void 0:a.avatar_url:null,o=(r==null?void 0:r.id)===s.id;return e.jsxs("div",{onClick:()=>b(s.id),className:`flex items-center px-3 py-3 cursor-pointer border-b border-[#f0f2f5] hover:bg-[#f5f6f6] ${o?"bg-[#f0f2f5]":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 mr-3 flex-shrink-0 overflow-hidden flex items-center justify-center",children:d?e.jsx("img",{src:d,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-gray-500 font-bold text-lg",children:i[0]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("h3",{className:"text-[#111b21] font-normal text-lg truncate",children:i}),s.lastMessage&&e.jsx("span",{className:"text-xs text-[#667781] whitespace-nowrap",children:I(new Date(s.lastMessage.createdAt),"h:mm a")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-[#667781] truncate max-w-[200px]",children:[((E=s.lastMessage)==null?void 0:E.sender_id)===(t==null?void 0:t.id)&&e.jsx("span",{className:"mr-1",children:"You:"}),(M=s.lastMessage)==null?void 0:M.content]}),s.unreadCount>0&&e.jsx("span",{className:"bg-[#25d366] text-white text-[10px] font-bold px-1.5 rounded-full min-w-[20px] h-5 flex items-center justify-center",children:s.unreadCount})]})]})]},s.id)})})]}),r?e.jsxs("div",{className:"flex-1 flex flex-col relative bg-[#efeae2]",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.06] pointer-events-none",style:{backgroundImage:'url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png")'}}),e.jsxs("div",{className:"h-16 bg-[#f0f2f5] border-b border-[#d1d7db] flex items-center justify-between px-4 z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center overflow-hidden",children:((k=r.name)==null?void 0:k.charAt(0))||((z=r.participants.find(s=>s.user.id!==(t==null?void 0:t.id)))==null?void 0:z.user.full_name.charAt(0))}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[#111b21] font-medium",children:r.name||((S=r.participants.find(s=>s.user.id!==(t==null?void 0:t.id)))==null?void 0:S.user.full_name)}),e.jsx("p",{className:"text-xs text-[#667781]",children:"click here for contact info"})]})]}),e.jsxs("div",{className:"flex gap-6 text-[#54656f]",children:[e.jsx(_,{size:22,className:"cursor-pointer"}),e.jsx(A,{size:22,className:"cursor-pointer"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-8 space-y-2 z-10 custom-scrollbar",children:[p.map((s,a)=>{const i=s.sender_id===(t==null?void 0:t.id);return e.jsx("div",{className:`flex ${i?"justify-end":"justify-start"} mb-2`,children:e.jsxs("div",{className:`
                                        max-w-[65%] px-3 py-1.5 rounded-lg shadow-sm text-sm relative group
                                        ${i?"bg-[#d9fdd3] rounded-tr-none":"bg-white rounded-tl-none"}
                                    `,children:[e.jsx("p",{className:"text-[#111b21] whitespace-pre-wrap leading-relaxed pb-2",children:s.content}),e.jsxs("div",{className:"flex justify-end items-center gap-1 -mt-1.5",children:[e.jsx("span",{className:"text-[10px] text-[#667781]",children:I(new Date(s.createdAt),"h:mm a")}),i&&e.jsx(re,{size:14,className:"text-[#53bdeb]"})]})]})},s.id)}),e.jsx("div",{ref:y})]}),e.jsxs("div",{className:"bg-[#f0f2f5] px-4 py-3 flex items-center gap-4 z-20",children:[e.jsxs("div",{className:"flex gap-4 text-[#54656f] relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>h(!g),children:e.jsx(J,{size:26})}),g&&e.jsxs("div",{className:"absolute bottom-12 left-0 z-50 shadow-2xl rounded-lg",children:[e.jsx("button",{className:"absolute -top-8 right-0 bg-white rounded-full p-1 shadow-md hover:bg-red-50",onClick:()=>h(!1),children:e.jsx(T,{size:16,className:"text-red-500"})}),e.jsx(Z,{onEmojiClick:U,width:300,height:400})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>F(!w),children:e.jsx(ee,{size:26})}),e.jsx(se,{children:w&&e.jsxs(L.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:"absolute bottom-12 left-0 flex flex-col gap-3 mb-2",children:[e.jsx("button",{className:"w-12 h-12 rounded-full bg-blue-500 text-white flex items-center justify-center shadow-lg hover:bg-blue-600",title:"Document",children:e.jsx(te,{size:20})}),e.jsx("button",{className:"w-12 h-12 rounded-full bg-pink-500 text-white flex items-center justify-center shadow-lg hover:bg-pink-600",title:"Image",children:e.jsx(ae,{size:20})}),e.jsx("button",{className:"w-12 h-12 rounded-full bg-purple-500 text-white flex items-center justify-center shadow-lg hover:bg-purple-600",title:"Video",children:e.jsx(le,{size:20})})]})})]})]}),e.jsx("div",{className:"flex-1 bg-white rounded-lg px-4 py-2 flex items-center",children:e.jsx("input",{type:"text",placeholder:"Type a message",className:"w-full border-none focus:ring-0 text-[#111b21] placeholder:text-[#54656f]",value:c,onChange:s=>x(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&C(s)}})}),c.trim()?e.jsx("button",{onClick:C,className:"text-[#54656f]",children:e.jsx(ie,{size:26})}):e.jsx("button",{className:"text-[#54656f]",children:e.jsx(ne,{size:26})})]})]}):e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center bg-[#f0f2f5] border-b-[6px] border-[#25d366]",children:e.jsxs("div",{className:"max-w-md text-center",children:[e.jsx("h2",{className:"text-[#41525d] text-2xl font-light mb-4",children:"WhatsApp Web (Native)"}),e.jsxs("p",{className:"text-[#667781] text-sm",children:["Send and receive messages without keeping your phone online.",e.jsx("br",{}),"Use WhatsApp on up to 4 linked devices and 1 phone."]}),e.jsxs("div",{className:"mt-8 flex items-center justify-center text-[#8696a0] text-xs gap-1",children:[e.jsx(ce,{size:12})," End-to-end encrypted"]})]})}),V&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs(L.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-xl shadow-xl w-full max-w-md h-[80vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"bg-[#008069] p-4 text-white flex items-center gap-4",children:[e.jsx("button",{onClick:()=>f(!1),children:e.jsx(T,{})}),e.jsx("h2",{className:"font-semibold text-lg",children:"New Chat"})]}),e.jsx("div",{className:"p-3 bg-white border-b",children:e.jsx("input",{type:"text",placeholder:"Search contacts...",className:"w-full bg-[#f0f2f5] border-none rounded-lg px-4 py-2 focus:ring-1 focus:ring-[#008069]",value:$,onChange:s=>H(s.target.value)})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[e.jsx("div",{className:"text-xs font-bold text-[#008069] px-4 py-2",children:"CONTACTS ON QIX"}),N.length===0&&e.jsx("p",{className:"text-center text-gray-400 mt-4",children:"No contacts found"}),N.map(s=>e.jsxs("div",{onClick:()=>K(s),className:"flex items-center gap-3 p-3 hover:bg-[#f5f6f6] cursor-pointer rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 overflow-hidden flex items-center justify-center",children:s.avatar?e.jsx("img",{src:s.avatar,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-gray-500 font-bold",children:s.name[0]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[#111b21] font-medium",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.type," ",s.subtext?`â€¢ ${s.subtext}`:""]})]})]},s.id))]})]})})]})]})},ce=({size:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",children:e.jsx("path",{d:"M12 2C9.243 2 7 4.243 7 7v3H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-1V7c0-2.757-2.243-5-5-5zm-3 7V7c0-1.654 1.346-3 3-3s3 1.346 3 3v3H9zm3 8c-1.103 0-2-.897-2-2s.897-2 2-2 2 .897 2 2-.897 2-2 2z"})});export{xe as default};
