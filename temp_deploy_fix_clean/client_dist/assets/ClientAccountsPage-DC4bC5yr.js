import{C as _,j as e,r as u,J as H,x as f}from"./index-_K9dBzXA.js";import{j as d,u as g,B as l,D as L,b as q,Q as z,a as $,Y as F,Z as Q}from"./index-C0_MxDCy.js";import{f as o}from"./format-D4js0obD.js";import{C as N,a as b,b as w,c as v}from"./card-BJXC2BmV.js";import{T as V,a as B,b as C,c as T}from"./tabs-BB7NwzE5.js";import{B as W}from"./badge-BRRI9-vD.js";import{I as G}from"./InvoiceTemplate-BU5RMrpM.js";import U from"./html2canvas.esm-CBrSDip1.js";import{E as Y}from"./jspdf.es.min-DaBCeuWy.js";import{P}from"./printer-BV8c6w5B.js";import"./index-CemV9wER.js";import"./index-feRhg8F5.js";const K=_.forwardRef(({transactions:i,clientName:m,startDate:r,endDate:c},x)=>(i.reduce((a,n)=>n.type==="RECEIPT"||n.type==="INVOICE"?a:a+n.amount,0),e.jsxs("div",{ref:x,className:"p-8 bg-white text-black font-sans max-w-[210mm] mx-auto min-h-[297mm]",children:[e.jsxs("div",{className:"flex justify-between items-start border-b-2 border-primary pb-6 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/qix_logo.png",alt:"Qix Ads",className:"h-16 w-auto object-contain"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Qix Ads"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Digital Marketing Agency"})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsx("p",{children:"123, Tech Plaza,"}),e.jsx("p",{children:"Cyber City, Hyderabad, 500081"}),e.jsx("p",{children:"+91 98765 43210 | contact@qixads.com"}),e.jsx("p",{children:"www.qixads.com"})]})]}),e.jsx("div",{className:"text-center mb-8",children:e.jsx("h2",{className:"text-xl font-bold uppercase tracking-wide border-b inline-block pb-1",children:"Transaction History Statement"})}),e.jsxs("div",{className:"flex justify-between mb-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-700",children:"Statement For:"}),e.jsx("p",{className:"text-lg font-semibold",children:m||"Valued Client"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-bold",children:"Date Generated:"})," ",d(new Date,"dd MMM yyyy")]}),r&&c&&e.jsxs("p",{children:[e.jsx("span",{className:"font-bold",children:"Period:"})," ",d(r,"dd/MM/yy")," - ",d(c,"dd/MM/yy")]})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("table",{className:"w-full text-left text-sm border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 border-y border-gray-300",children:[e.jsx("th",{className:"px-4 py-3 font-bold uppercase text-gray-700 w-32",children:"Date"}),e.jsx("th",{className:"px-4 py-3 font-bold uppercase text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 font-bold uppercase text-gray-700 w-32 text-right",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-4 py-8 text-center text-gray-400",children:"No transactions found for this period."})}):i.map((a,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 align-top",children:d(new Date(a.date),"dd MMM yyyy")}),e.jsxs("td",{className:"px-4 py-3 align-top",children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.description}),a.reference&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Ref: ",a.reference]})]}),e.jsx("td",{className:`px-4 py-3 text-right font-mono font-bold ${["PAYMENT","RECEIPT"].includes(a.type)?"text-green-700":"text-gray-900"}`,children:o(a.amount)})]},a.id||n))})]})}),e.jsxs("div",{className:"mt-12 pt-8 border-t border-gray-200 text-center text-xs text-gray-500",children:[e.jsx("p",{children:"This is a computer-generated statement and does not require a physical signature."}),e.jsx("p",{children:"Thank you for doing business with Qix Ads."})]})]}))),de=()=>{const[i,m]=u.useState(null),r=u.useRef(null),c=u.useRef(null),x=()=>{if(c.current){const s=c.current.innerHTML,t=window.open("","","height=800,width=800");t&&(t.document.write("<html><head><title>Statement</title>"),t.document.write('<script src="https://cdn.tailwindcss.com"><\/script>'),t.document.write("</head><body >"),t.document.write(s),t.document.write("</body></html>"),t.document.close(),t.focus(),setTimeout(()=>t.print(),1e3))}},[a]=H(),n=a.get("entity_id"),{data:D=[],isLoading:M}=g({queryKey:["client-transactions",n],queryFn:async()=>{const s=new URLSearchParams({limit:"50"});n&&s.append("client_id",n);const{data:t}=await f.get(`/accounting/transactions?${s.toString()}`);return t}}),{data:j=[],isLoading:I}=g({queryKey:["client-invoices"],queryFn:async()=>{const{data:s}=await f.get("/billing/invoices");return s}}),S=M||I,A=()=>{if(r.current){const s=r.current.innerHTML,t=window.open("","","height=600,width=800");t&&(t.document.write("<html><head><title>Print Invoice</title>"),t.document.write('<script src="https://cdn.tailwindcss.com"><\/script>'),t.document.write("</head><body >"),t.document.write(s),t.document.write("</body></html>"),t.document.close(),t.focus(),setTimeout(()=>t.print(),500))}},R=async()=>{if(r.current){const s=await U(r.current,{scale:2}),t=s.toDataURL("image/png"),p=new Y("p","mm","a4"),y=p.internal.pageSize.getWidth(),k=s.height*y/s.width;p.addImage(t,"PNG",0,0,y,k),p.save(`Invoice_${i.invoice_number}.pdf`)}},E=s=>{const t=`Here is your invoice ${s.invoice_number||s.reference} for Amount ${o(s.net_payable||s.amount)}.`;window.open(`https://wa.me/?text=${encodeURIComponent(t)}`,"_blank")};if(S)return e.jsx("div",{className:"p-8 text-center",children:"Loading account details..."});const h=D;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"My Accounts"}),e.jsx("p",{className:"text-muted-foreground",children:"View your invoices and payment history."}),e.jsxs(V,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(B,{children:[e.jsx(C,{value:"overview",children:"Transaction History"}),e.jsx(C,{value:"invoices",children:"Invoices"})]}),e.jsx(T,{value:"overview",children:e.jsxs(N,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsx(w,{children:"Transaction History"}),e.jsxs(l,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(P,{className:"h-4 w-4 mr-2"})," Print Statement"]})]}),e.jsxs(v,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-muted text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 font-semibold uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 font-semibold uppercase",children:"Description"}),e.jsx("th",{className:"px-6 py-3 font-semibold uppercase text-right",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-6 py-8 text-center text-muted-foreground",children:"No recent activity found."})}):h.map(s=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d(new Date(s.date),"dd MMM yyyy")}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium",children:s.description}),s.reference&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ref: ",s.reference]})]}),e.jsx("td",{className:`px-6 py-4 text-right font-mono font-bold ${["PAYMENT","RECEIPT"].includes(s.type)?"text-green-600":""}`,children:o(s.amount)})]},s.id))})]})}),e.jsx("div",{className:"hidden",children:e.jsx(K,{ref:c,transactions:h,clientName:"Client Account"})})]})]})}),e.jsx(T,{value:"invoices",children:e.jsxs(N,{children:[e.jsx(b,{children:e.jsx(w,{children:"All Invoices"})}),e.jsx(v,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-muted text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 font-semibold uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 font-semibold uppercase",children:"Invoice #"}),e.jsx("th",{className:"px-6 py-3 font-semibold uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 font-semibold uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 font-semibold uppercase text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-muted-foreground",children:"No invoices generated yet."})}):j.map(s=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d(new Date(s.invoice_date||s.date),"dd MMM yyyy")}),e.jsx("td",{className:"px-6 py-4 font-mono font-medium",children:s.invoice_number||s.reference}),e.jsx("td",{className:"px-6 py-4 font-mono font-bold",children:o(s.net_payable||s.amount)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(W,{variant:"outline",className:s.status==="PAID"?"bg-green-50 text-green-700 border-green-200":"bg-yellow-50 text-yellow-700 border-yellow-200",children:s.status||"PENDING"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(L,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>m(s),children:[e.jsx(z,{className:"h-4 w-4 mr-2"})," View"]})}),e.jsx($,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-end gap-2 border-b pb-4",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:A,children:[e.jsx(P,{className:"h-4 w-4 mr-2"})," Print"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:R,children:[e.jsx(F,{className:"h-4 w-4 mr-2"})," Download PDF"]})]}),e.jsx("div",{className:"border p-1 bg-gray-50 flex justify-center",children:e.jsx("div",{className:"scale-90 origin-top",children:e.jsx(G,{ref:r,data:i})})})]})})]}),e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>E(s),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"})," Share"]})]})})]},s.id))})]})})})]})})]})]})};export{de as default};
