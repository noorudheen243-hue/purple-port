import{r as p,x as m,j as t,E as h}from"./index-_K9dBzXA.js";import{i as b,Y as f,_ as w}from"./index-C0_MxDCy.js";const E=()=>{const[n,d]=p.useState(null),[o,r]=p.useState(""),x=async()=>{try{r("Downloading export...");const e=await m.get("/backup/export-json",{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=s,a.setAttribute("download",`purple-port-backup-${new Date().toISOString().split("T")[0]}.zip`),document.body.appendChild(a),a.click(),a.remove(),r("Export Complete!")}catch(e){console.error(e);let s="Export Failed";if(e.response&&e.response.data&&e.response.data instanceof Blob){const a=await e.response.data.text();try{s=JSON.parse(a).message||s}catch{}}else e.message&&(s=e.message);r(s)}},l=b({mutationFn:async e=>await m.post("/backup/import-json",e,{headers:{"Content-Type":"multipart/form-data"},timeout:18e5}),onSuccess:()=>{r("SUCCESS: Data Restored! Please refresh the page."),d(null),setTimeout(()=>window.location.reload(),2e3)},onError:async e=>{var a,i,c;console.error("Import Error:",e);let s="Import Failed";if(((a=e.response)==null?void 0:a.data)instanceof Blob){const u=await e.response.data.text();try{s=JSON.parse(u).message||s}catch{}}else(c=(i=e.response)==null?void 0:i.data)!=null&&c.message?s=e.response.data.message:e.message&&(s=e.message);r(`Error: ${s}`)}}),g=()=>{if(!n||!window.confirm("WARNING: This will DELETE all existing data on this server and replace it with the file data. Are you sure?"))return;const e=new FormData;e.append("file",n),r("Restoring data... This may take a minute..."),l.mutate(e)};return t.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto p-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Data Synchronization"}),t.jsx("p",{className:"text-gray-600",children:"Sync data between your Local Application and the Online Server."}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white p-6 rounded-xl shadow border border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:t.jsx(f,{className:"w-6 h-6 text-blue-600"})}),t.jsx("h3",{className:"text-lg font-semibold",children:"Export Data"})]}),t.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Download all current database records (Users, Clients, Tasks, etc.) as a JSON file."}),t.jsx("button",{onClick:x,className:"w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition",children:"Download Backup (.zip)"})]}),t.jsxs("div",{className:"bg-white p-6 rounded-xl shadow border border-red-50",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:t.jsx(w,{className:"w-6 h-6 text-red-600"})}),t.jsx("h3",{className:"text-lg font-semibold",children:"Import Data"})]}),t.jsxs("div",{className:"bg-red-50 p-3 rounded border border-red-100 mb-4 flex gap-2",children:[t.jsx(h,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),t.jsxs("p",{className:"text-xs text-red-800",children:[t.jsx("strong",{children:"Warning:"})," Importing will Permanently DELETE existing data on this server and replace it."]})]}),t.jsx("input",{type:"file",accept:".zip,.json",onChange:e=>{var s;return d(((s=e.target.files)==null?void 0:s[0])||null)},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100 mb-4"}),t.jsx("button",{onClick:g,disabled:!n||l.isPending,className:"w-full py-2 px-4 bg-red-600 hover:bg-red-700 disabled:bg-gray-300 text-white rounded-lg transition",children:l.isPending?"Restoring...":"Restore Data"})]})]}),o&&t.jsx("div",{className:`p-4 rounded-lg text-center font-medium ${o.includes("SUCCESS")?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:o})]})};export{E as default};
