import{v as _,q as $,r as c,x as w,j as e}from"./index-_K9dBzXA.js";import{u as O,i as L,a3 as Q,B as A,l as J}from"./index-C0_MxDCy.js";import{C as d,a as m,b as u,c as j}from"./card-BJXC2BmV.js";import{T as K,a as Y,b as g,c as n,d as z,e as a}from"./table-CZtgpgQ3.js";import{S as C,a as S,b as D,c as E,d as i}from"./select-BsM-SyXO.js";import{B as P}from"./badge-BRRI9-vD.js";import{C as U}from"./ConfirmationModal-CBglAdUX.js";import{X}from"./x-circle-DJEckX6R.js";import{C as W}from"./clock-89fNMNOB.js";import{L as Z}from"./loader-2-m9uN2hHg.js";import"./index-feRhg8F5.js";import"./index-I-cGsQdO.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=_("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]),me=()=>{const R=$(),[p,M]=c.useState((new Date().getMonth()+1).toString()),[f,k]=c.useState(new Date().getFullYear().toString()),[v,F]=c.useState("ALL"),[x,N]=c.useState(null),[o,y]=c.useState(null),{data:l=[],isLoading:V}=O({queryKey:["leave-history",p,f,v],queryFn:async()=>{const{data:t}=await w.get(`/leave/history?month=${p}&year=${f}&status=${v}`);return t}}),B=L({mutationFn:async t=>{await w.post(`/leave/${t}/revert`)},onSuccess:()=>{alert("Leave request reverted to Pending"),R.invalidateQueries({queryKey:["leave-history"]}),b()},onError:t=>{var s,r;alert(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to revert request")}}),I=L({mutationFn:async t=>{await w.delete(`/leave/${t}`)},onSuccess:()=>{alert("Leave request deleted permanently"),R.invalidateQueries({queryKey:["leave-history"]}),b()},onError:t=>{var s,r;alert(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete request")}}),q=()=>{x&&(o==="revert"?B.mutate(x.id):o==="delete"&&I.mutate(x.id))},b=()=>{N(null),y(null)},h={total:l.length,approved:l.filter(t=>t.status==="APPROVED").length,rejected:l.filter(t=>t.status==="REJECTED").length,pending:l.filter(t=>t.status==="PENDING").length},H=t=>{const s={APPROVED:"bg-green-100 text-green-700 hover:bg-green-100",REJECTED:"bg-red-100 text-red-700 hover:bg-red-100",PENDING:"bg-orange-100 text-orange-700 hover:bg-orange-100"};return e.jsx(P,{className:s[t]||"",children:t})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Leave Request History"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 bg-secondary/30 p-2 rounded-lg",children:[e.jsxs(C,{value:p,onValueChange:M,children:[e.jsx(S,{className:"w-[120px] bg-background",children:e.jsx(D,{placeholder:"Month"})}),e.jsx(E,{children:Array.from({length:12},(t,s)=>e.jsx(i,{value:(s+1).toString(),children:new Date(0,s).toLocaleString("default",{month:"long"})},s+1))})]}),e.jsxs(C,{value:f,onValueChange:k,children:[e.jsx(S,{className:"w-[100px] bg-background",children:e.jsx(D,{placeholder:"Year"})}),e.jsx(E,{children:[2025,2026,2027].map(t=>e.jsx(i,{value:t.toString(),children:t},t))})]}),e.jsxs(C,{value:v,onValueChange:F,children:[e.jsx(S,{className:"w-[140px] bg-background",children:e.jsx(D,{placeholder:"Status"})}),e.jsxs(E,{children:[e.jsx(i,{value:"ALL",children:"All Status"}),e.jsx(i,{value:"APPROVED",children:"Approved"}),e.jsx(i,{value:"PENDING",children:"Pending"}),e.jsx(i,{value:"REJECTED",children:"Rejected"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Requests"}),e.jsx("div",{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:h.total})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-green-600",children:"Approved"}),e.jsx(Q,{className:"h-4 w-4 text-green-600"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-green-700",children:h.approved})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-red-600",children:"Rejected"}),e.jsx(X,{className:"h-4 w-4 text-red-600"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-red-700",children:h.rejected})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-orange-600",children:"Pending"}),e.jsx(W,{className:"h-4 w-4 text-orange-600"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-700",children:h.pending})})]})]}),e.jsx(d,{className:"overflow-hidden",children:e.jsxs(K,{children:[e.jsx(Y,{className:"bg-muted/40",children:e.jsxs(g,{children:[e.jsx(n,{children:"Staff Details"}),e.jsx(n,{children:"Leave Type"}),e.jsx(n,{children:"Dates / Duration"}),e.jsx(n,{children:"Reason"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Action By"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(z,{children:V?e.jsx(g,{children:e.jsx(a,{colSpan:7,className:"h-24 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(Z,{className:"h-4 w-4 animate-spin"})," Loading history..."]})})}):l.length===0?e.jsx(g,{children:e.jsx(a,{colSpan:7,className:"h-24 text-center text-muted-foreground",children:"No records found for this period."})}):l.map(t=>{var T;const s=new Date(t.start_date),r=new Date(t.end_date),G=Math.ceil((r.getTime()-s.getTime())/(1e3*60*60*24))+1;return e.jsxs(g,{children:[e.jsx(a,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.user.full_name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.user.department})]})}),e.jsx(a,{children:e.jsx(P,{variant:"outline",className:"font-mono text-xs",children:t.type})}),e.jsx(a,{children:e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsxs("span",{children:[s.toLocaleDateString()," - ",r.toLocaleDateString()]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[G," days"]})]})}),e.jsx(a,{className:"max-w-[200px]",children:e.jsx("p",{className:"truncate text-sm text-muted-foreground",title:t.reason,children:t.reason})}),e.jsx(a,{children:H(t.status)}),e.jsx(a,{children:e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:((T=t.approver)==null?void 0:T.full_name)||"-"})}),e.jsx(a,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[t.status!=="PENDING"&&e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"Revert to Pending",onClick:()=>{N(t),y("revert")},children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50",title:"Delete Permanently",onClick:()=>{N(t),y("delete")},children:e.jsx(J,{className:"h-4 w-4"})})]})})]},t.id)})})]})}),e.jsx(U,{isOpen:!!x,onClose:b,onConfirm:q,title:o==="revert"?"Revert Request?":"Delete Request?",message:o==="revert"?"Are you sure you want to revert this request to PENDING? This will remove any associated 'LEAVE' records from the Attendance Register.":"Are you sure you want to permanently delete this request? This action cannot be undone and will remove associated attendance records.",confirmLabel:o==="revert"?"Revert":"Delete",isDestructive:!0})]})};export{me as default};
