import{q as A,r as u,j as e,x as j}from"./index-_K9dBzXA.js";import{u as L,i as b,B as i,D as k,a as q,d as F,e as R,aj as B,k as E,f as H}from"./index-C0_MxDCy.js";import{C as M,a as Q,b as z,d as K,c as V}from"./card-BJXC2BmV.js";import{S as N,a as w,b as v,c as S,d as o}from"./select-BsM-SyXO.js";import{T as Y,a as I,b as g,c as t,d as O,e as n}from"./table-CZtgpgQ3.js";import{L as C}from"./loader-2-m9uN2hHg.js";import{A as $}from"./alert-circle-Dgl9YWib.js";import"./index-feRhg8F5.js";import"./index-I-cGsQdO.js";const te=()=>{const p=A(),[c,P]=u.useState(new Date().getFullYear().toString()),[d,D]=u.useState((new Date().getMonth()+1).toString()),[a,r]=u.useState(null),{data:x,isLoading:T}=L({queryKey:["payroll-run",d,c],queryFn:async()=>(await j.get("/payroll/run",{params:{month:d,year:c}})).data}),h=((x==null?void 0:x.slips)||[]).filter(s=>s.status==="PENDING"||s.status==="DRAFT"),m=b({mutationFn:async s=>{await j.post(`/payroll/slip/${s}/process`)},onSuccess:()=>{p.invalidateQueries({queryKey:["payroll-run"]}),r(null)}}),y=b({mutationFn:async s=>{await j.delete(`/payroll/slip/${s}`)},onSuccess:()=>{p.invalidateQueries({queryKey:["payroll-run"]})}}),_=s=>{r({id:s.id,name:s.name,netPay:s.net_pay})};return e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto pb-12",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-6 rounded-lg shadow-sm border",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Payroll Process"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and finalize team salary payments."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(N,{value:d,onValueChange:D,children:[e.jsx(w,{className:"w-[140px]",children:e.jsx(v,{placeholder:"Month"})}),e.jsx(S,{children:Array.from({length:12},(s,l)=>l+1).map(s=>e.jsx(o,{value:s.toString(),children:new Date(0,s-1).toLocaleString("default",{month:"long"})},s))})]}),e.jsxs(N,{value:c,onValueChange:P,children:[e.jsx(w,{className:"w-[100px]",children:e.jsx(v,{placeholder:"Year"})}),e.jsxs(S,{children:[e.jsx(o,{value:"2024",children:"2024"}),e.jsx(o,{value:"2025",children:"2025"}),e.jsx(o,{value:"2026",children:"2026"})]})]})]})]}),T?e.jsx("div",{className:"flex justify-center p-12",children:e.jsx(C,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs(M,{children:[e.jsxs(Q,{children:[e.jsxs(z,{children:["Pending Approvals (",h.length,")"]}),e.jsx(K,{children:"Review the following salary slips before processing. Once processed, the amount will be posted to the ledger."})]}),e.jsx(V,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Y,{children:[e.jsx(I,{children:e.jsxs(g,{children:[e.jsx(t,{children:"Staff Name"}),e.jsx(t,{children:"Designation"}),e.jsx(t,{children:"Basic"}),e.jsx(t,{children:"Allowances"}),e.jsx(t,{children:"Deductions"}),e.jsx(t,{className:"text-right font-bold",children:"Net Pay"}),e.jsx(t,{className:"text-center",children:"Actions"})]})}),e.jsx(O,{children:h.length===0?e.jsx(g,{children:e.jsx(n,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No pending slips found for this month."})}):h.map(s=>{var l,f;return e.jsxs(g,{children:[e.jsxs(n,{className:"font-medium",children:[s.name,e.jsx("div",{className:"text-xs text-muted-foreground",children:(f=(l=s.user)==null?void 0:l.staffProfile)==null?void 0:f.staff_number})]}),e.jsx(n,{children:s.designation}),e.jsxs(n,{children:["₹",s.basic_salary.toLocaleString()]}),e.jsxs(n,{children:["₹",(s.allowances+s.conveyance_allowance+s.accommodation_allowance+s.incentives).toLocaleString()]}),e.jsxs(n,{className:"text-red-500",children:["-₹",(s.lop_deduction+s.advance_salary+s.other_deductions).toLocaleString()]}),e.jsxs(n,{className:"text-right font-bold text-green-700",children:["₹",s.net_pay.toLocaleString()]}),e.jsxs(n,{className:"flex justify-center gap-2",children:[e.jsx(i,{size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700 hover:bg-red-50",disabled:y.isPending,onClick:()=>y.mutate(s.id),children:"Reject"}),e.jsx(i,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>_(s),children:"Submit"})]})]},s.id)})})]})})})]}),e.jsx(k,{open:!!a,onOpenChange:s=>!s&&r(null),children:e.jsxs(q,{children:[e.jsxs(F,{children:[e.jsx(R,{children:"Confirm Salary Process"}),e.jsxs(B,{children:["Are you sure you want to process the salary for ",e.jsx("strong",{children:a==null?void 0:a.name}),"?"]})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Net Payable Amount"}),e.jsxs("span",{className:"text-xl font-bold text-green-700",children:["₹",a==null?void 0:a.netPay.toLocaleString()]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 text-yellow-800 text-sm rounded border border-yellow-200 flex gap-2",children:[e.jsx($,{className:"w-5 h-5 shrink-0"}),e.jsx("p",{children:"This action will post a debit entry to Salary Expense and credit to the staff's ledger. This cannot be undone."})]})]}),e.jsxs(E,{children:[e.jsx(i,{variant:"outline",onClick:()=>r(null),children:"Cancel"}),e.jsxs(i,{className:"bg-green-600 hover:bg-green-700",disabled:m.isPending,onClick:()=>a&&m.mutate(a.id),children:[m.isPending?e.jsx(C,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(H,{className:"w-4 h-4 mr-2"}),"Confirm & Process"]})]})]})})]})};export{te as default};
