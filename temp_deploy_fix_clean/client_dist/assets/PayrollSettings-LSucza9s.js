import{u as L,q as T,r as c,j as e,x as N}from"./index-_K9dBzXA.js";import{u as O,i as P,B as q,p as A,I as t}from"./index-C0_MxDCy.js";import{C as F,a as J,b as H,c as B}from"./card-BJXC2BmV.js";import{T as E,a as I,b as o,c as n,d as M,e as l}from"./table-CZtgpgQ3.js";import{S as Q}from"./save-BPR9f-BE.js";const $=()=>{const{user:R}=L(),j=T(),[i,b]=c.useState(""),[d,y]=c.useState([]),[S,p]=c.useState([]),[D,m]=c.useState(!1),{data:u=[],isLoading:_}=O({queryKey:["staff-list-payroll"],queryFn:async()=>(await N.get("/team/staff")).data});c.useEffect(()=>{if(u.length>0){const a=u.map(s=>({id:s.id,user_id:s.user_id,full_name:s.user.full_name,staff_number:s.staff_number,designation:s.designation,base_salary:s.base_salary||0,hra:s.hra||0,conveyance_allowance:s.conveyance_allowance||0,accommodation_allowance:s.accommodation_allowance||0,allowances:s.allowances||0}));y(a),p(JSON.parse(JSON.stringify(a))),m(!1)}},[u]);const r=(a,s,x)=>{const g=parseFloat(x)||0;y(C=>C.map(f=>f.id===a?{...f,[s]:g}:f)),m(!0)},w=a=>(a.base_salary||0)+(a.hra||0)+(a.conveyance_allowance||0)+(a.accommodation_allowance||0)+(a.allowances||0),h=P({mutationFn:async()=>{const a=d.filter(s=>{const x=S.find(g=>g.id===s.id);return JSON.stringify(s)!==JSON.stringify(x)});if(a.length===0){alert("No changes detected to save.");return}await Promise.all(a.map(s=>N.patch(`/team/staff/${s.id}`,{base_salary:s.base_salary,hra:s.hra,conveyance_allowance:s.conveyance_allowance,accommodation_allowance:s.accommodation_allowance,allowances:s.allowances})))},onSuccess:()=>{j.invalidateQueries({queryKey:["staff-list-payroll"]}),j.invalidateQueries({queryKey:["staff"]}),alert("All changes saved successfully! Data is now available in Salary Calculator."),p(JSON.parse(JSON.stringify(d))),m(!1)},onError:a=>alert("Failed to save some changes: "+a.message)}),v=d.filter(a=>{var s;return a.full_name.toLowerCase().includes(i.toLowerCase())||((s=a.staff_number)==null?void 0:s.toLowerCase().includes(i.toLowerCase()))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Payroll Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage default salary structures. Changes reflect automatically in Salary Calculator."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(q,{onClick:()=>h.mutate(),disabled:h.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),h.isPending?"Saving...":"Save All Changes"]})})]}),e.jsxs(F,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(H,{children:"Staff Salary Registry"}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(A,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(t,{placeholder:"Search staff...",className:"pl-8",value:i,onChange:a=>b(a.target.value)})]})]})}),e.jsx(B,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(E,{children:[e.jsx(I,{children:e.jsxs(o,{children:[e.jsx(n,{className:"w-[200px]",children:"Staff Name"}),e.jsx(n,{children:"Basic Salary"}),e.jsx(n,{children:"HRA"}),e.jsx(n,{children:"Conveyance"}),e.jsx(n,{children:"Accommodation"}),e.jsx(n,{children:"Fixed Allow."}),e.jsx(n,{className:"text-right font-bold w-[120px]",children:"Total Per Month"}),e.jsx(n,{className:"text-right font-bold w-[120px]",children:"Per Day Wage"})]})}),e.jsx(M,{children:_?e.jsx(o,{children:e.jsx(l,{colSpan:8,className:"text-center py-4",children:"Loading..."})}):v.length===0?e.jsx(o,{children:e.jsx(l,{colSpan:8,className:"text-center py-4",children:"No staff found"})}):v.map(a=>e.jsxs(o,{children:[e.jsx(l,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.full_name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.staff_number}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.designation})]})}),e.jsx(l,{children:e.jsx(t,{type:"number",className:"h-8 w-24",value:a.base_salary,onChange:s=>r(a.id,"base_salary",s.target.value)})}),e.jsx(l,{children:e.jsx(t,{type:"number",className:"h-8 w-24",value:a.hra,onChange:s=>r(a.id,"hra",s.target.value)})}),e.jsx(l,{children:e.jsx(t,{type:"number",className:"h-8 w-24",value:a.conveyance_allowance,onChange:s=>r(a.id,"conveyance_allowance",s.target.value)})}),e.jsx(l,{children:e.jsx(t,{type:"number",className:"h-8 w-24",value:a.accommodation_allowance,onChange:s=>r(a.id,"accommodation_allowance",s.target.value)})}),e.jsx(l,{children:e.jsx(t,{type:"number",className:"h-8 w-24",value:a.allowances,onChange:s=>r(a.id,"allowances",s.target.value)})}),e.jsxs(l,{className:"text-right font-bold text-green-700",children:["₹",w(a).toLocaleString("en-IN")]}),e.jsxs(l,{className:"text-right font-bold text-blue-700",children:["₹",(w(a)/30).toLocaleString("en-IN",{maximumFractionDigits:2})]})]},a.id))})]})})})]})]})};export{$ as default};
