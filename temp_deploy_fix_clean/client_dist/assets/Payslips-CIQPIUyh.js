import{u as G,r as v,j as e,x as W}from"./index-_K9dBzXA.js";import{u as F,Q as H,B as w,Y as V,Z as Q,$ as O,K as Y,X as K,S as J}from"./index-C0_MxDCy.js";import X from"./html2canvas.esm-CBrSDip1.js";import{E as Z}from"./jspdf.es.min-DaBCeuWy.js";import{S as A,a as L,b as I,c as R,d as _}from"./select-BsM-SyXO.js";import{D as T,a as z,b as B,c as q,d as C}from"./dropdown-menu-3eTXn1g5.js";import{P as ee}from"./printer-BV8c6w5B.js";import"./index-feRhg8F5.js";import"./index-I-cGsQdO.js";import"./index-CemV9wER.js";import"./circle-C-AcgedN.js";const te=({slip:t,onClose:u})=>{var f,N,S,P,a,g,E;const h=()=>{window.print()},[m,o]=v.useState(!1),b=async()=>{const l=document.getElementById("payslip-content");if(!l)return null;try{document.body.classList.add("pdf-mode");const i=await X(l,{scale:2,useCORS:!0,logging:!1,windowWidth:794});document.body.classList.remove("pdf-mode");const s=i.toDataURL("image/png"),n=new Z("p","mm","a4"),r=n.internal.pageSize.getWidth(),d=n.internal.pageSize.getHeight(),c=n.getImageProperties(s),p=c.width,U=c.height,M=Math.min(r/p,d/U);return n.addImage(s,"PNG",0,0,p*M,U*M),n.output("blob")}catch(i){return console.error("PDF Generation failed",i),document.body.classList.remove("pdf-mode"),null}},j=async()=>{var i;o(!0);const l=await b();if(l){const s=window.URL.createObjectURL(l),n=document.createElement("a");n.href=s,n.download=`Payslip_${(i=t.user)==null?void 0:i.full_name}_${t.run.month}_${t.run.year}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s)}o(!1)},D=async()=>{o(!0);const l=`Here is my payslip for ${t.run.month}/${t.run.year}.
Net Pay: ₹${t.net_pay.toLocaleString("en-IN")}`,i=`Payslip_${t.run.month}_${t.run.year}.pdf`;try{const s=await b();if(!s)throw new Error("Failed to generate PDF");const n=new File([s],i,{type:"application/pdf"});if(navigator.canShare&&navigator.canShare({files:[n]}))await navigator.share({files:[n],title:"Payslip",text:l});else{const r=window.URL.createObjectURL(s),d=document.createElement("a");d.href=r,d.download=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),setTimeout(()=>{window.open(`https://wa.me/?text=${encodeURIComponent(l+`
(Please attach the downloaded payslip)`)}`,"_blank")},1e3)}}catch(s){console.error("Error sharing to WhatsApp:",s),window.open(`https://wa.me/?text=${encodeURIComponent(l)}`,"_blank")}finally{o(!1)}},y=async()=>{var n;o(!0);const l=`Payslip - ${t.run.month}/${t.run.year} - ${(n=t.user)==null?void 0:n.full_name}`,i=`Please find attached the payslip for ${t.run.month}/${t.run.year}.

Net Pay: ₹${t.net_pay.toLocaleString("en-IN")}`,s=`Payslip_${t.run.month}_${t.run.year}.pdf`;try{const r=await b();if(!r)throw new Error("Failed to generate PDF");const d=new File([r],s,{type:"application/pdf"});if(navigator.canShare&&navigator.canShare({files:[d]}))await navigator.share({files:[d],title:l,text:i});else{const c=window.URL.createObjectURL(r),p=document.createElement("a");p.href=c,p.download=s,document.body.appendChild(p),p.click(),document.body.removeChild(p),setTimeout(()=>{window.open(`mailto:?subject=${encodeURIComponent(l)}&body=${encodeURIComponent(i+`

(Payslip downloaded - please attach)`)}`)},1e3)}}catch(r){console.error("Error sharing to Mail:",r),window.open(`mailto:?subject=${encodeURIComponent(l)}&body=${encodeURIComponent(i)}`)}finally{o(!1)}},$=async()=>{o(!0);const l=`Here is my payslip for ${t.run.month}/${t.run.year}.
Net Pay: ₹${t.net_pay.toLocaleString("en-IN")}`,i=`Payslip_${t.run.month}_${t.run.year}.pdf`;try{const s=await b();if(s){const n=window.URL.createObjectURL(s),r=document.createElement("a");r.href=n,r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r)}await J.fire({title:"PDF Downloaded",text:"Due to browser security, we cannot auto-attach files to WhatsApp Web. Please drag & drop the downloaded payslip into the chat.",icon:"info",confirmButtonText:"Open WhatsApp Web",confirmButtonColor:"#25D366",showCancelButton:!0,cancelButtonText:"Close"}).then(n=>{n.isConfirmed&&window.open(`https://web.whatsapp.com/send?text=${encodeURIComponent(l+`
(Please attach the downloaded payslip)`)}`,"_blank")})}catch(s){console.error(s)}finally{o(!1)}},k=async()=>{var n;o(!0);const l=`Payslip - ${t.run.month}/${t.run.year} - ${(n=t.user)==null?void 0:n.full_name}`,i=`Please find attached the payslip for ${t.run.month}/${t.run.year}.

Net Pay: ₹${t.net_pay.toLocaleString("en-IN")}`,s=`Payslip_${t.run.month}_${t.run.year}.pdf`;try{const r=await b();if(r){const d=window.URL.createObjectURL(r),c=document.createElement("a");c.href=d,c.download=s,document.body.appendChild(c),c.click(),document.body.removeChild(c)}setTimeout(()=>{window.open(`https://mail.google.com/mail/?view=cm&fs=1&su=${encodeURIComponent(l)}&body=${encodeURIComponent(i+`

(Payslip downloaded - please attach)`)}`,"_blank")},1e3)}catch(r){console.error(r)}finally{o(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm overflow-y-auto print-container print:absolute print:top-0 print:left-0 print:w-full print:bg-white print:z-[100] print:block print:h-auto print:overflow-visible",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-4xl my-8 print:shadow-none print:w-full print:max-w-none print:my-0 flex flex-col max-h-[90vh] print:max-h-none print:h-auto print:overflow-visible",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-lg print:hidden shrink-0",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:"Salary Slip Preview"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:h,disabled:m,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"})," Print"]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:j,disabled:m,children:[e.jsx(V,{className:"w-4 h-4 mr-2"})," PDF"]}),e.jsxs(T,{children:[e.jsx(z,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",disabled:m,className:"text-green-600 border-green-200 bg-green-50 hover:bg-green-100",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," ",m?"Sharing...":"WhatsApp"," ",e.jsx(O,{className:"w-3 h-3 ml-1 opacity-50"})]})}),e.jsxs(B,{children:[e.jsx(q,{children:"Share via"}),e.jsx(C,{onClick:D,children:"WhatsApp App (Mobile)"}),e.jsx(C,{onClick:$,children:"WhatsApp Web"})]})]}),e.jsxs(T,{children:[e.jsx(z,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",disabled:m,className:"text-blue-600 border-blue-200 bg-blue-50 hover:bg-blue-100",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"})," ",m?"Sharing...":"Email"," ",e.jsx(O,{className:"w-3 h-3 ml-1 opacity-50"})]})}),e.jsxs(B,{children:[e.jsx(q,{children:"Share via"}),e.jsx(C,{onClick:y,children:"Default Mail App"}),e.jsx(C,{onClick:k,children:"Gmail"})]})]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:u,className:"hover:bg-red-50 hover:text-red-600",children:e.jsx(K,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-y-auto p-8 bg-gray-100 print:overflow-visible print:bg-white print:p-0 flex-1 leading-snug print:leading-tight",children:e.jsxs("div",{id:"payslip-content",className:"payslip-compact bg-white shadow-sm mx-auto max-w-3xl min-h-[800px] print:shadow-none print:border-0 relative print:max-w-none print:w-full",children:[e.jsx("div",{className:"h-4 w-full bg-[#FFD700] print:print-color-adjust-exact"}),e.jsxs("div",{className:"p-8 pb-4 print:p-6 print:pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6 border-b pb-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:"/qix_logo.png",alt:"Qix Ads",className:"h-20 object-contain print:h-10 print-logo"})}),e.jsxs("div",{className:"text-right text-xs text-gray-600 leading-relaxed max-w-md print:max-w-none print:text-[10px] print:leading-none print-header-text",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1 print:text-base",children:"Qix Ads"}),e.jsx("p",{children:"2nd floor City Center Complex, Pattambi Rd"}),e.jsx("p",{children:"Near Supplyco Store, Perintalmanna, Kerala 679322"}),e.jsxs("p",{className:"mt-2 text-[10px] print:mt-1",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," +91 99473 81381, +91 81369 12104"]}),e.jsxs("p",{className:"text-[10px]",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," qixmediasol@gmail.com | ",e.jsx("span",{className:"font-semibold",children:"Web:"})," www.qixads.com"]})]})]}),e.jsxs("div",{className:"text-center mb-8 print:mb-4",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 uppercase tracking-wider underline underline-offset-4 print:text-xl print:no-underline",style:{fontSize:"18px !important"},children:["Payslip for the month of - ",new Date(0,t.run.month-1).toLocaleString("default",{month:"long"})," ",t.run.year]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 print-header-text",children:["Generated: ",new Date().toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-12 gap-y-6 mb-8 text-sm print:gap-x-8 print:gap-y-1 print:mb-3 print-grid",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Employee Name"}),e.jsx("p",{className:"font-bold text-gray-900 text-lg border-b border-gray-200 pb-1 print:text-base",children:((f=t.user)==null?void 0:f.full_name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Designation"}),e.jsx("p",{className:"font-bold text-gray-900 text-lg border-b border-gray-200 pb-1",children:((S=(N=t.user)==null?void 0:N.staffProfile)==null?void 0:S.designation)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Department"}),e.jsx("p",{className:"font-medium text-gray-800",children:((a=(P=t.user)==null?void 0:P.staffProfile)==null?void 0:a.department)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Staff ID"}),e.jsx("p",{className:"font-medium text-gray-800",children:((E=(g=t.user)==null?void 0:g.staffProfile)==null?void 0:E.staff_number)||"N/A"})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-lg mb-8 grid grid-cols-3 gap-6 text-center print:bg-gray-50 print:border-gray-300 print:p-2 print:mb-4 print:gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Total Working Days"}),e.jsx("p",{className:"font-bold text-gray-900 text-lg",children:t.total_working_days||30}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"(Excl. Sundays & Holidays)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"LOP Days"}),e.jsx("p",{className:"font-bold text-red-600 text-lg",children:t.lop_days||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Paid Days"}),e.jsx("p",{className:"font-bold text-green-700 text-lg",children:(t.total_working_days||30)-(t.lop_days||0)})]})]}),e.jsxs("div",{className:"border border-gray-300 rounded overflow-hidden mb-8 print:mb-2 text-sm print:text-xs",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-gray-800 text-white",children:[e.jsx("div",{className:"p-3 font-semibold text-center border-r border-gray-600 print-table-header",children:"EARNINGS"}),e.jsx("div",{className:"p-3 font-semibold text-center print-table-header",children:"DEDUCTIONS"})]}),e.jsxs("div",{className:"grid grid-cols-2 text-sm print:text-xs",children:[e.jsxs("div",{className:"border-r border-gray-300",children:[e.jsx(x,{label:"Basic Salary",value:t.basic_salary}),e.jsx(x,{label:"HRA",value:t.hra}),e.jsx(x,{label:"Conveyance Allowance",value:t.conveyance_allowance}),e.jsx(x,{label:"Accommodation Allowance",value:t.accommodation_allowance}),e.jsx(x,{label:"Special Allowances",value:t.allowances}),e.jsx(x,{label:"Incentives / Bonus",value:t.incentives}),e.jsxs("div",{className:"p-4 flex justify-between font-bold border-t border-gray-300 bg-gray-50 mt-auto items-end print:p-2",children:[e.jsx("span",{children:"Total Earnings"}),e.jsxs("span",{children:["₹ ",ae(t).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(x,{label:"LOP Deduction",value:t.lop_deduction,isDeduction:!0}),e.jsx(x,{label:"Salary Advance Recovery",value:t.advance_salary,isDeduction:!0}),e.jsx(x,{label:"Other Deductions",value:t.other_deductions,isDeduction:!0}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"p-4 flex justify-between font-bold border-t border-gray-300 bg-gray-50 mt-auto items-end print:p-2",children:[e.jsx("span",{children:"Total Deductions"}),e.jsxs("span",{className:"text-red-600",children:["₹ ",ne(t).toLocaleString("en-IN")]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-900 print:bg-white print:border-2 print:border-black text-white print:text-black p-6 rounded-lg flex justify-between items-center shadow-lg mb-12 print-net-pay",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80 uppercase tracking-widest font-medium",children:"Net Payable Amount"}),e.jsx("p",{className:"text-xs opacity-60 print:opacity-100 hidden print:block",children:"(Earnings - Deductions)"})]}),e.jsxs("div",{className:"text-4xl font-bold tracking-tight print:text-3xl",children:["₹ ",t.net_pay.toLocaleString("en-IN")]})]})]})," ",e.jsx("div",{className:"p-8 pt-0",children:e.jsxs("div",{className:"border-t-2 border-dashed border-gray-300 pt-8 flex justify-between items-end text-xs text-gray-500",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900 mb-8 text-sm",children:"For Qix Ads"}),e.jsx("div",{className:"w-40 border-b border-gray-400"}),e.jsx("p",{className:"mt-1",children:"Authorized Signatory"})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{children:"This is a computer-generated document and does not require a physical signature."})})]})})]})})]})})},x=({label:t,value:u,isDeduction:h})=>e.jsxs("div",{className:"flex justify-between p-3 border-b last:border-0 hover:bg-gray-50/50 print:p-0.5 print-table-row",children:[e.jsx("span",{className:"text-gray-600",children:t}),e.jsx("span",{className:`font-medium ${h?"text-red-600":"text-gray-900"}`,children:u!==void 0?`₹ ${u.toLocaleString("en-IN")}`:"-"})]}),ae=t=>(t.basic_salary||0)+(t.hra||0)+(t.conveyance_allowance||0)+(t.accommodation_allowance||0)+(t.allowances||0)+(t.incentives||0),ne=t=>(t.lop_deduction||0)+(t.advance_salary||0)+(t.other_deductions||0),ue=()=>{const{user:t}=G(),u=(t==null?void 0:t.role)==="ADMIN"||(t==null?void 0:t.role)==="MANAGER"||(t==null?void 0:t.role)==="DEVELOPER_ADMIN",[h,m]=v.useState(null),[o,b]=v.useState("me"),[j,D]=v.useState(new Date().getFullYear().toString()),[y,$]=v.useState("all"),{data:k=[]}=F({queryKey:["staff-list"],queryFn:async()=>(await W.get("/team/staff")).data,enabled:u}),{data:f,isLoading:N}=F({queryKey:["payslips",o,j,y],queryFn:()=>{const a={year:j};return o!=="me"&&(a.userId=o),y!=="all"&&(a.month=y),W.get("/payroll/history",{params:a}).then(g=>g.data)}});if(N)return e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading payslips..."});const S=[{value:"all",label:"All Months"},{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}],P=[2024,2025,2026];return e.jsxs("div",{className:"space-y-6",children:[h&&e.jsx(te,{slip:h,onClose:()=>m(null)}),e.jsxs("div",{className:`flex flex-col md:flex-row gap-4 justify-between items-start md:items-center ${h?"print:hidden":""}`,children:[e.jsx("h2",{className:"text-xl font-bold",children:"My Payslips"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[u&&e.jsx("div",{className:"w-[200px]",children:e.jsxs(A,{value:o,onValueChange:b,children:[e.jsx(L,{children:e.jsx(I,{placeholder:"Select Staff"})}),e.jsxs(R,{children:[e.jsx(_,{value:"me",children:"My Payslips"}),k.map(a=>e.jsx(_,{value:a.user_id,children:a.user.full_name},a.user_id))]})]})}),e.jsx("div",{className:"w-[120px]",children:e.jsxs(A,{value:j,onValueChange:D,children:[e.jsx(L,{children:e.jsx(I,{placeholder:"Year"})}),e.jsx(R,{children:P.map(a=>e.jsx(_,{value:a.toString(),children:a},a))})]})}),e.jsx("div",{className:"w-[150px]",children:e.jsxs(A,{value:y,onValueChange:$,children:[e.jsx(L,{children:e.jsx(I,{placeholder:"Month"})}),e.jsx(R,{children:S.map(a=>e.jsx(_,{value:a.value,children:a.label},a.value))})]})})]})]}),e.jsx("div",{className:`bg-white shadow overflow-hidden sm:rounded-md ${h?"print:hidden":""}`,children:!f||f.length===0?e.jsx("div",{className:"p-12 text-center text-gray-500",children:"No payslips found for selected criteria."}):e.jsx("ul",{role:"list",className:"divide-y divide-gray-200",children:f.map(a=>{var g;return e.jsx("li",{className:"hover:bg-gray-50 transition",children:e.jsxs("div",{className:"px-4 py-4 sm:px-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-indigo-600 truncate",children:[new Date(0,a.run.month-1).toLocaleString("default",{month:"long"})," ",a.run.year]}),e.jsx("p",{className:"text-xs text-gray-500",children:(g=a.user)==null?void 0:g.full_name})]}),e.jsx("div",{className:"ml-2 flex-shrink-0 flex",children:e.jsx("p",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Paid"})})]}),e.jsxs("div",{className:"mt-2 sm:flex sm:justify-between items-center",children:[e.jsx("div",{className:"sm:flex",children:e.jsxs("p",{className:"flex items-center text-sm text-gray-500",children:["Net Pay: ",e.jsxs("span",{className:"font-medium text-gray-900 ml-1",children:["₹",a.net_pay.toLocaleString("en-IN")]})]})}),e.jsx("div",{className:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0 gap-4",children:e.jsxs("button",{onClick:()=>m(a),className:"flex items-center gap-1 text-gray-600 hover:text-gray-900 transition",children:[e.jsx(H,{className:"h-4 w-4"})," View Slip"]})})]})]})},a.id)})})})]})};export{ue as default};
