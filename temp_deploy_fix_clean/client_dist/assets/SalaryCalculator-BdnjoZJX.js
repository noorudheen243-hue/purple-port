import{u as B,r as x,j as e,q as U,x as A}from"./index-_K9dBzXA.js";import{u as Q,a1 as z,i as K,B as T,a0 as W,I as c}from"./index-C0_MxDCy.js";import{C as b,a as f,b as v,c as g}from"./card-BJXC2BmV.js";import{L as o}from"./label-Cxi2tPpM.js";import{S as w,a as S,b as k,c as L,d as j}from"./select-BsM-SyXO.js";import J from"./PayrollSettings-LSucza9s.js";import{D}from"./dollar-sign-k8ODSGZ6.js";import{A as I}from"./alert-circle-Dgl9YWib.js";import{S as X}from"./save-BPR9f-BE.js";import"./index-feRhg8F5.js";import"./index-I-cGsQdO.js";import"./table-CZtgpgQ3.js";const ie=()=>{const{user:d}=B();console.log("SalaryCalculator v2.2 Loaded");const E=(d==null?void 0:d.role)==="ADMIN"||(d==null?void 0:d.role)==="MANAGER"||(d==null?void 0:d.role)==="DEVELOPER_ADMIN",[N,O]=x.useState("CALCULATOR");if(!E)return e.jsx("div",{className:"p-8 text-center text-red-500",children:"You are not authorized to access this page."});const P=U(),[i,Y]=x.useState(""),[p,F]=x.useState(new Date().getMonth()+1),[h,R]=x.useState(new Date().getFullYear()),[u,V]=x.useState("MONTHLY"),{data:m}=Q({queryKey:["staff"],queryFn:()=>A.get("/team/staff").then(s=>s.data)}),{register:r,handleSubmit:H,setValue:_,watch:y,reset:M}=z({defaultValues:{basic_salary:0,hra:0,allowances:0,conveyance_allowance:0,accommodation_allowance:0,incentives:0,advance_salary:0,other_deductions:0,lop_days:0,lop_deduction:0,total_working_days:30,net_pay:0,calculation_date:void 0,days_in_period:0,is_prorated:!1,gross_total:0,daily_wage:0,payroll_type:"MONTHLY"}});x.useEffect(()=>{i&&p&&h&&m&&(async()=>{try{const l=m.find(q=>q.user_id===i),t=(await A.get("/payroll/draft",{params:{userId:i,month:p,year:h,payrollType:u}})).data;l&&M({basic_salary:t.basic_salary||l.base_salary||0,hra:t.hra||l.hra||0,conveyance_allowance:t.conveyance_allowance||l.conveyance_allowance||0,accommodation_allowance:t.accommodation_allowance||l.accommodation_allowance||0,allowances:t.allowances||0,incentives:t.incentives||0,advance_salary:t.advance_salary||0,other_deductions:t.other_deductions||0,lop_days:t.lop_days||0,lop_deduction:t.lop_deduction||0,total_working_days:t.total_working_days||30,net_pay:t.net_pay||0,calculation_date:t.calculation_date?new Date(t.calculation_date):void 0,days_in_period:t.days_in_period||0,is_prorated:t.is_prorated||!1,gross_total:t.gross_total||0,daily_wage:t.daily_wage||0,payroll_type:t.payroll_type||u})}catch(l){console.error("Failed to fetch salary data",l)}})()},[i,p,h,u,M,m]);const a=y();x.useEffect(()=>{(Number(a.basic_salary)||0)+(Number(a.hra)||0)+(Number(a.conveyance_allowance)||0)+(Number(a.accommodation_allowance)||0)+(Number(a.allowances)||0)+(Number(a.incentives)||0),Number(a.gross_total);const s=(Number(a.lop_deduction)||0)+(Number(a.advance_salary)||0)+(Number(a.other_deductions)||0);let l=Number(a.gross_total)||0;u==="MONTHLY"&&(l=(Number(a.basic_salary)||0)+(Number(a.hra)||0)+(Number(a.conveyance_allowance)||0)+(Number(a.accommodation_allowance)||0)+(Number(a.allowances)||0)+(Number(a.incentives)||0));const n=l-s;if(u==="MONTHLY")a.gross_total!==l&&_("gross_total",l),a.net_pay!==n&&_("net_pay",n);else{const t=(Number(a.gross_total)||0)-s;a.net_pay!==t&&_("net_pay",t)}},[a.basic_salary,a.hra,a.conveyance_allowance,a.accommodation_allowance,a.allowances,a.incentives,a.lop_deduction,a.advance_salary,a.other_deductions,a.gross_total,u,_]);const C=K({mutationFn:s=>A.post("/payroll/slip",{month:p,year:h,userId:i,data:{...s,payroll_type:u}}),onSuccess:()=>{alert("Payroll Stub Saved"),P.invalidateQueries({queryKey:["payroll-draft"]})},onError:s=>{var l,n;return alert(((n=(l=s.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to save")}}),G=s=>{C.mutate(s)};return e.jsxs("div",{className:"p-6 space-y-8 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex gap-4 mb-2",children:[e.jsxs(T,{onClick:()=>O("CALCULATOR"),className:N==="CALCULATOR"?"bg-purple-700 text-white hover:bg-purple-800 shadow-md":"bg-purple-100 text-purple-700 hover:bg-purple-200 border-purple-200 variant='outline'",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Salary Calculator"]}),e.jsxs(T,{onClick:()=>O("SETTINGS"),className:N==="SETTINGS"?"bg-yellow-500 text-white hover:bg-yellow-600 shadow-md":"bg-yellow-100 text-yellow-700 hover:bg-yellow-200 border-yellow-200 variant='outline'",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Payroll Settings"]})]}),N==="SETTINGS"&&e.jsx("div",{className:"animate-in fade-in slide-in-from-left-4 duration-300",children:e.jsx(J,{})}),N==="CALCULATOR"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-b pb-6",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Salary Calculator"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{value:u,onValueChange:s=>V(s),children:[e.jsx(S,{className:"w-[140px] bg-background",children:e.jsx(k,{placeholder:"Type"})}),e.jsxs(L,{children:[e.jsx(j,{value:"MONTHLY",children:"Monthly"}),e.jsx(j,{value:"TILL_DATE",children:"Till Date"})]})]}),e.jsxs(w,{value:p.toString(),onValueChange:s=>F(parseInt(s)),children:[e.jsx(S,{className:"w-[120px] bg-background",children:e.jsx(k,{placeholder:"Month"})}),e.jsx(L,{children:Array.from({length:12},(s,l)=>e.jsx(j,{value:(l+1).toString(),children:new Date(0,l).toLocaleString("default",{month:"long"})},l+1))})]}),e.jsxs(w,{value:h.toString(),onValueChange:s=>R(parseInt(s)),children:[e.jsx(S,{className:"w-[100px] bg-background",children:e.jsx(k,{placeholder:"Year"})}),e.jsx(L,{children:Array.from({length:5},(s,l)=>{const n=new Date().getFullYear()-2+l;return e.jsx(j,{value:n.toString(),children:n},n)})})]})]})]}),e.jsxs(b,{children:[e.jsx(f,{children:e.jsx(v,{children:"Staff Selection"})}),e.jsx(g,{children:e.jsxs(w,{value:i,onValueChange:Y,children:[e.jsx(S,{children:e.jsx(k,{placeholder:"Select Staff Member"})}),e.jsx(L,{className:"max-h-[300px] overflow-y-auto",children:m==null?void 0:m.map(s=>e.jsxs(j,{value:s.user_id,children:[s.user.full_name," - ",s.designation]},s.user_id))})]})})]}),i&&a.is_prorated&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx(I,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-1",children:"Pro-rated Calculation"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Salary calculated for ",e.jsxs("strong",{children:[a.days_in_period||0," days"]})," (1st to ",a.calculation_date?new Date(a.calculation_date).toLocaleDateString("en-IN",{month:"short",day:"numeric",year:"numeric"}):"today",").",e.jsx("br",{}),"LOP and deductions are based on attendance data up to this date."]})]})]})}),i&&e.jsxs("form",{onSubmit:H(G),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(b,{className:"border-green-200 dark:border-green-900",children:[e.jsx(f,{className:"bg-green-50 dark:bg-green-950/20",children:e.jsxs(v,{className:"text-green-700 dark:text-green-400 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"})," Earnings"]})}),e.jsx(g,{className:"space-y-4 pt-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{children:["Basic Salary ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Locked)"})]}),e.jsx(c,{type:"number",...r("basic_salary"),readOnly:!0,className:"bg-muted text-muted-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{children:["HRA ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Locked)"})]}),e.jsx(c,{type:"number",...r("hra"),readOnly:!0,className:"bg-muted text-muted-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{children:["Conveyance ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Locked)"})]}),e.jsx(c,{type:"number",...r("conveyance_allowance"),readOnly:!0,className:"bg-muted text-muted-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{children:["Accommodation ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Locked)"})]}),e.jsx(c,{type:"number",...r("accommodation_allowance"),readOnly:!0,className:"bg-muted text-muted-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Allowance (Misc)"}),e.jsx(c,{type:"number",...r("allowances")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Incentives"}),e.jsx(c,{type:"number",...r("incentives")})]})]})})]}),e.jsxs(b,{className:"border-purple-200 dark:border-purple-900 md:col-span-2",children:[e.jsx(f,{className:"bg-purple-50 dark:bg-purple-950/20",children:e.jsxs(v,{className:"text-purple-700 dark:text-purple-400 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"})," Gross Total (Before Deductions)"]})}),e.jsx(g,{className:"pt-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-900 dark:to-purple-800 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300 mb-2 font-semibold",children:"GROSS TOTAL"}),e.jsxs("p",{className:"text-4xl font-bold text-purple-900 dark:text-purple-50",children:["₹",(y("gross_total")||0).toLocaleString("en-IN")]}),e.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-300 mt-2",children:"Auto-calculated based on salary structure and days worked"})]})})]}),e.jsxs(b,{className:"border-red-200 dark:border-red-900",children:[e.jsx(f,{className:"bg-red-50 dark:bg-red-950/20",children:e.jsxs(v,{className:"text-red-700 dark:text-red-400 flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"})," Deductions"]})}),e.jsxs(g,{className:"space-y-4 pt-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-red-100 dark:bg-red-900/30 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block font-semibold text-red-900 dark:text-red-200",children:"Auto-LOP Days"}),e.jsx("span",{className:"text-xs text-red-700 dark:text-red-300",children:"Derived from Attendance"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-700 dark:text-red-400",children:Number(y("lop_days"))}),e.jsx("input",{type:"hidden",...r("lop_days")})]}),e.jsxs("div",{className:"p-4 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block font-semibold text-blue-900 dark:text-blue-200",children:"Total Working Days"}),e.jsx("span",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Days - Sundays - Holidays"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-400",children:Number(y("total_working_days"))||30}),e.jsx("input",{type:"hidden",...r("total_working_days")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"LOP Deduction (Auto)"}),e.jsx(c,{type:"number",...r("lop_deduction"),readOnly:!0,className:"bg-muted"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Calculated based on LOP Days"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Salary Advance (Ledger)"}),e.jsx(c,{type:"number",...r("advance_salary"),readOnly:!0,className:"bg-muted"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Fetched from Accounting Ledger"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Other Deductions"}),e.jsx(c,{type:"number",...r("other_deductions")})]})]})]})]}),e.jsx(b,{className:"md:col-span-2 bg-slate-900 text-white",children:e.jsxs(g,{className:"p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-slate-300",children:"Net Payable"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Earnings - Deductions"})]}),e.jsxs("div",{className:"text-4xl font-bold text-white",children:["₹ ",Math.max(0,Number(y("net_pay"))).toLocaleString("en-IN")]}),e.jsxs(T,{size:"lg",className:"bg-green-500 hover:bg-green-600 text-white",disabled:C.isPending,children:[e.jsx(X,{className:"w-5 h-5 mr-2"}),C.isPending?"Saving...":"Save Payroll Stub"]})]})})]})]})]})};export{ie as default};
