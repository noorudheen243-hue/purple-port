import{u as D,r as g,j as e,x as u}from"./index-_K9dBzXA.js";import{u as y,B as L,Y as C}from"./index-C0_MxDCy.js";import{C as I,c as T}from"./card-BJXC2BmV.js";import{T as E,a as O,b as i,c as r,d as P,e as s}from"./table-CZtgpgQ3.js";import{S as N,a as _,b as S,c as f,d as x}from"./select-BsM-SyXO.js";import{u as h,w as Y}from"./xlsx-DrgRuPKf.js";import"./index-feRhg8F5.js";import"./index-I-cGsQdO.js";const V=()=>{const{user:n}=D(),m=(n==null?void 0:n.role)==="ADMIN"||(n==null?void 0:n.role)==="MANAGER"||(n==null?void 0:n.role)==="DEVELOPER_ADMIN",[o,w]=g.useState("me"),[d,v]=g.useState(new Date().getFullYear().toString()),{data:b=[]}=y({queryKey:["staff-list"],queryFn:async()=>(await u.get("/team/staff")).data,enabled:m}),{data:l=[],isLoading:p}=y({queryKey:["salary-statement",o,d],queryFn:async()=>{const t={year:d};return o!=="me"&&(t.userId=o),(await u.get("/payroll/history",{params:t})).data}}),A=()=>{const t=h.json_to_sheet(l.map(a=>({Month:new Date(0,a.run.month-1).toLocaleString("default",{month:"long"}),Year:a.run.year,Basic:a.basic_salary,HRA:a.hra,Conveyance:a.conveyance_allowance,Accommodation:a.accommodation_allowance,Allowances:a.allowances,Incentives:a.incentives,Gross:j(a),LOP_Days:a.lop_days,LOP_Ded:a.lop_deduction,Advance:a.advance_salary,Other_Ded:a.other_deductions,Net_Pay:a.net_pay}))),c=h.book_new();h.book_append_sheet(c,t,"Salary Statement"),Y(c,`Salary_Statement_${d}.xlsx`)},j=t=>(t.basic_salary||0)+(t.hra||0)+(t.conveyance_allowance||0)+(t.accommodation_allowance||0)+(t.allowances||0)+(t.incentives||0);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Annual Salary Statement"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[m&&e.jsx("div",{className:"w-[200px]",children:e.jsxs(N,{value:o,onValueChange:w,children:[e.jsx(_,{children:e.jsx(S,{placeholder:"Select Staff"})}),e.jsxs(f,{children:[e.jsx(x,{value:"me",children:"My Statement"}),b.map(t=>e.jsx(x,{value:t.user_id,children:t.user.full_name},t.user_id))]})]})}),e.jsx("div",{className:"w-[100px]",children:e.jsxs(N,{value:d,onValueChange:v,children:[e.jsx(_,{children:e.jsx(S,{placeholder:"Year"})}),e.jsx(f,{children:Array.from({length:5},(t,c)=>{const a=new Date().getFullYear()-2+c;return e.jsx(x,{value:a.toString(),children:a},a)})})]})}),e.jsxs(L,{variant:"outline",onClick:A,disabled:l.length===0,children:[e.jsx(C,{className:"w-4 h-4 mr-2"})," Export"]})]})]}),e.jsx(I,{children:e.jsx(T,{className:"p-0 overflow-x-auto",children:e.jsxs(E,{children:[e.jsx(O,{children:e.jsxs(i,{children:[e.jsx(r,{children:"Month"}),e.jsx(r,{className:"text-right",children:"Basic"}),e.jsx(r,{className:"text-right",children:"HRA"}),e.jsx(r,{className:"text-right",children:"Conv."}),e.jsx(r,{className:"text-right",children:"Accomm."}),e.jsx(r,{className:"text-right",children:"Allow."}),e.jsx(r,{className:"text-right",children:"Incent."}),e.jsx(r,{className:"text-right font-bold text-gray-700",children:"GROSS"}),e.jsxs(r,{className:"text-right text-red-600",children:["LOP (",l.length>0?"Days":"",")"]}),e.jsx(r,{className:"text-right text-red-600",children:"LOP Amt"}),e.jsx(r,{className:"text-right text-red-600",children:"Adv."}),e.jsx(r,{className:"text-right text-red-600",children:"Other"}),e.jsx(r,{className:"text-right font-bold bg-gray-50",children:"NET PAY"})]})}),e.jsx(P,{children:p?e.jsx(i,{children:e.jsx(s,{colSpan:13,className:"text-center h-24",children:"Loading statement..."})}):l.length===0?e.jsx(i,{children:e.jsx(s,{colSpan:13,className:"text-center h-24 text-muted-foreground",children:"No data found for selected year."})}):l.map(t=>e.jsxs(i,{children:[e.jsx(s,{children:new Date(0,t.run.month-1).toLocaleString("default",{month:"short"})}),e.jsx(s,{className:"text-right",children:t.basic_salary}),e.jsx(s,{className:"text-right",children:t.hra}),e.jsx(s,{className:"text-right",children:t.conveyance_allowance}),e.jsx(s,{className:"text-right",children:t.accommodation_allowance}),e.jsx(s,{className:"text-right",children:t.allowances}),e.jsx(s,{className:"text-right",children:t.incentives}),e.jsx(s,{className:"text-right font-bold bg-green-50",children:j(t).toLocaleString("en-IN")}),e.jsx(s,{className:"text-right text-red-600 font-medium",children:t.lop_days>0?`${t.lop_days}`:"-"}),e.jsx(s,{className:"text-right text-red-600",children:t.lop_deduction>0?t.lop_deduction:"-"}),e.jsx(s,{className:"text-right text-red-600",children:t.advance_salary>0?t.advance_salary:"-"}),e.jsx(s,{className:"text-right text-red-600",children:t.other_deductions>0?t.other_deductions:"-"}),e.jsx(s,{className:"text-right font-bold bg-gray-100",children:t.net_pay.toLocaleString("en-IN")})]},t.id))})]})})})]})};export{V as default};
