import{r,j as e,D as O,x as h}from"./index-_K9dBzXA.js";import{u as F,i as y,j as P,l as R,X as A}from"./index-C0_MxDCy.js";import{f as N}from"./format-D4js0obD.js";import{C as L,c as _}from"./card-BJXC2BmV.js";import{C as v}from"./ConfirmationModal-CBglAdUX.js";import{F as $}from"./filter-t9sSzATh.js";import{P as I}from"./pencil-Cl0nWfVN.js";import{S as q}from"./save-BPR9f-BE.js";const J=()=>{const[n,m]=r.useState({start:"",end:""}),[l,f]=r.useState({limit:20,start:"",end:""}),[C,u]=r.useState(!1),[i,g]=r.useState(null),[w,o]=r.useState(!1),[s,d]=r.useState(null),[D,x]=r.useState(!1),{data:a,isLoading:j,refetch:c}=F({queryKey:["transactions",l],queryFn:async()=>{const t={limit:l.limit};return l.start&&(t.start_date=l.start),l.end&&(t.end_date=l.end),(await h.get("/accounting/transactions",{params:t})).data}}),b=y({mutationFn:async t=>h.delete(`/accounting/transactions/${t}`),onSuccess:()=>{u(!1),g(null),c()},onError:t=>alert("Failed to delete: "+t.message)}),p=y({mutationFn:async t=>h.put(`/accounting/transactions/${t.id}`,t),onSuccess:()=>{x(!1),o(!1),d(null),c()},onError:t=>alert("Failed to update: "+t.message)}),S=()=>{f({limit:100,start:n.start,end:n.end}),setTimeout(c,100)},E=t=>{g(t),u(!0)},k=t=>{d({id:t.id,description:t.description,date:t.date.split("T")[0],reference:t.reference,amount:t.amount}),o(!0)},T=()=>{s&&x(!0)},M=()=>{p.mutate({id:s.id,description:s.description,date:new Date(s.date).toISOString(),reference:s.reference,amount:parseFloat(s.amount)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Transaction History"}),e.jsx(L,{children:e.jsxs(_,{className:"p-4 flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"From Date"}),e.jsx("input",{type:"date",className:"w-full bg-background border rounded-md px-3 py-2",value:n.start,onChange:t=>m({...n,start:t.target.value})})]}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"To Date"}),e.jsx("input",{type:"date",className:"w-full bg-background border rounded-md px-3 py-2",value:n.end,onChange:t=>m({...n,end:t.target.value})})]}),e.jsxs("button",{onClick:S,className:"bg-primary text-primary-foreground px-6 py-2 rounded-md hover:bg-primary/90 flex items-center gap-2 h-10",children:[e.jsx($,{className:"w-4 h-4"})," Generate History"]}),e.jsxs("button",{onClick:()=>{m({start:"",end:""}),f({limit:20,start:"",end:""}),c()},className:"border px-4 py-2 rounded-md hover:bg-secondary flex items-center gap-2 h-10",title:"Reset to Last 20",children:[e.jsx(O,{className:"w-4 h-4"})," Reset"]})]})}),e.jsx("div",{className:"bg-card rounded-lg border shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted text-muted-foreground font-medium border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"ID"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3",children:"Description"}),e.jsx("th",{className:"px-4 py-3",children:"Type"}),e.jsx("th",{className:"px-4 py-3",children:"Debit (To)"}),e.jsx("th",{className:"px-4 py-3",children:"Credit (From)"}),e.jsx("th",{className:"px-4 py-3",children:"Ref"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:j?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-muted-foreground",children:"Loading transactions..."})}):(a==null?void 0:a.length)===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-muted-foreground",children:"No transactions found."})}):a==null?void 0:a.map(t=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-mono text-xs",children:t.transaction_number||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:P(new Date(t.date),"dd/MM/yyyy")}),e.jsx("td",{className:"px-4 py-3 font-medium",children:t.description}),e.jsx("td",{className:"px-4 py-3 text-xs uppercase badge",children:e.jsx("span",{className:`px-2 py-0.5 rounded font-medium ${t.type==="INCOME"?"bg-green-100 text-green-700 border border-green-200":t.type==="EXPENSE"?"bg-red-100 text-red-700 border border-red-200":"bg-secondary text-foreground"}`,children:t.type})}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground",children:t.debit_ledgers}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground",children:t.credit_ledgers}),e.jsx("td",{className:"px-4 py-3 text-xs font-mono",children:t.reference||"-"}),e.jsx("td",{className:`px-4 py-3 text-right font-mono font-bold ${t.type==="INCOME"?"text-green-600":t.type==="EXPENSE"?"text-red-600":""}`,children:N(t.amount)}),e.jsxs("td",{className:"px-4 py-3 text-center flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>k(t),className:"p-1.5 hover:bg-blue-100 text-blue-600 rounded transition-colors",title:"Edit Details",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>E(t),className:"p-1.5 hover:bg-red-100 text-red-600 rounded transition-colors",title:"Delete (Reverse Transaction)",children:e.jsx(R,{className:"w-4 h-4"})})]})]},t.id))})]})}),!j&&(a==null?void 0:a.length)>=20&&!n.start&&e.jsx("div",{className:"text-center text-xs text-muted-foreground pt-2",children:"Showing last 20 transactions. Use date filters to see more."}),w&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background p-6 rounded-lg w-full max-w-md space-y-4 shadow-lg border",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Edit Transaction"}),e.jsx("button",{onClick:()=>o(!1),children:e.jsx(A,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date"}),e.jsx("input",{type:"date",className:"w-full border rounded p-2 bg-background",value:s.date,onChange:t=>d({...s,date:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("input",{className:"w-full border rounded p-2 bg-background",value:s.description,onChange:t=>d({...s,description:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Reference"}),e.jsx("input",{className:"w-full border rounded p-2 bg-background",value:s.reference||"",onChange:t=>d({...s,reference:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Amount"}),e.jsx("input",{type:"number",className:"w-full border rounded p-2 bg-background font-mono",value:s.amount,onChange:t=>d({...s,amount:t.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Changing this updates associated ledger balances."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 border rounded hover:bg-secondary",children:"Cancel"}),e.jsxs("button",{onClick:T,disabled:p.isPending,className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90 flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"})," Save Changes"]})]})]})}),e.jsx(v,{isOpen:C,onClose:()=>u(!1),onConfirm:()=>b.mutate(i.id),title:"Delete Transaction?",message:`Are you sure you want to delete this transaction for ${N(i==null?void 0:i.amount)}? This will reverse the balances in the ledgers.`,confirmLabel:b.isPending?"Deleting...":"Delete Permanently",isDestructive:!0}),e.jsx(v,{isOpen:D,onClose:()=>x(!1),onConfirm:M,title:"Confirm Changes",message:"Are you sure you want to edit this transaction? Changing financial details will automatically update the linked ledger balances.",confirmLabel:p.isPending?"Saving...":"Confim & Save",isDestructive:!1})]})};export{J as default};
