import{u as z,r as i,j as e,x as q}from"./index-_K9dBzXA.js";import{C as M,a as T,b as D,d as I,c as L}from"./card-BJXC2BmV.js";import{R as u,ag as p,m as g,aL as F,a3 as O,I as j,B as R,aM as A,S as c,U as V,n as H}from"./index-C0_MxDCy.js";import{L as f}from"./label-Cxi2tPpM.js";import{T as B,a as k,b as t,c as r}from"./tabs-BB7NwzE5.js";import Y from"./SystemRoleManagement-DxVj39qg.js";import W from"./PayrollSettings-LSucza9s.js";import Z from"./DataSync-B8x-zcFK.js";import{A as E}from"./alert-circle-Dgl9YWib.js";import"./index-CemV9wER.js";import"./index-feRhg8F5.js";import"./loader-2-m9uN2hHg.js";import"./table-CZtgpgQ3.js";import"./save-BPR9f-BE.js";const oe=()=>{const{user:s}=z(),[y,w]=i.useState(""),[d,b]=i.useState(""),[N,v]=i.useState(""),[C,S]=i.useState(!1),[m,l]=i.useState(null),h=(s==null?void 0:s.role)===u.DEVELOPER_ADMIN,U=async a=>{var n,o;if(a.preventDefault(),l(null),d!==N){l({type:"error",text:"New passwords don't match"});return}if(d.length<6){l({type:"error",text:"Password must be at least 6 characters"});return}try{S(!0),await q.post("/auth/change-password",{currentPassword:y,newPassword:d}),l({type:"success",text:"Password changed successfully!"}),w(""),b(""),v("")}catch(x){l({type:"error",text:((o=(n=x.response)==null?void 0:n.data)==null?void 0:o.message)||"Failed to change password"})}finally{S(!1)}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account and system preferences."})]}),e.jsxs(B,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(k,{className:"bg-muted p-1 rounded-lg",children:[e.jsxs(t,{value:"profile",className:"flex items-center gap-2",children:[e.jsx(p,{size:16})," My Security"]}),h&&e.jsxs(t,{value:"system",className:"flex items-center gap-2",children:[e.jsx(g,{size:16})," System Control"]}),(h||(s==null?void 0:s.role)===u.ADMIN)&&e.jsxs(t,{value:"maintenance",className:"flex items-center gap-2",children:[e.jsx(F,{size:16})," Maintenance"]})]}),e.jsx(r,{value:"profile",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:e.jsxs(M,{children:[e.jsxs(T,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5 text-purple-600"}),"Change Password"]}),e.jsx(I,{children:"Update your password to keep your account secure."})]}),e.jsx(L,{children:e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[m&&e.jsxs("div",{className:`p-3 rounded-md text-sm flex items-center gap-2 ${m.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[m.type==="success"?e.jsx(O,{className:"h-4 w-4"}):e.jsx(E,{className:"h-4 w-4"}),m.text]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"current",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(j,{id:"current",type:"password",className:"pl-9",value:y,onChange:a=>w(a.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"new",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(j,{id:"new",type:"password",className:"pl-9",value:d,onChange:a=>b(a.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"confirm",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(j,{id:"confirm",type:"password",className:"pl-9",value:N,onChange:a=>v(a.target.value),required:!0})]})]}),e.jsx(R,{type:"submit",disabled:C,className:"w-full",children:C?"Updating...":"Change Password"})]})})]})})}),(h||(s==null?void 0:s.role)===u.ADMIN)&&e.jsx(r,{value:"maintenance",children:e.jsxs(M,{children:[e.jsxs(T,{children:[e.jsxs(D,{className:"flex items-center gap-2 text-orange-700",children:[e.jsx(E,{className:"h-5 w-5"}),"System Maintenance"]}),e.jsx(I,{children:"Perform critical system operations to ensure application health."})]}),e.jsx(L,{className:"space-y-6",children:e.jsxs("div",{className:"p-4 border border-orange-200 bg-orange-50 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[e.jsx(A,{size:18}),"Clear Application Cache"]}),e.jsx("p",{className:"text-sm text-orange-700 mb-4",children:"Use this if you are experiencing synchronization issues, missing features after an update, or display errors. This will force a reload of the application and clear local data."}),e.jsx(R,{variant:"destructive",onClick:()=>{c.fire({title:"Clear System Cache?",text:"This will clear local storage, session data, and force a hard reload. You may be logged out.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, Clear & Reload"}).then(a=>{if(a.isConfirmed){const n=localStorage.getItem("theme");localStorage.clear(),n&&localStorage.setItem("theme",n),sessionStorage.clear();let o;c.fire({title:"Clearing Cache...",html:"Reloading system in <b></b> milliseconds.",timer:1500,timerProgressBar:!0,didOpen:()=>{var P;c.showLoading();const x=(P=c.getHtmlContainer())==null?void 0:P.querySelector("b");o=setInterval(()=>{x&&(x.textContent=String(c.getTimerLeft()))},100)},willClose:()=>{clearInterval(o)}}).then(()=>{window.location.reload()})}})},children:"Clear Cache & Reload"})]})})]})}),h&&e.jsxs(r,{value:"system",className:"space-y-6",children:[e.jsxs("div",{className:"bg-yellow-50/50 border border-yellow-100 rounded-lg p-4 mb-6 flex gap-3 text-yellow-800 text-sm",children:[e.jsx(g,{className:"h-5 w-5 shrink-0"}),e.jsxs("p",{children:[e.jsx("strong",{children:"System Control Zone:"})," Changes made here affect the entire system structure. Use with caution."]})]}),e.jsxs(B,{defaultValue:"roles",className:"w-full",children:[e.jsxs(k,{className:"w-full justify-start border-b rounded-none bg-transparent p-0 mb-6 h-auto",children:[e.jsxs(t,{value:"roles",className:"data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none border-b-2 border-transparent rounded-none pb-2 px-4 font-medium",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Role Management"]}),e.jsxs(t,{value:"payroll",className:"data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none border-b-2 border-transparent rounded-none pb-2 px-4 font-medium",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Payroll Config"]}),e.jsxs(t,{value:"sync",className:"data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none border-b-2 border-transparent rounded-none pb-2 px-4 font-medium",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Data Sync"]})]}),e.jsx(r,{value:"roles",className:"mt-0",children:e.jsx(Y,{})}),e.jsx(r,{value:"payroll",className:"mt-0",children:e.jsx(W,{})}),e.jsx(r,{value:"sync",className:"mt-0",children:e.jsx(Z,{})})]})]})]})]})};export{oe as default};
